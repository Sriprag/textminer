IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 11, NOVEMBER 2014

2679

A System and Method for Online High-Resolution
Mapping of Gastric Slow-Wave Activity
Simon H. Bull, Gregory O’Grady, Peng Du, and Leo K. Cheng∗

Abstract—High-resolution (HR) mapping employs multielectrode arrays to achieve spatially detailed analyses of propagating bioelectrical events. A major current limitation is that spatial
analyses must currently be performed “off-line” (after experiments), compromising timely recording feedback and restricting experimental interventions. These problems motivated
development of a system and method for “online” HR mapping. HR
gastric recordings were acquired and streamed to a novel software
client. Algorithms were devised to filter data, identify slow-wave
events, eliminate corrupt channels, and cluster activation events. A
graphical user interface animated data and plotted electrograms
and maps. Results were compared against off-line methods. The
online system analyzed 256-channel serosal recordings with no unexpected system terminations with a mean delay 18 s. Activation
time marking sensitivity was 0.92; positive predictive value was
0.93. Abnormal slow-wave patterns including conduction blocks,
ectopic pacemaking, and colliding wave fronts were reliably identified. Compared to traditional analysis methods, online mapping
had comparable results with equivalent coverage of 90% of electrodes, average RMS errors of less than 1 s, and CC of activation
maps of 0.99. Accurate slow-wave mapping was achieved in near
real-time, enabling monitoring of recording quality and experimental interventions targeted to dysrhythmic onset. This work also
advances the translation of HR mapping toward real-time clinical
application.
Index Terms—Dysrhythmia, gastric electrical activity, interstitial cells of Cajal, software, visualization.

I. INTRODUCTION
ASTRIC motility is regulated by slow-wave activity,
generated and propagated by interstitial cells of Cajal,
and dysrhythmic slow-wave activity is associated with gastric

G

Manuscript received February 9, 2014; revised April 29, 2014; accepted
March 31, 2014. Date of publication May 20, 2014; date of current version
October 16, 2014. This work was supported in part by the NIH (R01 DK64775),
in part by the Health Research Council, New Zealand, in part by a Marsden
Fast-Start Grant, and in part by a New Zealand Postdoctoral Fellowship. Asterisk
indicates corresponding author.
S. H. Bull was with the Auckland Bioengineering Institute, University
of Auckland, Auckland 1010, New Zealand. He is now with the Technical
University of Denmark, Copenhagen 2800, Denmark (e-mail: simonhbull@
gmail.com).
G. O’Grady was with the Auckland Bioengineering Institute, University of
Auckland, Auckland 1010, New Zealand. He is now with Westmeade Hospital,
Sydney, N.S.W 2145, Australia (e-mail: ogrady.greg@gmail.com).
P. Du is with the Auckland Bioengineering Institute, University of Auckland,
Auckland 1010, New Zealand (e-mail: peng.du@auckland.ac.nz).
∗ L. K. Cheng is with the Auckland Bioengineering Institute, University of Auckland, Auckland 1010, New Zealand, and also with Department of Surgery,Vanderbilt University, Nashville, TN 37235 USA (e-mail:
l.cheng@auckland.ac.nz).
This
paper
has
supplementary
material
downloadable
at
http://ieeexplore.ieee.org (File size: 9.4 mb).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2014.2325829

dysmotility [1], [2]. High-resolution (HR) electrical mapping
enables the analysis of slow-wave activation sequences in spatiotemporal detail. Arrays of multiple electrodes are used to
simultaneously or sequentially record extracellular potentials at
multiple sites, so that propagation patterns can be reconstructed
from the activation times detected at each electrode [3], [4]. HR
mapping has been extensively applied to define normal and aberrant slow-wave patterns in animal models [5], [6], and recently
in humans [7], [8].
A major current barrier to progress in experimental and clinical HR slow-wave mapping is the inability to perform analyses
“online,” i.e., during the recordings. At present, only selected
electrograms can be viewed during experiments, while all spatial and graphical representations of the data must be performed
after recordings have been completed [9]. This restriction is
a particularly significant limitation to trialing therapeutic investigations, because manipulations such as gastric pacing for
dysrhythmia ideally require immediate feedback of the transient
and dynamic responses in slow-wave activity [10]. In addition,
suboptimal electrode positioning currently goes undetected during experiments, potentially compromising outcomes.
Online electrophysiological analysis tools that allow near
real-time HR mapping are in routine clinical usage in cardiology,
enabling clinicians to diagnose and treat cardiac dysrhythmias
in their intervention suites [11], [12]. This clinical paradigm is
also a feasible vision for gastric dysrhythmia, and the development of an online analysis platform would be a significant
translational step. However, existing cardiac approaches cannot
simply be adapted for gastric slow-wave analyses, due to the
differences in slow-wave propagation and signal characteristics
[13], [14]. Recently, a series of studies have presented robust
event identification, cycle partitioning, and mapping algorithms
specific for enabling automated slow-wave analyses, but the
complexity means their computational demand is unsuitable for
online usage [9], [13], [14].
This study addresses the above problems by presenting a new
system and method for online HR gastric slow-wave mapping.
Specifically, this study presents the following advances: 1) a
simplified, robust and computationally efficient adaptation of
existing slow-wave identification and partitioning algorithms
suitable for online use; 2) a statistical method for calculating
the likelihood of accurate event detection occurring in a particular channel, allowing the online identification and elimination
of channels containing false-positive (FP) data to improve mapping accuracy; and 3) a user-friendly software package for online
mapping, which can be readily integrated with existing methods
of HR data acquisition. The developed system and method was
tested in vivo in a porcine model, and validated against existing

0018-9294 © 2014 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

2680

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 11, NOVEMBER 2014

Fig. 2. Detection of slow-wave events. (a) Filtered signal trace and (b) the
corresponding “detection signal” gives a short positive response to the downward
slope of extracellular gastric slow-wave events (indicating a wave front passing
under the electrode), and a much smaller response to the alternative downward
deflections of competing noise.

B. Event Detection
Fig. 1. Flowchart illustrating the system developed to process online HR slowwave data. The signal input is shown in a light oval, the processing modules in
rectangles, and the outputs in dark ovals.

off-line and manual analysis approaches. Aspects of this software and preliminary results have previously been reported in
abstract form at an IEEE EMBS conference [15].
II. METHODS
A flowchart outlining the system of online mapping developed
here is illustrated in Fig. 1. Steps in the workflow are detailed
in the subsequent sections.
A. Filtering
Sources of noise in extracellular recordings, such as cardiac
activity (1 Hz), baseline drift (<0.2 Hz), and main interference (50/60 Hz), may be reduced by filtering [16]. An online
signal filtering strategy was devised based on a selection of previous off-line filtering practices [16], [17] that were deemed
most suitable for online analyses due to their computational efficiency. Input signals were first down sampled to 32 Hz using a
Chebyshev type 1 filter to reduce data volumes (see the Appendix) [18]. Low-frequency drift was removed using a long
finite impulse response (FIR) filter [18]. An FIR filter was
selected due to its speed, and to reduce the size of the computational buffer required to store the processed information
compared to off-line methods [9]. A second-order Butterworth
filter (high-frequency cutoff 1 Hz) was then applied for highfrequency noise [16].

Accurate detection of activation times (ATs) is fundamental
to extracellular potential mapping [19]. The AT indicates the
arrival of a propagating wave front under an electrode, and corresponds to the maximum negative gradient of an extracellular
event [20]. Erickson et al. [13], [14] previously presented an
algorithm for the off-line detection of slow-wave ATs, termed
the “Falling-Edge Variable-Threshold” (FEVT) method, which
remains accurate in the presence of moderate noise. In order
to apply the FEVT method in online detection, we made the
modifications detailed below (see the Appendix for equations).
Essential to FEVT is a signal transform termed the “nonlinear energy operator” (NEO) [21], which was also applied to the
online signals. The NEO transform generates a strong response
to the rapid downward deflection of the extracellular slow-wave
event [13]. The NEO signal was smoothed and piece-wise multiplied with a further signal obtained by convolving the same
input signal with an “edge detection kernel” (detailed in [13]),
giving a “detection signal.” The detection signal provides brief
positive spikes corresponding to slow-wave ATs, and a much
smaller response to deflections of noise (e.g., see Fig. 2).
The FEVT method further included a variable threshold for
AT identification, based on signal intensity [13]. However, this
variable threshold method was unsuitable for online use because it was calculated from the complete recorded signals.
Instead, the online threshold was calculated by a median absolution deviation method [22] but using a mean calculation
method instead of median for computational efficiency (see the
Appendix). “Candidate ATs” were identified when the detection signal exceeded an empirically defined (species-specific)
threshold. Only the candidate AT of highest magnitude within a
specified time window was then marked for further processing,

BULL et al.: SYSTEM AND METHOD FOR ONLINE HIGH-RESOLUTION MAPPING OF GASTRIC SLOW-WAVE ACTIVITY

2681

with the remainder being discarded. This step prevented multiple ATs being detected within a short period which is usually not
physiological, except during instances of slow-wave reentry or
wave collisions, which may generate “double potentials” [6]).
C. Detection of Signal Fidelity
A novel signal fidelity measure was introduced for online
recordings. Due to areas of quiescence in the normal stomach,
it is not always immediately obvious experimentally whether
a recording channel containing no signal has poor contact, or
is over an inactive region [7], [23], [24]. The FEVT algorithm
may report FPs in such channels, due to the “variable threshold,”
causing a response to a lack of true-positive (TP) events in the
presence of noise [13]. These FPs do not presented a major
problem during off-line analysis, because they can be manually
removed given sufficient time, but it is critical to minimize FPs
online to provide accurate data, and particularly because FPs
distort automated mapping analyses [14], [22].
A novel approach to assessing signal fidelity online was developed by assessing a moving estimate of signal “kurtosis”
[25]. A kurtosis-based approach was chosen based on the observation that signals recording TP events generally show a small
range with periodic slow-wave deflections, whereas channels
recording FPs tend to show a more consistent variation around
a mean value, representing random noise or ventilator signal
[13]. Additional information on the kurtosis method is provided
in the Appendix.
D. Cycle Clustering
The traditional outputs of mapping are isochronal activation
maps to quantify electrical propagation sequences. Activation
maps effectively condense a large volume of information into a
format that is easily and rapidly read by the user [12]. However,
in order to generate activation maps, it is first essential to group
together (cluster) all ATs that arise from each propagation cycle.
Erickson et al. previously presented a region-growing approach
to group ATs from seeding electrodes known as REGROUPS
[14]. REGROUPS cannot be applied for online recordings because the method requires input of complete recorded sequences
in their entirety.
Instead, a modified “wave-mapping approach” was employed
for online use, based on a search and sort routine [26]. Lists of
“candidate waves” were maintained that each consisted of a list
of ATs. Each newly identified AT was added to a candidate wave
if at least one recent AT in that wave closely matched the new
AT in time and space. If a candidate wave had no recent ATs,
then it was considered complete. Complete waves were further
tested against a specified “minimal coverage parameter,” and
only accepted waves were recorded for mapping (below) or
saving to file.
E. Data Display
1) Animations: Animation sequences were chosen as the primary method for visualizing data online. These animations (refer to supplementary animations) consisted of a grid of cells

Fig. 3. Screenshot of the interface developed to enable online HR mapping.
The dataset include multiple low SNR channels, as well as a patch of electrodes
over a quiescent region of the stomach (i.e., bottom three rows of the array). (a)
Animation window. The wave front is propagating from top-right to bottomleft (see also the corresponding animation Fig. 3.mp4, available in the online
supplementary material). Reliable channels (anticipated to contain TP data) are
colored green, while unreliable channels (anticipated to contain FP data) are red.
(b) User controls. Users can “toggle” to view a column or row of electrodes, and
change their selection to the next or previous row or column. (c) Signal traces
from the user-selected electrograms with reliable channels (blue), unreliable
channels (red), and detected activation times (vertical green bars). The vertical
red line indicates the point in time currently being animated. Column of red
squares outline electrodes are shown in the signal traces.

representing each of the recording electrodes. Each cell would
initially be assigned a “baseline” color, then when a slow-wave
event passed under each electrode it would be highlighted a particular color (e.g., bright green in Fig. 3). The cell would then
gradually returned to the original “baseline” color over time
(e.g., black in Fig. 3). The red color represents a cell where a
potential slow wave was detected but the system had low confidence of the accuracy of detection.
The advantages of animations over activation maps in the online context include relative insensitivity to random noise (falsepositive/false-negative data) due to human pattern recognition,
a continually updating display, and the ability to demonstrate
complex dysrhythmias not easily amenable to static activation
mapping (e.g., reentry) [27]. Animations have been successfully
applied to complex slow-wave dysrhythmias in several previous
studies (e.g., [5], [8]). Online animations were generated by our
previously described methods using unclustered ATs [9].
2) Isochronal Activation Mapping: Activation mapping was
included as a secondary display option. Each activation map
typically quantifies propagation over many sec., and several
maps can be viewed simultaneously to allow several min. of data
to be reviewed and compared. Online activation mapping was
performed using clustered ATs, using the spatial visualization
and interpolation (SIV) scheme [14].
3) Graphical User Interface: All of the above system elements were incorporated into a graphical user interface (GUI)
with three features (see Fig. 3): 1) live animation of ATs;
2) display of electrograms; and 3) secondary view for activation mapping. The animation represents the electrodes as an
array of flashing lights, corresponding to AT detection, with
color-coding according to signal fidelity to distinguish “accurate
channels” (expected to contain reliable ATs) from “inaccurate
channels” (expected to contain unreliable ATs) [see Fig. 3(a)].
The user selects a row or column from the array, for which the
electrograms are shown [see Fig. 3(b) and (c)]. Viewing lines
of stacked electrograms provides an interpretable quantity of

2682

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 11, NOVEMBER 2014

data and allows users to assess for an anticipated propagation
“lag” between consecutive channels. When viewing activation
maps, the most recently discovered map is displayed, with the
option to also display earlier maps. Viewing multiple maps can
reduce the time spent watching the animation, and helps in the
identification and characterization of dysrhythmic features such
as pacemakers (normal and ectopic) and conduction blocks [5],
[6], [8].
F. Implementation in a Python Software Package
In our laboratory, recordings are performed using the BioSemi
ActiveTwo acquisition system and a modified version of the ActiView recording software (Biosemi, The Netherlands), which is
written in LabView (National Instruments, Austin, TX, USA).
A novel Python programming-language software package was
interfaced with this system, as described below. Importantly,
however, the online mapping software presented here could also
be modified to function with a range of alternative acquisition
systems used in other laboratories.
Raw data was streamed from ActiView via a “TCP server”
feature that allows client software to connect via a “socket,”
either on the same computer or over a network, without affecting
the recordings. The novel Python software (shown operational
in Fig. 3 and Fig. 3.mp4, available in the online supplementary
material) receives, decodes, analyzes, and displays the online
data according to system outlined in Fig. 1. For this analysis to
occur, the user must also input an additional configuration file
that specifies the physical distribution of the recording array.
G. Validation Methods
1) Experimental Data: Ethical approval was granted by the
University of Auckland Animal Ethics Committee. Experiments
were performed in vivo, in female cross-breed weaner pigs
(n = 6, 34–37 kg). In contrast to humans, dysrhythmias occur spontaneously during approximately 15% of intraoperative
recordings (50% of cases) in these weaner animals [6], [8].
Methods of animal preparation, anesthesia and monitoring, and
surgical access were the same as previously described in another recent study [23]. HR mapping was performed over the
gastric serosa, using flexible printed circuit board (PCB) arrays [4]. Each array used in this study had 256 contact electrodes (0.3 mm diameter, 4 mm interelectrode spacing, area of
36 cm2 ).
2) Validation: Online results were compared to traditional
off-line analyses performed in the GEMS software [9]. Six experimental comparison datasets were selected as representative
of a typical range of porcine slow-wave propagation scenarios, comprising two each of: normal longitudinal propagation,
pacemaker area, conduction block, and circular propagations
[6], [23]. These patterns are also representative of a range of
known human gastric propagation patterns in health and disease
[7], [8].
Two experienced analysts independently analyzed each experiment to create a reference dataset. Each analyst was blinded
to the online results, and analyzed the data using validated automated off-line methods [9], [13], [14], followed by compre-

Fig. 4. Automated online marking outcomes (sensitivity and PPV) compared
with the reference dataset. The PPV was calculated for masked data (i.e., not
including channels with a low SNR that were discarded by the manual marker),
and unmasked data (representing real-world accuracy with the applied flexible
PCB electrodes).

hensive manual review and correction of every individual AT
and clustering outcome. Online automated AT marking outcomes were then compared to this reference dataset according
to “sensitivity” (proportion of reference ATs correctly identified online), and “positive predictive value” (PPV; proportion
of all ATs identified online that correctly matched reference
ATs). The PPV was further calculated using two methods, firstly
with all channels being considered (“unmasked”), and secondly
only considering channels that the reference dataset (manual
marker) had retained as containing reliable marks (“masked”).
The unmasked comparison reflects real-life performance of the
combined event detection and signal fidelity methods with the
PCB electrodes. The masked comparison reflects theoretical
outcomes of the methods if given data without any low signal-tonoise (SNR) channels. Full details of these metrics are provided
in the Appendix.
The activation maps produced by the online system were also
quantitatively compared using the following metrics (see the
Appendix): root-mean-squared error (RMSE), mean difference
(MD), and Pearson correlation coefficient (PCC). The RMSE
and MD provide average absolute and relative differences in
times between two methods, while the PCC metric provides a
measure of any changes in pattern and is independent of any
changes in absolute magnitude. An RMSE and MD error of
0.0 s indicates exact match while a PCC value of 1.0 indicates
exact correlation.
In addition to these quantitative analyses, raw data animations were qualitatively compared by two experienced analysts,
one reading the animated online data, and the other reading the
animated reference dataset. The two analysts independently described the pattern of slow-wave activation and classified any
dysrhythmias, before comparing outcomes.
III. RESULTS
A. Stability and Time Delay
The online system analyzed 256-channel experimental data
with total stability (no unexpected system terminations) when
running on either a laptop or over a network connection. The

BULL et al.: SYSTEM AND METHOD FOR ONLINE HIGH-RESOLUTION MAPPING OF GASTRIC SLOW-WAVE ACTIVITY

2683

Fig. 5. Comparison of activation maps produced for normal pacemaker activity. (A) Position of the electrode array. (B) Off-line activation maps from three
consecutive waves (a–c). The isochronal intervals are 1 s. (C) Signal traces
(electrograms) from 8 representative electrodes with locations as indicated in
B(a). (D) Corresponding online activation maps. Animation of the corresponding time sequence comparing the online and off-line analysis is presented in
Fig. 5.mp4, available in the online supplementary material.

Fig. 7. Comparison of activation maps produced from ectopic pacemaking
with looping propagations. A. Position of the electrode array spanning the
anterior and posterior surfaces across the greater curvature. B. Offline activation
maps from three consecutive waves (a-c). The isochronal intervals are 1 s. C.
Corresponding online activation maps. D. Signal traces from 15 electrodes with
locations as indicated in B(a). Animation of the corresponding time sequence
comparing the online and offline analysis is presented in Fig. 7.mp4.

Fig. 6. Comparison of activation maps produced from unstable activity with
conduction block. A. Position of the electrode array spanning the anterior and
posterior surfaces across the greater curvature. B. Offline activation maps from
three consecutive waves (a-c). The isochronal intervals are 1 s. C. Signal traces
from 12 electrodes with locations as indicated in B(a). D. Corresponding online
activation maps. Animation of the corresponding time sequence comparing the
online and offline analysis is presented in Fig. 6.mp4.

software functioned with a mean delay to animation of approximately 18 s from capture of experimental data.
B. Event Detection and Activation Mapping Metrics
Fig. 4 reports the sensitivity and PPV (masked and unmasked)
event detection results across all six datasets and animals. The
median AT detection sensitivity was 0.90 (range: 0.62–0.94),
indicating that a high proportion of reference ATs were being detected by online analysis. The median “masked” PPV
was 0.91 (range 0.85–0.94), and the median “unmasked” PPV
0.72 (range 0.65–0.83), indicating that a high proportion of ATs
marked online were true ATs.
Slow-wave activation patterns from 59 randomly selected
slow-wave cycles across four animals were used for the quantitative comparisons of online versus off-line activation maps.
Examples are demonstrated in Fig. 5 (normal pacemaker activity), Fig. 6 (conduction block), Fig. 7 (ectopic pacemaking with
looping propagations), and their accompanying animations. For

these analyzed cycles, the online method identified an average of
134 ± 6 slow-wave events per cycle, while the off-line method
identified 139 ± 5 per cycle (p = 0.27). Of these events, median
122 ± 6 events were identified in common by both methods.
The RMSE error between the online and off-line methods
was 0.700 ± 0.01 s, with an MD of −0.650 ± 0.004 s. The
negative MD value indicates that the ATs determined by the
online method were consistently delayed by 0.7 s when compared to the off-line methods, which was due to the use of more
simplistic filtering methods by the online method. The activation maps presented in Figs. 5–7 were adjusted to compensate
for this delay. The PCC was 0.993 ± 0.002, indicating a high
overall concordance between online and off-line activation map
patterns.
C. Qualitative Comparison: Activation
Mapping and Animations
The online and off-line methods qualitatively provided similar results with regard to the propagation pattern and direction
of propagation (see Figs. 5–7), with 100% classification concordance between the blinded online and off-line analysts. As
demonstrated by the animations (see Fig. 5.mp4, available in
the online supplementary material, Fig. 6.mp4, available in the
online supplementary material, and Fig. 7.mp4, available in the
online supplementary material), the reduced PPV of the online
versus off-line event detection metrics did not adversely affect
the ability to interpret the animations, primarily because of the

2684

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 11, NOVEMBER 2014

human visual filtering of background random noise versus. patterns, as has been recognized in the cardiac field [27].
The activation maps calculated by the online system tended
to have slightly reduced coverage when compared with those
found off-line with the help of the REGROUPS algorithm,
partly because the cycle clustering tended to terminate early (see
Figs. 5–7). This was anticipated, and because the REGROUPS
algorithm specifically incorporated a polynomial surface fitting
function designed to overcome this problem, which cannot be
implemented online [14], [28]. Nevertheless, in the majority
of cases, the online maps still provided a reliable view of the
slow-wave propagation pattern, because the areas of lost coverage tended to be situated at patches at the edges of the array
(where SNR is often lower due to a reduced quality of contact)
(see Figs. 5–7fig6 fig7.fig ), and because FP events are often
discarded in a reliable grouping process [14].
IV. DISCUSSION
This study has presented a system, method and software for
“online” HR mapping of gastric slow-wave propagation. The
platform comprises a series of analytical algorithms coupled to
an intuitive GUI, which seamlessly integrates with data acquisition systems. The platform is simple to use and was stable,
including when operating over a network connection. Performance was validated in a series of porcine experimental studies encompassing normal and dysrhythmic slow-wave patterns,
and quantitative and qualitative results were demonstrated to be
sufficient for accurate mapping. The system was designed for
optimal computational efficiency, and the lag to animation display (approx. 18 s) is less than the period of one normal human
gastric slow-wave cycle [7]. This delay is a fixed time interval
over which the system can scan for potential slow-wave events.
As the delay is fixed and relatively short compared to the period
of gastric slow waves, it should not be a significant issue when
used in practice unless the system is adapted to interact directly
with the measured events (e.g., electrical stimulation triggered
by a particular measured event).
The advances presented here overcome a key barrier to current progress in experimental and clinical HR gastric mapping.
Displaying spatial and graphical representations of electrical
propagation patterns during live recordings will allow experimental interventions to be targeted to observations of slow-wave
patterns in real time. A similar paradigm of real-time mapping
and targeted intervention was instrumental in advancing the
localization and treatment of cardiac rhythm abnormalities in
previous decades [29], [30], and cardiac mapping has since
developed into a mature clinical discipline [12]. The clinical
significance of gastric dysrhythmias is much less certain than
cardiac dysrhythmias; however, evidence continues to accumulate that gastric dysrhythmias are associated with major gastric
functional disorders including gastroparesis and functional dyspepsia [8], [31]. Furthermore, gastric initiation and conduction
disturbances may be promoted and maintained by complex behaviors resembling those seen in cardiac dysrhythmias, including ectopic pacemaking, reentry, and self-perpetuating conduction block patterns [5], [6], [8]. Given this context, we anticipate

that the current work will be a useful translational step toward
better elucidating the pathophysiologic and therapeutic significance of gastric dysrhythmias.
Enabling real-time experimental feedback will also substantially improve the reliability of HR mapping experiments. Previously, information about slow-wave propagation patterns during
experiments had to be estimated by visualizing selected groups
of electrograms (typically a column or row of an electrode array). This provided a limited (one-dimensional) view of the underlying activity. The onset of dysrhythmias may sometimes be
appreciable from just a few electrograms, because extracellular
slow-wave amplitudes increase up to 2.5× during the circumferential propagation that routinely accompanies dysrhythmia activation patterns [8], [32]. However, only spatiotemporal analyses
can reliably identify and classify abnormal gastric slow-wave
initiation and conduction patterns, due to their spatial complexity [5], [6]. Dysrhythmia identification can now be performed
during experiments, allowing investigators to determine if and
when experimental endpoints are met. In addition, sub-optimal
position of a mapping array can now be detected and corrected
immediately, to avert problems with inadequate tissue contact or
partial capture of events of interest. This is particularly important for human intraoperative studies, when data must typically
be captured within a tight experimental window [7], [8].
The system was also shown to have robust performance over
a computer network. This feature means the resultant software
package is sufficiently flexible to be used in a research laboratory, endoscopy suite or operating room, and with the mapping
personnel being on-site or off-site.
There has been only one previous attempt at developing a
system for online spatial analyses of gastrointestinal electrical
conduction [22]. The system presented here includes several
improvements over their approach, including an event detection
method that is relatively insensitive to noise, computationally
efficient automated clustering and mapping, and elimination of
noisy channels by kurtosis estimation. Chronic awake studies
are needed because all HR studies of gastric dysrhythmia to date
been restricted to the anaesthetized and fasted state. Recently,
a wireless and potentially endoscopically implantable device
was developed as a step toward human telemetric dysrhythmia
monitoring [33], and it could be usefully coupled to the system presented here, to help progress this challenge in future
work.
The successful development of a kurtosis-based estimate of
signal fidelity was a key advance in this work, and this step could
now also be applied to improve the efficiency of automated processing of off-line recordings [9]. Currently, significant manual
effort is still required to remove false-positives from off-line
recordings, particularly in human cases due to operating room
noise. Another useful step would be to also include a method
for eliminating pacing artifacts from gastric electrograms so
that these artifacts do not interfere with automated marking and
mapping algorithms during the HR analysis of pacing protocols
for dysrhythmia [10].
A limitation of this work is that the AT marking and clustering
results were inferior to off-line analyses, which was expected
because whole recordings can be processed using superior but

BULL et al.: SYSTEM AND METHOD FOR ONLINE HIGH-RESOLUTION MAPPING OF GASTRIC SLOW-WAVE ACTIVITY

much less computationally efficient techniques off-line [13],
[14]. Nevertheless, the outcomes were satisfactory, as demonstrated by the quantitative results, and concordance in qualitative analyses of the isochronal maps and animations during
experiments. As in cardiac electrophysiology, however, several
complexities may impair performance of this system during
dysrhythmia mapping [19]. Grouping cycles becomes complex
in rhythms such as reentry and fibrillation-type behaviors [5],
[8], limiting the utility of online isochronal mapping, though
animation remains of great utility. The accuracy of activation
time marking can also reduce or become more subjective during dysrhythmia [19], as irregular morphologies may arise due
to colliding wave fronts, fractionation of electrograms, double
potentials, and amplitude variability [6], [32]. Although the current setup was able to successfully process in near real-time 256
channels with a high sampling frequency, the introductio additional channels would result in additional delays. Additional
channels could readily be monitored by reducing the sampling
frequency.
Although the current system has been tuned for gastric slowwave recording, it is possible to adapt the filtering and signal
detection parameters to enable analysis of recordings from other
parts of the gastrointestinal tract, most notably the slow-wave
recordings from the small intestine. As the primary function
small intestine involves mixing of the digesta, its slow-wave
activity is also more complex and dynamic making construction
of isochronal activation maps more complex [34]. However, the
animation-based analysis (as shown in Fig. 3 and in the supplementary animations) should provide an immediate assessment
of the slow-wave propagation patterns.
In conclusion, this study has presented a new platform for
the online analysis of HR gastric slow-wave recordings. This
system and method resolves a key problem currently facing HR
mapping work, and is anticipated to be a valuable translational
step. We are now in the process of applying this technology to
intraoperative human studies.
APPENDIX
Chebyshev Filtering: Signal downsampling was performed using a Chebyshev type I filter
Gn (ω) = |Hn (jω)| = 

1
1 + ε2 Tn2 (ω/ω0 )

(1)

with parameters identical to those previously used in offline analyses: order (Tn = 8), passband edge (ω0 = 0.8 Fs /8),
where Fs is the sampling frequency and ripple parameter
(ε = 0.05) [9].
Event Detection Algorithm: Online event detection was
adapted from the FEVT method [13]. A nonlinear filter termed
the NEO was applied to the downsampled and filtered signal
[Vi : i ∈ N ]
NEO (Vi ) = Vi Vi − Vi−1 Vi+1 .

(2)

The resultant signal was smoothed with a moving average
filter of width 1 s, resulting in the SENO signal (St ). The signals were also convolved with an edge detect kernel (Et ). The
detection signal was calculated as the element-wise product of

the edge detected the kernel and the SNEO signal

St Et , if St Et ≥ 0
.
Ft =
0,
if St Et < 0

2685

(3)

An online, variable threshold step was used to derive “candidate ATs” from the detection signal, by an adaptation of the
median absolute deviation (MAD) approach [22]
MAD (X) = mediani (|Xi − meanj (Xj )|) .

(4)

The threshold is determined by the MAD of the detection
signal, within a time window, multiplied by a tunable scalar
parameter. A window width of 30 s (15 s in each direction), and
scalar multiplier of 5.9 was found to be most effective. However,
the MAD was found to be computationally inefficient, taking
substantial processing time and limiting online analysis of large
data sets. Therefore, a mean absolute deviation was used instead,
based on the observation that in the majority of channels, the
detection signal was typically close to zero at most time points
(e.g., see Fig. 2). If more than half of the signal values within
the time window were close to zero, then the MAD was close
to the mean value. A moving mean was therefore a justified
simplification, and functioned with a significant reduction in
computational cost.
Similar to the FEVT method, the online method defines a
set of “candidate ATs” based on the detection signal F and
threshold T
u = {t|F (t) ≥ T (t)} .

(5)

Elements of u having the detection signal F (t) of greatest
magnitude within a time window of half-width Tlim were designated ATs, and the remainder of the candidate ATs were discarded. This step prevents multiple ATs being detected within a
closely spaced interval. Tlim is a tunable parameter that should
be specified according to a priori knowledge about the underlying slow-wave activity and species under evaluation.
Signal Fidelity Assessment by Kurtosis: The kurtosis [25]
k(V) of a window from the filtered signal V was defined as

|V | v ∈V (v − mean (V ))4
(6)
k (V ) = 
2 − 3.
2
(v
−
mean
(V
))
v ∈V
On empirical testing, a kurtosis threshold of 0 and time parameter of 4 s were identified as most effective for classifying
“unreliable channels,” i.e., containing an excess of FP ATs.
Validation Metrics for Event Detection: Validation metrics were employed to analyze online event detection accuracy
against a reference dataset prepared by an expert analyst. The
kurtosis measure of signal fidelity was first applied to remove
unreliable channels.
A TP was an online AT that matched a reference AT to within
0.2 s, while an FP was an online AT for which there was no
corresponding reference AT within 0.2 s. Erickson et al. [13]
had previously applied a threshold time of 1 s. In this study,
a substantially more restrictive 0.2 s window was employed
for determining either a TP or false positive data point. As
noted above, different filtering methods were employed online,
compared to standard off-line methods [9], [16]. Although the

2686

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 11, NOVEMBER 2014

on-line methods employed more computationally efficient filtering methods, this resulted in a small constant phase-shift in
the signals. To account for this, all online signals were adjusted
by a negative time shift of 0.65 s for validation purposes.
“Sensitivity” referred to the fraction of online ATs that were
also detected by the off-line methods (reference dataset calculated by the expert analyst) while the Positive Predictive Value
(PPV) referred to the fraction of erroneous ATs calculated using
the online methods
TP
TP + FN
TP
.
PPV =
TP + FN

Sensitivity =

(7)
(8)

Validation Metrics for Activation Mapping: The activation
maps produced by the online method were quantitatively compared with those produced off-line with manual intervention [9].
Results were compared using the RMSE, MD, and PCC metrics

N
2
n =1 (An − Bn )
(9)
RMSE =
N
N
(An − Bn )
MD = n =1
(10)
N
	
	
N 
Bn − B̄
n =1 An − Ā
PCC = 


	 2 
N 
	2 (11)
N
A
B
−
Ā
−
B̄
n
n
n =1
n =1
where An and Bn are the activation times being compared at
location n, and there are a total of N common activation times,
and A and B are the mean activation times for each activation
map. The RMSE and MD provide an absolute and relative time
difference between the two activation maps.
ACKNOWLEDGMENT
The authors would like to thank the invaluable contribution of
the late Prof. A. Pullan. They would also like to thank L. Nisbett,
N. Paskaranandavadivel, and J. Erickson for expert advice and
assistance.

REFERENCES
[1] J. D. Chen, J. Pan, and R. W. McCallum, “Clinical significance of gastric
myoelectrical dysrhythmias,” Dig. Disorder, vol. 13, no. 5, pp. 275–290,
1995.
[2] G. Farrugia, “Interstitial cells of Cajal in health and disease,” Neurogastroenterol. Motil., vol. 20, Suppl. 1, pp. 54–63, May 2008.
[3] W. J. E. P. Lammers, A. Al-Kais, S. Singh, K. Arafat, and T. Y.
El-Sharkawy, “Multielectrode mapping of slow-wave activity in the isolated rabbit duodenum,” J. Appl. Physiol., vol. 74, no. 3, pp. 1454–1461,
Mar. 1993.
[4] P. Du, G. O’Grady, J. U. Egbuji, W. J. E. P. Lammers, D. Budgett,
P. Nielsen, J. A. Windsor, A. J. Pullan, and L. K. Cheng, “Highresolution mapping of in vivo gastrointestinal slow wave activity using
flexible printed circuit board electrodes: Methodology and validation,”
Ann. Biomed. Eng., vol. 37, no. 4, pp. 839–846, Apr. 2009.
[5] W. J. E. P. Lammers, L. Ver Donck, B. Stephen, D. Smets, and J. A. J.
Schuurkes, “Focal activities and re-entrant propagations as mechanisms
of gastric tachyarrhythmias,” Gastroenterology, vol. 135, no. 5, pp. 1601–
1611, Nov. 2008.

[6] G. O’Grady, J. U. Egbuji, P. Du, W. J. E. P. Lammers, L. K. Cheng, J. A.
Windsor, and A. J. Pullan, “High-resolution spatial analysis of slow wave
initiation and conduction in porcine gastric dysrhythmia,” Neurogastroenterol. Motil., vol. 23, no. 9, pp. e345–e355, Sep. 2011.
[7] G. O’Grady, P. Du, L. K. Cheng, J. U. Egbuji, W. J. E. P. Lammers,
J. A. Windsor, and A. J. Pullan, “Origin and propagation of human gastric
slow-wave activity defined by high-resolution mapping,” Amer. J. Physiol. Gastrointest. Liver Physiol., vol. 299, no. 3, pp. G585–G592, Sep.
2010.
[8] G. O’Grady, T. R. Angeli, P. Du, C. Lahr, W. J. E. P. Lammers, J. A.
Windsor, T. L. Abell, G. Farrugia, A. J. Pullan, and L. K. Cheng, “Abnormal initiation and conduction of slow-wave activity in gastroparesis,
defined by high-resolution electrical mapping,” Gastroenterology, vol.
143, no. 3, pp. 589-e1–598-e3, Sep. 2012.
[9] R. Yassi, G. O’Grady, N. Paskaranandavadivel, P. Du, T. R. Angeli, A. J.
Pullan, L. K. Cheng, and J. C. Erickson, “The gastrointestinal electrical
mapping suite (GEMS): Software for analyzing and visualizing highresolution (multi-electrode) recordings in spatiotemporal detail,” BMC
Gastroenterol., vol. 12, pp. 1–14, Jan. 2012.
[10] G. O’Grady, P. Du, W. J. E. P. Lammers, J. U. Egbuji, P. Mithraratne, J. D.
Z. Chen, L. K. Cheng, J. A. Windsor, and A. J. Pullan, “High-resolution
entrainment mapping of gastric pacing: A new analytical tool,” Amer. J.
Physiol. Gastrointest. Liver Physiol., vol. 298, no. 2, pp. G314–G321,
Feb. 2010.
[11] Y. H. He, R. N. Ghanem, A. L. Waldo, and Y. Rudy, “An interactive
graphical system for automated mapping and display of cardiac rhythms,”
J. Electrocardiol., vol. 32, no. 3, pp. 225–241, Jul. 1999.
[12] M. Shenasa, H. Gerhard, B. Martin, and B. Gunter, Cardiac Mapping, 3rd
ed. Hoboken, NJ, USA: Wiley, 2009, p. 544.
[13] J. C. Erickson, G. O’Grady, P. Du, C. Obioha, W. Qiao, W. O. Richards,
L. A. Bradshaw, A. J. Pullan, and L. K. Cheng, “Falling-edge, variable
threshold (FEVT) method for the automated detection of gastric slow wave
events in high-resolution serosal electrode recordings,” Ann. Biomed. Eng.,
vol. 38, no. 4, pp. 1511–1529, Apr. 2010.
[14] J. C. Erickson, G. O’Grady, P. Du, J. U. Egbuji, A. J. Pullan, and L. K.
Cheng, “Automated gastric slow wave cycle partitioning and visualization
for high-resolution activation time maps,” Ann. Biomed. Eng., vol. 39,
no. 1, pp. 469–483, Jan. 2011.
[15] S. H. Bull, G. O’Grady, L. K. Cheng, and A. J. Pullan, “A framework for
the online analysis of multi-electrode gastric slow wave recordings,” in
Proc. IEEE Conf. Eng. Med. Biol. Soc., Jan. 2011, vol. 2011, pp. 1741–
1744.
[16] N. Paskaranandavadivel, G. O’Grady, P. Du, and L. K. Cheng, “Comparison of filtering methods for extracellular gastric slow wave recordings,”
Neurogastroenterol. Motil., vol. 25, no. 1, pp. 79–83, Jan. 2013.
[17] N. Paskaranandavadivel, L. K. Cheng, P. Du, G. O’Grady, and A. J. Pullan,
“Improved signal processing techniques for the analysis of high resolution
serosal slow wave activity in the stomach,” in Proc. Annu. Int. Conf.
IEEE Eng. Med. Biol. Soc. IEEE Eng. Med. Biol. Soc. Conf., Jan. 2011,
vol. 2011, pp. 1737–1740.
[18] A. Williams and F. Taylor, Electronic Filter Design Handbook, 4th ed.
New York, NY, USA: McGraw-Hill, 2006, p. 775.
[19] J. M. Rogers, P. V Bayly, R. E. Ideker, and W. M. Smith, “Quantitative
techniques for analyzing high-resolution cardiac-mapping data,” IEEE
Eng. Med. Biol. Mag., vol. 17, no. 1, pp. 62–72, Jan./Feb. 1998.
[20] J. M. T. de Bakker and F. H. M. Wittkampf, “The pathophysiologic basis
of fractionated and complex electrograms and the impact of recording
techniques on their detection and interpretation,” Circ. Arrhythm. Electrophysiol., vol. 3, no. 2, pp. 204–213, Apr. 2010.
[21] J. F. Kaiser, “Some useful properties of Teager’s energy operators,” in
Proc. IEEE Int. Conf. Acoust. Speech Signal Process., 1993, vol. 3,
pp. 149–152.
[22] W. J. E. P. Lammers, B. Michiels, J. Voeten, L. Ver Donck, and J. A. J.
Schuurkes, “Mapping slow waves and spikes in chronically instrumented
conscious dogs: Automated on-line electrogram analysis,” Med. Biol. Eng.
Comput., vol. 46, no. 2, pp. 121–129, Feb. 2008.
[23] J. U. Egbuji, G. O’Grady, P. Du, L. K. Cheng, W. J. E. P. Lammers, J. A.
Windsor, and A. J. Pullan, “Origin, propagation and regional characteristics of porcine gastric slow wave activity determined by high-resolution
mapping,” Neurogastroenterol. Motil., vol. 22, no. 10, pp. e292–e300, Oct.
2010.
[24] W. J. E. P. Lammers, L. Ver Donck, B. Stephen, D. Smets, and J. A.
J. Schuurkes, “Origin and propagation of the slow wave in the canine
stomach: The outlines of a gastric conduction system,” Amer. J. Physiol.
Gastrointest. Liver Physiol., vol. 296, no. 6, pp. G1200–G1210, Jun. 2009.

BULL et al.: SYSTEM AND METHOD FOR ONLINE HIGH-RESOLUTION MAPPING OF GASTRIC SLOW-WAVE ACTIVITY

[25] L. T. DeCarlo, “On the meaning and use of kurtosis,” Psychol. Methods,
vol. 2, no. 3, pp. 292–307, 1997.
[26] W. J. Lammers, A. El-Kays, K. Arafat, and T. Y. El-Sharkawy, “Wave
mapping: Detection of co-existing multiple wavefronts in high-resolution
electrical mapping,” Med. Biol. Eng. Comput., vol. 33, no. 3, pp. 476–481,
May 1995.
[27] R. E. Ideker, W. M. Smith, S. M. Blanchard, S. L. Reiser, E. V. Simpson,
P. D. Wolf, and N. D. Danieley, “The assumptions of isochronal cardiac
mapping,” Pacing Clin. Electrophysiol., vol. 12, no. 3, pp. 456–478, Mar.
1989.
[28] P. V. Bayly, B. H. KenKnight, J. M. Rogers, R. E. Hillsley, R. E. Ideker,
and W. M. Smith, “Estimation of conduction velocity vector fields from
epicardial mapping data,” IEEE Trans. Biomed. Eng., vol. 45, no. 5,
pp. 563–571, May 1998.
[29] J. J. Gallagher, M. Gilbert, R. H. Svenson, W. C. Sealy, J. Kasell, and
A. G. Wallace, “Wolff-parkinson-white syndrome. The problem, evaluation, and surgical correction,” Circulation, vol. 51, no. 5, pp. 767–785,
May 1975.
[30] M. E. Josephson, L. N. Horowitz, A. Farshidi, J. F. Spear, J. A. Kastor, and
E. N. Moore, “Recurrent sustained ventricular tachycardia. 2. Endocardial
mapping,” Circulation, vol. 57, no. 3, pp. 440–447, Mar. 1978.
[31] X. Lin and J. D. Z. Chen, “Abnormal gastric slow waves in patients
with functional dyspepsia assessed by multichannel electrogastrography,”
Amer. J. Physiol. Gastrointest. Liver Physiol., vol. 280, no. 6, pp. G1370–
G1375, Jun. 2001.
[32] G. O’Grady, P. Du, N. Paskaranandavadivel, T. R. Angeli, W. J. E. P.
Lammers, S. J. Asirvatham, J. A. Windsor, G. Farrugia, A. J. Pullan, and
L. K. Cheng, “Rapid high-amplitude circumferential slow wave propagation during normal gastric pacemaking and dysrhythmias,” Neurogastroenterol. Motil., vol. 24, no. 7, pp. e299–e312, Jul. 2012.
[33] A. Farajidavar, G. O’Grady, S. M. N. Rao, L. K. Cheng, T. L. Abell, and
J.-C. Chiao, “A miniature bidirectional telemetry system for in vivo gastric
slow wave recordings,” Physiol. Meas., vol. 33, no. 6, pp. N29–N37, Jun.
2012.
[34] T. R. Angeli, G. O’Grady, P. Du, N. Paskaranandavadivel, A. J. Pullan,
I. P. Bissett, and L. K. Cheng, “Circumferential and functional re-entry of
in vivo slow-wave activity in the porcine small intestine,” Neurogastroenterol. Motil., vol. 25, no. 5, pp. e304–e314, May 2013.

Simon H. Bull received the B.E. (Hons.) in engineering science, the B.Sc. degree in computer science, and
the M.E. (Hons.) degree in engineering science from
the University of Auckland, Auckland, New Zealand.
He is currently working toward the Ph.D. degree from
the Technical University of Denmark, Copenhagen,
Denmark.

2687

Gregory O’Grady received the B.H.B., the
M.B.Ch.B., and the Ph.D. (surgery) degrees from the
University of Auckland, Auckland, New Zealand.
He is currently an Advanced Trainee in Gastrointestinal Surgery at Westmeade Hospital, Sydney,
Australia.

Peng Du received the B.E. (Hons.) degree in engineering science and the Ph.D. degree in bioengineering from the University of Auckland, Auckland, New
Zealand.
He is currently a New Zealand Postdoctoral Fellow
at the Auckland Bioengineering Institute, University
of Auckland.

Leo K. Cheng received the B.E. (Hons.) degree in
engineering science and the Ph.D. degree in bioengineering from the University of Auckland, Auckland,
New Zealand.
He is currently an Associate Professor at the
Auckland Bioengineering Institute, University of
Auckland and a Research Assistant Professor in
the Department of Surgery, Vanderbilt University,
Nashville, TN, USA.

