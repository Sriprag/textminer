IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 9, SEPTEMBER 2014

2379

Control of an Electromechanical Hydrocephalus
Shunt—a New Approach
Inga M. Elixmann∗ , Monika Kwiecien, Christine Goffin, Marian Walter, Member, IEEE, Berno Misgeld,
Michael Kiefer, Wolf-Ingo Steudel, Klaus Radermacher, and Steffen Leonhardt, Senior Member, IEEE

Abstract—Hydrocephalus is characterized by an excessive accumulation of cerebrospinal fluid (CSF). Therapeutically, an artificial
pressure relief valve (so-called shunt) is implanted which opens in
case of increased intracranial pressure (ICP) and drains CSF into
another body compartment. Today, available shunts are of a mechanical nature and drainage depends on the pressure drop across
the shunt. According to the latest data, craniospinal compliance
is considered to be even more important than mean ICP alone. In
addition, ICP is not constant but varies due to several influences. In
fact, heartbeat-related ICP waveform patterns depend on volume
changes in the cranial vessels during a heartbeat and changes its
shape as a function of craniospinal compliance. In this paper, we
present an electromechanical shunt approach, which changes the
CSF drainage as a function of the current ICP waveform. A series
of 12 infusion tests in patients were analyzed and revealed a trend
between the compliance and specific features of the ICP waveform.
For waveform analysis of patient data, an existing signal processing
algorithm was improved (using a Moore machine) and was implemented on a low-power microcontroller within the electromechanical shunt. In a test rig, the ICP waveforms were replicated and the
decisions of the ICP analysis algorithm were verified. The proposed
control algorithm consists of a cascaded integral controller which
determines the target ICP from the measured waveform, and a
faster inner-loop integral controller that keeps ICP close to the
target pressure. Feedforward control using measurement data of
the patient’s position was implemented to compensate for changes
in hydrostatic pressure during change in position. A model-based
design procedure was used to lay out controller parameters in a
simple model of the cerebrospinal system. Successful simulation
results have been obtained with this new approach by keeping ICP
within the target range for a healthy waveform.
Index Terms—Electromechanical shunt, hydrocephalus,
intracranial pressure (ICP), pulse wave, signal processing.

Manuscript received July 31, 2013; revised January 12, 2014; accepted February 9, 2014. Date of publication February 27, 2014; date of current version
August 18, 2014. Asterisk indicates corresponding author.
*I. M. Elixmann is with the Philips Chair of Medical Information
Technology, RWTH Aachen University, 52062 Aachen, Germany (e-mail:
Elixmann@hia.rwth-aachen.de).
M. Kwiecien, M. Walter, B. Misgeld, and S. Leonhardt are with the
Philips Chair of Medical Information Technology, RWTH Aachen University, 52062 Aachen, Germany (e-mail: Monika.Kwiecien@rwth-aachen.de;
walter@hia.rwth-aachen.de; misgeld@hia.rwth-aachen.de; leonhardt@hia.
rwth-aachen.de).
C. Goffin and K. Radermacher are with the Chair of Medical Engineering, RWTH Aachen University, 52062 Aachen, Germany (e-mail: goffin@hia.
rwth-aachen.de; radermacher@hia.rwth-aachen.de).
W.-I. Steudel and M. Kiefer are with the Saarland University Medical Center,
66123 Saarbrucken, Germany (e-mail: ingo.Steudel@uniklinikum-saarland.de;
Michael.Kiefer@uniklinikum-saarland.de).
Digital Object Identifier 10.1109/TBME.2014.2308927

I. INTRODUCTION
HE intracranial space consists of brain matter, cerebral
blood, and cerebrospinal fluid (CSF) surrounded by the
skull. The ability of the intracranial space to recompensate a
change in blood volume due to pulsation is called intracranial
compliance and is made up by four main components: arteries,
veins, spinal thecal sac, and brain tissue. Hydrocephalus patients
with an increased intracranial pressure (ICP) have a lower compliance according to the exponential pressure–volume curve of
Marmarou et al. and additional volume causes significant increase in ICP. The same effect can be observed in normal pressure hydrocephalus (NPH) patients, which show normal ICP
values most of the time but do have a reduced compliance [1].
Hydrocephalus patients are generally treated by a shunt that
lowers the ICP to normal or—in case of NPH, to—even lower
than normal values thereby increasing compliance. The shunt
lowers ICP by draining CSF into another body compartment
(mainly the abdomen) where CSF can be reabsorbed. We hypothetize that compliance may be a more efficient control parameter for a future shunt than ICP, as ICP does not always
increase, whereas compliance is significantly lower in various
types of hydrocephalus and may even be the cause of Hydrocephalus [2]. In addition, there is a significant change in ICP
with change in body position, as demonstrated during an animal
trial with a prototype of an active implant measuring ICP and
2-D-acceleration [3]. This latter result underlines the challenge
of using ICP as the sole control parameter, as a change in body
position needs to be included in the control setup.
In this paper, a new control approach for an electromechanical
shunt is proposed, which extracts compliance-related features
from the ICP pulse waveform and uses them to adjust the target
ICP. The ICP pulse wave is caused by pressure pulse in the intracranial arterial vessels, which is propagated through the brain
tissue to the CSF-filled craniospinal space [2], [4]. It is assumed
that the CSF pressure wave squeezes the venous system, which
itself forms a very low pressure pulse in the ICP pulse waveform
by dilating again afterwards. However, the origin of the shape
of the intracranial pulse wave is not clearly understood. Some
authors believe that the peaks P1, P2, and P3 in the intracranial
pulse waveform (see Fig. 1) result from a superposition of the
arterial and venous pressure pulses [4], [5]. An ICP pulse wave
consists of up to five peaks (P1 to P5), but P4 and P5 are often
not visible. Greitz et al. described a time delay between the first
arterial pulse followed by a smaller capillary pulse, but a direct
link to the pulse wave forms was not drawn [2].
The shape of the intracranial pulse wave is typically altered
by increasing pressure and decreasing compliance [4]–[7], as

T

0018-9294 © 2014 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

2380

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 9, SEPTEMBER 2014

Fig. 1. Intracranial pressure pulse wave over time as a superposition of the
arterial and venous pulse wave.

Fig. 2. Intracranial pulse waveforms can be divided into five patterns. Patterns 1 and 2 represent a physiological compliance, and patterns 3–5 represent
decreasing compliance. Peak P2 increases and dominates P1 as compliance
decreases, whereas peaks P1 and P3 become indistinct and disappear. AMP =
pulse wave amplitude.

shown in the five examples in Fig. 2. Here, the pattern number
increases with decreasing compliance. Note that the intracranial
pulse wave amplitude (AMP) increases with increasing ICP [8].
Changes in a patient’s position and the resulting ICP changes do
not affect the waveform, but change the absolute ICP [4], [9].
For future automated analysis, the variability of the intracranial pulse wave form is challenging. Some authors attempted to
address this problem by extensive processing of the pulse waves
and use of a large dataset of known waveforms [10], [11]. However, these latter algorithms require high processing power, long
ICP recordings, and a considerable amount of memory.
By contrast, the classification algorithm presented here was
specifically developed for use with a low-power microcontroller.
The algorithm is designed to analyze the intracranial pulse
waveform inside an implantable, electromechanical shunt, developed for the treatment of hydrocephalus. This algorithm is
an improvement of an earlier one, also developed by Elixmann
et al. [12]. Description of the wave detection and wave shape
has been enhanced, together with improved detection of the
dominant waveform.
The following sections describe the simulation model of the
electromechanical shunt, including the new control approach
and a CSF model. The relationship between the intracranial
compliance (measured during infusion tests) and the waveform
pattern is also described (see Results) and the performance of
the waveform analysis algorithm on patient data and on data as
used in a test rig. Finally, results of the new control approach in
a closed-loop simulation are presented.
II. PULSE WAVEFORM: PROPAGATION AND ANALYSIS
One reason for dilated ventricles in the skull during hydrocephalus is thought to be increased arterial pulsatility of the

small blood vessels in brain tissue, caused by low intracranial
compliance. The intracranial arteries can dilate during the pressure pulse if intracranial compliance is sufficient. If compliance
decreases, dilatation of the arteries is obstructed and pulsatility passes to the small blood vessels. Implantation of a shunt
enhances compliance by draining CSF from the ventricles [2].
In fact, an increased pulsatility of the small vessels could explain the increase of the peak P2 in the ICP pulse wave, if P2
represents the pulsation of the small vessels and P1 the arterial
pulsation.
In studies on ICP pulse waveforms, volume load in the skull
was effected by constant dilatation of the arterial intracranial
vessels, or by infusion of artificial liquor. In various studies,
simultaneous ICP monitoring showed similar changes in the
waveform and the reason for these changes is attributed to decreased compliance [4]–[7]. In a study by Foltz et. al. [13]
involving 118 patients, waveform changes were analyzed while
ICP was increased by compression of the skull’s veins; the authors showed that when using analysis of the waveform, the
diagnosis of hydrocephalus was more reliable than when considering the mean ICP alone.
To our knowledge, no decision rules are available for clinicians regarding the typical waveforms of patients with hydrocephalus; the change in waveform after shunt implantation is
also unknown. So far, some authors have investigated using the
pulse wave AMP as a diagnostic parameter. Note that at a physiological compliance, the arterial pressure pulse causes a small
increase in ICP and this increase in pressure is further elevated
by a decline in compliance [8], [14].
Eide et al. reported that patients with an initial AMP of
≥4 mmHg showed an AMP of <4 mmHg after shunt implantation and further improved after implantation [15]. In contrast,
patients with an initial AMP of <4 mmHg did not benefit
from shunting, although they had similar mean ICP values
[15].
In this paper, we present long-term recordings obtained from
several hydrocephalus patients before shunt-implantation and
during dynamic infusion tests. During the infusion tests, artificial CSF was injected to increase volume load in the skull [16].
A relationship was determined between waveform, AMP, and
the compliance (for details, see Results section).

III. MATERIALS AND METHODS
A. Clinical Data
ICP recordings of long-term measurements and infusion tests
before shunt implantation of NPH patients were used for retrospective analysis of the waveforms, AMP, and compliance.
All datasets used for this paper were obtained during clinical
routine procedures over several years up to 2009. ICP data were
recorded with a sampling frequency of 100 Hz using a comR
, a multimodal
mercial tip catheter connected to a Datalogger
neuromonitor (Raumedic AG, Muenchberg, Germany). Pulse
waveforms were visually classified by one of the authors and
used as gold standard.

ELIXMANN et al.: CONTROL OF AN ELECTROMECHANICAL HYDROCEPHALUS SHUNT—A NEW APPROACH

2381

Fig. 3. Sketch of the test rig presents the implant with its sensors and the valve
connected to a system of tubes, a micro gear pump to generate pulse waves and
a balloon membrane for the hydraulic coupling between emulated arteries and
cerebrospinal space.
Fig. 4. Newly developed algorithm is based on an existing algorithm [12].
New or improved components are marked with an asterisk (*).

B. Electromechanical Shunt and Experimental Setup
To validate the robustness of the algorithm, white noise with
an amplitude of 0.3 mmHg was added to the ICP data from
the neuromonitor (white noise was identified beforehand by
means of pressure measurements performed with the implant).
Based on these data, an existing algorithm [12] was improved
to detect the waveform. This algorithm was implemented on
a prototype of the electromechanical shunt with implant electronics, ball-in-cone valve including a piezomotor (SQL-RV1.8 from New Scale Technologies, Victor, NY, USA) to adjust
the opening pressure, a gravitational sensor (MMA7455L from
Freescale Semiconductor, Austin, TX, USA) for the patient’s
position and pressure sensors (tip catheters from RAUMEDIC
AG, Münchberg, Germany). The implant was connected to a
test rig via water-filled tubes and a micro gear pump (HNP,
Mikrosysteme GmbH, Schwerin, Germany), which repetitively
(80 times) generated pulse waves of each ICP waveform pattern.
The waves were measured by the shunt’s pressure sensors with
a sampling frequency of 100 Hz and classified by the algorithm
working on the microcontroller (MSP430F2617, Texas Instruments, Dallas, TX, USA) of the shunt. In Fig. 3, a sketch of
the test rig is presented. The aim of this test was to check the
algorithm’s online performance on the microcontroller and the
overall hardware of the implant. To simulate the new control
approach in a closed loop, a model of the shunt with pressure controller and a simple CSF model were implemented in
MATLAB–Simulink.
IV. SIGNAL PROCESSING AND CLASSIFICATION ALGORITHM
The shape of the pulse wave is divided into five patterns (see
Fig. 2). The classification algorithm for the pulse waves presented here is based on an existing algorithm; the structure of
the algorithm is presented in Fig. 4. After lowpass filtering of
ICP signals (length of 5.12 s) recorded with a sampling rate of
100 Hz, the pulse waves in the signal are detected. With knowledge of the wave position, detected peaks can be allocated to the
corresponding wave. Local minimum and maximum values are

recognized as peaks in the wave. The arrangement of the peaks
in the corresponding wave will allocate the classification of this
wave to a specific pattern. After classification of all waves in
the signal, the dominant pattern is selected by a majority decision [12].
This algorithm was successfully improved, as partly already
described [17]. The following sections describe the new algorithm in more detail.
A. Peak and Notch Detection
For identification of the start and end points of a pulse wave
(see Fig. 5), the wavelength λm ean of the waves has to be determined in the sinusoidal signal, where peaks P1 to P3 are filtered
out. Starting at the absolute minimum in the analyzed pressure
signal Mabsolute , the next local minima Mlo cal are searched for
in a small window around Pjum ptarget , which is in a distance of
λm ean from the last minimum.
As no high-pass filter is used to filter the low-frequency fluctuations due to the respiration, every pressure value in a pulse
wave ICP(n) is corrected to ICPcor (n) as follows:
Waveend − Waveb egin
·n
(1)
λ
with the pressure values Waveb egin and Waveend as shown
in Fig. 5 and n being the counted samples from Waveb egin .
Use of the first-time derivation of a pulse wave improved peak
detection, also because saddle points are detected as peaks.
ICPcor (n) = ICP(n) −

B. Classification
Misinterpreted or undetected peaks were the main reason for
wrong classifications and incorrect detection could not be completely avoided. Therefore, the next step of the algorithm, the
waveform classification, is designed to be more robust against
incorrect peak detection.
Criteria for wave classification are the number of peaks, the
difference in pressure and time between the peaks relative to
the wavelength λ, the AMP and the slope of the peak P2. All

2382

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 9, SEPTEMBER 2014

Fig. 6. Moore machine used to determine the dominant pattern from the
number of detected patterns in signals of 5.12 s long. The input of the machine
N i , with i = 0, . . . , 5 corresponds to five detections of the respective patterns
0 to 5. N i∗ corresponds to three detections of a pattern, two patterns away from
the dominant pattern.

reject wrongly detected waves. Another possibility is to use a
Moore machine that determines the dominant pattern based on
a defined number of classified waves and the previous dominant
pattern. These two possibilities are discussed in the following
subsections.
C. Learning Peak Positions

Fig. 5. Two steps in detection of the pulse wave are presented. The first step
is to determine the wave lengths λi in the low-pass filtered signal. Therefore the
waves are divided into blocks B i (length of 16 ICP values) and the minima of
the wave is found when the minima of one block B i is smaller than the adjacent
blocks. The mean distance between the minima is the wavelength. The second
step is to localize the minima between the pulse waves in the original signal
to detect the start and end points of the waves. Starting point is the absolute
minimum in the signal M a b so lu te . P ju m p ta rg e t is the next point in a distance of
λm e a n from M a b so lu te . Around this point the next minimum M lo c a l between
two waves is searched. Waveb e g in and Wavee n d mark the detected first and
last pressure values in a single wave.
TABLE I
CRITERIA FOR THE CLASSIFICATION OF PATTERNS 1 TO 5 (WITH PULSE WAVE
AMPLITUDE (AMP) AND WAVELENGTH (λ))

thresholds for classification are presented in Table I. Waveforms
with features not corresponding to the patterns are assigned to
pattern 0.
The decision of the dominant pattern out of the classified
waves in the signal is made by a learning program which should

This method consists of learning the peak positions of patterns
1, 2, and 3 identifying the peak composition for these patterns.
The pulse waves in a window of pressure signals (length 5.12 s)
are classified by the criteria presented previously. If all waves
belong to patterns 1, 2, or 3, the mean distance between the peaks
is stored for the next classification. If the waves contain two
different patterns, the peak distances of each wave are compared
with the stored distances for the corresponding pattern. With
deviating or not-stored distances, the pattern is classified as
pattern 0.
D. Determination of the Dominant Pattern by
a Moore Machine
Another possibility is to identify the dominant pattern with a
Moore machine (see Fig. 6). The Moore machine is a finite-state
machine. The output of this machine only depends on the state
of the machine [18]. The output of the machine is the dominant
pattern Pi with i = 0, . . . , 5. The output is influenced by the
distribution of recognized patterns in a window. If one pattern
was detected five times and is adjacent to the current dominant
pattern, this pattern is selected as new dominant pattern Pi .
Due to respiration and the associated low-pressure fluctuations
causing waveform changes, two patterns can often be found in
one window and, in most cases, there are ≤ 5 waves of the same
pattern in one window. Therefore, up to four additional windows
are analyzed and the distribution of recognized patterns changes
with newly recognized patterns, until one pattern is detected five
times.
An exception is the detection of three waves of the same pattern, which is two or more patterns away from the dominant

ELIXMANN et al.: CONTROL OF AN ELECTROMECHANICAL HYDROCEPHALUS SHUNT—A NEW APPROACH

Fig. 7. Setup of the ball-in-cone valve. A ball is used to close the shunt and
is pushed by the spring placed rear-ward, whose tension Fsp rin g is set by the
linear piezo motor. To increase the tension and thereby the opening pressure
P o p e n , the motor has to move in the direction of the spring (Δz).

one. In this case, a change to the adjacent pattern is allowed.
Thus, B-waves (low-frequency ICP waves) accompanied by a
rapid change of the pulse waveform [19], can still be recognized
using this new approach. It is assumed that, after shunt implantation, changes of the waveform are slow and jumps over more
patterns are not expected (except with B-waves). Therefore, the
algorithm should normally detect five waves of a pattern adjacent to the dominant one, before three waves of a pattern that is
further away from the dominant pattern.
V. MODELING AND CONTROL DESIGN OF THE
ELECTROMECHANIC HYDROCEPHALUS SHUNT
A model of the cerebrospinal system, together with a model
of the valve, was used to develop and validate the control unit
R
.
in MATLAB/Simulink
The model of the cerebrospinal system consists of a volume
storage for the craniospinal system with a compliance C, an
input Qpro d as the excess production rate of CSF (the CSF
production rate minus the CSF resorption), and an output QDrain
as the drainage through the shunt. The production rate and the
compliance are pressure dependent; however, for the considered
ICP values the production rate and compliance are assumed to be
constant. Based on this model, the ICP is calculated as follows:

1
(2)
ICP(t) =
(Qpro d − QDrain )dt.
C
The electromechanical shunt consists of a ball-in-cone valve
with an adjustable opening pressure Pop en . The shunt is closed
if the pressure across the shunt is smaller than Pop en , otherwise
the valve opens. A small linear piezo motor changes the tension
of a spring, which pushes the ball into the cone to set the opening
pressure (see Fig. 7). The piezo motor’s position is measured
with a hall-sensor and controlled by the microcontroller.
Pop en depends on the position z of the piezo motor, the spring
constant cspring (0.035 N/mm) and the surface of the ball Aball
(5,4 mm2 ):
cspring
Pop en =
· z.
(3)
Aball
The flow through the shunt QDrain mainly depends on the
flow resistances of the tubes before and after the valve Rshunt ,
and to a small extent on the resistance of the valve itself Rvalve
and the pressure across the shunt:


ICP + ΔPhyd − Pab d − Pop en
QDrain = max 0,
. (4)
Rshunt + Rvalve

2383

Here, ΔPhyd is the hydrostatic pressure difference between
the tube endings of the shunt (equal to zero if the patient is
supine) and Pab d is the abdominal pressure at the resorption
side. For simplicity, Pab d was assumed to be a constant value of
6 mmHg. Drainage is only possible if ICP + ΔPhyd > Pab d +
Pop en , otherwise the flow equals zero.
Every 30 s, the waveform is determined by the classification
algorithm with the Moore machine over ICP measurements of
up to 20 s. Depending on the dominant pattern, the opening
pressure of a ball-in-cone valve has to be decreased to drain
CSF if patterns 3, 4, or 5 are detected, or increased to avoid
overdrainage if pattern 1 is dominant. In case of a noisy signal,
determination of the waveform could result in pattern 0 and
waveform control would be disabled. In this situation, AMP is
used as an alternative control variable (see Fig. 8).
For the alternative AMP control, the resulting control error e1 is the difference between AMPtarget and the measured
AMPoutput . The multiplication with the controller gain KI,AM P
leads to the adaptation dP :
dP = KI,AM P · (AMPtarget − AMPoutput ).

(5)

For waveform control, there is a considerable discretization
between the patterns. Depending on the measured pattern, an
adaptation of ICPtarget by adding the value dP is stored in a
look-up table LUTpattern . For pattern 1, the adaptation is positive, whereas for patterns 3–5 it is negative with an increasing
value to pattern 5. The item for pattern 2 in LUTpattern is 0.
A sampling time of 30 s for pattern determination is too long
for some disturbance which result in a fast pressure change
across the valve, such as ΔPhyd when standing up. Therefore,
a sampling time of 1 s followed by an averaging 5 s filter has
been implemented. This inner-loop controller guarantees that
the desired ICP determined by the waveform algorithm is stabilized (see Fig. 8). The filter determines ICP every second by a
moving window of 5 s filled with 100-Hz data ICPm easured by
the following equation:
ICP(t) = 0.5 · (min(ICPm easured ) + max(ICPm easured ))
(6)
and is effective to eliminate ICP oscillations due to volume
changes in cranial blood vessels during respiration and pulsation, which cannot and should not be eliminated by control.
From the considered disturbances, the change of the patient’s
position can induce a change in pressure on the valve, which is
five times greater than the target ICP. The hydrostatic pressure
ΔPhyd of the water column in the shunt tubes of total length
ltub e = 60 cm connected to the valve linking the cranium with
the abdomen changes with the inclination angle α (for a patient
in supine position α = 0◦ ):
ΔPhyd = ρ · g · sin(α) · ltub e .

(7)

For an effective control, disturbance feedforward control has
been implemented which adds a Δzhyd to the control value
zcontrol depending on the measured angle at 1 s sampling time:
Δzhyd =

Aball
· ΔPhyd .
cspring

(8)

2384

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 9, SEPTEMBER 2014

Fig. 8. Block diagram of shunt control based on waveform or AMP, respectively, in a closed-loop simulation with a cerebrospinal fluid and a ball-in-cone valve
model. A cascaded control approach is proposed consisting of an outer-loop control to set ICP ta rg e t from the ICP pulse waveform or AMP and an inner-loop
control to hold this ICP ta rg e t . The control unit includes a reference and disturbance feedforward control for the fast control of changes in body posture α and
hence resulting hydrostatic pressure ΔP hy d .

Additionally, a reference feedforward control has been implemented for the target ICP as it changes with the patient’s
position according to
ΔICPphys = ΔICPphys,m ax · sin(α)

(9)

with ΔICPphys,m ax being the maximum physiological change
of ICP when the patient’s position changes from supine to
upright (for the simulation ΔICPphys,m ax = −8 mmHg was
used). However, there might be an error in the angular measurement, e.g., due to implant displacement over time. The error in
the disturbance feedforward control value has to be corrected by
the inner-loop ICP controller. The outer-loop controller determines the target ICP (ICPtarget ) and adjusts it. This is necessary
if the pressure sensor measures with an offset (which may occur
in an implant after some time) or the compliance has changed.
The overlaid controller has to be conservative, so as not to influence the ICP control during disturbances.
In our simulation, the ICP waveform reconstruction was
skipped. Only the absolute ICP has been simulated and the
AMP and pattern waveform were deduced. The relationship
between the AMP or pattern number and the ICP was established from one infusion test for the simulation (see Fig. 9).

Fig. 9. Relationship between the AMP or pattern number (1–5) and ICP
established from one infusion test for the simulation.

During an infusion test, two patterns are often in the same pressure range; however, for simplification, a regression curve of
the AMP to ICP was approximated and specific pressure limits
for the patterns were chosen (see Table II). For the simulation,
target pressure was chosen to be in the middle of pattern 2 at
10 mmHg.
The values of the outer-loop controller KI,AM P and
KI,Valve were determined by nonlinear least-squares method

ELIXMANN et al.: CONTROL OF AN ELECTROMECHANICAL HYDROCEPHALUS SHUNT—A NEW APPROACH

2385

TABLE II
THE ICP AND THE AMP RANGE FOR EACH PATTERN TO DETERMINE THE
PATTERN AND AMP FOR THE SIMULATED ICP

(Levenberg–Marquardt algorithm) to minimize the cost function during a change in α as disturbance:
J=

k
end




(ICPk − ICPtarget,k )2 · t + 100 · Δzoutput,k 2 · tk

k =1

(10)
with the change in piezo motor position Δzoutput in mm, the
pressures in mmHg and the discrete time tk in seconds. This
cost function of integrated squared error was chosen to obtain
a slow control with only slight overshoot. An additional term
has been added to minimize remaining changes in the actuator
position and thus save energy.
To determine the control parameters by minimizing the cost
function, a typical but demanding disturbance scenario was simulated. In this scenario, a person in supine position stands up
with disturbance feedforward control which compensates for
only 90% of the change and the optimal control parameter
KI,Valve of the inner-loop controller was obtained. To determine
the parameter KI,AM P for the outer-loop controller, a pressure
drift with a constant slope of 0.001 mmHg/s on the pressure
sensor was simulated in addition to the change in body position.
The change in body position was added during optimization so
that the parameter of the outer-loop controller is conservative
enough to ensure that no oscillations occur due to an influence
on the inner-control loop. The optimal values for the waveform
control depend on which ICP the class limits lie. When ICP
reaches a limit of the pattern, the optimal dP is the difference
between ICP and ICPtarget .

Fig. 10. Average ICP, AMP, and Compliance (with error bars showing the
standard deviation) over the waveform patterns of dynamic infusion tests from
different patients, when ICP is falling due to resorption of the injected fluid.
TABLE III
RESULTS OF THE CLASSIFICATION OF PATIENT DATA FROM THREE INFUSION
TESTS AND TWO LONG TIME RECORDS USING THE EXISTING ALGORITHM [12]
AND THE TWO NEW ALGORITHMS DESCRIBED HERE

VI. RESULTS
A. Analysis of Relations in Infusion Tests
In 80% of the long-term records of ICP, increased AMPs (≥
4 mmHg) together with waveforms of patterns 3–5 were found.
In 21 dynamic infusion tests, ICP, AMP, waveform pattern,
and compliance were analyzed, including their correlations (see
Fig. 10). The compliance was calculated based on the definition
of Meier [16].This needs a smooth increase and decrease of
ICP; however, patient movements and noise made compliance
determination in nine infusion tests impossible.
The AMP over the waveform patterns in Fig. 10 shows an
increasing AMP from ≥ 4 mmHg to 13 ± 5 mmHg with an increasing waveform pattern number. The calculated compliance
in Fig. 10 indicates that the compliance decreases with the waveform pattern in all 12 infusion tests. Therefore, it is concluded
that, as expected, both the waveform and the AMP change together with a change in compliance. It should be noted that
the curve shapes and the absolute values are patient-dependent,
including AMP and compliance over ICP.

B. Validation of the Algorithms for Pulse Wave Analysis
The new classification algorithms presented here, and the
original algorithm, were compared with visual classifications
of ICP data. The percentages of correct classifications of these
algorithms and the previous developed algorithm [12] are presented in Table III.
The presented algorithm is computationally cost-effective
and easy to be implemented on a microcontroller. In addition,
the results in Table III demonstrate the superiority of the new
algorithms.
The new algorithm with the Moore machine performed best,
also when white noise was added to the signal. The learning
algorithm showed a high sensitivity for white noise. The patterns

2386

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 9, SEPTEMBER 2014

TABLE IV
PARAMETERS DETERMINED FOR THE WAVEFORM CONTROL UNIT
(LUT P a tte rn ), THE AMP CONTROL UNIT (K I, A M P ) AND THE ICP
CONTROL UNIT (K I, Va lve ) AFTER OPTIMIZATION WITH NONLINEAR LEAST
SQUARES METHOD

Fig. 12. Inner-loop ICP control during a simulated change in production rate
Q P ro d at t = 100 s.

Fig. 11. Inner-loop ICP control with reference and disturbance feedforward
control during a simulation of a patient standing up (angle Δα = 90◦ ) with the
resulting change in ICP ta rg e t at t = 100 s.

in a signal were not always correctly determined because of this
noise and wrong patterns were learned.
Our test rig succeeded in generating the pulse wave patterns. With an additional noise in the pressure signal due to
a slight damage on the sensor’s surface the sensitivity of the
pattern recognition within the implant deteriorated from 82.9%
to 72.6%. However, the classification algorithm choses pattern
0 rather than selecting a wrong pattern. Both hardware and software of the implant prototype worked properly. The proposed
algorithm was able to identify a pattern within the sampling time
of the control loop, which was the purpose to evaluate through
the test rig.
C. Simulations and Control Unit Parameter Determination
From a medical point of view, a difference of 10 mmHg in
ICP can be tolerated for ≤30 s and ICP should not deviate (on
average) ≥2 mmHg from the ICPtarget [20]. In this example, the
“healthy pattern” (pattern 2) lies within a range of 2.3 mmHg
(from 8.9 to 11.2 mmHg).Therefore, the performance of the
control algorithm can be considered successful if the ICP stays
within class 2 or abandons it for ≤30 s.
With the optimized parameters presented in Table IV, three
control scenarios for disturbances will be presented.
Fig. 11 shows the result of the simulation when a patient
stands up (at time t = 100 s): there is a physiological change in
ICPtarget and the actuator position changes quickly due to the

Fig. 13. Comparison of the outer-loop pattern (black line) and alternative
AMP (grey line) control of the electromechanic valve for a simulated growing
offset of 0.001 mmHg/s in ICP measurements.

disturbance feedforward control. Small decreasing oscillations
staying within pattern 2 occur with the inner-loop ICP control
because disturbance feedforward control only worked for 90%
of change in this simulation.
A change in production rate is likely to occur during the day
and can be controlled as shown in the simulation of a production
rate increase of 2 ml/h/min in Fig. 12. The actuator position
changes with minimal step size of 2.5 μm when ICP changes
more than its resolution of 0.1 mmHg.
Finally, Fig. 13 demonstrates how the outer-loop controller
reacts to an assumed offset in ICP measurements. For the pattern controller, the change/adjustment in ICPtarget only occurs
when ICP crosses the bound of pattern 2 to 3. Before this change
in target pressure, the inner-loop ICP controller tries to maintain
the old target pressure, although the measured ICP drifts. In contrast, the AMP controller immediately measures the change in
AMP during drift and adjusts ICPtarget slowly (as the parameter
value of KI,AM P is tuned in a conservative way).

ELIXMANN et al.: CONTROL OF AN ELECTROMECHANICAL HYDROCEPHALUS SHUNT—A NEW APPROACH

VII. SUMMARY AND OUTLOOK
A preexisting algorithm with low computational cost for
pulse waveform classification inside an implant was significantly improved with the help of a Moore machine. The algorithm was evaluated on patient data and showed similar good
results comparing favorably to published algorithms by other
research groups with more computational power. The proposed
algorithm was implemented on our electromechanical shunt to
evaluate its online performance on a low-power microcontroller
at a test rig, which induced the waveform patterns. Hard- and
software of the implant prototype worked well and the time required to measure, analyze and determine the intracranial state
using the new algorithm was ≤30 s, which was the simulated
sampling time for a new simulated control approach.
Initial steps in the development of a control concept based
on ICP waveform have been proposed; the presented results
of a simulation demonstrate that a simple cascaded controller
(consisting of an inner-loop and outer-loop controller) might be
suitable for this task. An additional AMP controller was integrated as an option, if noisy signals prevent the classification
of pulse waveform. The use of the AMP controller as sole controller is not recommended, because the AMPs of patterns 1–3
were almost the same in several patients. A discrete waveform
pattern as a control variable allows more accurate control of the
state of the cerebrospinal system. Weaning off the shunt for patients with waveform pattern 1 might be possible by decreasing
the drainage.
Future in-vitro studies should extend the test rig, so that pulse
waveform can be generated within the closed-loop test scenarios. The craniospinal space was simplified by only one single
compliance chamber. It would be more realistic to evaluate a
shunt with a life-size phantom as recently developed by Bottan
et al. [21], [22].
Future clinical studies need to investigate the temporal dynamics at which the waveform is changing after CSF drainage
(which was assumed to be negligible in this paper). Studies also
need to investigate if this waveform approach is suitable for all
hydrocephalus patients and in which cases the dependency of
waveform on compliance might be disturbed too much through
other features like a change in heart rate or obstruction of the
CSF pathway into the spine. According to a recent study of
Eide et al., changes in cardiac output or blood pressure amplitude have no influence on AMP in NPH patients with intact
autoregulation [23].
ACKNOWLEDGMENT
The authors gratefully acknowledge financial support received from the BMBF with the project “iShunt”, the support
received from our project partner Reco Medizintechnik Wolfgang Rentsch e.K., Raumedic AG, and the support of HNP
Mikrosysteme GmbH, Germany.
REFERENCES
[1] M. E. Wagshul, P. K. Eide, and J. R. Madsen, “The pulsating brain: A
review of experimental and clinical studies of intracranial pulsatility,” in
Proc. Fluids Barriers CNS, 2011, vol. 8, no. 1.

2387

[2] D. Greitz, “Radiological assessment of hydrocephalus: New theories and
implications for therapy,” Neurosurg. Rev., vol. 27, no. 3, pp. 145–165,
2004.
[3] S. Jetzki, M. Weinzierl, I. Krause, S. Hahne, H. Rehbaum, M. Kiausch,
I. Kozubek, C. Zhellenbroich, M. Oertel, M. Walter, and S. Leonhardt,
“A multisensor implant for continuous monitoring of intracranial pressure
dynamics,” IEEE Trans. Biomed. Eng., vol. 6, no. 4, pp. 356–365, Aug.
2012.
[4] E. R. Cardoso, J. O. Rowan, and S. Galbraith, “Analysis of the cerebrospinal fluid pulse wave in intracranial pressure,” J. Neurosurg, vol. 59,
no. 5, pp. 817–821, 1983.
[5] O. Hirai, H. Handa, M. Ishikawa, and S. H. Kim, “Epidural pulse waveform as an indicator of intracranial pressure dynamics,” Surg. Neurol.,
vol. 21, no. 1, pp. 67–74, 1984.
[6] S. Asgari, M. Bergsneider, R. Hamilton, P. Vespa, and X. Hu, “Consistent changes in intracranial pressure waveform morphology induced by
acute hypercapnic cerebral vasodilatation,” Neurocrit. Care, vol. 15, no. 1,
pp. 55–62, 2011.
[7] D. J. Doyle and P. W. S. Mark, “Analysis of intracranial pressure,” J. Clin.
Monitor Comp., vol. 8, pp. 81–90, 1992.
[8] M. Czosnyka, P. Wollk-Laniewski, L. Batorski, and W. Zaworski, “Analysis of intracranial pressure waveform during infusion test,” Acta Neurochir., vol. 93, pp. 140–145, 1988.
[9] A. Raabe, M. Czosnyka, I. Piper, and V. Seifert, “Monitoring of intracranial compliance: correction for a change in body position,” Acta Neurochir., vol. 141, no. 1, pp. 31–36, 1999.
[10] A. Calisto, M. Galeano, S. Serrano, A. Calisto, and B. Azzerboni,
“A new approach for investigating intracranial pressure signal: filtering and morphological features extraction from continuous recording,” IEEE Trans. Biomed. Eng., vol. 60, no. 3, pp. 830–837, Mar.
2013.
[11] X. Hu, P. Xu, F. Scalzo, P. Vespa, and M. Bergsneider, “Morphological
clustering and analysis of continuous intracranial pressure,” IEEE Trans.
Biomed. Eng., vol. 56, no. 3, pp. 696–705, Mar. 2009.
[12] I. M. Elixmann, J. Hansinger, C. Goffin, S. Antes, K. Rademacher, and
S. Leonhardt, “Single pulse analysis of intracranial pressure for a hydrocephalus implant,” in Proc. IEEE 34th Ann. Int. Conf. Eng. Med. Biol.
Soc., 2012, pp. 3939–3942.
[13] E. L. Foltz and C. Aine, “Diagnosis of hydrocephalus by CSF pulse-wave
analysis: A clinical Study,” Surg. Neurol., vol. 15, no. 4, pp. 283–293,
1981.
[14] M. Czosnyka, Z. Czosnyka, S. Momjian, and J. D. Pickard, “Cerebrospinal
fluid dynamics,” Physiol. Meas., vol. 25, no. 5, pp. R51–R76, 2004.
[15] P. K. Eide and W. Sorteberg, “Changes in intracranial pulse pressure amplitude after shunt implantation and adjustment of shunt valve opening
pressure in normal pressure hydrocephalus,” Acta Neurochir., vol. 150,
no. 11, pp. 1141–1147, 2008.
[16] U. Meier, F. S. Zeilinger, and D. Kintzel, “Diagnostic in normal pressure hydrocephalus: A mathematical model for determination of the ICPdependent resistance and compliance,” Acta Neurochir., vol. 141, no. 9,
pp. 941–947, 1999.
[17] M. Kwiecien, I. M. Elixmann, and C. Goffin, “A comparison of different
algorithms of single pulse analysis on an electromechanical hydrocephalus
shunt,” in Proc. 17th Int. Student Conf. Electr. Eng., 2013.
[18] E. F. Moore, “Gedanken-experiments on sequential machines,” in Automata Studies, Annals of Mathematical Studies. Princeton, NJ, USA:
Princeton University Press, 1956, vol. 34, pp. 129–153.
[19] M. Kasprowicz, S. Asgari, M. Bergsneider, M. Czosnyka, R. Hamilton,
and X. Hu, “Pattern recognition of overnight intracranial pressure slow
waves using morphological features of intracranial pressure pulse,” J.
Neurosci. Meth, vol. 190, pp. 310–318, 2010.
[20] S. Jetzki, M. Kiefer, M. Walter, and S. Leonhardt, “Concepts for a mechatronic device to control intracranial pressure,” presented at the IFAC Symp.
Mechatronic Syst., Heidelberg, Germany, 2006.
[21] S. Bottan, D. Poulikakos, and V. Kurtcuoglu, “Phantom model of physiologic intracranial pressure and cerebrospinal fluid dynamics,” IEEE Trans.
Biomed. Eng., vol. 59, no. 6, pp. 1532–1538, Jun. 2012.
[22] M. Schmid Daners, S. Bottan, L. Guzzella, D. Poulikakos, and
V. Kurtcuoglu, “Craniospinal pressure-volume dynamics in phantom models,” IEEE Trans. Biomed. Eng., vol. 59, no. 12, pp. 3482–3490, Dec. 2012.
[23] P. K. Eide, “Cardiac output in idiopathic normal pressure hydrocephalus:
association with arterial blood pressure and intracranial pressure wave
amplitudes and outcome of shunt surgery,” in Proc. Fluids Barriers CNS,
2011, vol. 8, no. 1.

2388

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 9, SEPTEMBER 2014

Inga M. Elixmann was born in Recklinghausen, Germany, in 1982. She received the Dipl.-Ing.(FH) degree in electrical engineering from Aachen University
of Applied Sciences, Aachen, Germany, in 2007, and
the M.Sc. degree in electrical engineering from the
Technical University of Munich, Munich, Germany,
in 2008. She is currently working toward the Ph.D.
degree at the RWTH Aachen University, Aachen.
In 2008, she joined the Philips Chair of Medical
Information Technology at RWTH Aachen University, as a Member of the scientific staf. Her research
interests include hydrocephalus therapy, signal processing, physiological modeling, and control theory.

Monika Kwiecien was born in Mielec, Poland, in
1986. She received the Dipl.-Ing. degree in electrical engineering from RWTH Aachen University,
Aachen, Germany, in 2012, where she is currently
working toward the Ph.D. degree.
In 2013, she joined the Institute for Power Electronics and Electrical Drives at RWTH Aachen University, as a Member of the scientific staf.

Christine Goffin was born in Aachen, Germany, in
1984. She received the Dipl.-Ing. degree in mechanical engineering from Aachen University of Applied
Sciences, Aachen, where she is currently working toward the Ph.D. degree.
In 2010, she joined the Chair of Medical Engineering at RWTH Aachen University, Aachen, Germany,
as a Member of the scientific staf. Her research interests include hydrocephalus therapy and physiological
modeling.

Michael Kiefer was born in Saarbruecken, Germany,
in 1963. He studied medicine at the Saarland University, Saarbruecken, Germany, where he received the
M.D. degree for his thesis entitled “SEM-studies of
the ependyma in hydrocephalic rats,” and the Habilitation degree for his Postdoctoral thesis entitled “innovative methods on indicating and new treatment
modalities in hydrocephalus,” in 2006.
He has been a Consultant for neurosurgery since
1996, and a Senior Consultant, since 2001, at the
Saarland University, where he currently works as the
Managing Senior Consultant. Hewas made a Professor by the Saarland University in 2010. Additionally, he works as the Delegate of the German Neurosurgical
Society with DIN (Deutsches Institut fuer Normung e.V.) and has been involved
in the establishment of national and international guidelines on hydrocephalus.

Wolf-Ingo Steudel was born in Freiburg/Breisgau,
Germany, in 1944. He studied medicine at the universities of Freiburg, Kiel, Munich and Ulm, all in
Germany. He received the Graduation degree from
the University of Kiel, Kiel, Germany. He received
the Habilitation degree in cerebral hemorrhage from
Johann Wolfgang Goethe University, Frankfurt, Germany, in 1983.
The topic of his dissertation, during his stay at the
University of Kiel, was the innovation time of new
findings in the Licensing Regulations. He was a Senior Physician at the Department of Neurosurgery, Johann Wolfgang Goethe
University, where he became a Private Docent, in 1983, and later an Applient
Professor. He is an Honorary Professor of the Tongji Medical University, Wuhan,
China. Since 1991 until 2011, he was the Chairman of the Neurosurgical Department, University of Saarland. Since 2011, he has been the Chief Executive
Officer and the Chairman of the Executive Board of the Saarland University.

Marian Walter (M’97) was born in Saarbrücken,
Germany, in 1966. He studied electrical engineering,
with a specialization in control engineering, at Technische Universität Darmstadt, Darmstadt, Germany,
where he received the Dipl.-Ing. and the Dr.-Ing. degrees, in 1995 and 2002, respectively.
He has worked in the medical engineering industry
for three years and was appointed as a Senior Scientist
at the Philips Chair of Medical Information Technology, RWTH Aachen University, Aachen, Germany, in
2004. His research interests include noncontact monitoring techniques, signal processing, and feedback control in medicine.

Klaus Radermacher was born in Kirchen, Germany,
in 1964. He received the Dipl.-Ing. degree in mechanical engineering from the Technische Universität
Darmstadt, Darmstadt, Germnay, and the Dr.-Ing.
degree in mechanical Engineering from the RWTH
Aachen University, Aachen, Germany.
From 1990 to 2001, he was a Research Associate of the FGBMT Aachen e.V., Aachen (engaged
in ergonomics in medicine, biomechanics and computer assisted surgery). From 2001 to 2005, he was
a Cofounder and the Chief Executive Officer of the
SurgiTAIX AG, Aachen, and a Senior Research Engineer at the Chair of Applied
Medical Engineering of the Medical Faculty of the RWTH Aachen University.
Since 2005, he has been the Head of the Chair of Medical Engineering of the
Mechanical Engineering Faculty of the RWTH Aachen University.

Berno Misgeld was born in Euskirchen, Germany,
in 1979. She received the Dipl.-Ing. (FH) in electrical and automation engineering from University of
Applied Sciences, Aachen, Germany, and the M.Sc.
degree from Coventry University, Coventry, U.K., in
2003, respectively. In 2007, he received the Dr.-Ing.
degree in biomedical and control engineering from
Ruhr-University Bochum, Bochum, Germany.
From 2006 to 2011, he was a Research and Development Engineer for guidance and flight control systems at Diehl-BGT-Defence, Ueberlingen, Germany.
Since 2011, he is a Senior Scientific Engineer in biomechatronical systems
and rehabilitation robotics at the Chair of Medical Information Technology at
RWTH Aachen University, Aachen, Germany. His research interests include
feedback control and filtering with application to biomedical systems, robotics
and medicine.

Steffen Leonhardt (SM’06) was born in Frankfurt,
Germany, in 1961. He received the M.S. degree in
computer engineering from State University of New
York System, Buffalo, NY, USA, the Dipl.-Ing. degree in electrical engineering and the Dr.-Ing. degree
in control engineering from the Technische Universität Darmstadt, Darmstadt, Germany, and the M.D.
degree in medicine from J. W. Goethe University,
Frankfurt, Germany.
He has five years of R&D management experience in the medical engineering industry and was
appointed as a Full Professor and Head of the Philips endowed Chair of Medical Information Technology at RWTH Aachen University, Aachen, Germany,
in 2003. His research interests include physiological measurement techniques,
personal health care systems, and feedback control systems in medicine.

