522

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

TROIKA: A General Framework for Heart Rate
Monitoring Using Wrist-Type
Photoplethysmographic Signals During
Intensive Physical Exercise
Zhilin Zhang∗ , Member, IEEE, Zhouyue Pi, Senior Member, IEEE, and Benyuan Liu

Abstract—Heart rate monitoring using wrist-type photoplethysmographic signals during subjects’ intensive exercise is a difficult problem, since the signals are contaminated by extremely
strong motion artifacts caused by subjects’ hand movements. So
far few works have studied this problem. In this study, a general
framework, termed TROIKA, is proposed, which consists of signal
decomposiTion for denoising, sparse signal RecOnstructIon for
high-resolution spectrum estimation, and spectral peaK trAcking
with verification. The TROIKA framework has high estimation accuracy and is robust to strong motion artifacts. Many variants can
be straightforwardly derived from this framework. Experimental
results on datasets recorded from 12 subjects during fast running
at the peak speed of 15 km/h showed that the average absolute
error of heart rate estimation was 2.34 beat per minute, and the
Pearson correlation between the estimates and the ground truth of
heart rate was 0.992. This framework is of great values to wearable
devices such as smartwatches which use PPG signals to monitor
heart rate for fitness.
Index Terms—Ambulatory monitoring, heart rate monitoring,
photoplethysmograph (PPG), signal decomposition, singular spectrum analysis (SSA), sparse signal reconstruction (SSR), wearable
computing.

I. INTRODUCTION
EART rate (HR) monitoring for fitness is important for
exercisers to control their training load. Thus, it is a key
feature in many wearable devices, such as Samsung Gear Fit,
Atlas Fitness Tracker, and Mio Alpha Heart Rate Sport Watch.
These devices estimate HR in real time using photoplethysmographic (PPG) signals recorded from wearers’ wrist.
PPG signals [1], [2] are optically obtained by pulse oximeters.
Embedded in a wearable device, a pulse oximeter illuminates a
wearer’s skin using a light-emitting diode (LED) and measures
intensity changes in the light reflected from skin, forming a
PPG signal. The periodicity of the PPG signal corresponds to

H

Manuscript received July 10, 2014; revised September 5, 2014; accepted
September 9, 2014. Date of publication September 19, 2014; date of current
version January 16, 2015. Asterisk indicates corresponding author.
∗ Z. Zhang is with the Emerging Technology Lab, Samsung Research
America—Dallas, Richardson, TX 75082 USA (e-mail: zhilinzhang@ieee.org).
Z. Pi is with the Emerging Technology Lab, Samsung Research America—
Dallas, Richardson, TX 75082 USA (e-mail: z.pi@samsung.com).
B. Liu is with the Science and Technology on Automatic Target Recognition
Laboratory, National University of Defense Technology, Changsha 410074,
China (e-mail: liubenyuan@gmail.com).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2014.2359372

the cardiac rhythm, and thus, HR can be estimated using the
PPG signal.
However, PPG signals are vulnerable to motion artifacts
(MA), which strongly interfere with HR monitoring in fitness.
Many signal-processing techniques have been proposed to remove MA.
One technique is independent component analysis (ICA). For
example, Kim and Yoo [3] suggested to use a basic ICA algorithm and block interleaving to remove MA. Krishnan et al. later
[4] proposed using frequency-domain-based ICA. However, the
key assumption in ICA, namely statistical independence or uncorrelation, does not hold in PPG signals contaminated by MA
[5]. Thus, MA removal is not satisfactory. Besides, using ICA
needs multiple PPG sensors, which may not be feasible in some
wearable devices.
Another technique is adaptive noise cancelation (ANC) [6],
[7]. For example, Ram et al. [6] proposed using ANC to remove MA, where the reference signal was constructed from fast
Fourier transform (FFT), singular value decomposition (SVD),
or ICA of artifact-contaminated PPG signals. However, one
limitation in this technique is that the artifact-removal performance of ANC is sensitive to the reference signal, and reconstructing qualified reference signals is difficult when subjects
are exercising.
Acceleration data are also helpful to remove MA. For example, Fukushima et al. [8] suggested a spectrum subtraction
technique to remove the spectrum of acceleration data from that
of a PPG signal. Acceleration data can be also used to reconstruct the observation model for Kalman filtering [9] to remove
MA. However, acceleration data (in three axis) reflect hand
movement in 3-D space, while MA in a PPG signal originates
from changes of the gap between skin and a pulse oximeter’s
surface. Thus, in the presence of irregular and complicated hand
movements, merely exploiting acceleration data may not gain
large benefits.
Other MA-removal techniques include electronic processing
methodology [10], time-frequency analysis [11], wavelet denoising [12], and empirical mode decomposition (EMD)[13], to
name a few.
Most of these techniques were proposed for clinical scenarios,
when wearers performed small motions, such as finger movements [4], [6], [7], [14] and walking [7]. In these scenarios, MA
was not strong. Thus, these techniques may not work well when
wearers perform intensive physical exercise.

0018-9294 © 2014 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

ZHANG et al.: TROIKA: A GENERAL FRAMEWORK FOR HEART RATE MONITORING

Only a few techniques were proposed for HR monitoring in
fitness. But most of them focused on slowly running (speed
slower than 8 km/h) [7], [15], [16], and PPG data were recorded
from fingertip [7], [15] or ear [16]. In these cases, MA was not
very strong and even exhibited characteristics facilitating HR
estimation [15].
Also, few works studied MA removal in PPG signals recorded
from wrist. Comparing to fingertip and earlobe, wrist can cause
much stronger and complicated MA due to large flexibility of
wrist and loose interface between pulse oximeter and skin.
However, recording PPG from wrist greatly facilitates design
of wearable devices and maximizes user experience. Furthermore, estimating HR from wrist-type PPG signals becomes
a popular feature in smartwatch-type devices. Thus, developing high-performance HR monitoring algorithms for wrist-type
PPG signals is of great values.
This study focuses on HR monitoring using wrist-type PPG
signals when wearers perform intensive physical activities. A
novel framework is proposed. Termed TROIKA, it consists of
three key parts, namely signal decomposiTion, sparse signal RecOnstructIon (SSR), and spectral peaK trAcking. Signal decomposition aims to partially remove MA in a raw PPG signal and
sparsify its spectrum. SSR aims to calculate a high-resolution
spectrum of the PPG signal, which is robust to noise interference
and is advantageous over traditional nonparametric spectrum estimation algorithms and model-based line spectrum estimation
algorithms. Spectral peak tracking is also a necessary part of the
TROIKA framework, which seeks the spectral peak corresponding to HR. To further overcome strong interference from MA
and complement the peak selection approach, some decision
mechanisms are designed to verify the selected spectral peak.
Experimental results on datasets recorded from 12 subjects
during fast running at the peak speed of 15 km/h showed that the
proposed framework has high estimation performance with the
average absolute error being only 2.34 beat per minute (BPM).
The remainder of this paper is organized as follows. Section
II states the HR monitoring problem and our motivations. Section III presents the TROIKA framework. Section IV describes
recorded datasets, experiment settings, and experimental results.
Conclusion is given in the last section.
MATLAB codes and datasets used in experiments are available at the first author’s homepage: https://sites.google.com/
site/researchbyzhang/. A preliminary work has been published
in [17].
II. PROBLEM STATEMENT AND MOTIVATIONS
When MA is strong, estimating HR in the time domain is difficult. A natural approach is to estimate HR using power spectrum
estimation. One widely used algorithm is the Periodogram algorithm computed via FFT [18]. However, Periodogram has some
drawbacks.
First, Periodogram is an inconsistent spectrum estimator and
has high variance [18]. Second, Periodogram has serious leakage
effect [18]. Thus, a dominant spectral peak can lead to an estimated spectrum that contains power in frequency bands where

523

Fig. 1. Example showing the leakage effect of Periodogram. (a) Raw PPG
signal sampled at 125 Hz and bandpass filtered from 0.4 to 5 Hz. It has a
dominant quasi-periodic signal component caused by rhythmic hand swing
and a weak signal component caused by heartbeat. The two components have
close periods. (b) PPG’s spectrum calculated by Periodogram. The spectral
peak corresponding to HR (indicated by a circle) cannot be distinguished from
the one corresponding to the hand swing. (c) PPG’s spectrum calculated by
FOCUSS [19], an SSR algorithm. The two spectral peaks are clearly separated.
The ground truth HR is obtained from simultaneously recorded ECG.

there should be no power. The effect can make a weak spectral
peak associated with HR smeared, if a dominant spectral peak
associated with MA is nearby.
Fig. 1(a) and (b) shows a raw PPG signal and its spectrum
calculated by Periodogram, respectively. The signal has a dominant quasi-periodic signal component resulting from rhythmic
hand swing and another signal component corresponding to
heartbeat. The two components have close periods. Due to the
leakage effect, the spectral peak associated with the HR cannot be separated from the peak associated with the hand swing
rhythm. Thus, an error in HR estimation could occur.
This example motivates using high-resolution line spectrum
estimation. However, conventional high-resolution line spectrum estimation algorithms such as MUSIC require model order
selection, which is difficult for MA-contaminated PPG signals,
since the spectra of MA are complicated and time-varying.
The limitations of conventional nonparametric spectrum estimation and high-resolution line spectrum estimation motivate
us to use SSR [19]–[21]. Recently, it is found that SSR-based
spectrum estimation has a number of advantages over traditional spectrum estimation [22]. Compared to nonparametric
spectrum estimation methods such as Periodogram, the SSRbased spectrum estimation features high spectrum resolution,
low estimation variance, and increased robustness; compared to
conventional line spectral estimation methods, the SSR-based

524

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

Fig. 2. Example showing many spectral peaks exhibit when MA occurs.
(a) PPG signal after bandpass filtered from 0.4 to 5 Hz. (b) Spectrum calculated by Periodogram. (c) Spectrum calculated by FOCUSS. The circles in
(b) and (c) indicate the frequency location corresponding to the true HR (which
is calculated from simultaneously recorded ECG).

spectrum estimation does not require model selection and has
improved estimation performance. Fig. 1(c) shows the spectrum
calculated by an SSR algorithm, where the spectral peak associated with the HR is clearly separated from the spectral peak
associated with the hand swing.
Note that SSR requires that the spectrum to estimate is sparse
or compressive, that is, the spectrum has a few spectrum coefficients of large nonzero values, while other coefficients have
zero values or nearly zero values. Since MA-contaminated PPG
signals may not have sparse/compressive spectra, SSR needs
preprocessing to sparsify the spectra.
However, a high-resolution spectrum estimation algorithm is
insufficient to solve the problem of HR monitoring. A large gap
between a pulse oximeter and skin could make the spectral peak
associated with HR buried in random spectral fluctuations, as
shown in Fig. 2. Finding the spectral peak is difficult. In an
extreme situation, a PPG signal may not contain any heartbeatrelated signal component, and thus, one cannot find the spectral
peak associated with HR, as shown in Fig. 3. Therefore, some
methods are needed to deal with the cases when the corresponding spectral peak is buried in spectral fluctuations or does
not exhibit.
Due to the above issues, a satisfactory framework for HR
monitoring during intensive exercise should consists of three
parts: denoising, high-resolution spectrum estimation, and spectral peak tracking (including peak selection and verification).
Thus, we propose the TROIKA framework. Details of the framework are given in the next section.

Fig. 3. Example showing a case when the spectral peak associated with the
HR does not exhibit. (a) Raw PPG signal after bandpass filtered from 0.4 to 5 Hz.
(b) Spectrum calculated by Periodogram. (c) Spectrum calculated by FOCUSS.
The circles in (b) and (c) indicate the frequency location corresponding to the
true HR (which is calculated from simultaneously recorded ECG).

Fig. 4. Flowchart of the TROIKA framework. Signal decomposition, SSR,
and spectral peak tracking are the three key parts.

III. TROIKA FRAMEWORK
The TROIKA framework consists of three key parts: signal
decomposition, SSR, and spectral peak tracking. Signal decomposition is used for denoising and sparsifying spectra of PPG
signals. SSR yields high-resolution spectrum estimation. The
spectral peak tracking part selects correct spectral peaks and
deals with the nonexistence cases of the peaks. The flowchart
of the framework (including other auxiliary signal processing
parts) is shown in Fig. 4.
TROIKA is used for a single-channel PPG signal and simultaneously recorded acceleration data. A time window of T
seconds is sliding on the signals with incremental step of S

ZHANG et al.: TROIKA: A GENERAL FRAMEWORK FOR HEART RATE MONITORING

seconds (generally S ≤ T /2). The framework estimates HR in
each time window. In our experiments, T = 8 and S = 2 .1
Before TROIKA starts, the raw PPG signal and the acceleration signal in a given time window are first bandpass filtered
from 0.4 and 5 Hz. This preprocessing removes noise and MA
outside of the frequency band of interest, which also sparsifies
the spectra.
A. Signal Decomposition
Signal decomposition is an effective denoising methodology.
Generally speaking, it decomposes a signal y into a number of
components as follows:
y=

Q


yi .

(1)

Then, based on some criteria, the components associated
with noise/interference are recognized and removed from the
above expression. The reconstructed signal is thus noise- and
interference-free.
There are many signal decomposition approaches, such as
singular spectrum analysis (SSA) [23], [24], single-channel independent component analysis [25], [26], and [27]. These approaches decompose signals based on different criteria and procedures.
For illustration, we chose SSA in our experiments. SSA decomposes a time series into oscillatory components and noise. It
includes four steps: Embedding, Singular Value Decomposition
(SVD), Grouping, and Reconstruction.
In the Embedding Step, a time series y  [y1 , . . . , yM ]T is
mapped into an L × K matrix (K = M − L + 1, L < M/2)
called L-trajectory matrix2 ,
⎡
⎤
y1
y2
···
yK
⎢
⎥
⎢ y2
y3
· · · yK +1 ⎥
⎢
⎥
.
(2)
Y ⎢ .
..
.. ⎥
..
⎢ ..
.
.
. ⎥
⎣
⎦
yM
yL yL +1 . . .
In the SVD Step, the L-trajectory matrix is decomposed by
SVD as follows:
Y=

Yi ,

d  min{L, K}

into g disjoint subsets {I1 , . . . , Ig } (g ≤ d) and
Y=

g


YI p

(4)

p=1

	
with YI p = t∈I p Yt . The rank-one matrices in each group
YI p satisfy some common characteristics (such as their corresponding oscillatory components after reconstruction have the
same frequen?cy or exhibit harmonic relation).
In the Reconstruction Step, each group YI p is used to re
p with the length M by a so-called
construct a time series y
diagonal averaging procedure [23]. Thus, the original signal y
can be reexpressed as a sum of g time series, i.e.,
y=

g



p .
y

(5)

p=1

i=1

d


525

(3)

i=1

where Yi = σi ui viT and σi , ui , vi are the ith singular value,
the corresponding left-singular vector and the corresponding
right-singular vector, respectively.
In the Grouping Step, the d rank-one matrix Yi are assigned
into g groups. That is, the set of indices {1, . . . , d} is partitioned

1 The exact values of T and S are not important. Choosing relatively large
T is to increase spectrum resolution, while choosing small S is to make the
calculated HRs in two successive time windows close to each other.
2 The parameter L is defined by users. It is suggested to set L close to M/2
for stable decomposition [23].

Once having identified noise time series {

yp , p ∈ Inoise }, where
Inoise indicates the set of indices of all identified noise time
series, one can reconstruct a noise-free signal as follows:


p .
yrecon =
(6)
y
p∈In o i s e

In our framework, SSA partially removes MA frequency components from 0.4 to 5 Hz. (MA components with frequencies
outside of this range have already been removed by a bandpass
filter.) This also sparsifies the spectrum coefficients in the range
from 0.4–5 Hz, alleviating the difficulty of SSR. To recognize
the MA components in the SSA decomposition, we exploit information from acceleration data. Details are given below.
First, in current time window Periodogram3 is used to calculate the spectrum of each channel of acceleration data4 from
which dominant frequencies are determined. The dominant frequencies are the ones corresponding to the spectral peaks with
amplitude larger than 50% of the maximum amplitude in a given
spectrum. Denote by Facc the set of location indexes of selected
dominant frequencies in spectra.
Then, SSA is performed on the PPG signal in current time
window. After SVD, the grouping is automatically finished by
clustering singular values as described in [23, pp. 66]. Thus, the
original PPG signal is decomposed into a number of time series.
Next, we remove the time series whose dominant frequencies
have location indexes in Facc . The remaining time series is used
to reconstruct a cleansed PPG signal.
Note that some selected dominant frequencies may be close
to the fundamental and harmonic frequencies of heartbeat.
Thus, the above procedure may remove the signal components associated with the heartbeat. Some modifications to
the above procedure are needed. Denote by Np the location indexes of fundamental and harmonic frequencies of the
heartbeat estimated in the previous time window. We exclude
{Np − Δ, · · · , Np − 1, Np , Np + 1, . . . , Np + Δ} from Facc ,
3 Here using Periodogram is to save computational load. Advanced spectrum
estimation algorithms are not necessarily needed, since the goal is to select
dominant frequencies of MA in acceleration data.
4 Three-axis acceleration data were used in our experiments.

526

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

forming a refined set of location indexes of dominant frequencies, denoted by F
acc . Δ is a small positive integer. Then, the
above SSA procedure is performed using F
acc .
In the experiments, we set the parameters L = 400, set the
number of FFT points used in Periodogram to 4096, and set
Δ = 10. Since the sampling rate was 125 Hz in our experiments,
with 4096 FFT points, the parameter value Δ = 10 corresponds
to about 0.3 Hz.
B. Temporal Difference Operation
To further improve robustness of the framework, we suggest
temporally differentiating the cleansed PPG signal output by
SSA and then performing SSR-based spectrum estimation.
For a periodic time series h = [h(1), h(2), . . . , h(M )], its
first-order difference, defined as h  [h(2) − h(1), h(3) −
h(2), . . . , h(M ) − h(M − 1)], maintains the fundamental frequency and harmonic frequencies. The second-order difference
of h, i.e., the first-order difference of h , also maintains the
fundamental frequency and the harmonic frequencies. As long
as k is not large, the spectrum of the kth-order difference of
the time series significantly presents the fundamental frequency
and its harmonic frequencies. In contrast, this phenomenon is
not observed from a nonperiodic time series.
Note that the PPG component associated with HR is approximately periodic in a short time window, while MA is generally aperiodic (except to the MA components corresponding to
rhythmic hand swing). Therefore, the temporal difference operation can make the heartbeat fundamental and harmonic spectral peaks more prominent, while suppressing random spectrum
fluctuations.
In the experiments, we calculated the second-order difference
of the cleansed PPG signal output by SSA.

Φm ,n is given by
2π

Φm ,n = ej N

mn

, m = 0, . . . , M − 1, n = 0, . . . , N − 1 (9)

the solution (8) leads to a sparse spectrum of the signal y. Specifically, denoting the spectrum by s ∈ RN ×1 , its kth element, sk ,
is given by
xk |2 ,
sk = |

k = 1, . . . , N

(10)

 ∈ C N ×1 .
where x
k is the kth element of x
When performing SSR with the model (7)–(9), the size of
Φ is very large, implying large computational load. However, a
simple pruning procedure to Φ before running SSR algorithms
can largely reduce computational load. Let fs denote the sampling rate. Equation (9) indicates that the whole spectrum [0, fs ]
is divided into N equal frequency bins. A frequency bin with
location index Nf ∈ {1, 2, . . . , N } corresponds to a physical
frequency
f=

Nf − 1
fs
N

(Hz).

(11)

For example, the first frequency bin with location index Nf = 1
corresponds to 0 Hz.
In our experiments, the signal has been bandpass filtered
from 0.4 to 5 Hz. Thus, only the spectrum coefficients with the
location indexes Nf satisfying Nf ∈ IΦ have nonzero values,
where IΦ is given by

 0.4
5
IΦ 
N + 1 − Δf 1 ,
N + 1 + Δf 2
fs
fs


5
0.4
∪ N − N + 1 − Δf 2 , N −
N + 1 + Δf 1 .
fs
fs
(12)

C. Sparse Signal Reconstruction
SSR [19]–[21], [28] is an emerging signal-processing technique, showing great potentials in many application fields. The
basic SSR model can be expressed as follows:
y = Φx + v.

(7)

Here, Φ is a known basis matrix of the size M × N . The vector
y is an observed signal of the size M × 1. x is an unknown
solution vector which is assumed to be sparse or compressive,
i.e., most elements of x are zero or nearly zero, while only a
few elements have large nonzero values. v is an unknown noise
vector. The goal is to find the sparsest vector x based on y
and Φ. This can be done by solving the following optimization
problem:
 ← min y − Φx22 + λg(x)
x
x

(8)

where λ is a regularization parameter, and g(x) is a penalty
. Some popfunction encouraging the sparsity of the solution x
ular penalty functions are the 1 -norm function, i.e., x1 [29],
or the p -norm function (0 < p < 1), i.e., xp [19].
It is interesting to see that SSR can be used in spectrum estimation [19], [22]. Let y ∈ RM ×1 be a real-valued signal. Constructing the matrix Φ ∈ C M ×N such that its (m, n)th element

Here, using Δf 1 and Δf 2 is to consider the width of the transition band of a practical bandpass filter. Thus, the columns of
Φ with indexes Nf ∈ IΦ can be pruned out before performing SSR. This can largely reduce computational load. In the
2
experiments, we set Δf 1 = 0.4
f s N − 1 and Δf 2 = f s N .
Although the proposed framework is general, not restricted
to a specific algorithm, carefully choosing an SSR algorithm
is helpful to improve the performance of HR monitoring. Note
that when M 
 N , the columns of the basis matrix Φ are
highly correlated [22]. In this case, some SSR algorithms do not
work well. In the experiments, we chose the FOCUSS algorithm
[19] for illustrations. The algorithm is robust when columns of
Φ are highly correlated and has been used widely in source
localization and direction-of-arrival estimation. Details on the
parameter settings are given in Section IV.
Remark 1: As stated in Section II, the SSR-based spectrum
estimation has a number of advantages over traditional spectrum
estimation algorithms [19], [22]. However, a key assumption
of SSR is that x should be sparse or compressive. Otherwise,
the performance is degraded. When complicated intensive hand
movements occur, the spectrum of a PPG signal is nonsparse,
causing poor performance of SSR. Thus, the preprocessing procedures including bandpass filtering, signal decomposition, and

ZHANG et al.: TROIKA: A GENERAL FRAMEWORK FOR HEART RATE MONITORING

temporal difference operation are important, since they can sparsify spectrum coefficients, alleviating the difficulty in SSR.
Remark 2: Since an input PPG signal is first bandpass filtered from 0.4 to 5 Hz in the framework, one may think the
number of nonzero spectrum coefficients is small enough, and
the PPG spectrum is sparse. But it should be noted that when
columns of Φ are highly correlated (as in our problem), even
a small number of nonzero spectrum coefficients can bring difficulty to SSR. Hence, it is preferred to further remove the
significantly nonzero spectrum coefficients associated with MA
after bandpass filtering.
Remark 3: When using SSR to estimate power spectrum of
a signal, setting N requires some considerations. Increasing
N can reduce the off-grid effect in spectrum estimation5 and
thus can potentially increase HR estimation accuracy. However,
large N increases the correlation among columns of Φ, thus
potentially decreasing SSR performance. Therefore, we suggest
setting N such that each frequency grid fNs 60 corresponds to
about 1 BPM. Since in our experiments fs = 125 Hz, we set
N = 4096. Also, since each time window lasts T = 8 s, M =
8 × 125 = 1000.
D. Spectral Peak Tracking
Spectral peak tracking is another key part in TROIKA. It
exploits the frequency harmonic relation of HR, and the observation that HR values in two successive time windows are
very close if the two time windows overlap largely. In fact, our
experiments showed that in many cases the spectral peak associated with HR keeps its location unchanged in two successive
time windows.
The spectral peak tracking consists of initialization, peak selection, and verification.
1) Initialization: In the initialization stage, wearers are required to reduce hand motions as much as possible for several
seconds (2 or 3 s are enough). Thus, HR can be estimated by
choosing the highest spectral peak in a PPG spectrum during
this stage. Without this stage, there may be no way to estimate
HR, since an MA-contaminated PPG spectrum contains many
peaks, and there is no prior information to help find the correct
one (see Fig. 2).
2) Peak Selection: Denote by Nprev the frequency location
index of HR estimated in the previous time window. We set
a search range for the fundamental frequency of HR in current time window, denoted by R0 = [Nprev − Δs , . . . , Nprev +
Δs ], where Δs is a small positive integer. In our experiments, we
set Δs = 16. Also, we set another search range for the first-order
harmonic frequency of HR, denoted by R1 = [2(Nprev − Δs −
1) + 1, . . . , 2(Nprev + Δs − 1) + 1]6 . In each search range, we
select no more than three highest peaks with amplitude no less
than a threshold η. In our experiments, η was set to 30% of the
highest peak amplitude in R0 . This setting is helpful to remove
spectral fluctuations. Denote the frequency location indexes of

5 The off-grid effect refers to the case when a frequency of a signal does not
locate on any of the frequency grids Nn fs , n = 0, . . . , N − 1.
6 Remind that the first frequency bin in a spectrum corresponds to 0 Hz.

527

the three peaks in R0 by Ni0 (i = 1, 2, 3) and the indexes of the
three peaks in R1 by Nj1 (j = 1, 2, 3).
 be the location index of the selected spectral peak. We
Let N
consider three cases.
Case 1: If there exists a peak pair (Ni0 , Nj1 )(i, j ∈ {1, 2, 3})
with a harmonic relation, then Ni0 is the frequency location index
of HR, and thus
 ← Ni0
N

(13)

Case 2: If there is no such a peak pair (due to MA), based
 as follows:
on the observation stated previously, we select N
 ← arg min{|Nf − Nprev |}
N

(14)

Nf

N 1 −1

N 1 −1

N 1 −1

where Nf ∈ {N10 , N20 , N30 , 12 + 1, 22 +1, 32 + 1}. 7
Case 3: If no peaks are found in either search range, we have
 ← Nprev
N

(15)

which is based on the observation that the spectral peak associated with HR often keeps the same location in two successive
time windows.
3) Verification: The peak selection method sometimes can
wrongly track the spectral peak associated with MA or spectral
fluctuations. Thus, a verification stage is necessary. Several rules
are designed to prevent the wrong tracking.
The first rule is to prevent a large change in the estimated BPM
values in two successive time windows. The change of BPM
values in two successive time windows rarely exceeds 10 BPM.
Therefore, once the change exceeds 10 BPM, a regularization
is performed as follows:
⎧
 − Nprev ≥ θ
⎪
N
+ τ,
if N
⎪
⎨ prev
 − Nprev ≤ −θ
(16)
Ncur = Nprev − τ,
if N
⎪
⎪
⎩
N,
otherwise
 is the selected spectral peak location in Section IIIwhere N
D2), and Ncur is the regularized spectral peak location. Since
in our experiments the whole spectrum [0, 125] (Hz) is divided
into N = 4096 grids, a change of six locations in the spectrum means a change of about 11 BPM. Thus, we set θ = 6.
The parameter τ can be set to any small positive integer, such
as τ = 2.
The second rule is to prevent from losing tracking over long
time. If strong MA interference continues over long time, the
spectral peak selection by (15) could happen in many successive
time windows. Thus, the spectral peak associated with HR is lost
 = Nprev
and may not be found back. To avoid this situation, if N
for h successive time windows, then
Ncur = Nprev + 2 · NTrend

(17)

where NTrend ∈ {−1, 0, 1} indicating the change direction of
the HR peak location. Also, when this situation occurs, the
search range is broadened by setting Δs = 20. (If the situation
7 Because the first frequency bin corresponds to 0 Hz, the calculation of
(N 11 − 1)/2 + 1 is used, instead of N 11 /2. Similarly, we have (N 21 − 1)/2 + 1
and (N 31 − 1)/2 + 1.

528

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

does not occur, Δs is set to the original value, i.e. ,Δs = 16,
since narrower search range is helpful to avoid interference from
non-HR spectral peaks.) In the experiments, we set h = 3 and
calculated NTrend as follows:

NTrend

⎧
⎪
⎨ 1,
= −1,
⎪
⎩
0,

if BPMpredict − BPMprev ≥ 3
if BPMpredict − BPMprev ≤ −3 (18)
otherwise

where BPMprev was the estimated BPM in the previous time
window, and BPMpredict was the predicted BPM of the current time window. The predicted BPM was obtained by using
the third-order Polynomial curve fitting on the estimated BPM
values in previous 20 time windows.
E. Remarks
TROIKA is a general framework. Although we adopt specific
algorithms for signal decomposition and SSR, other signal decomposition algorithms and SSR algorithms can be used as well.
For example, sparse Bayesian learning [30] is an alternative to
FOCUSS, and EMD is an alternative to SSA.
TROIKA has some user-defined parameters. In the previous
subsections, we assigned values to these parameters by heuristics. Experiments showed that TROIKA’s performance is robust
to these values; other values can yield similar performance (see
the following section). However, we emphasize that these parameter values are assigned based on the sampling rate used
in our experiments (fs = 125 Hz). When the sampling rate
changes much, several parameters’ values should be adjusted
proportionally. For example, when fs is 25 Hz instead of 125
Hz, the number of frequency bins, N , should take about onefifth of the original value such that other parameters’ values
(e.g., Δs and Δ) maintain the same physical measures.
IV. EXPERIMENTAL RESULTS
A. Data Recording
We simultaneously recorded a single-channel PPG signal, a
three-axis acceleration signal, and an ECG signal from 12 male
subjects with yellow skin and ages ranging from 18 to 35. For
each subject, the PPG signal was recorded from wrist using a
pulse oximeter with green LED (wavelength: 609 nm). The acceleration signal was also recorded from wrist using a three-axis
accelerometer. Both the pulse oximeter and the accelerometer
were embedded in a wristband, which was comfortably worn.
The ECG signal was recorded from the chest using wet ECG
sensors. All signals were sampled at 125 Hz.
During data recording subjects walked or ran on a treadmill with the following speeds in order: the speed of 1–2 km/h
for 0.5 min, the speed of 6–8 km/h for 1 min, the speed of
12–15 km/h for 1 min, the speed of 6–8 km/h for 1 min, the
speed of 12–15 km/h for 1 min, and the speed of 1–2 km/h for
0.5 min. The subjects were asked to purposely use the hand with
the wristband to pull clothes, wipe sweat on forehead, and push
buttons on the treadmill, in addition to freely swing.

B. Parameter Settings
When using FOCUSS for SSR, we chose the Regularized
M-FOCUSS algorithm [28]8 . We set its parameter p = 0.8, the
regularization parameter λ = 0.1, and the spectrum grid parameter N = 4096 [given in (9)]. Note that the algorithm does not
need to iterate till convergence. It has been observed that coefficients with large values can converge after only a few iterations
[19]. Thus, we set the iteration number to 5.
C. Performance Measurement
The ground truth of HR in each time window was calculated
from the simultaneously recorded ECG signal. Given a time
window, we counted the number of cardiac cycles H and the
associated duration D (in seconds), and then calculated the HR
as 60H/D (in BPM). We did not use any ECG HR estimation
algorithms to avoid estimation errors.
To evaluate TROIKA’s performance, multiple measurement
indexes were used. Denote by BPMtrue (i) the ground truth
of HR in the ith time window, and denote by BPMest (i) the
estimated HR using TROIKA. The average absolute error is
defined as
Error 1 =

W

1  
BPMest (i) − BPMtrue (i)
W i=1

(19)

where W is the total number of time windows. Similarly, the
average absolute error percentage, defined as

W 
1  BPMest (i) − BPMtrue (i)
Error 2 =
(20)
W i=1
BPMtrue (i)
was calculated. The Bland–Altman plot [31] was also used to
examine the agreement between ground truth and estimates,
which shows the difference between each estimate and the
associated ground truth against their average. Limit of agreement (LOA) in this analysis was calculated, which is defined as
[μ − 1.96σ, μ + 1.96σ], where μ is the average difference and σ
is the standard deviation. In this range, 95% of all differences are
inside. Pearson correlation between ground truth and estimates
was also evaluated.
D. Results
Tables I and II list the average absolute error (Error1) and the
average error percentage (Error2) on all 12 subjects’ recordings, respectively. Using the complete TROIKA framework
(namely all signal decomposition, SSR, and spectral peak verification are employed), we obtained satisfactory results. Averaged across the 12 subjects, the absolute estimation error
(Error1) was 2.34 ± 0.82 BPM (mean ± standard deviation),
and the error percentage (Error2) was 1.80%. Fig. 5 gives the
Bland–Altman plot. The LOA was [−7.26, 4.79] BPM (standard
deviation σ = 3.07 BPM). Fig. 6 gives the Pearson coefficient
plot; the Pearson correlation coefficient was 0.992.
8 The algorithm was designed for an extended SSR model, but can also be
used for the basic SSR model, since the latter is a special case of the former.

ZHANG et al.: TROIKA: A GENERAL FRAMEWORK FOR HEART RATE MONITORING

529

TABLE I
AVERAGE ABSOLUTE ERROR (ERROR1) ON ALL 12 SUBJECTS’ RECORDINGS

Err1 (SSA+FOCUSS+Vrf)
Err1 (FOCUSS+Vrf)
Err1 (SSA+FFT+Vrf)
Err1 (SSA+FOCUSS)

Subj 1

Subj 2

Subj 3

Subj 4

Subj 5

Subj 6

Subj 7

Subj 8

Subj 9

Subj 10

Subj 11

Subj 12

2.29
4.56
62.73
3.45

2.19
4.63
5.55
14.00

2.00
3.97
1.99
24.07

2.15
2.81
3.25
2.62

2.01
2.06
1.11
2.10

2.76
55.2
55.84
54.79

1.67
1.84
1.17
2.97

1.93
1.75
1.68
1.77

1.86
1.84
0.45
1.92

4.70
5.86
12.26
51.89

1.72
4.92
1.84
2.69

2.84
8.76
2.54
60.14

In the results, the first row was obtained when using the complete TROIKA framework. The second, third, and fourth row was obtained when removing the signal
decomposition part, replacing the SSR algorithm with FFT, and removing the spectral peak verification part, respectively. Only the complete TROIKA framework
showed robust and high performance.

TABLE II
AVERAGE ERROR PERCENTAGE (ERROR2) ON ALL 12 SUBJECTS’ RECORDINGS

Err2 (SSA+FOCUSS+Vrf)
Err2 (FOCUSS+Vrf)
Err2 (SSA+FFT+Vrf)
Err2 (SSA+FOCUSS)

Subj 1

Subj 2

Subj 3

Subj 4

Subj 5

Subj 6

Subj 7

Subj 8

Subj 9

Subj 10

Subj 11

Subj 12

1.90%
3.22%
42.79%
2.69%

1.87%
3.66%
5.13%
12.91%

1.66%
3.01%
1.80%
19.36%

1.82%
2.39%
2.93%
2.30%

1.49%
1.48%
0.88%
1.50%

2.25%
39.11%
39.50%
38.87%

1.26%
1.39%
0.89%
2.14%

1.62%
1.45%
1.57%
1.48%

1.59%
1.53%
0.37%
1.53%

2.93%
3.59%
7.44%
32.82%

1.15%
3.28%
1.23%
1.79%

1.99%
6.08%
1.73%
41.00%

Each row of the results corresponds to the same case as in Table I.

Fig. 5.

Bland–Altman plot of the estimation results on the 12 datasets.

Fig. 7. Estimation results on recordings of Subject 6. Four cases were considered, i.e., using the complete TROIKA framework, removing the SSA part,
replacing SSR with Periodogram (computed via FFT), and removing the peak
tracking verification. In each case, the estimated HR trace was plotted and was
compared to the ground truth (obtained from simultaneous ECG).

Fig. 6.

Pearson correlation of the estimation results on the 12 datasets.

To highlight importance of the three main parts of TROIKA,
we considered three cases, i.e., removing SSA, replacing the
SSR algorithm with FFT, and removing the spectral peak verification. We evaluated the performance in the three cases and
listed the estimation errors in Tables I and II as well. The results show that if any of the three main parts was missing, the
performance was not robust; TROIKA did completely lose the
tracking of HR on some datasets.

To get closer look to the performance of TROIKA, Fig. 7
gives the result on the recordings of Subject 6, which shows that
missing any part of TROIKA resulted in failure. Fig. 8 shows
the result on recordings of Subject 5 as another example when
all parts of TROIKA played roles. The estimated HR was very
close to the ground truth, and every small change in the ground
truth was estimated with high fidelity.
To better see the benefit of using SSA to partially remove
MAs, we carried out an experiment using a raw PPG segment
and a simultaneous ECG segment (see Fig. 9(a) and (c), respectively). Both the simultaneous ECG segment and the PPG
segment contained strong MAs, which can be seen from their
spectra (calculated by Periodogram) in Fig. 9(b) and (d), respectively. In each of the spectra, the two significant peaks

530

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

Fig. 8. Estimation result on recordings of Subject 5. The walking/running
speed at every duration is indicated on the top of the figure.

Fig. 10. Robustness of TROIKA to parameter values. “Paper” indicates the
result with parameter values given in Section III. “L=100” indicates the result
with all parameter values given in Section III except to L which was changed
to 100. Similar meanings go to other x-labels in the figure.

that SSA can remove MAs in PPG and make more significant
the spectral peak associated with HR.
To verify TROIKA is robust to parameter values, we used the
recordings of Subject 5 to study the sensitivity of TROIKA to the
parameters L (used in SSA), Δ (used in SSA), τ (used in spectral peak tracking) and Δs (used in spectral peak tracking). In
the previous experiments, these parameters were set as L = 400,
Δ = 10, τ = 2, and Δs = 16. In this experiment, TROIKA was
performed using these parameter values except to one parameter which was changed to another value. In particular, L was
changed to 100, 200, and 300, Δ was changed to 5, 12, and 15,
τ was changed to 0, 1, 3, and 4, and Δs was changed to 12, 14,
and 20. The results, given in Fig. 10, show that the performance
was almost the same regardless of the specific parameter values.
E. Discussions

Fig. 9. Example showing the benefit of SSA. (a) Segment of simultaneously
recorded ECG (as a ground truth for HR estimation). (b) Spectrum (by Periodogram) of the ECG segment. (c) and (d) Segment of simultaneously recorded
raw PPG, and its spectrum (by Periodogram), respectively. (e) and (f) PPG after
SSA, and its sparse spectrum calculated by FOCUSS, respectively. All signals
in (a), (c), and (e) are normalized to have zero mean and unit variance. The
circles in (b), (d), and (f) indicate the spectral peaks corresponding to the HR
(which was calculated as described in Section IV-C).

correspond to the fundamental and harmonic frequencies of
strides. However, the spectral peak associated with HR is not
discernible. In contrast, after SSA, the spectrum of the cleansed
PPG signal [see Fig. 9(e)] clearly presents the spectral peak associated with the HR, as shown in Fig. 9(f). This result shows

Comparing to prior works on HR monitoring during running, TROIKA showed competitive or superior performance.
For example, in [16], the Pearson correlation coefficient was
0.75 when subjects were running at peak speed of 8 km/h. In
[7], the Pearson correlation coefficient was 0.78 at the speed of
3 miles/h (4.8 km/h), and 0.64 at the speed of 5 miles/h (8 km/h).
In contrast, in our experimental results, the correlation coefficient was 0.992. In [8], the standard deviation of error was 8.7
BPM, while in our experimental results the standard deviation
was 3.07 BPM.
One can adopt a lower sampling rate to reduce computational
load. We found when the sampling rate was even reduced to
25 Hz and some parameters were tuned suitably, the HR estimation performance was almost the same but the running time was
dramatically shortened. We will investigate this topic in future
works.
V. CONCLUSION
In this paper, we proposed a general framework, called
TROIKA, for HR estimation using wrist-type PPG signals when

ZHANG et al.: TROIKA: A GENERAL FRAMEWORK FOR HEART RATE MONITORING

subjects are performing intensive physical exercise. The framework consists of three key parts: signal decomposition for denoising, SSR for high-resolution spectrum estimation, and spectral peak tracking with verification mechanisms. Experimental
results on recordings from 12 subjects showed that TROIKA
has high estimation accuracy, and each of its three parts is indispensable to the high performance.
The TROIKA framework provides large flexibility. Many
variants can be derived from it by choosing specific algorithms
in the three key parts according to specific requirements in hardware design. Thus, it is of great values to any wearable devices.
REFERENCES
[1] J. Allen, “Photoplethysmography and its application in clinical physiological measurement,” Physiol. Meas., vol. 28, no. 3, pp. R1–R39, 2007.
[2] A. Kamal, J. Harness, G. Irving, and A. Mearns, “Skin photoplethysmographya review,” Comput. Methods Programs Biomed., vol. 28, no. 4,
pp. 257–269, 1989.
[3] B. S. Kim and S. K. Yoo, “Motion artifact reduction in photoplethysmography using independent component analysis,” IEEE Trans. Biomed. Eng.,
vol. 53, no. 3, pp. 566–568, Mar. 2006.
[4] R. Krishnan, B. Natarajan, and S. Warren, “Two-stage approach for detection and reduction of motion artifacts in photoplethysmographic data,”
IEEE Trans. Biomed. Eng., vol. 57, no. 8, pp. 1867–1876, Aug. 2010.
[5] J. Yao and S. Warren, “A short study to assess the potential of independent component analysis for motion artifact separation in wearable pulse
oximeter signals,” in Proc. Eng. Med. Biol. Soc. IEEE EMBS 27th Annu.
Int. Conf., 2005, pp. 3585–3588.
[6] M. Ram, K. V. Madhav, E. H. Krishna, N. R. Komalla, and K. A. Reddy,
“A novel approach for motion artifact reduction in PPG signals based
on AS-LMS adaptive filter,” IEEE Trans. Instrum. Meas., vol. 61, no. 5,
pp. 1445–1457, May 2012.
[7] R. Yousefi, M. Nourani, S. Ostadabbas, and I. Panahi, “A motiontolerant adaptive algorithm for wearable photoplethysmographic biosensors,” IEEE J. Biomed. Health Informat., vol. 18, no. 2, pp. 670–681,
Mar. 2014.
[8] H. Fukushima, H. Kawanaka, M. S. Bhuiyan, and K. Oguri, “Estimating
heart rate using wrist-type photoplethysmography and acceleration sensor
while running,” in Proc. Annu. Int. Conf. IEEE Eng. Med. Biol. Soc., 2012,
pp. 2901–2904.
[9] B. Lee, J. Han, H. J. Baek, J. H. Shin, K. S. Park, and W. J. Yi, “Improved
elimination of motion artifacts from a photoplethysmographic signal using a Kalman smoother with simultaneous accelerometry,” Phys. Meas.,
vol. 31, no. 12, pp. 1585–1603, 2010.
[10] M. J. Hayes and P. R. Smith, “A new method for pulse oximetry possessing
inherent insensitivity to artifact,” IEEE Trans. Biomed. Eng., vol. 48,
no. 4, pp. 452–461, Apr. 2001.
[11] Y. sheng Yan, C. C. Poon, and Y. ting Zhang, “Reduction of motion
artifact in pulse oximetry by smoothed pseudo Wigner-Ville distribution,”
J. NeuroEng. Rehab., vol. 2, no. 3, 2005.
[12] M. Raghuram, K. V. Madhav, E. H. Krishna, and K. A. Reddy, “Evaluation
of wavelets for reduction of motion artifacts in photoplethysmographic
signals,” in Proc. 10th Int. Conf. Inform. Sci. Signal Process. Appl., 2010,
pp. 460–463.
[13] X. Sun, P. Yang, Y. Li, Z. Gao, and Y.-T. Zhang, “Robust heart beat
detection from photoplethysmography interlaced with motion artifacts
based on empirical mode decomposition,” in Proc. IEEE EMBS Int. Conf.
Biomed. Health Inform., 2012, pp. 775–778.

531

[14] K. A. Reddy, B. George, and V. J. Kumar, “Use of Fourier series
analysis for motion artifact reduction and data compression of photoplethysmographic signals,” IEEE Trans. Instrum. Meas., vol. 58, no. 5,
pp. 1706–1711, May 2009.
[15] S. M. López, R. Giannetti, M. L. Dotor, J. P. Silveira, D. Golmayo,
F. Miguel-Tobal, A. Bilbao, M. Galindo Canales, P. Martı́n Escudero
et al., “Heuristic algorithm for photoplethysmographic heart rate tracking during maximal exercise test,” J. Med. Biol. Eng., vol. 32, no. 3,
pp. 181–188, 2012.
[16] M.-Z. Poh, N. C. Swenson, and R. W. Picard, “Motion-tolerant magnetic
earring sensor and wireless earpiece for wearable photoplethysmography,
” IEEE Trans. Inform. Technol. Biomed., vol. 14, no. 3, pp. 786–794,
May 2010.
[17] Z. Zhang, “Heart rate monitoring from wrist-type photoplethysmographic
(PPG) signals during intensive physical exercise,” in Proc. 2nd IEEE
Global Conf. Signal Inf. Process., 2014.
[18] P. Stoica and R. L. Moses, Spectral Analysis of Signals. Upper Saddle
River, NJ, USA: Prentice-Hall 2005.
[19] I. F. Gorodnitsky and B. D. Rao, “Sparse signal reconstruction from limited
data using FOCUSS: A re-weighted minimum norm algorithm,” IEEE
Trans. Signal Process., vol. 45, no. 3, pp. 600–616, Mar. 1997.
[20] D. Donoho, “Compressed sensing,” IEEE Trans. Inf. Theory, vol. 52,
no. 4, pp. 1289–1306, Apr. 2006.
[21] M. Elad, Sparse and Redundant Representations: From Theory to Applications in Signal and Image Processing. New York, NY, USA:Springer,
2010.
[22] M. F. Duarte and R. G. Baraniuk, “Spectral compressive sensing,” Appl.
Comput. Harmonic Anal., vol. 35, no. 1, pp. 111–129, 2013.
[23] N. Golyandina, V. Nekrutkin, and A. A. Zhigljavsky, Analysis of Time
Series Structure: SSA and Related Techniques. Boca Raton, FL, USA:
CRC Press, 2001.
[24] T. Harris and H. Yuan, “Filtering and frequency interpretations of singular
spectrum analysis,” Physica D, Nonlinear Phenomena, vol. 239, no. 20,
pp. 1958–1967, 2010.
[25] C. J. James and D. Lowe, “Extracting multisource brain activity from
a single electromagnetic channel,” Artif. Intell. Med., vol. 28, no. 1,
pp. 89–104, 2003.
[26] M. E. Davies and C. J. James, “Source separation using single channel
ICA,” Signal Process., vol. 87, no. 8, pp. 1819–1832, 2007.
[27] N. E. Huang, Z. Shen, S. R. Long, M. C. Wu, H. H. Shih, Q. Zheng, N.-C.
Yen, C. C. Tung, and H. H. Liu, “The empirical mode decomposition
and the Hilbert spectrum for nonlinear and non-stationary time series
analysis,” in Proc. Roy. Soc. London. Series A, Math., Phys. Eng. Sci.,
vol. 454, no. 1971, pp. 903–995, 1998.
[28] S. F. Cotter, B. D. Rao, K. Engan, and K. Kreutz-Delgado, “Sparse solutions to linear inverse problems with multiple measurement vectors,”
IEEE Trans. Signal Process., vol. 53, no. 7, pp. 2477–2488, Jul. 2005.
[29] R. Tibshirani, “Regression shrinkage and selection via the Lasso,” J. R.
Statist. Soc. B, vol. 58, no. 1, pp. 267–288, 1996.
[30] Z. Zhang and B. D. Rao, “Extension of SBL algorithms for the recovery
of block sparse signals with intra-block correlation,” IEEE Trans. Signal
Process., vol. 61, no. 8, pp. 2009–2015, Apr. 2013.
[31] J. Martin Bland and D. Altman, “Statistical methods for assessing agreement between two methods of clinical measurement,” Lancet, vol. 327,
no. 8476, pp. 307–310, 1986.

Author’s photographs and biographies not available at the time of publication.

