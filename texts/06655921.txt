IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 5, SEPTEMBER 2014

1707

Adaptive Shape Prior Constrained Level Sets for
Bladder MR Image Segmentation
Xianjing Qin, Xuelong Li, Fellow, IEEE, Yang Liu, Hongbing Lu, and Pingkun Yan, Senior Member, IEEE

Abstract—Three-dimensional bladder wall segmentation for
thickness measuring can be very useful for bladder magnetic resonance (MR) image analysis, since thickening of the bladder wall
can indicate abnormality. However, it is a challenging task due to
the artifacts inside bladder lumen, weak boundaries in the apex
and base areas, and complicated outside intensity distributions.
To deal with these difficulties, in this paper, an adaptive shape
prior constrained directional level set model is proposed to segment the inner and outer boundaries of the bladder wall. In addition, a coupled directional level set model is presented to refine
the segmentation by exploiting the prior knowledge of region information and minimum thickness. With our proposed method,
the influence of the artifacts in the bladder lumen and the complicated outside tissues surrounding the bladder can be appreciably
reduced. Furthermore, the leakage on the weak boundaries can
be avoided. Compared with other related methods, better results
were obtained on 11 patients’ 3-D bladder MR images by using the
proposed method.
Index Terms—Adaptive shape prior (ASP), coupled level sets,
directional gradient, segmentation.

I. INTRODUCTION
LADDER cancer is the fourth leading cause of cancer
cases among men in the U.S., according to Cancer Fact
& Figures 2012 of American Cancer Society [1]. Magnetic resonance (MR) imaging, for its high resolution of soft tissues,
noninvasiveness, and easy performance [2], is a good option for
early detection of bladder cancer. As thickening of the bladder
wall is a useful indicator of tumors [3], segmenting the entire
wall accurately from MR images plays an important role in the
following analysis and therapy planning. At present, the segmentation of the bladder wall is usually performed manually
by experts. However, it is a time consuming and tedious task.
Therefore, an effective automated segmentation method can be
very helpful.

B

Manuscript received May 1, 2013; revised September 5, 2013 and October
12, 2013; accepted October 24, 2013. Date of publication November 5, 2013;
date of current version September 2, 2014. This work was supported by the
National Natural Science Foundation of China under Grant 61172142, Grant
61125106, Grant 81230035, and Grant 81071220.
X. Qin and P. Yan are with the Xi’an Institute of Optics and Precision
Mechanics, Chinese Academy of Sciences, Xi’an 710119, China (e-mail:
xianjing.qin@gmail.com; pingkun@ieee.org).
X. Li is with the Center for Optical Imagery Analysis and Learning, State
Key Laboratory of Transient Optics and Photonics, Xi’an Institute of Optics
and Precision Mechanics, Chinese Academy of Sciences, Xi’an 710119, China
(e-mail: xuelong_li@opt.ac.cn).
Y. Liu and H. Lu are with the Department of Biomedical Engineering/Computer Application, Fourth Military Medical University, Xi’an 710032,
China (e-mail: liuyhehe@163.com; luhb@fmmu.edu.cn).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/JBHI.2013.2288935

Numerous medical image segmentation methods have been
reported in recent years, such as active shape model (ASM)
based methods [4], [5], atlas-based methods [6], shape prior
constrained deformable methods [7], [8], and level set-based
methods [9], [10]. Both the ASM and atlas-based methods assume that the shape in the test image is similar to that of training
images. They cannot be applied to bladder wall segmentation,
as bladder shape varies greatly from patient to patient, even
varies in different filling stages of the bladder. Therefore, to get
promising segmentation results, level set-based method, considering its advantage in delineating complex shape, turns out to
be a better choice [11]–[13]. In addition, this method can fully
exploit the region and gradient features of images by means of
gradient-based [14], [15] and region-based models [16].
So far, few and limited bladder wall segmentation methods
have been proposed. Duan et al. [11] developed a coupled level
set framework for bladder wall segmentation on T1-weighted
MR images, which used a modified Chan–Vese model [16] to
locate the inner and outer boundaries, and then constructed a
coupled model to segment them. However, it is difficult to locate the outer boundary due to the complicated outside intensity
distributions. Furthermore, overlapping or crossing may occur
since no distance constraint between the two zero level sets has
been applied. Chi et al. [12] segmented the inner boundary using
a geodesic active contour (GAC) model in T2-weighted MR image, and then segmented the outer boundary in T1-weighted MR
image with the penalization of maximum thickness of bladder
wall. The multisequence algorithm may lead to the segmentation results depending on the quality of the alignment. Recently,
a region of interest (ROI) of outer boundary is introduced by
Ma et al. [13] to initialize the outer level set function (OLSF)
after the inner boundary segmentation, and then, a shape influence field is used to avoid the outer zero level set overlapping
with the inner zero level set. However, it is difficult to define an
appropriate ROI automatically.
Automatically segmenting bladder boundaries is a challenging task due to several factors, including various bladder shapes,
inside artifacts, weak boundary, and complicated outside intensity distributions, as shown in Fig. 1. The image artifacts are
often caused by respiratory motion, urine, chemical shift, and
susceptibility effects [11]. These artifacts, which also have obvious edges, make it hard to directly use the intensity gradient
to distinguish the real inner boundaries from the false edges. In
the base and apex areas of the bladder, some parts of the boundaries are often so weak that makes it impossible to detect the
complete boundaries. Moreover, the intensity distributions of
tissues outside the bladder are inhomogeneous. Edges of tissues
might be segmented as one part of the outer bladder boundary,
which makes outer boundary segmentation even more difficult.

2168-2194 © 2013 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

1708

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 5, SEPTEMBER 2014

function smooth. Length term L(φ) and area term A(φ) are
external energy which depends on the image data.
Let a level set function φ be defined on a domain Ω → ; the
energy function can then be written in detail as


p (|∇φ|)dx + λ
Ig δ (φ) |∇φ| dx
Edrls (φ) = μ
Ω

Ω



Fig. 1. Some challenges of bladder wall segmentation in MR images. (a) Inside
artifacts. (b) Weak boundary. (c) Complicated outside intensity distributions.

To deal with these difficulties, we propose an adaptive shape
prior (ASP) constrained coupled directional level set (CDLS)
method in this paper, which exploits directional gradient, interslice information, region information, and minimum thickness
information to obtain robust segmentation results. The main
contributions of our method can be summarized as follows:
1) An efficient directional level set (DLS) model is proposed
by exploiting the gradient direction information to distinguish
the desired boundary from the false artifact edge. 2) The ASP
constrained level set model is proposed by embedding interslice
information into the DLS model to reduce the leakage on weak
boundary. 3) The region information of the bladder wall is used
to construct a variance energy term, which is incorporated into a
CDLS model to reduce the influence of the complicated outside
tissues. 4) The minimum thickness information of bladder wall
is added into the CDLS model to avoid the overlap between
the inner and outer zero level sets. The proposed DLS model is
the first work utilizing the gradient direction feature of bladder
wall adequately [17]. More importantly, to our best knowledge,
this is the first work to segment 3-D bladder under the guidance
and constraint of the interslice information. Compared with the
other two state-of-the-art methods [18], [19], more accurate segmentation has been shown by using our proposed method.
The rest of this paper is organized as follows. A brief summary
of related work is given in Section II. The bladder wall segmentation method, consists of the DLS, ASP, and CDLS models,
is proposed in Section III. Third, we describe the workflow of
the proposed method in Section IV. Section V gives the experimental results and performance evaluation. The conclusions are
provided in Section VI.
II. RELATED WORKS
Osher and Sethian first presented level set method in 1988 [20]
to solve the curve (surface) evolving problem effectively. Li
et al. [19] presented a gradient-based level set model, called
distance regularized level set (DRLS) model, which avoided the
traditional reinitialization by maintaining the level set function
as a signed distance function (SDF) during the evolution. The
DRLS model consists of internal energy and external energy
Edrls (φ) = μR(φ) + λL(φ) + αA(φ)

(1)

where μ > 0, λ > 0, and α ∈  are the parameters. φ is a level
set function. The first term R(φ) is a level set regularization
term, also called the internal energy, to maintain the level set

+α

Ig H (φ) dx

(2)

Ω

where p is a potential function. H denotes Heaviside function
as

1, f (x) ≥ 0
H (f (x)) =
(3)
0, f (x) < 0
and δ is the Dirac delta function derived from the Heaviside
function. The function Ig is an edge indicator function defined
as Ig (x) = 1+|∇I1 (x)|2 , where I(x) is an image defined on the
domain Ω. The edge indicator function Ig (x) maps the image
gradient |∇I(x)| to an energy image for the level set evolution.
The DRLS energy can be minimized by the following Euler–
Lagrange equation:
∂φ
= μdiv (d (|∇φ|) ∇φ)
∂t


∇φ
+ λδ (φ) div Ig
− αIg δ (φ)
|∇φ|

(4)

where d(|∇φ|) is a diffusion rate function. During the evolution,
if the gradient |∇I(x)| at point x is very small, the corresponding
Ig (x) is approximately equal to 1, the level set variation ∂∂φt is
large, and the evolution is going on. While the level set comes
across the sharp edge and Ig (x) approaches zero because of the
great gradient |∇I(x)|, the energy function is minimized and
the sharp edge can be extracted. More details about the DRLS
model can be found in [15] and [19].
III. ASP CONSTRAINED CDLS
In 3-D bladder wall segmentation, a slice from the center of
the bladder is first segmented, and then, the result is used as
a shape prior to constrain the segmentation of the following
slice. In the process of an individual slice segmentation, the
ASP constrained DLS model is proposed to extract the inner
and outer boundaries. Then, the proposed CDLS model is used
to refine the results by tuning the inner and outer boundaries
simultaneously. The proposed DLS, ASP, and CDLS models
are described in the following sections.
A. Directional Level Set
According to the report of [21], the bladder wall has obvious
lower signal intensity than the bladder lumen and soft tissues in
T2-weighted FSE MR images, which can also be seen in Fig. 2.
The gradient amplitude on the boundaries of bladder wall is
large. Thus, using the gradient-based level set model [19], the
inner boundary should be segmented accurately. However, in
practice, some artifacts existing in the bladder lumen also have
great gradient amplitude, as shown in Fig. 2(a), and they may

QIN et al.: ADAPTIVE SHAPE PRIOR CONSTRAINED LEVEL SETS FOR BLADDER MR IMAGE SEGMENTATION

(a)

(b)

(c)

Fig. 2. (a) Red circle: initial zero level set. Yellow arrows: inward gradient of
level set and inner boundary. Blue arrows: outward gradient of artifact edge and
outer boundary. (b) Red curve: inner zero level set. Yellow curve: outer zero
level set. (c) Coupled segmentation without minimum thickness constraint.

cause false inner edges. Fortunately, it can also be seen that
another feature of the bladder wall is the bright–dark–bright
transition from the lumen to wall and then to outside of the
bladder. This is an important feature that can be used to distinguish the desired bladder boundary from artifact edge.
Fig. 2(a) shows an initialization of the level set function φ as a
circle with positive inside. The gradient directions of the level set
and inner boundary are inward, while that of artifact is outward.
Inspired by the directional gradient edge indicator in [18], the
energy function of slice segmentation Edls is constructed as
Edrls , and then, Ig is replaced with Id (x) in (4) as
Ig (x) → Id (x) =

1709

1
1 + t (x) |∇I (x)|2

(5)

where t (x) can be defined as ti (x) and to (x) according to the
segmentation of inner and outer boundaries, and the corresponding Id (x) is Idi (x) and Ido (x). The definition of ti (x) and to (x)
are

ILSF
ti (x) = H (θ0 − θ (∇I (x) , ∇φi (x))) ,
(6)
to (x) = 1 − H (θ0 − θ (∇I (x) , ∇φo (x))) , OLSF
where φi (x) and φo (x) represent the inner level set function
(ILSF) and OLSF for inner and outer boundaries segmentation,
respectively. θ (∇I(x), ∇φ(x)) represents the angle between
the gradients of the input image and level set at point x, and θ0 is
a predefined angle. Thus, the directional edge indicator function
Id (x) maps the image directional gradient t (x) |∇I (x)| to an
energy image for the level set evolution.
Take ti (x) for example, when the zero level set approaches
to the artifact edge at point x, θ > θ0 , as shown in Fig. 2. So
t = ti (x) = 0 and Idi (x) = 1; the evolution is going on and
the artifact edge cannot be detected. When the zero level set
meets the inner boundary at point x, θ ≤ θ0 . t = ti (x) = 1, the
gradient |∇I(x)| is large, and Idi (x) is very small, the zero level
set can be stopped. The evolving equation for ILSF is
∂φi
= μdiv (d (|∇φi |) ∇φi )
∂t


∇φi
+ λδ (φi ) div Idi
− αIdi δ (φi ) .
|∇φi |

Fig. 3. Segmentation results with global shape prior constraint. (Left) Segmentation of the jth slice. (Middle) Segmentation of the (j + 1)th slice with weak
constraint. (Right) Segmentation of the (j + 1)th slice with strong constraint.

evolves with the equation
∂φo
= μdiv (d (|∇φo |) ∇φo )
∂t


∇φo
+ λδ (φo ) div Ido
− αIdo δ (φo ) .
|∇φo |

Therefore, (7) and (8) are the proposed DLS model for the
inner and outer boundaries extraction.
B. ASP Constrained Model
By using the DLS model on inner and outer boundaries extraction, some leakage may still occur on the weak boundaries
of the base and apex slices. This is because the boundaries of
these slices are so weak that the intensity variation of the boundaries and that of other ambient tissues are just the same. Since
the shapes between neighboring slices are similar, using the interslice information to make up the missing information of the
weak boundary may be an effective way to avoid leakage.
1) Global Shape Prior Model: As shown in Fig. 3, the zero
level set on the (j + 1)th slice of the base and apex areas usually
leaks out since there is no significant boundary in that region. It
can be seen that the shapes of the bladder between the jth slice
and (j + 1)th slice are similar, so it may be an effective way to
use the result of the jth slice as a shape prior to constrain the
segmentation of the (j + 1)th slice.
Let φs be the segmentation result of the jth slice, and φ be
the level set of (j + 1)th slice; then, the shape constraint term
is defined as

(H (φ) − H (φs ))2 dx
(9)
Eshap e (φ) =
Ω

where H(·) represents the Heaviside function.
Therefore, the shape prior constrained level set energy function for inner (or outer) boundary extraction can be defined as
E1 (φ) = Edls (φ) + γEshap e (φ)

(7)

After the inner boundary is extracted, we set t(x) = to (x)
and Id (x) = Ido (x). The gradient of the outer boundary points
outward, leading the outer boundary turn to be the desired edge
by using the corresponding Ido (x). Thus, it can distinguish the
desired outer boundary from the inner boundary. The OLSF

(8)

(10)

where φ can be φi or φo according to the inner or outer
boundary extraction. Parameter γ represents the strength of the
constraint. Minimizing the energy function, the corresponding
Euler–Lagrange equation is


∇φ
∂φ
= μdiv (d (|∇φ|) ∇φ) + λδ (φ) div Id
∂t
|∇φ|
− αId δ (φ) − 2γδ (φ) (H (φ) − H (φs )) .

(11)

1710

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 5, SEPTEMBER 2014

2) ASP Model: However, in experiments, we found that the
global shape prior is not suitable for bladder segmentation in
practice. As shown in Fig. 3, if the constraint is weak, the
leakage will still occur on weak part of boundary because the
small force of shape prior cannot stop the level set. On the other
hand, if the constraint is strong, the leakage will be avoided but
the contour may not snap to the boundaries at other parts. The
large force drives the level set to pass over the strong boundary
to approach the shape prior.
The purpose of shape constraint in bladder segmentation is to
solve the leakage problem in the weak part of boundary. Ideally,
the shape constraint should be added adaptively according to
the obviousness of boundary: adding a strong constraint to the
weak part of boundary, and a weak constraint to the strong part
of boundary. Therefore, we propose the ASP model by rewriting
the γ as γasp (x) to make the effect of constraint to be adaptive
as
γasp (x) =

ω1
1 + ω2 D(x)

(12)

where ω1 and ω2 are two constants, and ω2  ω1 . Function
D (x) can be divided into Di (x) and Do (x) according to the
segmentation of inner and outer boundaries, and the corresponding γasp (x) is γaspi (x) and γaspo (x). The definition of Di (x)
and Do (x) are


Di (x) = H (θ1 − θ (∇I (x) , ∇φi (x))) ,
Do (x) = 1 − H (θ2 − θ (∇I (x) , ∇φo (x))) ,

ILSF
OLSF
(13)
where φi (x) and φo (x) represent ILSF and OLSF, respectively.
θ (∇I(x), ∇φ(x)) represents the angle between the gradients
of the input image and level set at point x, and θ1 and θ2 are
predefined angles.
Take Di for example, if the angle θ at point x larger than
predefined θ1 , which means the boundary is obvious and strong
ω1
	
enough to be detected, then Di = 1 and γaspi (x) = 1+ω
2
1; the shape constraint in this part is weak. Otherwise, if the
angle smaller than predefined θ1 , meaning the boundary is weak,
Di = 0 and γaspi (x) = ω1 , the weak part is constrained by
the shape prior with ω1 times. Therefore, the shape constraint
is added adaptively to guide the segmentation of the current
slice. We do not directly use the gradient amplitude because the
gradient of the artifact and outside tissues is also large and the
constraint may be misled. Using gradient direction here not only
measures the strength of the boundary but also distinguishes the
real boundary from edges of artifacts and outside tissues.
C. Coupled Directional Level Set
After applying the ASP constrained DLS model, the segmentation of the inner boundary is generally accurate, while the
outer boundary segmentation is usually not correct enough due
to some confusion between the boundary and the edges of outside tissues. Therefore, the relatively accurate ILSF can be used
to refine the segmentation of OLSF by incorporating ILSF with
OLSF as a coupled level set function.

Firstly, the area term A in (1) can be rewritten in the coupled
form as follows:

Ig (1 − H (φi ))H (φo ) dx.
(14)
A → Ac =
Ω

Second, as shown in Fig. 2(b), the intensity of the bladder
wall between the inner and outer boundaries is homogeneous.
Region information can be also exploited to reduce the influence
of outside tissues. Thus, a variance energy term can be defined
as


2
Ig I − C̄ (1 − H (φi )) H (φo ) dx
(15)
Vc =
Ω

where C̄ denotes the mean intensity between the inner and
outer zero level sets and is recomputed during each evolution.
This variance energy penalizes the variance of the intensity of
bladder wall to accelerate the evolution of ILSF and OLSF.
As the zero level sets approach to the boundaries, the sharp
descent of Ig defined in Section II speeds up the decrease of the
variance energy to stop the evolution, and the energy function
Vc is minimized.
Putting (14) and (15) into (1), the overall energy function of
the proposed coupled level set energy is defined as
E2 (φi , φo ) = μ (R (φi ) + R (φo )) + λ (L (φi ) + L (φo ))
+ αAc (φi , φo ) + βVc (φi , φo )

(16)

where μ, λ, α, and β are parameters. The first term
(R (φi ) + R (φo )) is a level set regularization term to maintain
the ILSF and OLSF as SDFs during the evolution. The second
term (L (φi ) + L (φo )) is an edge term that drives the zero level
sets to the edges of an image. The third term Ac (φi , φo ) is an
area term which minimizes the area size between the inner and
outer zero level sets. The fourth term Vc (φi , φo ) is a variance
term which minimizes the intensity variance between the inner
and outer zero level sets. Both the third and fourth terms control
the evolution speed and direction of the level sets.
Thus, the updated equations of ILSF and OLSF are obtained
by minimizing E2 (φi , φo ) with respect to φi and φo as


∂φi
∇φi
= μdiv (d (|∇φi |) ∇φi ) + λδ (φi ) div Ig
∂t
|∇φi |

2
+ αi Ig δ (φi ) H (φo ) + βi Ig I − C̄ δ (φi ) H (φo )
(17)


∂φo
∇φo
= μdiv (d (|∇φo |) ∇φo ) + λδ (φo ) div Ig
∂t
|∇φo |
− αo Ig δ (φo ) (1 − H (φi ))

2
− βo Ig I − C̄ δ (φo ) (1 − H (φi ))

(18)

where the parameters αi and αo and βi and βo are obtained from
α and β according to the evolution of ILSF and OLSF.
In practice, overlapping or crossing of the two zero level sets
may occur on where the bladder boundaries are weak, as shown
in Fig. 2(c). Fortunately, there is a prior knowledge that the
minimum thickness of the bladder wall is q = 1 mm [22]. Thus,
the prior knowledge can be utilized to solve this problem.

QIN et al.: ADAPTIVE SHAPE PRIOR CONSTRAINED LEVEL SETS FOR BLADDER MR IMAGE SEGMENTATION

1711

(a)

(b)
Fig. 4. Workflow of the proposed method. (a) Overall workflow of 3-D bladder segmentation. (b) Subprocess of (a) for an individual slice segmentation, which
is represented by the green arrow in (a).

The signs of the parameters αi,o and βi,o control the evolution
direction of ILSF and OLSF. Therefore, if the overlap between
the ILSF and OLSF is detected, the corresponding signs of αi,o
and βi,o should be adaptively adjusted to change the evolving




and βi,o
can be defined as
direction. The adaptive αi,o


αi,o


βi,o


(x) =

(x) =

αi,o , φo (x) − φi (x)  e
−αi,o , φo (x) − φi (x) < e

(19)

βi,o , φo (x) − φi (x)  e
−βi,o , φo (x) − φi (x) < e

(20)

where e = q/r, and r is the intraslice resolution of the bladder
image.
Finally, taking Ig → Idi (x), αi → αi
 (x), and βi → βi
 (x) in
(17), while taking Ig → Ido (x), αo → αo
 (x), and βo → βo
 (x)
in (18), the proposed CDLS model can be obtained.

IV. SUMMARY OF OUR PROPOSED METHOD
This section briefly summarizes the workflow of our proposed
method. As shown in Fig. 4, (a) shows the overall workflow of
3-D bladder segmentation, and (b) shows a subprocess of (a)
described by the green arrow in (a), which represents the process
of an individual slice segmentation.
For the overall 3-D bladder segmentation, it can be seen that
the bladder shape of the mid-gland slices is usually regular
and the boundary is relatively clear compared to that of the
base and apex slices. Therefore, the 3-D bladder segmentation
starts from the mid-gland slice to the base and apex slices. The

detail of the overall workflow in Fig. 4(a) can be summarized as
follows:
1) Initializing the ILSF as a circle inside the bladder lumen
of mid-gland slice j manually. Then, segmenting the inner
and outer boundaries of jth slice using (b) without ASP
constraint, resulting in ILSFj and OLSFj .
2) Initializing (j − 1)th slice (or (j + 1)th for the apex direction) under the guidance of the resulted ILSFj , which
is illustrated by the red arrow in Fig. 4(a). The center
of initialized circle is equal to that of positive points of
ILSFj . The radius of the initialized circle is half of the
minimum distance between the center and the points on
the zero ILSFj .
3) Then, segmenting the (j − 1)th slice by using ILSFj and
OLSFj as shape prior, which is illustrated by the blue arrows in Fig. 4(a). With the ASP constraint, the bladder wall
can be segmented by applying the process of an individual
slice segmentation described in the following paragraph,
which is illustrated by the green arrow in Fig. 4(a).
4) Looping steps 2 and 3 to segment next slice, until to the
base (or apex) slice.
5) Combining the results of all slices, the 3-D segmented
bladder can be visualized, as shown in Fig. 4(a).
As a subprocess of the overall workflow, an individual slice
segmentation is shown in Fig. 4(b). It can be seen that the intensity of the bladder lumen is relatively homogeneous compared
to outside tissues. Thus, the first step in slice segmentation is to
initialize ILSF to segment the inner boundary. More specifically,
the detail of an individual slice segmentation in Fig. 4(b) can be
summarized as follows.

1712

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 5, SEPTEMBER 2014

the increased uncertainty of the segmentation. In this paper, we
focus on the slice-by-slice segmentation approach, which only
utilizes the true image data acquired by MR scans.
B. Evaluation Methods

Fig. 5.

(a) T1-weighted MR image. (b) T2-weighted MR image.

1) Initializing ILSF as a circle inside the bladder lumen under
the guidance of the segmentation of previous slice, or
without the guidance for the mid-gland slice.
2) Inner boundary extraction by evolving the ILSF with
the proposed ASP constrained DLS model (described in
Section III-B), or without ASP constrained DLS model
(described in Section III-A) for mid-gland slice.
3) Initializing the OLSF using the resulting ILSF in step
2, then evolving the OLSF with the proposed ASP constrained DLS model, or without ASP constrained DLS
model for mid-gland slice.
4) Refining the results of ILSF and OLSF by the proposed
CDLS model (described in Section III-C).

To evaluate the performance of our proposed method, manual
segmentation from an expert is used as the ground truth. In the
expert’s segmentation, the edges of tumors are segmented as
parts of bladder boundaries since the tumors grow in the bladder
wall.
Two kinds of metrics are employed in our experiment. For the
average surface distance (ASD), let va be a point of the contour
of automatic segmentation and Cm be the contour of manual
segmentation, the minimum distance from va to Cm is defined
as
d (va , Cm ) = min |va − vm | .

(21)

v m ∈C m

Then, the ASD between Ca and Cm is defined as
ASD(Ca , Cm )
1
=
|Ca | + |Cm |



	

d (va , Cm ) +

v a ∈C a

	



d (vm , Ca ) .

v m ∈C m

(22)
V. EXPERIMENTS
A. Materials and Analysis
The proposed method was applied on the 3-D MR bladder
images of 11 patients. The numbers of the slices containing
the bladder vary between 6 and 21 for different patients. The
total number of the tested images is 121. There are six axial T2-weighted FSE sequences and five axial T2-weighted
SSFSE sequences, obtained by a 3.0-T scanner (MR-Signa
EXCITE HD, GE) with a phased-array abdominal/pelvis coil
(TORSOPA, GE). The sequences were performed with the
following parameters of slice thickness: 3.0–5.0 mm, intersection gap: 3.0–5.5 mm, matrix: 512 × 512, pixel resolution:
0.66–0.86 mm, and TR/TE: 2117.6/78.0 ms.
T1-weighted and T2-weighted sequences are two basic MR
scans for bladder imaging. The distinct appearances of the bladder in the two imaging methods can be seen in Fig. 5. In the
T1-weighted image, the perivesical fat is light while the bladder
wall and the urine in the bladder lumen are dark. Thus, the outer
bladder boundary is clear but the inner boundary is difficult to
be distinguished [13]. In the T2-weighted image, the bladder
wall is dark, while the perivesical fat and the urine are light.
Therefore, both the inner and outer boundaries are visualized
relatively well. In our experiments, we used the T2-weighted
MR images to test the proposed method.
Since the interslice gap of the data is large, simple interpolation between slices does not serve well for true 3-D segmentation. The complicated 3-D reconstruction algorithms, such as
fusion of anisotropic MR images [23] and image superresolution [24], may be helpful at some extent. However, this will
make the segmentation results depend on the performance of
those preprocessing reconstruction algorithms. That results in

For the Dice similarity coefficient (DSC), let Sa denote the
shape of automatic segmentation and Sm denote the shape of
manual segmentation, the overlap area between Sa and Sm is
defined as
2 |Sa ∩ Sm |
.
(23)
DSC(Sa , Sm ) =
|Sa | + |Sm |
C. Parameter Settings and Discussion
In our experiment, we empirically fixed the insensitive parameters μ = 0.2 and λ = 5, as in the work [19]. After a set of
trials, the other parameters in our method were set as in Table I.
Among these parameters, the most important parameters are ω1
and ω2 for controlling the ASP constraint in (12). ω1 controls
the constraint for the weak boundary. A large ω1 gives the weak
boundary a strong constraint and a small ω1 can provide a weak
constraint. In general, it should be large, since a strong conω1
straint is needed to avoid leakage on the weak boundary. 1+ω
ω1 2
controls the constraint for the strong boundary. A small 1+ω
2
can add on the strong boundary with a weak constraint and
vice versa. In general it should be small, since only a weak constraint is needed for the strong boundary to make the evolution
more attached to the real boundary, when it is obvious. Thus, we
set ω2  ω1 . Varying ω1 from 6 to 10 and ω2 from 600 to 1000,
the average ASD of inner segmentation results using ASP constrained DLS model are shown in Fig. 7. In this test, the ground
truth of previous slice is used as a shape prior of the current slice
for fair comparison. It can be seen that the best result is obtained
by setting (ω1 , ω2 ) as (8, 800). No significant variation of ASD
was caused by varying (ω1 , ω2 ) up to (±2, ±200). For the other
parameters in Table I, the similar experiments were carried out
and it was found that they are less sensitive than ω1 and ω2 . The

QIN et al.: ADAPTIVE SHAPE PRIOR CONSTRAINED LEVEL SETS FOR BLADDER MR IMAGE SEGMENTATION

1713

TABLE I
PARAMETER SETTINGS IN OUR EXPERIMENT

Fig. 6. Examples show the performance of gradient direction, region information and thickness constraint. (a) (Left) Without gradient direction. (Right) With
gradient direction. (b) (Left) without region information. (Right) With region information. (c) (Left) Without thickness constraint. (Right) With thickness constraint.

Fig. 7. Segmentation performance of different parameter settings for ASP
constraint. ω 1 controls the constraint for the weak boundary and 1 +ω ω1 2 controls
the constraint for the strong boundary.

parameter α controls the evolution direction and speed of level
set in DLS model, and the parameters αi , αo , βi , and βo control
the evolution direction and speed of level set in CDLS model.
The angle threshold θ0 was used to identify the desired boundary, and the angle thresholds θ1 and θ2 were used to determine
the strength of inner and outer boundaries, respectively.

the weak part of boundary of base slice. 2) The second row
shows the results of with global shape prior constraint. It can be
seen that the leakage on the weak part is reduced by some extent.
However, it can also be seen that there are even more serious
leakages on some strong parts of boundary. This is because the
large global force drives the level set to approach the shape prior.
Once the zero level set passes over the real boundary, it cannot
stop until to the stronger edge of the shape prior or outside
tissues. 3) Finally, by using our ASP constrained model which
adds a weak constraint to the strong boundary and a strong
constraint to the weak boundary, this leakage problem can be
solved well, as shown in the third row.
3) Performance of the CDLS Model: As shown in Fig. 6(b),
it presents the comparison of the results of without (left side) and
with (right side) region information (described in Section III-C).
Without using the region information, the edge of outside tissue
is segmented as one part of the outer boundary, which can be
excluded by adding the region information, as shown on the
right side of Fig. 6(b). The performance of minimum thickness
information is shown in Fig. 6(c). Without thickness constraint,
overlap easily occurs between ILSF and OLSF, as shown on the
left side of Fig. 6(c). On the contrary, by embedding minimum
thickness constraint to the proposed coupled model, the robust
result can be obtained, as shown on the right side of Fig. 6(c).

D. Performance of the Proposed Method
1) Performance of the DLS Model: As shown in Fig. 6(a),
we compared the results of without (left side) and with (right
side) gradient direction (described in Section III-A). It can be
seen that, without the gradient direction, the artifact edge may
be segmented as inner boundary and the outer boundary might
be confused with inner boundary. While by utilizing the directional gradient, the inner boundary can be distinguished from
the artifact edge and the outer boundary can also be detected.
2) Performance of the ASP Constrained Model: A sequence
of results from mid-gland to base are shown in each row in
Fig. 8. The images in the first column are the same mid-gland
slice segmented by the DLS model. 1) The first row is segmented
without shape prior constraint, and there is serious leakage on

E. Comparison With Other Methods
1) Comparison Methods: To further validate the performance of our proposed method, we tested the same images
using the following methods with the optimal parameter settings. 1) Directional geodesic active contour (DGAC) method,
which segments the inner and outer boundaries using two DGAC
models [18] independently. 2) DRLS method, segmenting the
inner and outer boundaries using two DRLS models [19] independently. 3) DLS method described in Section III-A. 4) Combining DLS and CDLS method (DCDLS), in which a coupled
segmentation is carried out after inner and outer boundaries
are extracted by DLS model. 5) Our proposed ASP constrained
DCDLS method.

1714

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 5, SEPTEMBER 2014

Fig. 8. Examples show the inner boundary segmentation results of a sequence of slices from the mid-gland to the base. First row: segmented without shape prior
constraint. Second row: segmented with global shape prior constraint. Third row: segmented with our proposed ASP constraint. Red: ground truth. Yellow: inner
boundary segmentation result.

Fig. 9. Examples show the segmentation results of three slices based on the five methods. Last column: ground truth. Red: inner boundary. Yellow: outer
boundary.

These methods were implemented in MATLAB R2012b on a
Core(TM) i5 2.50-GHz laptop computer. It took about 26.8 s for
our method to segment the inner and outer boundaries from an
image, while the average runtimes of DGAC, DRLS, DLS, and
DCDLS methods are 144.0, 18.0, 13.3, and 24.2 s, respectively.
2) Qualitative Comparison: Some segmentation results of
slices based on the five methods are shown in Fig. 9. It can
be seen that the results of our proposed method are the most
approximate to the ground truth. The DGAC method [18] with
necessary reinitialization of level set performs worst among the
five methods. This is because the GAC model tends to leak out
when the boundary is weak or has gaps and produces shapes
of inconsistent topology [25]. The other four methods based on
the DRLS model [19] can avoid the traditional reinitialization.
Directly applying the DRLS model on the bladder segmentation
cannot obtain satisfactory results because of the challenges from
the MR bladder images. Inner and outer boundaries and artifact
edge cannot be distinguished without the gradient direction, as
shown in the second column in Fig. 9. In the proposed DLS
model, gradient direction is added to the DRLS model to reduce

the influence of the inside artifacts and outside tissues. In the
proposed DCDLS model, a coupled framework with minimum
thickness constraint can further improve the results. However,
leakage still occurs in this method. The proposed method exploits the interslice information to get robust results. With the
proposed ASP model, the leakage problem is solved well.
The 3-D bladder segmentation results of one patient based on
the five methods are shown in Fig. 10. In the first row, the inner
segmentation result of our proposed method is better than other
methods. Though the result of the DRLS method appears to
suffer from less leakage, in fact, the surface of the segmentation
is within that of ground truth, since the zero level set often stops
at the artifact edge as shown in the second column in Fig. 9.
The outer results are shown in the second row. Our method is
obviously superior to others though there is still little leakage
due to the weak boundary and complicated outside tissues.
3) Quantitative Comparison: The statistical results are
shown in Figs. 11 and 12. The small circle on the bar represents the average ASD (DSC) value and the length of the
bar denotes the corresponding standard deviation. As shown in

QIN et al.: ADAPTIVE SHAPE PRIOR CONSTRAINED LEVEL SETS FOR BLADDER MR IMAGE SEGMENTATION

Fig. 10.

1715

Segmentation results of inner and outer bladder surfaces using five methods. Green surface: segmentation result. Red surface: ground truth.

Fig. 11. Average ASD of inner and outer segmentation results based on the five methods. The outer average ASD of DGAC is high to 14.1 mm and it is beyond
the showing range.

Fig. 12. (a) Average DSC of inner and outer segmentation results based on the five methods. (b) Average DSC of the segmentation results of bladder wall based
on the five methods.

Fig. 11, the five bars on the left side are the evaluation results
of the inner boundary segmentation, while those on the right
side are the evaluation results of the outer boundary segmentation. The inner and outer average ASD values of our proposed
method are 1.45 ± 0.76 and 1.94 ± 0.88 mm. The mean errors
of our method are smaller than the errors of the others, while
the standard deviation bars of our method are also shorter in

the same time. In Fig. 12, the average DSC values of inner and
outer boundaries are given in (a), while the average DSC values of bladder wall (the narrowband between inner and outer
boundaries) are provided in (b). The average DSC values of our
method are higher and the standard deviations are smaller than
other methods, which indicate consistent larger overlap between
our segmentation and the ground truth. It can also be seen that the

1716

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 5, SEPTEMBER 2014

proposed method obtained significant improvement (p < 0.05,
t-test) on the outer boundary segmentation compared with other
methods.
VI. CONCLUSION
In this paper, a novel 3-D bladder wall segmentation method
is proposed. First, gradient direction information is utilized to
obtain the DLS model for inner and outer boundaries extraction.
By exploiting the directional gradient, the inner boundary can
be distinguished from the artifact edge. Then, the interslice information is incorporated into the ASP constrained DLS model
to reduce the leakage caused by the weak boundary. After that,
we introduce the region information to construct a coupled level
set model to exclude the outside tissues where the outer boundary is weak. A minimum thickness constraint is also embedded
to avoid an overlap between the inner and outer zero level set.
Finally, our proposed method is shown to be effective in the
experiments and a significant improvement in outer boundary
segmentation compared to other methods [18], [19] is obtained.
Since the shape prior constraint for the 3-D bladder image segmentation is useful, in our future work, we would like to test our
method on a larger study to learn a more accurate shape prior
for the slice segmentation.
REFERENCES
[1] American Cancer Society, Cancer Facts & Figures 2012. Atlanta, GA,
USA: Amer. Cancer Soc., 2012
[2] D. Chen, B. Li, W. Huang, and Z. Liang, “A multi-scan MRI-based virtual
cystoscopy,” Proc. SPIE, vol. 3978, pp. 146–152, 2000.
[3] S. Jaume, M. Ferrant, B. Macq, L. Hoyte, J. Fielding, A. Schreyer,
R. Kikinis, and S. Warfield, “Tumor detection in the bladder wall with
a measurement of abnormal thickness in CT scans,” IEEE Trans. Biomed.
Eng., vol. 50, no. 3, pp. 383–390, Mar. 2003.
[4] H. C. van Assen, M. G. Danilouchkine, M. S. Dirksen, J. H. Reiber, and
B. P. Lelieveldt, “A 3-d active shape model driven by fuzzy inference:
Application to cardiac CT and MR,” IEEE Trans. Inf. Technol. Biomed.,
vol. 12, no. 5, pp. 595–605, Sep. 2008.
[5] P. Yan, S. Xu, B. Turkbey, and J. Kruecker, “Adaptively learning local
shape statistics for prostate segmentation in ultrasound,” IEEE Trans.
Biomed. Eng., vol. 58, no. 3, pp. 633–641, Mar. 2011.
[6] Y. Cao, Y. Yuan, X. Li, B. Turkbey, P. Choyke, and P. Yan, “Segmenting
images by combining selected atlases on manifold,” in Proc. Med. Image
Comput. Comput.-Assist. Interven., 2011, pp. 272–279.
[7] S. Zhang, Y. Zhan, M. Dewan, J. Huang, D. N. Metaxas, and X. S. Zhou,
“Towards robust and effective shape modeling: Sparse shape composition,” Med. Image Anal., vol. 16, no. 1, pp. 265–277, 2012.
[8] S. Zhang, Y. Zhan, and D. N. Metaxas, “Deformable segmentation via
sparse representation and dictionary learning,” Med. Image Anal., vol. 16,
pp. 1385–1396, 2012.
[9] G. Chen, L. Gu, L. Qian, and J. Xu, “An improved level set for liver
segmentation and perfusion analysis in MRIs,” IEEE Trans. Inf. Technol.
Biomed., vol. 13, no. 1, pp. 94–103, Jan. 2009.

[10] C. Li, R. Huang, Z. Ding, J. Gatenby, D. Metaxas, and J. Gore, “A
level set method for image segmentation in the presence of intensity
inhomogeneities with application to MRI,” IEEE Trans. Image Process.,
vol. 20, no. 7, pp. 2007–2016, Jul. 2011.
[11] C. Duan, Z. Liang, S. Bao, H. Zhu, S. Wang, G. Zhang, J. Chen, and
H. Lu, “A coupled level set framework for bladder wall segmentation with
application to MR Cystography,” IEEE Trans. Med. Imag., vol. 29, no. 3,
pp. 903–915, Mar. 2010.
[12] J. Chi, M. Brady, N. Moore, and J. Schnabel, “Segmentation of the bladder
wall using coupled level set methods,” in Proc. IEEE Int. Symp. Biomed.
Imag.: Nano Macro, 2011, pp. 1653–1656.
[13] Z. Ma, R. Jorge, T. Mascarenhas, and J. Tavares, “Novel approach to
segment the inner and outer boundaries of the bladder wall in T2-weighted
magnetic resonance images,” Ann. Biomed. Eng., vol. 39, pp. 1–11, 2011.
[14] V. Caselles, R. Kimmel, and G. Sapiro, “Geodesic active contours,” Int.
J. Comput. Vis., vol. 22, no. 1, pp. 61–79, 1997.
[15] C. Li, C. Xu, C. Gui, and M. Fox, “Level set evolution without reinitialization: A new variational formulation,” in Proc. IEEE Comput.
Soc. Conf. Comput. Vis. Pattern Recognit., 2005, vol. 1, pp. 430–436.
[16] T. Chan and L. Vese, “Active contours without edges,” IEEE Trans. Image
Process., vol. 10, no. 2, pp. 266–277, Feb. 2001.
[17] X. Qin, Y. Liu, H. Lu, X. Li, and P. Yan, “Coupled directional level set
for MR image segmentation,” in Proc. IEEE 11th Int. Conf. Mach. Learn.
Appl., 2012, vol. 1, pp. 185–190.
[18] G. Zhu, S. Zhang, Q. Zeng, and C. Wang, “Directional geodesic active contour for image segmentation,” J. Electron. Imag., vol. 16, no. 3,
pp. 030501–030501, 2007.
[19] C. Li, C. Xu, C. Gui, and M. Fox, “Distance regularized level set evolution
and its application to image segmentation,” IEEE Trans. Image Process.,
vol. 19, no. 12, pp. 3243–3254, Dec. 2010.
[20] S. Osher and J. Sethian, “Fronts propagating with curvature-dependent
speed: Algorithms based on Hamilton-Jacobi formulations,” J. Computat.
Phys., vol. 79, no. 1, pp. 12–49, 1988.
[21] B. Hamm, G. Krestin, M. Laniado, V. Nicolas, and M. Taupitz, MR Imaging of the Abdomen and Pelvis. New York, NY, USA: Thieme Medical
Pub, 2009.
[22] S. Paramasivam, A. Proietto, and M. Puvaneswary, “Pelvic anatomy and
MRI,” Best Pract. Res. Clin. Obstetr. Gynaecol., vol. 20, no. 1, pp. 3–22,
2006.
[23] J. W. Chi, M. Brady, N. R. Moore, and J. A. Schnabel, “Fusion of perpendicular anisotropic MRI sequences,” in Proc. IEEE Int. Symp. Biomed.
Imag.: Nano Macro, 2011, pp. 1455–1458.
[24] M. Kuklisova-Murgasova, G. Quaghebeur, J. V. Hajnal, and J. A. Schnabel,
“Unified framework for super-resolution reconstruction of 3D fetal brain
MR images from 2D slices with intensity correction and outlier rejection,”
in Proc. MICCAI Workshop Image Anal. Human Brain Development,
2011.
[25] C. Xu, D. L. Pham, and J. L. Prince, “Image segmentation using deformable models,” in Handbook of Medical Imaging, M. Sonka and J. M.
Fitzpatrick Eds., ch. 3, SPIE 2000, vol. 2, pp. 129–174.

Authors’ photographs and biographies not available at the time of publication.

