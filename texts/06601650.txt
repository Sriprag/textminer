3354

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 12, DECEMBER 2013

Real-Time Adaptive Apnea and Hypopnea Event
Detection Methodology for Portable Sleep
Apnea Monitoring Devices
Bijoy Laxmi Koley∗ , Member, IEEE, and Debangshu Dey, Member, IEEE

Abstract—This paper presents a novel real-time adaptive sleep
apnea monitoring methodology, suitable for portable devices used
in home care applications. The proposed method identifies apnea/hypopnea events with the help of oronasal airflow signal and
aimed to meet clinical standards in the assessment mechanism of
apnea severity. It uses a strategically combined adaptive two stage
classifier model to detect apnea or hypopnea events on the basis of
personalized breathing patterns. For the detection of events, optimum set of time, frequency, and nonlinear measures, extracted
from overlapping segments of typical 8 s were fed to support
vector machine-based classifiers model to identify the possible
origin of the segments, i.e., whether from normal or abnormal
(apnea/hypopnea) episodes, and then the decision of the classifier
model on the time sequenced successive segments have been used
to detect an event. The performance of the proposed real-time algorithm is validated on clinical tests online. Average accuracies of
hypopnea, apnea, and combined event detection when compared
with polysomnography-based respective indices on unseen subjects
during online tests were found to be 91.8%, 94.9%, and 96.5%, respectively, which are quite acceptable.
Index Terms—Adaptive system, apnea-hypopnea event detection, obstructive sleep apnea, real-time monitoring, respiration
signal.

I. INTRODUCTION
LEEP apnea and hypopnea syndrome (SAHS) is a common
sleep disorder characterized by partial (hypopnea) or complete (apnea) cessation of breathing during sleep [1]. Common
symptoms of sleep apnea are loud snoring, excessive daytime
sleepiness, low concentration, and impaired learning. Epidemiological data show that untreated SAHS is linked to respiratory, cardiovascular, and cerebrovascular diseases [2]. Therefore, the early detection is essential to reduce the adverse health
consequences.

S

Manuscript received February 14, 2013; revised May 22, 2013 and September 11, 2013; accepted September 11, 2013. Date of publication September 17,
2013; date of current version November 18, 2013. This work was supported
by University Grants Commission (UGC), India, under the University with Potential for Excellence (UPE), phase II scheme awarded to Jadavpur University,
Kolkata, India. Asterisk indicates corresponding author.
∗ B. Koley is with the Department of Instrumentation Engineering, B. C.
Roy Engineering College, Durgapur, West Bengal 713206, India (e-mail:
bijoylaxmikoley@yahoo.com).
D. Dey is with the Department of Electrical Engineering, Jadavpur University, Kolkata, West Bengal 700098, India (e-mail: ddey@ee.jdvu.ac.in).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2013.2282337

Polysomnography (PSG) is the gold standard method for the
diagnosis of sleep apnea [3]. During PSG recordings, multiple
physiological signals of a subject are acquired throughout the
night. The recorded signals are then analyzed by the sleep specialist to identify the apnea and hypopnea events. By counting
these events during total sleep duration and then averaging per
hour basis provides the measure of apnea severity, which is represented as apnea hypopnea index (AHI). Apart from AHI, it
is also recommended in American Academy of Sleep Medicine
(AASM) [3] to provide apnea index (AI), i.e., the average number of apnea events per hour of sleep, and hypopnea index (HI)
separately. However, PSG is an expensive, time-consuming, and
labor-intensive procedure, and can be performed in sleep centers. Thus, several techniques have been developed for simplified SAHS detection based on electrocardiogram [4]–[7], airflow [8]–[10], pulse oximetry [11], [12], and snoring [13] with
reduced number of signals.
According to the AASM guidelines [3], the recommended
sensor to detect the absence of airflow for the identification
of an apnea is an oronasal thermal sensor, and the sensor for
the detection of a hypopnea is a nasal air pressure transducer
or alternatively the thermal airflow sensor. Therefore, a number of single-channel airflow measurement-based methods have
been developed for automatic detection of sleep apnea [8], [9],
[14]–[18]. These are based on time domain [10], [14], frequency
domain [9], time-frequency domain [18], and nonlinear measures [8].
Nowadays, the real-time monitoring of apnea is drawing the
interest of medical community as it is often advised in monitoring of preterm infant, critically ill patient, and patients under
CPAP therapy for on-the-fly calibration [12]. Recently, Bsoul
et al. [5] and Burgos et al. [12] implemented real-time SAHS
detection systems using SVM-based classifier from ECG signal and an ensemble classifier using SaO2 signal, respectively.
Most recently, Xie et al. [19] performed real-time SAHS detection using classifier combiner based on ECG and SaO2 . These
works tried to identify apneic episodes in minute-by-minute basis (per epoch analysis), i.e., whether the 1 min fragment of
signal (epoch) belongs to apneic events or not, but did not identify the events. In these cases, the number of apneic events may
not be the same as the number of epochs, because one epoch can
contain multiple events or a long apnea event could be prolonged
in multiple epochs, so identifying of epochs for the estimation
of AHI could give wrong assessment of the disease severity.
Hence, the identification of events is required for an accurate
assessment of AHI as per recommendations of AASM.

0018-9294 © 2013 IEEE

KOLEY AND DEY: REAL-TIME ADAPTIVE APNEA AND HYPOPNEA EVENT DETECTION METHODOLOGY

Apnea or hypopnea event can occur any time during sleep
and its duration is not fixed, therefore in previous work [20],
events were identified by classifying the short-duration overlapped segments of respiration signal, and then combining the
consecutive decisions of classifiers. An event detection and average window classification accuracy of 95.1% and 88.6% were
obtained for unseen dataset from MIT-BIH database [21], using
only four time domain-based features extracted from each of
the short-duration segments. As the generalization performance
of a classifier depends primarily on the success of selection
of good features [22] hence, a detailed study on suitable set
of features from different domains like time, frequency, and
nonlinear analysis was made for apnea event detection [23]. It
was also observed that by selecting suitable set of features using support vector machine-based recursive feature elimination
(SVM-RFE) technique the classification performance can be improved up to 96.3% for the same database. Moreover, in [20], it
was observed that identifying apnea and hypopnea events separately leads to accuracies of 92.8% and 89.6%, respectively,
compared with event (combined) detection accuracy of 95.1%.
The reason of this difference is separating apnea from hypopnea
and vice versa becomes difficult due to intersubject variability
and to some extent due to nonlinearity of the thermal sensor.
To address the intersubject differences, a novel online adaptation algorithm has been developed for the automatic detection
of apnea/hypopnea events [24]. The system can adapt to the
new user autonomously by updating the classifier in real time
in contrast to the use of global classifiers [4]–[7]. Recently, the
authors in [25] observed sleep/wake classification system suffers from intersubject differences; therefore they introduced a
novel online adaption technique, which updates the sleep/wake
classifier in real time. Inspired by the work of [25], the present
contribution aimed to develop a technique which can be considered as the first step toward the development of personal sleep
apnea monitoring technique that is also able to adapt different users automatically with minimal user interaction. With this
recognition, a new way to improve the classification accuracy
with an online algorithm has been described here. Moreover, the
paper details the entire work and can be seen as extended work
of [24], with complete validation and evaluation in the clinical
trials.
The proposed adaptive event detection technique can be incorporated in some suitable type 4 [26] portable monitoring devices, which not only provide assessment results as per common
clinical standard, i.e., providing the count of apnea and hypopnea events separately. Moreover, it should also meet the medical
guidelines for the assessment mechanism of severity, which basically limit the use of oronasal thermal sensor. The applications
of such portable devices are mainly aimed at day-to-day home
monitoring of apneic subjects (mainly for critically ill patients)
for providing the statistics of the apnea severity over period of
time. As the proposed device is able to provide counts of apnea
and hypopnea event, it can assist field practitioner to adjust the
setting of continuous positive airway pressure (CPAP) device.
Moreover, the technique is adaptive and can detect some event
in real time. Therefore, it can be extended for other applications
as mentioned in [5], [12], and [19].

3355

TABLE I
DEMOGRAPHIC DETAILS OF THE POPULATION SET

Fig. 1.

Distribution of subjects under different datasets.

II. MATERIALS
Among the subjects referred by different physicians for the
overnight sleep study on the basis of preliminary questionnaires,
only 36 subjects who had given their informed consent were included in the study. The subjects were known to have one or
more diseases like diabetes, bronchial asthma, high blood pressure, hyperthyroid, hypertension, and obesity and they were
under treatment for their respective illnesses. The group of
subjects can also be characterized as smoker/nonsmoker, alcoholic/nonalcoholic, and day worker/night shift worker. Table I
presents the demographic details of the subjects under study.
The PSG (model: Alice LE, Philips Respironics) recordings
were conducted at the Center for Sleep Disorder Diagnosis,
Burdwan, West Bengal, India, following clinical ethics.
Initially, 28 airflow recordings (28 different subjects) from
the PSG system were collected for the study purpose, among
these recordings randomly chosen 18 recordings were kept for
the training dataset and the remaining 10 recordings were kept
separate for independent testing, as shown in Fig. 1 (under offline PSG recordings). All the recordings were scored by a sleep
expert with the help of full PSG recordings using criteria proposed by the AASM [3]. In addition to the standard scoring,
apnea and hypopnea event related starting and end point of each
event were marked on respiration signal in consultation with the
sleep expert.
Online testing of the proposed algorithm was performed on
separate group of eight subjects (shown in Fig. 1) accompanied by PSG recordings. Among these eight subjects, repeated
tests were performed on four subjects, in order to test the improvement in performance over repeated use. During online test
the oronasal airflow signal was measured with the help of a
thermistor-based sensor; model: 5700 T and 5700B (connector) from Salter Labs Thermis Sense. The output of the sensor
connector (5700B) is a voltage signal of 1 mV peak-to-peak
was taken into the proposed system through a 50 Hz notchfilter, amplifier and a data acquisition system (DAS) (Model:
USB6009, Make: National Instrument). A photograph of the
system is shown in Fig. 2(a).
III. METHODS
The proposed method for the detection of apnea and hypopnea events from respiration signal has been performed into

3356

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 12, DECEMBER 2013

TABLE II
LIST OF THE EXTRACTED FEATURES

Fig. 2. (a) Photograph of the online event detection system [(A) PSG monitor,
(B) test system for real time event detection, and (C) DAS]. (b) Functional block
diagram of the proposed method for apnea/hypopnea event detection system.
(The solid blue and green lines indicate data flow and the dotted lines indicate
decision flow).

several steps, details of which are discussed in different subsections. An overview of the proposed method is presented in
Fig. 2(b). In the proposed method, the measured respiration signal has been segmented after preprocessing with the help of a
time shifted window function. The segments have been named
as “N,” “H,” and “A” according to origin, i.e., “A” and “H” for
those segments which are originated from apnea or hypopnea
events, respectively, and the remaining segments are named as
“N,” i.e., normal breathing event. The classifications of these
short segments have been performed in two stages. In the first
stage, a classifier named “SVM_N_HA” is used to identify the
“N” segments from the “A” or “H” segments with the help of
suitable set of features extracted from the segmented respiration
signal. Now, if the decision of the classifier SVM_N_HA is “N”
[as shown in Fig. 2(b)], then the corresponding respiration signal segment will be utilized to calculate the mean of the normal
breathing pattern for the subject (shown by solid green line). On
the other hand, if the decision of SVM_N_HA is either “H” or
“A” (represented as “HA”), then the second stage of classifier,
i.e., SVM_H_A will be utilized to identify whether it is “A” or
“H.” This stage is adaptive in nature. The classification is performed on the basis of the deviations of a suitable set of features
from the mean normal breathing features of the subjects, which
is updated iteratively during the normal breathing condition of
the subjects. The event detector, as shown in Fig. 2(b), takes
the time sequenced decisions of the classifiers on the several
time sequenced segments to detect apnea/hypopnea events, on
the basis of experimentally derived rules. Following subsections
discuss this method in details.

limits and thereafter it is filtered with a sixth-order band pass
Butterworth filter having pass band of 0.01–0.8 Hz [24].
B. Segmentation and Feature Extraction
The preprocessed signal is segmented with the help of rectangular window function of duration 8 s, as found to be suitable
(discussed in Section IV-B). This window function is shifted
by 2 s at a time, which results several time sequenced overlapped segments of signals. Thereafter, the originated segments
are categorized into three classes: “A,” “H” or “N.” “A”or “H”
labeled segments are those that have at least 50% of their length
falling within start-to-end time of apnea or hypopnea event,
respectively. Remaining all other segments are labeled as “N.”
For classification of these segments into three categories, 24
features from time domain, frequency domain, and nonlinear
analysis are extracted from each segment. The list of these 24
features is presented in Table II. The instantaneous respiration
amplitude (IRA) and instantaneous respiration interval (IRI) are
obtained from the respiration signal prior to segmentation, for
the calculation of features related to IRA (F1 to F4) and IRI
(F5 to F8). The computational details of these measures can be
found in [10]. Most of the remaining features have already been
applied by various researchers in sleep apnea study, computational details and relevant applications in sleep apnea can be
found in [23].
C. Feature Selection
Feature selection has been performed to prevent the curse
of dimensionality, avoiding classification errors produced by
domination of irrelevant features and reducing computation, so
that it can be realized into low cost portable device with limited
computational power and memory. In [23], it was observed
that SVM-RFE technique showed better performance compared
with F-score-based feature selection.

A. Preprocessing of Respiration Signal

D. Construction of SVM-Classifiers Model

In order to remove noise or artifacts caused by patient or sensor movements, the respiration signal is compared with normal

For the classification of the segments into three different
classes, i.e., “A,” “H,” and “N,” a classification model is formed.

KOLEY AND DEY: REAL-TIME ADAPTIVE APNEA AND HYPOPNEA EVENT DETECTION METHODOLOGY

3357

Fig. 3. Scatter plot of features of (a) mean of IRA versus area of respiration signal for 18 subjects of training dataset and (b) Mean of IRA versus area for two
subjects. (c) Renormalized features for A and H classes. (d) Renormalized features for A and H classes after subtracting from mean N class.

The classification is performed in two steps with the help of two
binary SVM classifiers. Besides classification, these two classifiers are also used for the selection of optimal set of features
separately.
A binary SVM basically finds an optimal separating hyperplane with the help of examples present in the training dataset.
After training, when a test sample is presented to the SVM, it
returns a value for the discriminant function (D) depending on
some short of distance of the test sample from the optimal separating hyperplane, while D = 0 indicates the test sample is on
the hyperplane, D > 0 indicates one class and D < 0 indicates
another class. Higher |D| value indicates higher distance, therefore it also indicate the confidence on taking decision. A brief
theory of SVM and SVM-RFE technique can be found in [27].
For multiclass classification, binary SVM classifiers are often arranged in one-against-all or one-against-one strategy [28].
Using these strategies, it was observed that the classification of
the “N” class segments from the remaining “A” or “H” class
segments was much easier compared to “A” from “N” and “H”
or “H” from “N” and “A” [24]. This basic reason can be understood from the probability distributions of the features in
the feature space. Fig. 3(a) shows the probability distributions
of the two features obtained through Gaussian mixture model
(GMM), along with the scatter plot of the features for all the
subjects under training dataset. Though the visual observation
reveals that each class (for example, “N”) forms a cluster, but
the detailed analysis through GMM reveals the presence of multiple subclusters within each cluster (class). In most of the cases,

it was observed that these subclusters are due to different subjects. Fig. 3(b) shows such kind of phenomena for two subjects
(subject 1 and 2) with the same two features. From the figure,
it can be observed that each class for each subject forms separate Gaussian component. It can also be observed that the “N”
class components are quite separated from the remaining, “H”
and “A” class components. As the separation of “N” class, from
the remaining “A” and “H” was found reasonably successful in
spite of the intersubject variability [20], thus in the first stage of
classification, the “N” class was separated out by SVM_N_HA
classifier.
Now, if the features of “A” and “H” classes can be somehow
compared with the corresponding features of “N” class for a
particular subject, then this intersubject variability can be reduced. This fact is demonstrated with the help of Fig. 3(c) and
(d). Fig. 3(c) shows the scatter plot of the same features, as
shown in Fig. 3(b), but in this case the renormalized features
of “A” and “H” classes are plotted after the removal of “N”
class. Due to the process of renormalization, now these features are occupying the entire feature space. In another case, as
shown in Fig. 3(d), the same features of “A” and “H” classes
were subtracted from the respective subjects mean value, and
then renormalized. By doing so, it can be observed that intraclass variability due to the presence of two subjects has been
reduced, which in another way improved the distance between
the two classes. The improvement in discrimination of the two
classes was quantified by calculating Mahalnobis Distance [24].
This fact also comes in line with the basic definition, where the

3358

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 12, DECEMBER 2013

reduction of airflow from the base line breathing of the subject is
considered to judge apnea/hypopnea. Thus, in the second stage,
the classifier SVM_H_A was used to separate the “A” class segments from the “H” class segments on the basis of the deviation
of the features from respective subject’s normal value.
E. Training, Testing, and Optimization of SVM Parameters
From each of the recordings, sliding windowwise different
features were calculated and consequently arranged in feature
vectors. All the features in the training dataset were normalized (after removing outliers) to zero mean and unit standard
deviation before applying them to the classifiers. In this paper,
cost-based learning strategy [5] was adopted to avoid biasness
of optimal separating hyperplanes for the imbalanced training
dataset. The imbalance is caused by the presence of less number of event related segments than the normal segments. The
SVM_N_HA classifier was trained with the feature vectors of
“N” and “HA” classes, where “HA” class contain both the “H”
and “A” class feature vectors. The SVM_H_A classifier was
trained with the “H” and “A” class feature vectors obtained by
subtracting it from the respective subject’s normal value, i.e.,
the mean of “N” class feature vectors, which is termed as representative mean (rm ).
To check the performance of the classifiers and to optimize
the SVM classifiers parameters, the k-fold (k = 6) cross validation (CV) scheme was adopted [29]. After the repetitive cycle of
training and testing process, the classification performance of
the individual run was averaged and presented by means of four
measures, i.e., sensitivity (SE), specificity (SP), predictivity
(PR), and accuracy (AC) [30]. Among these four measures, SE
parameter was used to optimize the SVM models, as adopted in
previous study [19].
F. Event Detection
Finally, when the time sequenced (starting to end of the
recording) consecutive feature vectors (originated from sequential overlapping segments) of a subject are presented to the
already trained and optimized SVM classifiers one by one for
the prediction of possible classes, the output of the classifier
model will be the streamed of class labels, separated by an
interval equal to the window sliding duration. These time sequenced class labels are then fed to the event detector, as shown
in Fig. 2. Finally, from this time sequenced class labels events
are detected with the help of experimentally observed criteria,
which states that for some valid event, at least six consecutive
segments must be classified as “A” or “H.” If more numbers of
“A” labeled segments are present compared to “H” labeled, then
the corresponding event will be identified as apnea or hypopnea otherwise. The performance of event detection was judged
subjectwise, by calculating the complement of absolute error in
percent, termed as SE, with the help of (1)
Sensitivity (%)


|No. of events present − No. of events detected|
= 1−
No. of events present
× 100.

(1)

G. Optimization of Parameters
The performance of event detection primarily depends on
the performance of the classifiers, further the classification performances depend on the selection of features and SVM model
parameters, like regularization Ĉ kernel function, etc. The event
detection was also found to be affected by the duration of segment, segment overlap duration, sampling frequency, and resolution of analog-to-digital (ADC) converter used in digitizing
the oronasal airflow signal. Suitable choice of these parameters’
values is crucial to obtain the best performance, since variation
of one parameter’s value affects the others. An experimental
trial and error method was adopted for proper choice of these
parameters’ values by compromising performance with respect
to computation required.
H. Implementation of Real-Time System
For online testing, the subject’s 5 min respiration signal just
before the sleep condition was taken for setting a normalization
scale factor for the respiration signal. This time is considered
as calibration time. After the calibration, digitized respiration
signal was stored in a buffer, and the required optimum set of
features for SVM_N_HA were calculated and presented to the
already trained classifier. If the decision of the classifier is “HA”
then the required optimum set of measures for SVM_H_A are
extracted from the buffered signal, which are then subtracted
from the representative mean rm of the subject to form the feature vector. Unfortunately, the representative mean rm of the
subject is not available ahead of time, therefore for calculation
of rm , an adaptive system is implemented which continuously
updates the representative mean of the subject starting from
global mean during testing process. For calculation of representative mean, only those “N” class feature vectors are considered
which comes with a discriminant function’s value higher than
a predefined threshold value Td . This threshold value was previously derived by analyzing the discriminant function values
obtained during testing process for all the training dataset subjects. It is the value of the discriminant function above which all
the decisions of the SVM_N_HA were correct. Whenever the
SVM_N_HA detects “N” class with the discriminant function
value above some suitable selected threshold value Td , it will
update rm by the following rule:
rm =

1
(rm −1 + η ∗ New feature vector’s value).
η+1

As long as testing process continues, and the classifier
SVM_N_HA detects the “N” class segment with discriminant
function above the threshold value Td , the subject specific representative mean will be continuously updated, and ultimately
after certain number of such episodes, it comes closer to the
actual subject’s specific mean. The value of adaptation rate η
should be chosen much less than one and needs to be chosen
suitably in order to control this convergence process, high value
of η will give fast convergence, but may not provide good performance due to fast alteration of the rm . More detailed discussion
is presented in [24].
The time taken by the computer (CPU: Pentium Dual Core,
2.6 GHz, RAM: 2 GB), when implemented using Real Time

KOLEY AND DEY: REAL-TIME ADAPTIVE APNEA AND HYPOPNEA EVENT DETECTION METHODOLOGY

TABLE III
RANK (R N ) OF THE OPTIMUM SET OF FEATURES FOR THE RESPECTIVE
CLASSIFIERS

Environment of LabVIEW, to identify an “N” class segment
was found to be 0.32 s, whereas for “A” or “H” class it increases
to 0.39 s.This is due to fact that the “A/H” class segments pass
through both the classifiers. However, these computation times
can be assumed low as the next segments to be processed will
come after 2 s. Apnea/hypopnea event detection takes places
after it receives at least six consecutive “A” or “H” labeled windows, which takes 12 s after starting of some event. It can be
noted that these processing time depend on the hardware configuration. In case of limited capacity hardware, one can increase
the window sliding duration, by sacrificing event detection
resolution.
IV. RESULTS AND ANALYSIS
This section summarizes the obtained results at various stages
of the proposed scheme, starting from the selection of features.
A. Feature Selection
After getting the ranks of the features for each of the classifier through SVM-RFE technique [27], the respective SVM
classifiers were again cross validated in 24 cycles, by cumulatively incorporating one feature (rankwise) at a time. It was
observed that the SE does not improve substantially by incorporating more than nine features for SVM_N_HA and 12 features
for SVM_H_A. Table III shows the list of the features along
with their respective rank.
B. Selection of Model Parameters Sensitive to Performance
and Computation
In this study, the Gaussian radial basis function of the form
k(x, x/ ) = exp(−γx − x/ 2 ), where x is the feature vector
and γ is a kernel parameter, was shown to perform similar or
better than polynomial (upto second order) and linear kernels.
The optimum values of SVM parameters like Ĉ and γ for both
of the classifier model, i.e., SVM_N_HA and SVM_H_A, were
chosen through grid search, the variation of average classification SE for limited range fine grid search of SVM_N_HA
is shown in Fig. 4(a). The optimum values for Ĉ and γ for
SVM_N_HA were found to be 11 and 1.15, respectively, and
for SVM_H_A these were 56 and 2.5. Several other experiments were performed to optimize the computational burden
with performance, as discussed in Section III-G. Fig. 4(b) and
4(c) shows the variations of the event detection SE (average
over all the subjects under training dataset) with variations of
the window length and window sliding duration, respectively.
Fig. 4(b) shows that when the window length is in between 7
to 9 s, the event detection performance becomes high and with
increasing window duration beyond 10 s will affect the perfor-

3359

mance of the event detector rather than the classifiers. It was
also observed that when window length is high, classification
performance improves, but there is less scope for event detector
to detect short length events. Conversely, the performance of the
classifier drops significantly when the window length is small.
As the smaller length window does not contain major part of the
respiration cycle, thus it becomes difficult to classify the windows from its feature vectors. By considering all these factors
and numbers of calculation required when implemented in real
time, window duration of 8 s was chosen. Next parameter, which
was adjusted is the window sliding duration, this parameter was
varied from 1 to 8 s (i.e., no overlap) and the event detection
performance was observed. The small amount of sliding will
improve the performance by increasing the resolution of the
entire event detection process, but in real-time scenario it will
impose the computational burden. The drop in performance with
the increasing window sliding duration is presented in Fig. 4(c).
In this paper, window sliding of 2 s was considered since this
provides integer multiple numbers of windows for 8 s.
Moreover, to reduce the computation burden by compromising performance, the sampling rate of respiration signal acquired
at 200 Hz was reduced from 200 to 10 Hz. It was observed that
upto 40 Hz, the performance is almost constant, it starts reducing very slowly up to 20 Hz and any further reduction degrades
the performance. In this paper, signals were downsampled to
64 Hz, as reducing to this level does not affect the performance
significantly and 512 samples can be obtained per window. After selecting the sampling frequency, it is necessary to check the
effect of ADC-bit resolution on event detection performance.
For ADC resolution, 12 bit was found to be reasonable, further
reduction affects the performance.
The value of η was also chosen experimentally after observing the convergence of rm from global mean to subject specific
mean. Fig. 4(d) shows the convergence of the measure “variance” from global mean value to the subject specific mean value
(rm ) for a particular subject. From the figure, it can be observed
that when the η value is too small (0.0008), the convergence process requires 70 min to reach to actual value. When the η value
is 0.001, the settling time becomes 30 min. At higher value of
η, i.e., 0.002, the settling time reduced to 25 min but even after
it settles, first variation of representative mean can be observed
due to intrasubject variability, which was found to incorrectly
detect apnea events as hypopnea.
C. Classification Performance
For the experimentally chosen optimum model parameters,
the classification performances for both of the classifiers were
investigated on seen as well as unseen dataset during offline and
online test by considering adaptive and nonadaptive systems.
Table IV summarizes both the offline and online classification
results on seen and unseen datasets. The offline results on seen
data represent the average performance obtained for both of the
classifiers from a k-fold (k = 6) CV test on training dataset.
Offline unseen results indicate the average performance of the
classifiers when the feature vectors of the separately kept 10 set
of recordings were presented to the classifiers. In this case, as

3360

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 12, DECEMBER 2013

Fig. 4. Results and analysis. (a) Optimization of average SE for ĉ and γ. (b) and (c) Variation of event detection SE with respect to window duration, and window
sliding duration, respectively. (d) Convergence for one feature of rm , i.e., area with respect to η. (e) Relation between PSG based AHI and model obtained AHI.
(f)–(h) Bland–Altman plots of HI, AI, and AHI.
TABLE IV
SVM CLASSIFICATION PERFORMANCE IN PERCENT ON DIFFERENT DATASETS

well as during all the online tests, the classifiers were trained
with the training dataset only and the same normalization scale
factor for the individual measures was used as obtained from
the training dataset, the out of range instances were set to corresponding limiting values. During offline tests of the SVM_H_A,
the “HA” class feature vectors were subtracted from the respective subject specific representative mean rm and then were applied to the SVM_H_A to identify whether the feature vector is
originated from “A” class or “H” class window. Same process
was followed for online test, but in this case the value of rm
was initialized to global mean value (obtained from the subjects
present in the training dataset). During online nonadaptive test
the value of η was set to zero, so that the rm does not update,
and remains equal to global mean value during the entire detection period. Online adaptive test was performed with η = 0.001.
Online repeat tests were performed on the same four subjects as
done in online adaptive test, in this case, rm was initialized to
the previous test value of rm instead of global mean. The performances of the classifiers during online test were analyzed later,
after the availability of expert scoring on the whole recording
and event start stop markings, but on the basis of classifiers decisions during online tests. In this case, the performance of the
second classifier, i.e., SVM_H_A is on the basis of the feature
vectors presented to it, hence when the first classifier incorrectly

TABLE V
EVENT DETECTION SENSITIVITY/PPV (%) DURING OFFLINE TEST

identifies some feature vectors as “HA” instead of actual ones,
i.e., “N,” the second stage classifier will classify it as either
“A” or “H,” which is considered as error. On the other hand,
the performance results for the SVM_H_A do not include the
performances on those feature vectors which the first classifier
incorrectly identified as “N” instead of actual “HA.”
On the other hand, the performances of SVM_H_A fall during online test with nonadaptive SVM_H_A classifier when
compared with the offline unseen test results. The performance
improves drastically when adaptive classifier is used, which further improves when repeat test is performed. This indicates the
effectiveness of subtracting the “HA” class feature vectors from
rm instead of global mean.
D. Event Detection Performance
Event detection performance was also analyzed on seen and
unseen data during offline and online tests. Table V summarizes the event detection SE [calculated using (1)] and positive
predictive value (PPV) obtained during offline test on seen and
unseen data. Table V shows that event detection SE is reasonable high for both of the dataset, but when it comes to identify
the event as apnea or hypopnea then the SE falls. It can be seen
from Table V that the hypopnea event detection SE is relatively
poor compared to apnea, but the PPV is higher. It indicates that
more number of hypopnea events were treated as either apnea
or normal event, compared to the normal or apnea events which
were treated as hypopnea.
The proposed model-based indexes, i.e., HIM o del , AIM o del ,
and AHIM o del were calculated by dividing the total number of
apnea and hypopnea events detected by the proposed model
to the total duration of sleep, where the total sleep time was

KOLEY AND DEY: REAL-TIME ADAPTIVE APNEA AND HYPOPNEA EVENT DETECTION METHODOLOGY

3361

TABLE VI
ONLINE TESTING RESULTS WITH ADAPTIVE AND NONADAPTIVE MODEL

obtained from the PSG sleep study. If it is applied in home
monitoring, the sleep time will be replaced by time in bed. The
relationship between the proposed model predicted indexes, i.e.,
HIM o del , AIM o del , and AHIM o del with the clinical expert predicted indexes, i.e., HIPSG , AIPSG , and AHIPSG (from PSG
records) was obtained through the Pearson’s correlations coefficients. The obtained correlation values are 0.976, 0.988, and
0.992 for HI, AI, and AHI, respectively. All PSG-based indexes
were found to be positively correlated with the model-based
indexes. The correlation decreased in the HIPSG /HIM o del (r =
0.976) as compared with that in AIPSG /AIM o del (r = 0.988) and
AHIPSG /AHIM o del (r = 0.992). Fig. 4(e) shows the relationship between AHIPSG and AHIM o del . The agreement between
these data was also analyzed by Bland–Altman statistical measure [31]. It shows the paired difference between two observations on each subject against the mean of these two observations.
Fig. 4(f)–(h) shows Bland–Altman plots for HI, AI, and AHI,
respectively. From the figures, it was found that there is a negative bias and the linear regression line having negative slope for
HI, which is just reverse in case of AI but much smaller in magnitude. The overall AHI is somewhat balanced but having slight
negative bias due to higher biasness in HI. This indicates that
the proposed system has underdetected the hypopnea event, and
overdetected the apnea event. The overall slight negative bias
of AHI indicates that some of the hypopnea events have been
detected as normal breathings and apnea events. Bland–Altman
analysis showed that the mean ±1.96 SD difference between
the models predicted AHI and PSG based AHI is −0.2 ± 4.6.
The event detection performances during online test for all
the three cases, i.e., nonadaptive, adaptive, and adaptive repeat
tests are presented separately in Table VI. The table shows the
model predicted AHIM o del along with expert predicted AHIPSG
for each of the individual subject. From the Table VI, it can be
observed that in case of nonadaptive test, the average HI and AI
accuracies are poor but the average AHI accuracy is reasonable
high. It is again due to the fact of underdetection of hypopnea
events and overdetection of apnea events, indicating the inability
of SVM_H_A to distinguish between “H” class and “A” class
feature vector. High-AHI accuracy proves that the system is able
to detect events from normal condition properly; it is because of
the orientation of the features in the feature space, which leads

TABLE VII
SUBJECT CLASSIFICATION UNDER THREE AHI CUT-OFF LEVELS

to higher accuracy for SVM_N_HA compared with SVM_H_A.
The SVM_H_A detects some of the “H” class feature vector as
“A” class and hence hypopnea events identified as apnea event.
When adaptive tests are performed, the average accuracy of
HI jumps to 91.8%, average AI accuracy also improves to 94.9%,
but no such significant improvement occurs in average AHI
accuracy. It proves that the event detection performance remains
same but SVM_H_A works in better way when the features are
compared with subject specific mean rather than global mean,
which is again evident when repeat tests are performed on the
same subjects. In repeated adaptive test, the subject specific
representative mean feature vector rm settles properly and helps
to improve accuracies of HI and AI further.
Finally, the subject classification performance according to
different cutoff level of AHI, is also presented in Table VII,
which includes all the subjects under training, testing, and online
tests dataset.
V. DISCUSSION
A novel adaptive event detection system, which identifies
apnea and hypopnea events in real time on the basis of personalized normal breathing patterns, is presented in this paper. The
sleep patterns of respiration signal contained larger intersubject
variations therefore a novel adaptation scheme was developed.
The key novelties of the approach are as follows: first of all,
the proposed system assesses apnea severity on the basis of
counting individual events which is clinically more significant,
than assessing severity [5], [12], and [19] from the number of
1 min apneic epochs. The number of events need not be the
same as the number of epochs since one epoch can contain
multiple events or a long apnea event could appear across multiple epochs. Therefore, in order to reduce the hidden number

3362

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 12, DECEMBER 2013

of actual apnea events, use of short segment overlapped windows of respiration signal is introduced. The proposed system
not only identifies the events, but also identifies whether the
event is apneaor hypopnea. Moreover, the apnea and hypopnea
discrimination system is adaptive in nature, which differentiates
between these two on the basis of normal breathing patterns
only, instead of comparing it from some base line measures
which may include events. Here, only two binary classifiers have
been strategically combined to identify three different classes,
rather than using multiple classifiers model [12], [19]. The use
of only two classifiers makes it suitable to realize in small systems like smart phones, PDAs, and embedded system suitable
for Point-of-Care applications, where computational power and
memory is limited. On the other hand, the decision about the
presence of an event is based on the several sequential decisions of the classifiers; hence one or two missclassification may
not affect the event detection performance. Moreover, unlike in
other works [4]–[7], [12], and [19] the classifier decision is not
considered as final one.
During the online testing, the results obtained in predicting
AHI indicate that the accuracy of adaptive system is higher than
the nonadaptive scheme. Being a real-time system, the obtained
final results, i.e., the estimated AHI indexes were found to be
closely correlated with the expert scored indexes and the results
fall within the interscorer agreement [32]. Among the most recent automated real-time SAHS detection approaches involving
epoch/episode classification, Bsoul et al. [5] achieved an accuracy of 86% for subject independent experiment based on
Apnea-ECG database [21]. Burgos et al. [12] considered data
mining techniques for SAHS detection and obtained 93% accuracy. Xie et al. [19] incorporated both ECG and SaO2 features
for real-time SAHS detection. An accuracy of 82% was obtained
on UCD database available online from Physionet [21]. More
importantly, in this study the accuracy of the model improves
significantly on repeated use, proving that the adaptive system
is able to address the intersubject variations.
The other outcomes of the study are finding effective and
suitable set of features through SVM-RFE technique for event
detection, and an online event detection scheme using short
overlapping segment of signals.
The Bland–Altman plot showed considerable negative bias
between the model predicted HIM o del and actual HI obtained
through PSG study. The underestimation is to be due to the
failure of thermal sensor to detect all hypopnea events present
in subjects sleep study. It is well known that the change in
thermal flow signal is not linear to the change in actual airflow
and hypopnea detection by thermal sensor may underestimate
sleep disorder breathing events [33].The proposed system is able
to overcome this problem to some extent, which is evident from
the jump in average accuracy value of HI to 91.8% during online
adaptive test from the 82.2% found during online nonadaptive
test.
This study had several limitations. In this study, the online
testing results include small number of subjects. Thus, clinical
validation study based on larger signal database is needed. The
dataset includes a higher proportion of subjects with SAHS disease compared with the general population. Therefore, present

findings may not be applicable to the general population. Further work is required to test the performance of our methodology
when airflow signals are recorded in home environment. On the
other hand, the proposed system introduces two new variables
(Td and η), which may require adjustment on different dataset;
hence improper adjustment may make the system unstable.
In summary, it is clear that most of the event detection errors
are due to the failure of the system to detect some hypopnea
events. Observation revealed that in most of the cases, mainly
short duration hypopnea events which did not produce significant trace in amplitude reduction of acquired respiration signal
have been treated as normal respiration. It might be due to nonlinearity of the thermal sensor and due to the limitation of single
channel recording. It is well established that sometimes during
hypopnea, reduction in amplitude of respiration signal are not
clearly visible and therefore the SpO2 and/or arousals in EEG
are used to identify the event [3].
Finally, the response of the thermistor to detect hypopnea
events is poor. The use of Polyvinylidene fluoride film (PVDF)
can be considered in future study to improve the diagnostic
ability. Future scope also includes further validation in home
environment and extending the real-time adaptive methodology
to point-of-care applications such as adaptively adjusting the
CPAP device, from the output of classification model.
VI. CONCLUSION
This paper presents a computer-based algorithm for detecting sleep apnea and hypopnea events from oronasal respiration
signal. The proposed method automatically provides an estimation of the apnea-hypopnea index (AHI). Furthermore, the
system is able to adapt to previously unseen subjects in real
time. During online testing, it was found that the performance
of the system can be significantly boosted with a small amount
of adaptation and on repeated use. The proposed system can
be implemented in type-4 portable monitoring device, which
follows the AASM medical guidelines in the assessment mechanism of apnea severity and also able to present results with
the help of clinically acceptable indices, i.e., HI, AI, and AHI.
The use of such portable devices is mainly for day-to-day home
monitoring of apneic subjects. In the light of moderate computational power used, the proposed algorithm can be easily
deployed in smartphone or PDA so that it becomes suitable for
Point-of-Care applications.
ACKNOWLEDGMENT
The authors would like to thank Dr. R. Pal, Assistant Professor, Burdwan Medical College, Burdwan, for his valuable advices, feedback, and support and Poushali Electronics, Kolkata,
India.
REFERENCES
[1] W. W. Flemons, M. R. Littner, J. A. Rowlet, P. Gay, W. M. Anderson,
D. W. Hudgel, R. D. McEvoy, and D. I. Loube, “Home diagnosis of sleep
apnea: A systematic review of the literature,” Chest, vol. 124, pp. 1543–
1579, 2003.

KOLEY AND DEY: REAL-TIME ADAPTIVE APNEA AND HYPOPNEA EVENT DETECTION METHODOLOGY

[2] T. Young, P. E. Peppard, and D. G. Gottlier, “Epidemiology of obstructive
sleep apnea, a population health perspective,” Amer. J. Respiration, Crit.
Care Med., vol. 165, pp. 1217–1239, 2002.
[3] American Academy of Sleep Medicine (AASM) Task Force, “Sleeprelated breathing disorders in adults: Recommendations for syndrome
definition and measurement techniques in clinical research,” Sleep, vol. 22,
pp. 667–689, Aug. 1999.
[4] A. H. Khandoker, J. Gubbi, and M. Palaniswami, “Automated scoring of
obstructive sleep apnea and hypopnea events using short-term electrocardiogram recordings,” IEEE Trans. Inf. Technol. Biomed., vol. 13, no. 6,
pp. 1057–1067, Nov. 2009.
[5] M. Bsoul, H. Minn, and L. Tamil, “Apnea MedAssist: Real-time sleep
apnea monitor using single-lead ECG,” IEEE Trans. Inf. Technol. Biomed.,
vol. 15, no. 3, pp. 416–427, May 2011.
[6] P. de Chazal, C. Heneghan, E. Sheridan, R. Reilly, P. Nolan, and
M. O. Mally, “Automated processing of the single-lead Electrocardiogram for the detection of obstructive sleep apnea,” IEEE Trans. Biomed.
Eng., vol. 50, no. 6, pp. 686–696, Jun. 2003.
[7] A. H. Khandoker, M. Palaniswami, and C. K. Karmakar, “Support vector
machines for automated recognition of obstructive sleep apnea syndrome
from ECG recordings,” IEEE Trans. Inf. Technol. Biomed., vol. 13, no. 1,
pp. 37–48, Jan. 2009.
[8] S. I. Rathnayake, I. A. Wood, U. R. Abeyratne, and C. Hukins, “Nonlinear features for single-channel diagnosis of sleep-disordered breathing
diseases,” IEEE Trans. Biomed. Eng., vol. 57, no. 8, pp. 1973–1981, Aug.
2010.
[9] H. Nakano, T. Tanigawa, T. Furukawa, and S. Nishima, “Automatic detection of sleep-disordered breathing from a single-channel airflow record,”
Eur. Respiration, J., vol. 29, pp. 728–736, 2007.
[10] P. Varady, T. Micsik, S. Benedek, and Z. Benyo, “A novel method
for the detection of apnea and hypopnea events in respiration signals,” IEEE Trans. Biomed. Eng., vol. 49, no. 9, pp. 936–942, Sep.
2002.
[11] D. Alvarez, R. Hornero, J. V. Marcos, and F. Del Campo, “Multivariate
analysis of blood oxygen saturation recordings in obstructive sleep apnea
diagnosis,” IEEE Trans. Biomed. Eng., vol. 57, no. 12, pp. 2816–2824,
Dec. 2010.
[12] A. Burgos, A. Goni, A. Illarramedi, and J. Bermudez, “Real-Time detection of apneas on a PDA,” IEEE Trans. Inf. Technol. Biomed., vol. 14,
no. 4, pp. 995–10002, Jul. 2010.
[13] U. R. Abeyratne, A. S. Wakwella, and C. Hukins, “Pitch jump probability
measure for the analysis of snoring sound in apnea,” Physiol. Meas.,
vol. 26, pp. 779–798, 2005.
[14] J. Han, H.-B. Shin, D.-U. Jeong, and K. S. Park, “Detection of apneic events from single channel nasal airflow using 2nd derivative
method,” Comput. Methods Prog. Biomed., vol. 91, pp. 199–207,
2008.
[15] T. Shochat, N. Hadas, M. Kerkhofs, A. Herchuelz, T. Penzel, J. H. Peter,
and P. Lavie, “The SleepSstrip: An apnoea screener for the early detection
of sleep apnoea syndrome,” Eur. Respiration J., vol. 19, pp. 121–126,
2003.
[16] F. R. de Almedia, N. T. Ayas, R. Otsuka, H. Ueda, P. Hamilton, F. C. Ryan,
and A. A. Lowe, “Nasal pressure recordings to detect obstructive sleep
apnea,” Sleep Breath, vol. 10, pp. 62–69, 2003.
[17] R. Ragette, Y. Wang, G. Weinreich, and H. Teschler, “Diagnostic performance of single airflow channel recording (Apnea Link) in home diagnosis
of sleep apnea,” Sleep Breath, vol. 14, pp. 109–114, 2010.
[18] M. Kermit, A. J. Eide, T. Lindblad, and K. Waldemark, “Treatment of
obstructive sleep apnea syndrome by monitoring patients airflow signals,”
Pattern Recog. Lett., vol. 21, pp. 277–281, 2000.
[19] B. Xie and H. Minn, “Real time sleep apnea detection by classifier combination,” IEEE Trans. Inf. Technol. Biomed., vol. 16, no. 3, pp. 469–477,
May 2012.
[20] B. Koley and D. Dey, “Automated detection of apnea and hypopnea
events,” in Proc. Int. Conf. Emerging Appl. Inf. Technol., 2012, pp. 85–88.
[21] A. L. Goldberger, L. A Amaral, L. Glass, J. M Hausdorff, P. C. Ivanov,
R. G. Mark, J. E. Mietus, G. B. Moody, C. K. Peng,, and H. E. Stanley,
“Physiobank, physiotoolkit, and physionet: Components of a new research
resource for complex physiologic signals,” Circulation, vol. 101, no. 23,
pp. 215–220, 2000.

3363

[22] C. M. Bishop, Neural Networks for Pattern Recognition. New York, NY,
USA: Oxford Univ. Press, 1995.
[23] B. Koley and D. Dey, “Selection of features for detection of obstructive
sleep apnea events,” in Proc. IEEE Annu. India Conf., 2012, pp. 991–996.
[24] B. Koley and D. Dey, “Adaptive classification system for real-time detection of apnea and hypopnea events,” in Proc. IEEE Point-of-Care Healthcare Technol., 2013, pp. 42–45.
[25] W. Karlen and D. Floreano, “Adaptive sleep-wake discrimination for wearable devices,” IEEE Trans. Biomed. Eng., vol. 58, no. 4, pp. 920–926, Apr.
2011.
[26] Portable Monitoring Task Force of the American Academy of Sleep
Medicine, “Clinical guidelines for the use of unattended portable monitors
in the diagnosis of obstructive sleep apnea in adult patients,” J. Clinical
Sleep Med., vol. 3, no. 7, pp. 737–747, 2007.
[27] B. Koley and D. Dey, “An ensemble system for automatic sleep stage classification using single channel EEG signal,” Comput. Biol. Med., vol. 42,
no. 12, pp. 1186–1195, 2012.
[28] C. Cortes and V. Vapnik, “Support-vector machines,” Mach. Learn.,
vol. 20, pp. 273–297, 1995.
[29] M. Stone, “Cross-validatory choice and assessment of statistical predictions,” J. R. Statist. Soc., Series B, vol. 36, no. 1, pp. 111–147, 1974.
[30] C. C. C. Pang, A. R. M. Upton, G. Shine, and M. V. Kamath, “A comparison of algorithms for detection of spikes in the electroencephalogram,”
IEEE Trans. Biomed. Eng., vol. 50, no. 4, pp. 521–526, Apr. 2003.
[31] J. M. Bland and D. G. Altman, “Statistical methods for assessing agreement between two methods of clinical measurement,” Lancet, vol. 1,
pp. 307–310, 1986.
[32] T. Penzel and R. Conradt, “Computer based sleep recording and analysis,”
Sleep Med. Rev., vol. 4, pp. 131–148, 2000.
[33] R. Farre, J. M. Montserrat, M. Rotger, E. Ballester, and D. Navajas, “Accuracy of thermistors and thermocouples as flow measuring devices for
detecting hypopneas,” Eur. Respiration J., vol. 11, pp. 179–182, 1998.

Bijoy Laxmi Koley (M’11) received the B.E. and
M.Tech. degrees from NIT Rourkela, and DAV, Indore, India, in 2000 and 2002, respectively.
Presently, she is working as a faculty member in
the Applied Electronics and Instrumentation Engineering Department, Dr. B C Roy Engineering College, Durgapur, India. Her research interest includes
biomedical signal processing and its application in
clinical and health informatics.

Debangshu Dey (M’09) received the B.E.E, M.E.E.,
and Ph.D. degrees from Jadavpur University, Kolkata,
India in 2003, 2005, and 2009, respectively.
Presently, he is working as a faculty member in the
Electrical Engineering Department, Jadavpur University, Kolkata, India. His areas of interest are condition
monitoring, intelligent instrumentation and measurements, applications of signal processing tools.

