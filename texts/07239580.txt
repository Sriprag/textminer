IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 63, NO. 4, APRIL 2016

841

Improved Low-Rank Filtering of Magnetic
Resonance Spectroscopic Imaging Data Corrupted
by Noise and B0 Field Inhomogeneity
Yan Liu∗ , Member, IEEE, Chao Ma, Member, IEEE, Bryan A. Clifford, Student Member, IEEE,
Fan Lam, Student Member, IEEE, Curtis L. Johnson, Member, IEEE, and Zhi-Pei Liang, Fellow, IEEE

Abstract—Goal: To improve the signal-to-noise ratio (SNR) of
magnetic resonance spectroscopic imaging (MRSI) data. Methods:
A low-rank filtering method recently proposed for denoising MRSI
data is extended by: 1) incorporating tissue boundary constraints
to enable local low-rank filtering, and 2) integrating B0 field inhomogeneity correction by rank-minimization to make the low-rank
model more effective. Results: The proposed method was validated
using both simulated and in vivo MRSI data. Its denoising performance is also compared with an upper bound based on the
constrained Cramér–Rao lower bound for low-rank filtering. Conclusion: Low-rank filtering can effectively improve the SNR of
MRSI data corrupted by both noise and B0 field inhomogeneity.
Significance: The proposed low-rank filtering method will enhance
the practical utility of high-resolution MRSI, where SNR has been
a limiting factor.
Index Terms—B0 field inhomogeneity correction, denoising, lowrank approximation, magnetic resonance spectroscopic imaging
(MRSI), partial separability, subspace filtering.

I. INTRODUCTION
AGNETIC resonance spectroscopic imaging (MRSI) is
a unique tool for molecular imaging [1], [2]. For example, MRSI can map the metabolite concentrations of the brain,
such as N-acetylaspartate (NAA), Choline (Cho), and Creatine
(Cr), which provide useful information about neuronal viability, cellular membrane synthesis, and energy production [3]–[5].
However, practical applications of MRSI have been limited due
to low signal-to-noise ratio (SNR), as metabolite concentrations
are typically several orders of magnitude lower than that of water. A large number of denoising methods have been proposed
to address this problem, a partial list of which includes wavelet

M

Manuscript received January 8, 2015; revised May 11, 2015 and July 20,
2015; accepted August 31, 2015. Date of publication September 3, 2015; date of
current version March 17, 2016. The work presented in this paper was supported
in part by National Natural Science Foundation of China (No. 41306203),
State Scholarship Fund of China Scholarship Council (No. 2011491261) and
Beckman Postdoctoral Fellowship. Asterisk indicates corresponding author.
* Y. Liu is with the University of Chinese Academy of Sciences, Beijing
100049, China (e-mail: yanliu@ucas.ac.cn).
C. Ma, F. Lam, and C. L. Johnson are with the Beckman Institute for Advanced
Science and Technology, University of Illinois at Urbana-Champaign.
B. A. Clifford and Z.-P. Liang are with the Department of Electrical and
Computer Engineering and the Beckman Institute for Advanced Science and
Technology, University of Illinois at Urbana-Champaign.
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Copyright (c) 2014 IEEE. Personal use of this material is permitted. However,
permission to use this material for any other purposes must be obtained from
the IEEE by sending an email to pubs-permissions@ieee.org.
Digital Object Identifier 10.1109/TBME.2015.2476499

denoising methods [6], [7], sparse model-based methods [8],
Lorentzian model-based methods [9], [10], and Bayesian methods with anatomical structure constraints [11]–[13]. Although
these methods work well on MRSI data with reasonable starting
SNR, they are less effective on MRSI data with low SNR, as
is often the case in practice. Recently, a low-rank (subspace)
filtering method, called low-rank approximation (LORA) [14],
was proposed for denoising practical MRSI data. This method
exploits the fact that the multidimensional MRSI signals reside
in a low-dimensional subspace and shows potential for effective
denoising of MRSI data with low SNR.
This paper presents an extended versions of LORA, coined
compartmental low-rank approximation (CLORA), to further
improve its performance under practical conditions. First, we
extend the partial separability (PS) model used in LORA to incorporate tissue boundary information that is readily available
from a companion anatomical scan often done in any MRSI
experiment. Such boundaries can be used to define a set of
generalized voxels or compartments, as in the spectral localization by imaging method [15]–[17]. Assuming that the spatial
supports of weak and/or localized metabolite signals can be segmented from anatomical images, the proposed method allows
performing local low-rank filtering to protect these signals from
being filtered out by global low-rank approximation. Second,
we integrate correction of B0 field inhomogeneity into CLORA
to make the low-rank model more effective. LORA assumes that
the B0 field inhomogeneity effects in the MRSI data are negligible or have been removed, which is not practical. It is well
known that B0 field inhomogeneities cause position-dependent
frequency shifts in the MRSI spectra, which will increase the
effective rank of the data in the PS model (and thus, degrade the
denoising performance of LORA). Several methods have been
proposed for B0 correction of MRSI data by taking advantage
of known B0 maps and prior knowledge of the spatial distribution (e.g., smoothness) and spectral distribution (e.g., sparsity)
of the underlying MRSI signals [18]–[27]. We propose a new
rank-minimization method (using the surrogate nuclear norm)
to correct the B0 field inhomogeneity effects.
It is worthwhile to note that subspace (low-rank) modeling
has found wide applications in MRSI [28]–[30]. In CLORA, a
local low-rank model (or mathematically a union-of-subspaces
model) is exploited for denoising. A similar model has been
used in [28] to remove the nuisance water and lipid signals from
the MRSI data. Explicit low-rank modeling has also been used
to process CSI data to reduce spectral leakage artifacts [29].

0018-9294 © 2015 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

842

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 63, NO. 4, APRIL 2016

Spectroscopic imaging by exploiting spatiospectral correlation)
uses a subspace model to dictate both data acquisition and image
reconstruction for high-resolution MRSI [30]. A preliminary
account of this study was presented in our early conference
paper [31].
The rest of this paper is organized as follows: Section II describes the proposed method in detail; Section III presents representative denoising results from simulated and in vivo MRSI
data to illustrate the performance of CLORA, followed by the
conclusion in Section IV.
II. PROPOSED METHOD
A. Global Low-Rank Filtering and LORA
In the absence of B0 field inhomogeneity and noise, the desired spatiotemporal distribution of an MRSI dataset can be
modeled by PS functions as described in [14], [32], and [33] by
ρ(r, t) =

L


(1)

where {ψl (t)}Ll=1 are a set of temporal basis functions,
{al (r)}Ll=1 are the corresponding spatial coefficients, and L
is the model order or separation rank [32].
LORA exploits the fact that PS functions induce low-rank
matrices in which the true signal resides in a low-dimensional
(row or column) subspace. More specifically, suppose ρ(r, t)
,M
in (1) is measured over a set of grids {(rn , tm )}N
n =1,m =1 , the
corresponding Casorati matrix given by
⎛
⎞
ρ(r1 , t1 ) ρ(r1 , t2 ) · · · ρ(r1 , tM )
⎜
⎟
⎜ ρ(r2 , t1 ) ρ(r2 , t2 ) · · · ρ(r2 , tM ) ⎟
⎜
⎟
C(ρ) = ⎜
⎟ (2)
..
..
..
..
⎜
⎟
.
.
.
.
⎝
⎠
ρ(rN , t2 ) · · ·

ρ(rN , tM )

has a rank upper bounded by L [32].
In practice, the measured data are corrupted by noise
ρ̂(r, t) = ρ(r, t) + (r, t)

(3)

where (r, t) is assumed to be independent and identically distributed (i.i.d.) Gaussian noise. The corresponding Casorati matrix of ρ̂(r, t) (denoted as Ĉ(ρ̂)) will almost surely be full rank.
Denoising is then performed by finding an optimal rank-L approximation for Ĉ(ρ̂)
	2
	
	
	
C∗ = arg min 	C − Ĉ(ρ̂)	 , s.t. rank(C) = L (4)
C

F

where ·F denotes the Frobenius norm.
It is well known that the solution to the low-rank approximation problem in (4) can be obtained using singular value
decomposition (SVD)
C∗ =

L


We extend LORA using local low-rank filtering instead of
global low-rank filtering. First, we assume that the imaged object
can be partitioned into a set of compartments (in this case, each
compartment corresponding to one tissue type). This assumption
is valid because MRSI experiments often include a companion
anatomical scan, from which tissue boundary constraints can be
obtained. Second, we assume that the spatiotemporal function
within each compartment can be represented by low-rank PS
functions. This assumption is also valid because voxels in the
same compartment should have similar spectral characteristics.
Under these assumptions, we can rewrite the spatiotemporal
function ρ(r, t) as
ρ(r, t) =

σl ul vlH

(5)

l=1

where σl , ul , and vl are the lth singular value, left singular
vector, and right singular vector of Ĉ(ρ̂), respectively.

P

p=1

L

al (r)ψl (t)

l=1

ρ(rN , t1 )

B. Compartmental Low-Rank Filtering and CLORA

Lp



Wp (r)
ap,l (r)ψp,l (t)

(6)

l=1
L

p
p
where {ψp,l (t)}l=1
and {ap,l (r)}l=1
can be viewed as the temporal basis functions and spatial coefficients of the pth compartment, respectively, with Lp being the model order. Wp (r) is the
indicator function for the pth compartment

1, for r ∈ Dp
Wp (r) =
(7)
0, otherwise

where Dp represents the spatial support of the pth compartment.
Clearly, the compartmental PS model in (6) becomes the
global PS model in (1) when P = 1. For P > 1, local low-rank
modeling can better protect weak and/or localized features that
may not have sufficient energy to “survive” global low-rank
filtering. This point is illustrated in Fig. 1, which shows simulation results from a Shepp–Logan like phantom. The phantom
was designed to have five compartments, each containing singlet
resonance peaks of NAA, Cr, and Cho with different concentrations except for Compartment 1, which contains additional
resonance peaks of low-concentration Lactate (Lac). Note that
compartmental low-rank filtering not only reduced noise more
effectively (as shown in the denoised Cr and Lac concentration
map) but also better protected the localized signals in Compartment 2 and better revealed the weak Lac signals in Compartment
1 than global low-rank filtering.
C. B0 Field Inhomogeneity Correction
In the absence of B0 field inhomogeneity and noise, the acquired MRSI data can be expressed as

(8)
s(k, t) = ρ(r, t)e−i2π k·r dr.
In practice, B0 field inhomogeneities caused by imperfections in the main magnetic field of an MRI scanner and by
inhomogeneous susceptibilities of tissues are not negligible. In
the presence of B0 field inhomogeneities, the measured MRSI
data become

(9)
ŝ(k, t) = ρ(r, t)e−i2π Δ f (r)t e−i2π k·r dr

LIU et al.: IMPROVED LOW-RANK FILTERING OF MAGNETIC RESONANCE SPECTROSCOPIC IMAGING DATA CORRUPTED BY NOISE

843

(11) as an unconstrained optimization problem
ρ∗c = arg min FB ρc − s22 + λ C(ρc )∗
ρc

(12)

where ·∗ denotes the nuclear norm of a matrix.
The aforementioned formulation also allows for the incorporation of edge constraints (obtained from the anatomical scan)
by adding another regularization term as
ρ∗c = arg min FB ρc − s22 + λ1 C(ρc )∗ + λ2 R(ρc ) (13)
ρc

where R(ρc ) can be used to encourage spatial smoothness while
preserving edges. One such example is given in [12] and [25] as
 
R(ρc ) =
wn 1 ,n 2 |ρc,n 1 ,n t − ρc,n 2 ,n t |2 (14)
nt

Fig. 1. Illustration of local versus global low-rank filtering. Top row: Cr
concentration map; second row: Lac concentration map; third and fourth rows:
spectra from compartments 1 and 2, respectively, which include (a) ideal spectra,
(b) noisy spectra, (c) denoised spectra by global low-rank filtering, and (d)
denoised spectra by local low-rank filtering.

n 1 n 2 ∈Ω n 1

where Ωn 1 is the eight-pixel neighborhood of voxel n1 , and
wn 1 ,n 2 are the weighting coefficients derived from the highresolution anatomical reference image such that: Large weights
are chosen in uniform regions to encourage smoothness and
small weights across edges to protect sharpness. More detailed
description on the selection of wn 1 ,n 2 can be found in [12] and
[25]. The optimization problem in (13) can be effectively solved
using the augmented Lagrange multiplier method described in
[39]. The regularization parameters λ1 and λ2 in (13) are chosen
based on the discrepancy principle, although more advanced
regularization parameter selection schemes can also be used.
D. Summary of CLORA

where Δf (r) denotes the frequency shift caused by B0 field
inhomogeneity.
Without B0 field inhomogeneity correction, direct Fourier
transform reconstruction of the spatiotemporal function in (9)
is given by
ρ̃(r, t) = ρ(r, t)e−i2π Δ f (r)t ⊗ h(r)

(10)

where “⊗” denotes convolution and h(r) represents the point
spread function associated with the Fourier reconstruction operator.
Since the additional phase term e−i2π Δ f (r)t in (10) is not a
separable function in space and time, ρ̃(r, t) in (10) cannot be
well represented by the compartmental low-rank model in (6)
with finite separation ranks. Consequently, the corresponding
Casorati matrix of ρ̃(r, t) is not rank-deficient, and low-rank
filtering would not be effective.
We propose to use a rank-minimization method to correct the B0 field inhomogeneity effects in the measured data.
More specifically, we seek to solve the following optimization
problem:
min rank(C(ρc )),
ρc

s.t.

FB ρc −

s22

2

<

(11)

where ρc is the B0 inhomogeneity corrected data to be determined, FB is the data acquisition matrix that includes k-space
sampling, Fourier encoding, and B0 field inhomogeneity effects,
s is a vector containing all the measured data, and 2 specifies the
tolerance of data inconsistency. The rank-minimization problem
can be solved more easily by using the nuclear norm as a surrogate metric for “rank” [34]–[37]. Therefore, we reformulate

The proposed method takes as input an MRSI dataset to be
denoised, a high-resolution anatomical image from which tissue boundary constraints and the weighting coefficients in (14)
are obtained, and a B0 field inhomogeneity map. The signal
processing steps involved are summarized as follows.
1) Correct the B0 field inhomogeneity effects by solving the
optimization problem in (13).
2) Generate the spatial masks, {Wp (r)}Pp=1 in (6), by segmenting the high-resolution reference image. Many software packages are available to perform this task, including
SPM and FSL [40], [41].
3) Perform compartmental low-rank denoising. More specifically, for each compartment, let
ρ̂(p) (r, t) = Wp (r)ρ∗c (r, t), p = 1, 2, . . . , P

(15)

and form its Casorati matrix (denoted as C(p) (ρ̂(p) )).
Then, obtain the optimal low-rank approximation of the
Casorati matrix using SVD
(p)∗

C

(p)∗

(ρ̂

)=

Lp


(p)

(p)

(p)H

σl ul vl

(16)

l=1

where ρ̂(p)∗ is the denoised data for the pth compartment,
(p)
(p)
(p)
σl , ul , and vl are the lth singular value, left-singular
vector, and right-singular vector of C(p) (ρ̂(p) ), respectively. Lp is the rank for the pth compartment, which is
selected by examining the singular value distribution of
the corresponding Casorati matrix. More specifically, assuming i.i.d. Gaussian noise , Lp is chosen such that

844

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 63, NO. 4, APRIL 2016

[14]

	
	
	
	
σL p +1 (C(p) (ρ̂(p) )) ≤ 	C(p) ()	 ≤ σL p (C(p) (ρ̂(p) ))
2
(17)
where σL p (C(p) (ρ̂(p) )) is the Lp th singular value of
C(p) (ρ̂(p) ), C(p) () is the Casorati matrix formed from
i.i.d
noise for the pth compartment, and
	
	 (p)Gaussian
	C ()	 can be estimated based on the Marchenko–
2
Pastur distribution of the eigenvalues of a random Gaussian matrix [38].
4) Combine the compartmental denoised data using
ρ∗ (r, t) =

P


Wp (r)ρ̂(p)∗ (r, t).

Fig. 2. MRSI Simulation phantom used in out Monte Carlo simulation study.
(a) NAA concentration map. (b) B 0 field inhomogeneity map. (c) Representative
spectra marked by the red dot (red line) and blue square (black line) in (a).

(18)

p=1

Note that as the B0 field inhomogeneity corrected data
ρ∗c (r, t) in (13) are reconstructed at the resolution of the
anatomical scan, the final denoised data are obtained by
truncating ρ∗ (r, t) in (18) in k-space back to the original
MRSI data resolution.
III. RESULTS AND DISCUSSION
A. Performance Analysis of Denoising by Low-Rank Filtering
The denoising performance of basic low-rank filtering has
been characterized in [42]. Assuming i.i.d. Gaussian noise, the
maximum noise reduction factor (denoted as RE) by low-rank
filtering can be calculated using the constrained Cramér–Rao
lower bound [43], [44], and is given by [42]
lim RE = lim

N →∞

N →∞

Variance before denoising
= M/L
Variance after denoising

(19)

where N and M are the total number of spatial encodings and
temporal points of the MRSI dataset, respectively, and L is the
approximation rank.
For practical MRSI data corrupted by B0 field inhomogeneity
effects, the measured i.i.d. Gaussian noise becomes correlated
and non-Gaussian after correction of the B0 field inhomogeneity effects through (13). Therefore, the i.i.d Gaussian noise assumption for computing the noise reduction factor using (19)
is violated. We evaluated the effects of the proposed field inhomogeneity correction used in CLORA on the denoising performance of low-rank filtering as compared to the theoretical
bound in (19).
To this end, we carried out a Monte-Carlo simulation study
using a simulation phantom modified from the one in [14]. More
specifically, the phantom consists of commonly MR-observable
metabolites: NAA, Cr, Cho, glutamate/glutamine (Glx), and
myo-inositol (mI). The spectra of these metabolites were obtained from quantum mechanics simulations [45]. Their spatial
distributions were created from three segmented regions of the
brain: cerebrospinal fluid (CSF), gray matter (GM), and white
matter (WM), based on commonly reported literature values
[46]–[48]. In addition, the spectra of the voxels within a small
circle [indicated by the red arrow in Fig. 2(a)] are modified
to have extra, weak Lac signals along with stronger Cho and
smaller NAA signals compared to the voxels outside the cir-

Fig. 3. Simulation results to illustrate the denoising performance of the proposed method. (a) Normalized singular value distribution for the Casorati matrices formed by the simulated i.i.d. Gaussian noise (red line) and the noise
after B 0 field inhomogeneity correction (black line), where n represents singular value index. (b) Noise reduction factors for three conditions: denoising a
dataset with B 0 field inhomogeneity corruption (black line with square marks),
denoising a dataset without B 0 field inhomogeneity corruption (red line with
circle marks), and the upper bounds from (19) (blue line with diamond marks).
Curves in (b) are obtained with fixed M = 512 and L = 15 but changing N
from 32 × 32 to 128 × 128.

cle [as shown in Fig. 2(c)]. An experimental B0 field map [see
Fig. 2(b)] was added to the phantom to simulate MRSI data with
B0 field inhomogeneity corruption. The Monte Carlo simulation was carried out with 100 noise realizations. Denoising was
done with a single compartment as the purpose of this simulation study was to investigate the effects of B0 inhomogeneity
correction on low-rank filtering. The noise reduction factor was
computed as
RE =

N

n =1

Var(1,n )/

N


Var(2,n )

(20)

n =1

where N is the total number of spatial encodings of the simulated
MRSI data, 1,n and 2,n denote the noise before and after
denoising, respectively.
Results from our Monte Carlo simulation study are shown in
Figs. 3 and 4 and Table I. Although B0 field inhomogeneity correction resulted in non-Gaussian and spatially correlated noise,
it did not significantly change the singular value distribution of
the Casorati matrix formed from noise, as shown in Fig. 3(a).
Therefore, B0 field inhomogeneity corruption is not expected
to significantly affect the denoising performance of low-rank
filtering, and the upper bound of noise reduction factor in (19)
should still apply to the proposed method. These expectations
were confirmed in our simulation study by comparing the variance of the denoised data for the cases with and without B0 field
inhomogeneity corruptions, as shown in Fig. 3(b) and Table I.
Table I also shows that the proposed B0 inhomogeneity correction only introduced a small bias to the resultant denoised data.

LIU et al.: IMPROVED LOW-RANK FILTERING OF MAGNETIC RESONANCE SPECTROSCOPIC IMAGING DATA CORRUPTED BY NOISE

Fig. 4. Denoising performance for a simulation dataset (N = 64 × 64) (top)
without and (bottom) with B 0 field inhomogeneity corruption. (a)–(d) Representative spectra [marked in (h)] and reconstructed NAA concentration maps
before and after denoising of data without B 0 field inhomogeneity corruption.
(e)–(h) Representative spectra [marked in (h)] and reconstructed NAA concentration maps before and after denoising of data with B 0 field inhomogeneity
corruption. In (b) and (f), the denoised signal (black line) is compared with the
gold standard signal (red line). The NAA concentration maps were calculated
by computing the integral around the NAA peak in the spectral domain.
TABLE I
COMPARISONS OF THE DENOISING PERFORMANCE OF LOW-RANK FILTERING
WITH AND WITHOUT B 0 INHOMOGENEITY CORRUPTION
N

32 × 32
48 × 48
64 × 64
96 × 96
128 × 128

Without B 0 inhomogeneity

With B 0 inhomogeneity

Variance

Bias

Variance

Bias

0.914
0.699
0.601
0.511
0.467

0.015
0.006
0.007
0.006
0.005

1.129
0.755
0.634
0.532
0.460

0.013
0.013
0.011
0.006
0.004

845

where R(ρ) is a weighted 2 -norm penalty given in (14).
3) Denoising using LORA. The B0 field inhomogeneity effects were corrected in the same way as CLORA, i.e.,
using (13). The rank for denoising was 15.
4) Denoising using CLORA. Four compartments were segmented, containing gray matter, white matter, CSF, and
the small circle indicated by the red arrow in Fig. 2(a),
respectively. The corresponding rank for denoising was 7,
7, 3, and 2, respectively.
The comparison results are shown in Fig. 5, demonstrating
that all of the compared methods effectively improved the SNR
of the original data. However, the denoised NAA maps obtained by denoising using TV regularization [see Fig. 5(c)]
and weighted 2 -norm regularization [see Fig. 5(d)] show blurring artifacts, reflecting the inherent tradeoff between SNR and
spatial resolution of the denoising methods that rely on spatial smoothness penalties. Compared to these two methods, the
NAA maps obtained by LORA and CLORA have less blurring artifacts and the corresponding spectra have higher SNR
as shown in Fig. 5(e) and (f). Note that a relatively small
weighted 2 -norm penalty is used in the B0 inhomogeneity
correction step of LORA and CLORA as the goal of this step
is to achieve more accurate B0 inhomogeneity correction rather
than denoising. Among all of the compared methods, CLORA
achieved the best denoising performance. Most noticeably, the
weak Lac signals are clearly seen in the CLORA denoised data
[see Fig. 5(f)], indicating that the proposed local low-rank filtering can efficiently reduce noise as well as effectively protect
weak signals. The mean square errors achieved by the compared methods further confirm the superior performance of
CLORA.
C. In Vivo Experiment Results

*

The variance and mean (bias) of the difference between the denoised
data and the ground truth were calculated and averaged by the number
of voxels.

Representative denoising results for N = 64 × 64 are shown in
Fig. 4. The denoised NAA maps and spectra for the cases with
and without B0 field inhomogeneity corruption show similar
SNR improvement as expected.
B. Comparison of MRSI Denoising Methods
The phantom in the Monte Carlo simulation was also used to
compare the denoising performance of the following methods.
1) Denoising using total variation (TV) regularization
ρTV = arg min FB ρ − s22 + λTV(ρ)
ρ

(21)

where FB is defined in (11) and TV(ρ) penalizes the total variation in space domain. Note that this formulation
achieves denoising and B0 field inhomogeneity correction simultaneously because the B0 inhomogeneity map
is incorporated into the forward model through FB .
2) Denoising using weighted 2 -norm regularization [12]
ρWL2 = arg min FB ρ − s22 + λR(ρ)
ρ

(22)

In vivo experiments were performed on a 3T Siemens Trio
scanner (Siemens Healthcare) to show the performance of the
proposed method. MRSI datasets were collected from a healthy
volunteer following an experimental protocol approved by our
Institutional Review Board.
A 3-D high-resolution (0.9 mm × 0.9 mm ×1 mm) anatomical dataset was collected using a magnetization prepared rapid
gradient echo (MPRAGE) sequence in a 5-min scan. A chemical shift imaging (CSI) data-set [2] was collected in a 15.5-min
scan with the following parameters: 220 mm ×220 mm fieldof-view, 10-mm slice thickness, 24 × 24 spatial encodings,
2000-Hz readout bandwidth, and TR/TE = 1600/30 ms. Water suppression enhanced through T1 effects pulses [49] were
used for water suppression and eight outer-volume-suppression
pulses were used for fat suppression. The CSI dataset is at
low resolution and is expected to have high SNR. For comparison, a high-resolution echo-planar spectroscopic imaging
(EPSI) dataset [50] was collected in a 20-min scan with 48 ×
48 spatial encodings and 16 signal averages, and is expected to
have low SNR. The readout bandwidth was 100 kHz, resulting
in a 1400-Hz spectral bandwidth for a bipolar EPSI acquisition. The other imaging parameters of the EPSI dataset were
the same as those of the CSI dataset. A high-resolution B0 field

846

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 63, NO. 4, APRIL 2016

Fig. 5. Comparison of CLORA with other state-of-the-art denoising methods. (a) Ground truth. (b) Low-SNR data before denoising (B 0 field inhomogeneity
corrected using the conjugate phase method [18], [19]). (c) Denoising using TV regularization. (d) Denoising using weighted 2 -norm regularization. (e) Denoising
using LORA. (f) Denoising using CLORA. The metabolite concentration maps were calculated by computing the integral around the corresponding resonance
peaks in the spectral domain.

Fig. 6. Experimental data: (a) estimated B 0 field inhomogeneity map, (b)
high-resolution anatomical reference image, and (c) weighting coefficients derived from (b) used to solve (13).

Fig. 7. B 0 field inhomogeneity correction results. (a) and (b) Representative
spectra at two different locations before and after the correction, respectively. (c)
Singular value distribution of the MRSI data before (red line) and after (black
line) the correction, where n represents singular value index.

map (1.7-mm in-plane resolution) was also collected in a 3-min
scan.
A recently proposed union-of-subspaces based method was
used to remove the residual water and fat signals from the CSI
and EPSI data [28]. The MPRAGE dataset [see Fig. 6(b)] was
first aligned with the CSI and EPSI datasets and was then used to
derive the weighting coefficients in (14). The B0 field inhomogeneity effects were removed using (13). For practical MRSI
data, B0 field inhomogeneity effects lead to frequency shifts,
as shown in Fig. 7(a). After B0 field inhomogeneity correction,
the spectral shifting was removed and the spectra appeared to be
well aligned, as shown in Fig. 7(b). As can be seen from Fig. 7(c),
the B0 field inhomogeneity correction made the singular val-

Fig. 8. First row: Images of three tissue types segmented from an MPRAGE
dataset. Second row: Compartmental masks derived from the segmented tissue
images. Third row: Singular value distributions of the MRSI data for each
compartment, where n is the singular value index and the selected rank is
marked by “*.”

ues decay faster and promoted low rankness, as expected. The
spectrum after B0 field inhomogeneity correction has slightly
higher SNR than that before correction.
After B0 field inhomogeneity correction, SPM [41] (SPM8
available at http://www.fil.ion.ucl.ac.uk/spm/software/spm8/)
was used to segment the MPRAGE dataset into three tissue
types: CSF, GM, and WM (the first row of Fig. 8). Three compartment masks were derived from the segmented tissue images
by thresholding (the second row of Fig. 8). The singular value

LIU et al.: IMPROVED LOW-RANK FILTERING OF MAGNETIC RESONANCE SPECTROSCOPIC IMAGING DATA CORRUPTED BY NOISE

847

Fig. 10 shows representative spectra from marked positions in
Fig. 9. As can be seen, the CSI data had high SNR but suffered from significant blurring artifacts due to limited k-space
coverage; the original EPSI data had high-resolution but very
low SNR; the EPSI data after B0 inhomogeneity correction using (13) had slightly improved SNR; and the EPSI data after B0
inhomogeneity correction and local low-rank filtering (the complete procedure of CLORA) had significantly improved SNR.
Notably, the ventricle structure is recovered after denoising by
the proposed method [in Fig. 9(d)].

D. Discussion

Fig. 9. In vivo denoising results. (a) Metabolite concentration maps from a
high-SNR, low-resolution CSI dataset. (b)–(d) Metabolite concentration maps
from a low-SNR, high-resolution EPSI dataset before denoising, after B 0 inhomogeneity correction using (13), and after B 0 inhomogeneity correction and
local low-rank filtering, respectively.

Fig. 10. Representative spectra from marked red dots in Fig. 9. (a) CSI data.
(b)–(d) EPSI data before denoising, after B 0 inhomogeneity correction using
(13), and after B 0 inhomogeneity correction and local low-rank filtering, respectively.

distributions of the spectroscopic data in each compartment are
plotted in the third row of Fig. 8, all showing low-rank properties but with different decay rates. Based on the singular value
distributions, the rank for each compartment was selected independently as shown by the “*” marks in the third row of
Fig. 8.
Denoising results using the proposed method are shown in
Figs. 9 and 10. Fig. 9 shows metabolite concentration maps,
obtained by integrating the magnitude of the spectrum around
the resonance frequencies of NAA, Cr, and Cho, respectively.

Based on low-rank (subspace) modeling, CLORA uses a twostep procedure for denoising: 1) B0 inhomogeneity correction
using rank minimization to promote the underlying low-rank
structure of the measured MRSI data, and 2) local low-rank
filtering. The dominant denoising power of CLORA comes from
low-rank filtering, as can be seen in the denoising performance
analysis results obtained by Monte Carlo simulations and by
comparing the B0 inhomogeneity corrected data of the in vivo
experiments before and after low-rank filtering [see Fig. 9(c)
and (d)]. To this end, the additional spatial smoothness penalty
in (13) is used for better B0 inhomogeneity correction rather
than for denoising as in [12].
CLORA takes advantage of compartment support information derived from high-resolution anatomical images to exploit
the underlying local low-rank structures of the MRSI data for
effective denoising while protecting weak and localized metabolite signals, assuming that the spatial supports of these signals
can be segmented from the anatomical images. Note that, as the
noise distribution is generally uniform across an image, choosing different ranks for denoising different compartments makes
the denoising performance compartment dependent.
One practical issue of using compartment supports is due to
segmentation error. Assuming the ranks for denoising are properly selected (e.g., using the methods discussed in the LORA
paper [14]), segmentation errors may affect the denoising performance of the proposed method. For example, when a compartment with MRSI signals of a lower rank is erroneously
segmented and overlaps with a compartment with a higher rank,
the selected rank may increase, and thus, degrade the denoising
performance. However, the proposed method is less sensitive to
subtle segmentation errors (e.g., due to different thresholds in
segmentation), because such errors would not significantly impact the singular value distributions of the MRSI signals of each
compartment. We carried out a simulation study to demonstrate
the effects of segmentation errors on the denoising performance
of the proposed method, using the same phantom as in the
Monte Carlo simulation study. As shown in Fig. 11(c), subtle
segmentation errors (caused by choosing different thresholds
in segmentation) only slightly degraded the denoising performance. However, if the compartments that contain weak or
localized signals are not segmented, the subsequent low-rank
filtering was not be able to protect such signals, as shown in
Fig. 11(d).

848

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 63, NO. 4, APRIL 2016

Fig. 11. Simulation results to illustrate the effects of compartment segmentation errors on the denoising performance of CLORA. First row: Segmented
masks for the white matter. Second row: Concentration maps of NAA. Third
row: Concentration maps of Lac. Forth row: Representative spectra [indicated
by the red dot (red line) and blue square (black line)]. (a) Original data before
denoising. (b)–(d) CLORA denoised data using accurate support information,
shrunk support by choosing a different threshold in segmentation, and the support lumping the white matter and the small circle together, respectively.

IV. CONCLUSION
This paper has presented an improved method for low-rank
filtering of MRSI data, with two novel features: 1) extension
of global low-rank filtering to local low-rank filtering by incorporating tissue boundary constraints, and 2) correction of
B0 field inhomogeneity effects using a rank-minimization approach. These new features improve the performance and robustness of low-rank filtering under practical MRSI conditions,
which were demonstrated using simulated and in vivo MRSI
data. The proposed method may prove particularly useful for
high-resolution MRSI, where SNR is a limiting factor.
REFERENCES
[1] P. C. Lauterbur et al., “Zeugmatographic high resolution nuclear magnetic resonance spectroscopy: Images of chemical inhomogeneity within
macroscopic objects,” J. Amer. Chem. Soc., vol. 97, pp. 6866–6868, 1975.
[2] T. R. Brown et al., “NMR chemical shift imaging in three dimensions,”
in Proc. Natl. Acad. Sci. USA, vol. 79, pp. 3523–3526, 1982.
[3] R. A. de Graaf, In Vivo NMR Spectroscopy: Principles and Techniques,
2nd ed. Hoboken, NJ, USA: Wiley, 2007.
[4] P. B. Barker and D. D. M. Lin, “In vivo proton MR spectroscopy of the
human brain,” Prog. Nucl. Magn. Reson. Spectrosc., vol. 49, pp. 99–128,
2006.
[5] A. Henning, “In vivo 1 H MRS applications,” in Encyclopedia of Spectroscopy and Spectrometry, 2nd ed. Oxford, U.K.: Elsevier, 2010,
pp. 1077–1084.
[6] D. L. Donoho, “De-noising by soft-threshholding,” IEEE Trans. Inf. Theory, vol. 41, no. 3, pp. 613–627, May 1995.
[7] H. F. C. de Greiff et al., “Signal de-noising in magnetic resonance spectroscopy using wavelet transforms,” Concepts Magn. Reson., vol. 14,
pp. 388–401, 2002.

[8] A. Laruelo et al., “Hybrid sparse regularization for magnetic resonance
spectroscopy,” in Proc. IEEE Eng. Med. Biol. Soc. Conf., 2013, pp. 6768–
6771.
[9] J. A. Cadzow, “Signal enhancement—A composite property mapping
algorithm,” IEEE Trans. Acoust. Speech, Signal Process., vol. 36, no. 1,
pp. 49–62, Jan. 1988.
[10] A. Diop et al., “Improvements of quantitation by using the Cadzow
enhancement procedure prior to any linear-prediction methods,” J. Magn.
Reson., vol. 105, pp. 17–24, 1994.
[11] Y. Bao and A. A. Maudsley, “Improved reconstruction for MR spectroscopic imaging,” IEEE Trans. Med. Imag., vol. 26, no. 5, pp. 686–695,
May 2007.
[12] J. P. Haldar et al., “Anatomically constrained reconstruction from noisy
data,” Magn. Reson. Med., vol. 59, pp. 810–818, 2008.
[13] H. M. Nguyen et al., “Denoising of MR spectroscopic imaging data with
spatial-spectral regularization,” in Proc. IEEE Int. Symp. Biomed. Imag.,
2010, pp. 720–723.
[14] H. M. Nguyen et al., “Denoising MR spectroscopic imaging data with
low-rank approximations,” IEEE Trans. Biomed. Eng., vol. 60, no. 1,
pp. 78–89, Jan. 2013.
[15] X. Hu et al., “SLIM: Spectral localization by imaging,” Magn. Reson.
Med., vol. 8, pp. 314–322, 1988.
[16] X. Hu and Z. Wu, “SLIM revisted,” IEEE Trans. Med. Imag., vol. 12,
no. 3, pp. 583–587, Sep. 1993.
[17] Z.-P. Liang and P. C. Lauterbur, “A theoretical analysis of the SLIM
technique,” J. Magn. Reson. Series B, vol. 102, pp. 54–60, 1993.
[18] A. Macovski, “Volumetric NMR imaging with time-varying gradients,”
Magn. Reson. Imag., vol. 2, pp. 29–40, 1985.
[19] D. C. Noll et al., “Conjugate phase MRI reconstruction with spatially
variant sample density correction,” IEEE Trans. Med. Imag., vol. 24,
no. 3, pp. 325–336, Mar. 2005.
[20] A. Bashir and D. A. Yablonskiy, “Natural linewidth chemical shift imaging
(NL-CSI),” Magn. Reson. Med., vol. 56, pp. 7–18, 2006.
[21] I. Khalidov et al., “BSLIM: Spectral localization by imaging with explicit
B 0 field inhomogeneity compensation,” IEEE Trans. Med. Imag., vol. 26,
no. 7, pp. 990–1000, Jul. 2007.
[22] M. E. Halse and P. T. Callaghan, “Imaged deconvolution: A method for
extracting high-resolution NMR spectra from inhomogeneity fields,” J.
Magn. Reson., vol. 185, pp. 130–137, 2007.
[23] Z. Dong and B. S. Peterson, “Spectral resolution amelioration by deconvolution (SPREAD) in MR spectroscopic imaging,” J. Magn. Reson. Imag.,
vol. 29, pp. 1395–1405, 2009.
[24] R. Eslami and M. Jacob, “Correction of B0 inhomogeneity distortion
in magnetic resonance spectroscopic imaging,” in Proc. IEEE Int. Conf.
Acoust., Speech, Signal Process., 2009, pp. 405–408.
[25] X. Peng et al., “Correction of field inhomogeneity effects in limited kspace coverage MRSI data with anatomical constraint,” in Proc. IEEE
Eng. Med. Biol. Soc. Conf., 2010, pp. 883–886.
[26] R. Eslami and M. Jacob, “Robust reconstruction of MRSI data using a
sparse spectral model and high resolution MRI priors,” IEEE Trans. Med.
Imag., vol. 29, no. 6, pp. 1297–1309, Jun. 2010.
[27] S. Bhave et al., “Sparse spectral deconvolution algorithm for noncartesian
MR spectroscopic imaging,” Magn. Reson. Med., vol. 71, pp. 469–476,
2014.
[28] C. Ma et al., “Removal of nuisance signals from limited and sparse 1 H
MRSI data using a union-of-subspaces model,” Mag. Reson. Med., doi:
10.1002/mrm.25635.
[29] J. Kasten et al., “Data-driven MRSI spectral localization via low-rank
component analysis,” IEEE Trans. Med. Imag., vol. 32, no. 10, pp. 1853–
1863, Oct. 2013.
[30] F. Lam and Z.-P. Liang, “A subspace approach to high-resolution spectroscopic imaging,” Magn. Reson. Med., vol. 71, pp. 1349–1357, 2014.
[31] Y. Liu et al., “Field-inhomogeneity-corrected low-rank filtering of magnetic resonance spectroscopic imaging data,” in Proc. IEEE Eng. Med.
Biol. Soc. Conf., 2014, pp. 6422–6425.
[32] Z.-P. Liang, “Spatiotemporal imaging with partially separable functions,”
in Proc. IEEE Int. Symp. Biomed. Imag., 2007, pp. 988–991.
[33] J. P. Haldar and Z.-P. Liang, “Low-rank approximations for dynamic
imaging,” in Proc. IEEE Int. Symp. Biomed. Imag., 2011, pp. 1052–1055.
[34] S. Lingala et al., “Real-time cardiac MRI using low-rank and sparsity
penalties,” in Proc. IEEE Int. Symp. Biomed. Imag., 2010, pp. 988–991.
[35] S. Lingala et al., “Accelerated dynamic MRI exploiting sparsity and
low-rank structure: k-t SLR,” IEEE Trans. Med. Imag., vol. 30, no. 5,
pp. 1042–1054, May 2011.

LIU et al.: IMPROVED LOW-RANK FILTERING OF MAGNETIC RESONANCE SPECTROSCOPIC IMAGING DATA CORRUPTED BY NOISE

[36] A. Majumdar and R. K. Ward, “Causal dynamic MRI reconstruction via
nuclear norm minimization,” Magn. Reson. Imaging, vol. 2012, pp. 1483–
1494, 2012.
[37] B. Tremoulheac et al., “Fast dynamic MRI via nuclear norm minimization
and accelerated proximal gradient,” in Proc. IEEE Int. Symp. Biomed.
Imag., 2013, pp. 322–325.
[38] V. A. Marcenko and L. A. Pastur, “Distribution of eigenvalues for some
sets of random matrices,” Math. USSRSb., vol. 1, pp. 457–483, 1967.
[39] Z. Lin et al., “Linearized alternating direction method with adaptive
penalty for low rank representation,” in Proc. Conf. Adv. Neural Inf. Process. Syst., 2011, pp. 612–620.
[40] K. J. Friston et al., “Statistical parametric maps in functional imaging a
general linear approach,” Hum. Brain Mapp., vol. 2, pp. 189–210, 1994.
[41] S.M. Smith et al., “Advances in functional and structural MR image
analysis and implementation as FSL,” NeuroImage, vol. 23, pp. 208–219,
2004.
[42] F. Lam et al., “Performance analysis of denoising with low-rank and
sparsity constraints”, in Proc. IEEE Int. Symp. Biomed. Imag., 2013, pp.
1223–1226.
[43] H. Cramér, Mathematical Methods of Statistics. Princeton, NJ, USA:
Princeton Univ. Press, 1946.
[44] C. R. Rao, “Information and the accuracy attainable in the estimation of
statistical parameters,” Bull. Cal. Math. Soc., vol. 37, pp. 81–91, 1945.
[45] B. J. Soher et al., “GAVA: Spectral simulation for in vivo MRS applications,” J. Magn. Reson., vol. 185, pp. 291–299, 2007.
[46] V. Govindaraju et al., “Proton NMR chemical shifts and coupling constants for brain metabolites,” NMR Biomed., vol. 13, pp. 129–153, 2000.
[47] R. Srinivasan et al., “Evidence of elevated glutamate in multiple sclerosis
using magnetic resonance spectroscopy at 3 T,” Brain, vol. 128, pp. 1016–
1025, 2005.
[48] Y. Wang and S. J. Li, “Differentiation of metabolic concentrations between
gray matter and white matter of human brain by in vivo 1 H magnetic
resonance spectroscopy,” Magn. Reson. Med., vol. 39, pp. 28–33, 1998.
[49] R. J. Ogg et al., “WET, a T 1 - and B 1 -Insensitive water-suppression
method for in vivo localized 1 H NMR spectroscopy,” J. Magn. Reson.,
vol. 104, pp. 1–10, 1994.
[50] S. Posse et al., “High speed 1 H spectroscopic imaging in human brain
by echo planar spatial-spectral encoding,” Magn. Reson. Med., vol. 33,
pp. 34–40, 1995.

Yan Liu (M’09) received the B.S. degree in electonic
information science and technology and the M.S. degree in communication and information system from
Shandong University, Jinan, China, in 2001 and 2004,
respectively, and the Ph.D. degree in signal and information processing from the Institute of Electronics,
the Chinese Academy of Sciences, Beijing, China, in
2007.
She is currently an Assistant Professor in the
School of Computer and Control Engineering, University of Chinese Academy of Sciences. Her research interests include signal processing and image processing with applications to magnetic resonance imaging.
Dr. Liu is a member of the IEEE Signal Processing Society, Engineering in
Medicine and Biology Society, and Women in Engineering Society.

Chao Ma (M’08) received the B.S. and M.S. degrees
in electrical engineering from Tsinghua University,
Beijing, China, in 2004 and 2007, respectively, and
the Ph.D. degree in electrical and computer engineering from the University of Illinois at UrbanaChampaign (UIUC), Urbana, IL, USA, in 2013.
He is currently a Beckman Postdoctoral Fellow at
UIUC. His research interests include RF pulse design,
image reconstruction, and spectroscopic imaging.

849

Bryan A. Clifford (S’11) received the B.S. degree in
electrical engineering and applied physics from Rensselaer Polytechnic Institute, Troy, NY, USA, in 2012.
He is currently working toward the Ph.D. degree at
the University of Illinois at Urbana-Champaign, Urbana, IL, USA.
From 2010 to 2012, he was a summer intern at Sandia National Labs, Livermore, CA, USA, where he
worked on radiation detection and sensing systems.
His current research interests include image reconstruction from limited/sparse data and the development of fast, high-resolution data acquisition schemes for magnetic resonance
spectroscopic imaging.
Mr. Clifford received the Rensselaer Polytechnics 2011 MacFarlane Prize
and 2012 electrical engineering Ricketts Prize. He is currently a member of the
Tau Beta Pi, Eta Kappa Nu, and Sigma Pi Sigma national honor societies.

Fan Lam (S’10) received the B.S. degree in biomedical engineering from Tsinghua University, Beijing,
China, in 2008, and the M.S. and Ph.D. degrees in
electrical engineering from University of Illinois at
Urbana-Champaign, Urbana, IL, USA, in 2011 and
2015, respectively.
His research interests include sparse sampling,
denoising and parameter estimation, with applications to magnetic resonance imaging and spectroscopic imaging.
Dr. Lam received the Computational Science and
Engineering Fellowship, Beckman Institute Graduate Fellowship, and Beckman
Institute Postdoctoral Fellowship from the University of Illinois. He received the
Best Student Paper Award at ISBI’2015. He also received the Magna Cum Laude
Award from the International Society of Magnetic Resonance in Medicine in
2012, 2013, and 2014.

Curtis L. Johnson (M’10) received the B.S. degree
in mechanical engineering from the Georgia Institute
of Technology, Atlanta, GA, USA, in 2007, and the
M.S. and Ph.D. degrees in mechanical engineering
from the University of Illinois at Urbana-Champaign,
Urbana, IL, USA, in 2010 and 2013, respectively.
He is currently the Assistant Director for MR Operations in the Biomedical Imaging Center, Beckman Institute for Advanced Science and Technology,
University of Illinois. His research interests include
image acquisition and reconstruction for quantitative
neuroimaging methods, particularly magnetic resonance elastography.
Dr. Johnson received a Beckman Graduate Research Fellowship in 2012 from
the University of Illinois. He also received the Summa Cum Laude and Magna
Cum Laude awards from the International Society for Magnetic Resonance in
Medicine in 2013 and 2014, and the Young Investigator Award at the 2014 IEEE
EMBS BRAIN Grand Challenges conference.

Zhi-Pei Liang (M’92–SM’98–F’06) received the
Ph.D. degree in biomedical engineering from Case
Western Reserve University, Cleveland, OH, USA,
in 1989.
He is currently the Franklin W. Woeltge Professor
of electrical and computer engineering at the University of Illinois at Urbana-Champaign, Urbana, IL,
USA. His research interests include spin dynamics,
image formation theory, algorithms, and biomedical
applications.
Dr. Liang served as the President of the IEEE Engineering in Medicine and Biology Society from 2011 to 2012. He is a Fellow
of the International Society of Magnetic Resonance in Medicine and American
Institute for Medical and Biological Engineering. He was elected to the International Academy of Medical and Biological Engineering in 2012.

