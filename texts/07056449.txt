IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

2033

A Novel Kalman Filter for Human Motion Tracking
With an Inertial-Based Dynamic Inclinometer
Gabriele Ligorio∗ and Angelo M. Sabatini, Senior Member, IEEE

Abstract—Goal: Design and development of a linear Kalman filter to create an inertial-based inclinometer targeted to dynamic
conditions of motion. Methods: The estimation of the body attitude (i.e., the inclination with respect to the vertical) was treated
as a source separation problem to discriminate the gravity and the
body acceleration from the specific force measured by a triaxial
accelerometer. The sensor fusion between triaxial gyroscope and
triaxial accelerometer data was performed using a linear Kalman
filter. Wrist-worn inertial measurement unit data from ten participants were acquired while performing two dynamic tasks: 60-s
sequence of seven manual activities and 90 s of walking at natural speed. Stereophotogrammetric data were used as a reference.
A statistical analysis was performed to assess the significance of
the accuracy improvement over state-of-the-art approaches. Results: The proposed method achieved, on an average, a root mean
square attitude error of 3.6° and 1.8° in manual activities and locomotion tasks (respectively). The statistical analysis showed that,
when compared to few competing methods, the proposed method
improved the attitude estimation accuracy. Conclusion: A novel
Kalman filter for inertial-based attitude estimation was presented
in this study. A significant accuracy improvement was achieved
over state-of-the-art approaches, due to a filter design that better
matched the basic optimality assumptions of Kalman filtering. Significance: Human motion tracking is the main application field of
the proposed method. Accurately discriminating the two components present in the triaxial accelerometer signal is well suited for
studying both the rotational and the linear body kinematics.
Index Terms—Accelerometer, attitude estimation, human motion tracking, inertial sensors, Kalman filtering.

I. INTRODUCTION
HANKS to recent advances in the technology of microelectromechanical systems, sensor devices have become
available, the size, power consumption and cost of which are
suited to the design of wearable sensor systems for several
applications in biomedical engineering and health informatics
[1], [2]. An example of this technology trend is given by the
availability of inertial measurement units (IMUs). IMUs integrate a three-axis gyroscope and a three-axis accelerometer for

T

Manuscript received December 11, 2014; revised February 5, 2015 and March
5, 2015; accepted March 5, 2015. Date of publication March 9, 2015; date of
current version July 15, 2015. This work was supported by the Italian Ministry of Education and Research under the relevant national interest project “A
Quantitative and Multifactorial Approach for Estimating and Preventing the
Risk of Falls in Elderly People,” and by the EC funded Project I-DONT-FALL
“Integrated Prevention and Detection Solutions Tailored to the Population and
Risk Factors Associated With Falls” (CIP-ICT-PSP-2011-5-297225). Asterisk
indicates corresponding author.
∗ G. Ligorio is with the BioRobotics Institute, Scuola Superiore Sant’Anna,
Pisa 56025, Italy (e-mail: g.ligorio@sssup.it).
A. M. Sabatini is with Scuola Superiore Sant’Anna.
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2015.2411431

measuring the angular velocity and the acceleration, respectively, of the body segment they are attached to; oftentimes,
IMUs integrate a three-axis magnetic sensor to sense the earth’s
magnetic field. One task for which IMUs are used concerns the
estimation of the 3-D orientation (pitch, roll and heading angles)
of the body segment relative to an inertial reference frame [3],
[4]. For some applications like fall detection one may be just
interested in estimating the attitude (pitch and roll angles), in
which case the magnetic sensor may be not necessary [5]–[7].
The 3-D orientation can be computed by integrating the gyroscope output from known initial conditions. However, the errors
incurred during integration tend to increase unbounded over
time, because of low-frequency drifts and wideband measurement noise affecting the gyroscope output [8]. The 3-D orientation can also be computed using the accelerometer and magnetic
sensor output when the body segment is motionless, in locations
where the earth’s magnetic field is known, or can be accurately
measured [9]. Sensor fusion methods for orientation estimation
determination can be designed using approaches based either
on Kalman filtering [3], [4], [10], [11] or nonlinear complementary filtering [12], [13]. In this paper, we stick to the former
approach; this decision was not intended to bias the preference
between the two approaches, which is well beyond the scope
of this paper. It is noted that the orientation errors can become
large due to external acceleration and magnetic disturbance.
The problem with a three-axis accelerometer being used for
attitude estimation (leveling) is that it is sensitive to both the
reaction to the earth’s gravitational field and the acceleration
the sensor is subject to because of the body motion (external
acceleration) [6], [11], [14]. As a matter of fact, humans move in
such a manner that the external acceleration is time-varying and
can be high in dynamic conditions, i.e., fast motions, in contrast
with the situation when the human body takes static or quasistatic postures (slow motions). In conditions of slow motions
the gravity acceleration dominates the external acceleration, and
the three-axis accelerometer can provide accurate estimates of
attitude [15]. To achieve high accuracy in conditions of fast
motions, it is necessary to discriminate between the gravity
acceleration and the external acceleration.
Kalman filters (KFs) and extended Kalman filters (EKFs) are
the preferred sensor fusion methods for estimating the attitude
(orientation) using IMUs [14]. Different approaches to their design have been proposed to deal with the problem of the external
acceleration, i.e., the threshold-based switching approach and
the acceleration model-based approach [6].
In the threshold-based approach, also known as vector selection, the measured acceleration is screened before being used in
the KF update [3], [16]. The norm of the measured acceleration

0018-9294 © 2015 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

2034

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

is tested against the magnitude of the gravity acceleration g
(g = 9.81 m/s2 ), or the directions of the measured acceleration and the predicted gravity acceleration, resolved in the body
frame, are compared. When the norm and/or the directional differences exceed given threshold values, the measured acceleration is not retained by the KF [14], [17]. Alternatively, the weight
given to the measured acceleration in updating the state estimate
may be adapted according to the values of the norm and/or the
directional differences. In [11], the measurement noise covariance matrix was augmented in a component-wise fashion by
using an additive term, whose magnitude was proportional to
the components of the innovation vector that are related to the
acceleration.
On the other hand, the model-based approaches predict the
external acceleration by means of an a priori model. In [18],
the body-frame coordinates of the gravity acceleration and the
earth’s magnetic field were treated as system’s state components
and estimated using a KF, with the advantage of a great simplification in the formulation of the measurement model. The
KF prediction step was driven using the measured angular velocity; however, in the KF update step external acceleration and
magnetic disturbances were both assumed to be zero. A Kalman
mechanization was presented in [6] for estimating the attitude
and the external acceleration. In a similar fashion to [18], the
state vector included the body-frame coordinates of the gravity acceleration and the body-frame external acceleration was
modeled with a first-order Gauss–Markov (GM) stochastic process. The KF prediction step was implemented by predicting the
body-frame gravity acceleration (within the filter, using the gyroscope output), and the external acceleration (outside the filter,
using the GM model). The measured acceleration was compensated for the predicted external acceleration and plugged into the
measurement equation, giving rise to an identity matrix mapping from the state to the measurements. Finally, the external
acceleration was updated by subtracting the updated estimate
of the body-frame gravity acceleration from the measured acceleration. The main problem with the KF proposed in [6] is
the correlation between prediction and update. In fact, prediction errors are responsible for correlated measurement errors,
because of the way the measurement are defined.
In this paper, we propose a Kalman-based sensor fusion
method that aims at discriminating the gravity vector and the
external acceleration in the specific force measured from the
accelerometer. The attitude (roll and pitch angles) is then computed from the body-frame gravity outside the KF framework,
using standard formulae. Compared to [6] the novelty is that the
external acceleration is inserted in the system’s state together
with the gravity, both resolved in the body frame. Thereby,
the KF measurement equation describes the specific force as
the sum of two components that add together in a linear and
time-invariant fashion. In other words, we cast the problem of
estimating the attitude using inertial sensor measurements as an
instance of the classical source separation problem.
Moreover, the prediction of the external acceleration is decoupled from observations in the measurement equations of our
algorithm, in contrast with [6]. In our design, the KF prediction step of the body-frame gravity acceleration is driven by the

gyroscope output, while the GM model is used to predict the
body-frame external acceleration.
Although the credibility of the stochastic modeling approach
for describing the external acceleration is uncertain, few basic
assumptions that help making a Kalman-based filter optimal
are satisfied in our design: 1) the state transition model and the
measurement model are both linear; 2) the measurement noise
is white Gaussian noise with zero mean and known covariance
matrix. Usually, these assumptions are not met by most Kalmanbased filters for attitude estimation, either because of the need
for linearization of the process and/or measurement equations
[14], or because the process and/or measurement noise covariance matrices are state-dependent, e.g., [6], [19]. In particular,
it is known that linearization errors due to, e.g., wrong initial
conditions or incorrect modeling, affect filter convergence and
statistical consistency [19], [20].
Experimental testing was done with a wrist-worn IMU, while
subjects performed different tasks. Insights were provided into
the operation of the proposed sensor fusion method, compared
with the sensor fusion methods proposed in [6], [14] and with
the time integration of the gyroscope output. Based on reference
measurements of attitude and external acceleration that were obtained using a stereophotogrammetric system, the performance
of the tested methods were assessed empirically and compared
with a statistical analysis.
II. METHODS
A. Notation and Reference Frames
The reference frames necessary to the filter development are
the navigation frame and the body frame. The navigation frame
{n} is earth-fixed; the Z-axis points downwards so that it is
aligned with the gravity. The body frame {b}—attached to the
IMU case—is the frame where the inertial sensor measurements
are delivered in. We intend to estimate the following quantities:
1) the attitude of the IMU case relative to the navigation frame;
and 2) the external acceleration the IMU case is subject to
because of the body motion.
With gbk and abk we denote, respectively, the representation
of the gravity acceleration and the external acceleration in the
body frame {b} at the kth sample time. Henceforth, 0n and In
indicate the n × n null and identity matrices, respectively.
B. Algorithm Development
The basic task that the proposed KF attempts to accomplish
is the discrimination between the gravity acceleration and the
external acceleration, namely the two components of the specific
force actually measured by the IMU accelerometer
fkb = −gkb + abk .

(1)

The two acceleration components are stacked together to form
the vector state
 b
gk
.
(2)
xk =
abk

LIGORIO AND SABATINI: NOVEL KF FOR HUMAN MOTION TRACKING WITH AN INERTIAL-BASED DYNAMIC INCLINOMETER

2035

The following sensor models are considered, which are valid
for a calibrated IMU [6]:
g

yk = ωkb + g wk

a

yk = −gkb + abk + a vk .

(3)

g

yk and a yk are, respectively, the angular velocity and specific force measured at the kth time sample, ωkb = [p q r] T
is the body angular velocity. g wk and a vk are the measurement noise of the gyroscope and the accelerometer, respectively,
which are assumed uncorrelated white Gaussian noise with zero
mean and covariance matrices, respectively, Σg = I3 · σg2 and
Σa = I3 · σa2 .
The continuous-time evolution of the representation of the
gravity acceleration in the body frame is described by the following differential equation [18]:
d gb
= −[ω b (t)×]gb
dt
where

⎡

−r

0

 b  ⎢
ω × =⎢
⎣r

q

−q

p

Fig. 1. Flow chart of the proposed KF. Indicated within the blocks are the
Kalman equations. The minus and plus left superscripts denote the a priori and
the a posteriori state and state error covariance estimates, respectively.

(5)

model that allow to set, respectively, the correlation time constant and the variance of each component of the external acceleration. For the sake of simplicity, they are assumed equal in
each direction.
In conclusion, the state-space discrete-time model is
 b 
g
 b
gk −1
Fk −1
03
gk
=
gm
03
F
abk
abk −1
g
 g

Gk −1
03
wk −1
+
gm
gm
03
G
wk −1
 b
 gk

yk = −I3 I3
(10)
+ a vk .
abk

⎤

⎥
−p ⎥
⎦

0

(4)

0

is the skew-symmetric operator.
When the gravity acceleration is aligned with the z-axis of
the navigation frame, its expression in the body frame can be
written as follows:
⎡
⎤
−sinϑ
⎢
⎥
⎥
gb = g ⎢
(6)
⎣ sinϕcosϑ ⎦
cosϕcosϑ
where ϕ and ϑ are the roll and pitch angles, respectively, according to the default Z-Y-X rotation sequence [21].
Under the assumption that the angular velocity is constant
in the sampling period Ts , (4) can be integrated leading to the
discrete-time model
gkb = exp(−[ω bk −1 ×] · Ts ) gkb −1 = g Fk −1 gkb −1 .

(7)

g

Since the gyroscope output yk is used to propagate the gravity vector in (7), prediction errors occur due to the measurement
noise g wk . A first-order approximation to the prediction error
is as follows [19]:


Δgkb ≈ −Ts gkb −1 × g wk −1 = g Gk −1 g wk −1 .
(8)
The body-frame external acceleration is modeled with a firstorder GM stochastic process with zero mean and uncorrelated
components [5], [6]. The GM model captures the time evolution
of their realizations as follows:
abk = ca · I3 abk −1 + cb · I3 g m wk −1
=

gm

F abk −1

+

gm

G

gm

wk −1

(9)

where gm wk −1 is white Gaussian noise with zero mean and
identity covariance matrix; ca and cb are parameters of the GM

Using a more concise notation, (10) can be restated as follows
(see Fig. 1):
xk = Fk −1 xk −1 + Gk −1 wk −1
y k = H xk + a v k .

(11)

The process noise covariance matrix Qk −1 and the measurement noise covariance matrix R are derived from (9)


I3 · g σ 2 03
Qk −1 = Gk −1
GTk −1
03
I3
R = I3 · a σ 2 .

(12)

The updated estimate of the gravity acceleration is enforced
to have the norm equal to g. This step is the same as, e.g., when
the updated estimate of the quaternion is normalized to have the
norm equal to one in the update step of quaternion-based EKFs
for orientation determination [14].

2036

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

C. Other Tested Methods
In this study the proposed KF (denoted as Method A in the
remainder of the paper) was evaluated in comparison with three
other methods.
The KF proposed in [6] was implemented as our Method B—
this is the only example we are aware of where an acceleration
model-based approach to external acceleration compensation is
pursued, although the external acceleration is modeled and predicted outside the Kalman-framework. The quaternion-based
EKF developed in [14] estimated the attitude as our Method C;
Method C can be considered representative of the standard approach to determine orientation, where the external acceleration
is not modeled, rather it is considered a nuisance factor to guard
against with a threshold-based rule. Finally, the gravity acceleration was projected in the body frame using (7) (Method D). In
practice, this method is equivalent to recursively applying the
prediction step of Method A and Method B without any update
from the measured acceleration. We took Method D as a useful
reference to assess the advantages of pursuing sensor fusion for
attitude estimation.
Although the influence of the magnetic sensor can be suppressed by setting to zero the filter input parameters related to
magnetic sensor measurements and bias compensation, Method
C was implemented as described in [14], and the attitude was derived from the full orientation solution. There are two reasons for
doing so: first, since the quaternion from the body frame to the
navigation frame is part of the system’s state, heading errors can
play a critical role in the EKF linearization errors; second, because of the dynamics of the motion tracking tasks considered in
the experimental testing of this paper, the threshold-based rule
implemented in Method C may lead to low acceptance rates
of the acceleration measurements, making the difference with
Method D small.

D. Experimental Setup
1) Subjects and Tasks: Ten healthy subjects participated in
the study after being informed about the nature and goals of the
experimental procedures. The research methodology described
hereafter was approved by the university institutional review
board. Subjects were asked to wear an IMU on their dominant
wrist during the execution of two paradigmatic motor tasks,
namely manual routine and locomotion [22].
Manual routine tasks were acquired for about 60 s within a
limited measurement volume of about 0.8 m × 0.8 m × 0.8 m.
Subjects mimicked the following activities while seated in front
of a table with a shelf below it: drinking a glass of water (5 s),
writing with a pencil (5 s), writing using a keyboard (5 s),
brushing teeth (10 s), brushing hair (10 s), approaching to a
small magnet placed on the table (5 s), and moving an object
from the table to the lower shelf and back to the table (8 s). A
static pause of few seconds was included between each activity.
Locomotion tasks were acquired for about 90 s while subjects
were asked to walk at their preferred speed along an eightshaped path, which covered approximately a 4 m × 2 m area.

Fig. 2. Plastic support where both IR markers and the IMU (not visible) were
attached. The red reference frame was the body frame associated to the IR
markers, whereas the yellow one was associated to the IMU. The reference
frames were preliminarily aligned using the method proposed in [22].

Due to the oscillating motion of the upper arm, there were no
time intervals during which the IMU was motionless.
All tasks were carried with the subjects sitting or standing
still for at least 5 s before starting to move.
2) Acquisition of Reference and IMU Data: The IMU (Opal,
APDM, Inc., Oregon, USA) integrated a three-axis accelerometer, a three-axis gyroscope and a three-axis magnetic sensor
(±6g, ±1500◦ /s and ±600 μT of full-range scale, respectively).
It was fastened to the subjects’ dominant wrist using a Velcro
elastic belt (see Fig. 2). Angular velocity, acceleration and magnetic sensor data were acquired at the rate of 128 samples/s.
Magnetic sensor output was not used to run the sensor fusion
methods in this study except for running Method C.
A nine-camera stereo-photogrammetric system (Vicon MX3,
Oxford, U.K.) was used as a gold standard to measure wrist
kinematics at the rate of 100 samples/s. Four reflective infrared
(IR) markers were mounted over a small plastic support rigidly
attached to the IMU, as shown in Fig. 2. The IR markers allowed
to define a marker frame aligned with the body frame. IMU and
stereo-photogrammetric data streams were synchronized using
a square wave signal that was simultaneously detected by both
systems.
All data processing was performed with customized functions
using the Matlab software (The MathWorks, Inc., MA, USA).
IMU measurements and marker trajectories were resampled at
the same frequency, set at 200 samples/s, using cubic spline interpolation. To remove random noise, marker trajectories were
low-pass filtered using a second-order zero-lag Butterworth filter [22]. The filter cutoff frequency was determined by performing a residual analysis on each trial of each subject. The values

LIGORIO AND SABATINI: NOVEL KF FOR HUMAN MOTION TRACKING WITH AN INERTIAL-BASED DYNAMIC INCLINOMETER

obtained were similar among different motor tasks and among
different subjects (standard deviation less than 0.3 Hz). Thus,
the cutoff frequency value was conservatively set to 6 Hz for all
trials. Misalignment occurring between the marker frame and
the body frame was preliminarily estimated and compensated
using the method proposed in [23].
The calibration of the accelerometer was checked using the
following approach. First, three static trials were acquired where
each IMU axis was consecutively aligned with the gravity direction for one minute. A plumb line was used to verify the correct
alignment of each axis with the vertical line. The average gravity
acceleration measured along each axis was computed, and its
value compared to g, and to zero, for the two components lying
in the horizontal plane. As the maximal difference between the
measured acceleration and g, or zero, never exceeded 0.02 m/s2 ,
the accelerometer was considered as properly calibrated. The
magnetic sensor was calibrated as described in [14]. The IMU
was freely rotated about each of the three local axes for about
60 s, and the offset and scale factor of the magnetic sensor were
estimated.
The gyroscope bias was estimated by averaging the measured
angular velocity during the initial rest period at the beginning
of each trial; the estimated bias was then subtracted from all
gyroscope measurements made during the trial.
All methods were initialized using accelerometer data at the
beginning of each experimental trial, for computing either the
gravity in the body frame (Method A, B, and D), or the initial
quaternion (Method C, [14]).
E. Accuracy Assessment and Statistical Analysis
The marker trajectories were processed to compute markerbased estimates of pitch and roll angles (reference attitude)
[24]. The quaternion from the body frame to the navigation
frame was computed, from which the quaternion describing
only the attitude was derived (reference quaternion, qref ); the
estimates of the reference attitude and Euler angles (pitch and
roll) were derived using standard methods [21]. It should be
noted that the stereo-photogrammetric errors [25] propagate to
the angles of interest in this study causing a maximal inaccuracy
of 0.5°. The central-time finite-difference approximation to the
second derivative of the coordinates of the centroid of the four IR
markers was taken to generate the external acceleration, which
was rotated in the body frame using the quaternion from the body
frame to the navigation frame, yielding the reference external
acceleration.
The estimated quaternion qest describing only the attitude,
was computed from the estimated gravity (Method A, B, and D)
or from the full quaternion (Method C) [9]. The error quaternion
qe = qest ⊗ q−1
ref was then derived (⊗ denote the quaternion
product). The scalar part of the quaternion error was involved
in computing the attitude error [14]; the errors incurred in the
pitch and roll angles were derived from the quaternion error
using standard conversion formulae.
The accuracy assessment for all Methods A through D was
performed using the root mean square error (RMSE) metric.

2037

The RMSE θ of each variable θ of interest was computed as a
function of the discrete time using the following equation:
RMSEθ (kTs ) =

 k
1 

(θest (iTs ) − θref (iTs ))2 , k = 1, ..., N
k i=1

(13)

where θest (i Ts ) and θref (i Ts ) are the estimated and reference
value of θ at the time instant iTs , respectively. The sequence
RMSEθ (kTs ) was used to produce the time plots, while its
final value, i.e., RMSEθ = RMSEθ (N Ts )was involved in the
statistical analyses. The reference values were null when the estimations errors were involved in computing the RMSE values,
in the case of RMSEatt , RMSEpitch and RMSEroll .
Limited to Method A and Method B, the components of the
reference external acceleration were subtracted from the corresponding components of the estimated external acceleration
to compute RMSE
x , RMSEy and RMSEz and the performance

metric RMSEt = RMSE2x + RMSE2y + RMSE2z .
The statistical analysis aimed at answering the following
questions concerning the attitude estimates: 1) the effect of the
factor method, so as to state the significance of differences existing in the level of accuracy between each sensor fusion method
(Methods A through C) and Method D; 2) the effect of the factor task, so as to state the significance of differences existing
in the level of accuracy between manual routine and locomotion tasks. To answer 1) a repeated measures one-way ANOVA
was conducted with within-subject effect method (four levels,
corresponding to Method A through Method D), separately for
each motion task; the RMSEatt was the dependent variable. To
answer 2) an independent samples t-test was applied, for each
method, to the RMSEatt values obtained in the manual routine
and locomotion tasks.
The statistical analysis aimed at assessing the effects of the
factors method and task. As for the factor method, a paired samples t-test was conducted separately for each motion task to state
the significance of differences existing in the level of accuracy
between methods; the RMSEt was the dependent variable. As
for the factor task, an independent samples t-test was applied,
for each method, to the RMSEt values obtained in the manual
routine and locomotion tasks.
The statistical analysis was performed using IBM SPSS
Statistics software package (IMB SPSS Statistics 22, SPSS IBM,
New York, USA).
F. Filter Tuning

Four tuning parameters were required by Method A and
Method B, namely: the standard deviation of the gyroscope
measurement noise, which enters the process noise covariance
matrix Qk −1 via (8); the standard deviation of the accelerometer
measurement noise, which determines the isotropic measurement noise covariance matrix R; the task-dependent parameters
ca and cb , which enter the calculation of Qk −1 (Method A)
or help to introduce an element of adaptation in the matrix R

2038

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

Fig. 3. Tuning results: (a) RMSEs obtained for the attitude estimation in the manual routine task; (b) RMSEs obtained for the external acceleration in the manual
routine task; (c) RMSEs obtained for the attitude estimation in the locomotion task; (d) RMSEs obtained for the external acceleration in the locomotion task—The
black solid lines refer to the tuning results for method B. The colored dashed lines refer to method A, when the parameter cb was varied.

(Method B). Actually, cb = 1 in the original implementation of
Method B, which reduces the number of tuning parameters to
three.
Sensor-dependent tuning parameters were set using data from
a 1-min static trial for either Method A or Method B; conversely,
task-dependent parameters were obtained using a grid-search
procedure. A grid of parameters was built through the Cartesian
product of the same parameter set proposed in [6]: 0.001, 0.01,
0.05, 0.1, 0.3, 0.5, 0.7, and 1.0. For each subject and task the
IMU sensor data were processed by assigning to ca and cb the
values corresponding to each point in the grid; the RMSE values
were then computed. For the sake of a fair comparison between
Method A and Method B, we chose to adopt the approach to
parameter tuning presented in [6], separately for Method A (two
parameters-search) and Method B (one parameter-search), leaving to the results of the optimization process to tell the best values of ca , cb (Method A) and ca (Method B). Of course, this tuning approach may lead to different values of the task-dependent
parameters in the two cases. The grid point corresponding to the
minimum RMSE, averaged across subjects, was chosen as the
tuning parameter set for each task. This grid-search procedure
was implemented separately for Method A and Method B.
The tuning parameters required for running Method C were
obtained by a trial-and-error procedure [14].
III. EXPERIMENTAL RESULTS
Fig. 3(a) and (b) shows that, for the manual routine task, the
method A gave the most accurate results for ca and cb falling
in the intervals [0.001 0.1] and [0.1 0.3], respectively; ca = 0.3

TABLE I
TUNING PARAMETERS FOR METHOD A AND METHOD B
Task

Method A

Manual routine
Locomotion

ca
0.01
0.01

cb
0.1
1

Method B
ca
0.5
0.3

and cb = 1 (set by default) were chosen for method B. Fig. 3(c)
and (d) shows similar trends for the locomotion task: optimal
results were achieved for ca and cb in the intervals [0.001 0.3]
and [0.3 1], respectively (method A); ca = 0.5 and cb = 1 (set
by default) were chosen for method B.
The task-dependent tuning parameters were chosen as indicated in Table I. The sensor-dependent tuning parameters were
g
σ = 0.5 ◦ /s and a σ = 0.2 · 10−3 m/s2 . Finally, the values of
the tuning parameters needed by Method C are reported in Table II; they were found to perform adequately for the experimental trials in this paper.
Figs. 4–5 report, for each tested method, the barplots of the
RMSEpitch , RMSEroll , RMSEatt , RMSEx , RMSEy , RMSEz ,
RMSEt corresponding, respectively, to the manual routine task
and the locomotion task. Finally, Fig. 6 reports the values of the
RMSEatt for each subject in both motion tasks.
The values of the RMSEatt were log-transformed in order to achieve normality (Shapiro-Wilk test, p > 0.05) before
being submitted to the repeated measures one-way ANOVA.
For the locomotion task, the Mauchly’s test indicated that the
assumption of sphericity had not been violated, χ2 (5) = 10.75,

LIGORIO AND SABATINI: NOVEL KF FOR HUMAN MOTION TRACKING WITH AN INERTIAL-BASED DYNAMIC INCLINOMETER

2039

TABLE II
TUNING PARAMETERS FOR METHOD C

Gyro standard deviation [°/s]
Gyro bias process noise standard
deviation [°/s2 ]
Magnetic variations process noise
standard deviation [μT/s]
Magnetic variations process noise
correlation time [s]
Accelerometer standard deviation
[g · 10 −3 ]
Magnetic sensor standard
deviation [μT]
Acceleration threshold for vector
selection [g · 10 −3 ]
Magnetic threshold for vector
selection [μT]

Manual routine

Locomotion

2.5
0.01

0.5
0

10

1

1

1

2.5

10

3

3

10

40

5

5

Fig. 5. (a) RMSE p itch , RMSE ro ll , RMSE a tt boxplots for the four tested
methods. (b) RMSEt boxplots for Method A and Method B—locomotion task.

Fig. 4. (a) RMSE p itch , RMSE ro ll , RMSE a tt boxplots for the four tested
methods. (b) RMSEt boxplots for Method A and Method B—manual routine
task.

p > 0.05; therefore degrees of freedom were not reduced, yielding a significant effect of method, F (3, 27) = 18.74, p < 0.001.
The partial eta squared was 0.86, namely the factor method accounted by itself for 86% of the overall variance in the dependent variable RMSEatt . Given that the effect was significant, the
Dunn–Sidak’s posthoc pair-wise comparisons were performed;
statistical significance was achieved when Method A was compared with other tested methods, which did not differ from one
another. Converting the log-transformed data back to the original
scale, the significant difference SD and the 95% confidence
interval CI were as follows: between Method B and Method
A, SD = 0.39◦ (CI[0.14◦ , 0.68◦ ], p < 0.01); between Method
C and Method A, SD = 0.54◦ (95%CI[0.18◦ , 0.97◦ ], p <
0.01), and between Method D and Method A, SD =
0.64◦ (95%CI[0.31, 1.02◦ ], p < 0.01◦ ). The marginal mean for
Method A was RMSEatt = 1.79◦ .
For the manual routine task, the Mauchly’s test indicated that
the assumption of sphericity had been violated, χ2 (5) = 44.36,

Fig. 6. Values of the RMSE a tt that each method incurs when processing IMU
data from each subject, for either (a) locomotion task or (b) manual routine task.
It is noted that the errors incurred by each method are strongly correlated across
subjects, which justifies the choice of the repeated measures ANOVA as the
statistical tool to assess the factor method.

p < 0.001; therefore degrees of freedom were reduced using the
Greenhouse–Geisser correction (ε = 0.36), yielding a significant effect of method, F (1.09, 9.84) = 32.51, p < 0.001. The
partial eta squared was 0.98, namely the factor method accounted by itself for 98% of the overall variance in the dependent variable RMSEatt . Given that the effect was significant, the Dunn–Sidak’s posthoc pair-wise comparisons were
performed using the relevant correction; statistical significance
was achieved when Method D was compared with other tested
methods, which did not differ from one another. The marginal
mean for Method A was RMSEatt = 3.65◦ .

2040

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

Fig. 7. Representative trial of the manual routine task. (a) Reference attitude; (b) Norm of the reference acceleration; (c) RMSE a tt for the four tested
methods; d) RMSE t for Method A and Method B.

Fig. 8. Representative trial of the locomotion task. (a) Reference attitude; (b)
Norm of the reference acceleration; (c) RMSE a tt for the four tested methods;
(d) RMSE t for Method A and Method B.

For each tested method, independent samples t-tests were
conducted on the RMSEatt obtained in the locomotion and
manual routine tasks. Statistical significance of the independent samples t-test was achieved for all methods (p < 0.01),
after verifying that the assumption of equal variance was not
violated in all cases (Levene’s test—Method A: F = 0.16, p =
0.70; Method B: F = 1.00, p = 0.33; Method C: F = 3.88,
p = 0.06; Method D: F = 0.91, p = 0.35).
The RMSEt values were submitted to a paired samples t-test. For the locomotion task, the significant difference SD between Method B and Method A and the related
95% confidence interval CI were as follows: SD = 0.02m/s2
(CI[0.01m/s2 0.03m/s2 ], p < 0.05); the marginal mean for
Method A was 1.31 m/s2 . For the manual routine task, the
significant difference SD between Method B and Method
A and the related 95% confidence interval CI were as follows: SD = 0.04m/s2 (CI[0.02m/s2 0.07m/s2 ], p < 0.01); the
marginal mean for Method A was 1.72 m/s2 .
For both tested methods, independent samples t-tests were
conducted on the RMSEt obtained in the locomotion and manual
routine tasks. Statistical significance of the independent samples
t-test was achieved (p < 0.05), after verifying that the assumption of equal variance was not violated in both cases (Levene’s
test—Method A: F = 0.37, p = 0.55; Method B: F = 0.47,
p = 0.50).
Fig. 7 shows time plots of (a) the reference attitude angle,
(b) the norm of the reference acceleration, (c) the RMSEatt
and (d) the RMSEt for one representative trial of the manual
routine task. Some resting periods are seen to occur during the
trial [see Fig. 7(b)]. The acceptance rate of the acceleration
measurements by the threshold-based switching approach implemented in Method C was about 22%, on average. The mean
value of the reference acceleration norm averaged across trials
was 2.05 ± 0.60 m/s2 (mean value ± standard deviation); the
maximum value was 14.44 ± 6.53 m/s2 . The attitude estimation
errors tended to grow over time, with a somewhat steep increase observed at the onset of the brushing teeth activity (time

T ∼ 30 s) [see Fig. 7(c)]. The external acceleration estimation
errors increased over time too. It is noted in the RMSEatt time
plot that the error growth rate of Method D was faster than for
other tested methods. The RMSEt time plots of Method A and
Method B look very similar to each other [see Fig. 7(d)]. Fig. 8
shows the time plots of (a) the reference attitude angle, (b) the
norm of the reference acceleration, (c) the RMSEatt and (d) the
RMSEt time plots, for one representative trial of the locomotion task. Although the reference acceleration norm tended to be
smaller than in the case of the manual routine trial of Fig. 7(b),
it is apparent from Fig. 8(b) that no resting periods occurred,
because of the swinging motion of the instrumented upper limb.
The acceptance rate of the acceleration measurements by the
threshold-based switching approach implemented in Method C
was less than 1%, on average. The mean value of the reference
acceleration norm averaged across trials was 3.32 ± 1.10 m/s2 ;
the maximum value was 9.29 ± 2.26 m/s2 . As above, the attitude
errors incurred by Method D grew faster than those incurred,
e.g., by Method A [see Fig. 8(c)]. The RMSEt time plots of
Method A and Method B look very similar to one another [see
Fig. 8(d)].
Finally, limited to Method A, the time plots of the estimation
errors, either for the attitude or the external acceleration, are
reported for another representative trial of the manual routine
task, together with the corresponding norm of the reference
external acceleration (see Fig. 9).
IV. DISCUSSIONS
The filter tuning of Method A is very simple. As reported
in Fig. 3, filter performance seems not to change significantly
over a broad interval of values of ca (true, within the limits of
the present investigation), which simplified our choice (for both
motion tasks, ca = 0.01). The difference in the values of cb ,
and the fact that the process noise levels were higher for the
locomotion task than for the manual routine task [see (10)], can
be given the following interpretation: When the process noise

LIGORIO AND SABATINI: NOVEL KF FOR HUMAN MOTION TRACKING WITH AN INERTIAL-BASED DYNAMIC INCLINOMETER

Fig. 9. (a) Norm of the reference external acceleration during one trial of the
manual routines task; (b) Attitude estimation errors; (c) Norm of the external
acceleration estimation errors.

levels are higher, the model uncertainty is higher, which implies
that we put more weight on the sensor measurements when
updating the state estimate. In other words, the acceleration
signal separation performed within the filter was empirically
assessed more reliable for cyclical patterns of motion, such as
those found during locomotion.
The proposed method (Method A) performs at the same level
of accuracy or better than Method B. The performance improvement of Method A over Method B is about 20% for the locomotion task, while the two methods perform at the same level of
accuracy for the manual routine task. While IMU data fusion
was always advantageous for the manual routine task, only our
proposed method improved over the simple time-integration
of the gyroscope output (Method D) for the locomotion task
(see Figs. 4–5). As shown in Fig. 6, the intersubject variability and the correlation between the RMSE values can be quite
large; however, Method A performed consistently better than
all other methods (especially Method B and C) (locomotion
task), while Method D was outperformed by all other methods,
which performed equally well (manual routine task). We believe
that decoupling the prediction of the external acceleration from
the acceleration measurement is the crucial element to explain
the improved accuracy of attitude estimation by Method A for
the locomotion task; on the other hand, modeling uncertainty
in the stochastic description of the external acceleration was
presumably the performance limiting factor of the acceleration
model-based approach during the manual routine task. Moreover, in the spirit of state augmentation, the extra-state components of the external acceleration help accommodating the effects of calibration errors and sensor jolting. It should be noted
that the reference data from the stereophotogrammetric system
are substantially blind to these effects; this fact may partly explain the relatively high RMSE values for the components of
the external acceleration.

2041

Because of the very low acceptance rate of acceleration measurements with the threshold-based rule implemented in Method
C (especially for the locomotion task, where static pauses were
not present—see Figs. 7–8), we were forced to run Method C
with the magnetic sensor measurements assimilated in the EKFbased algorithm. Otherwise, Method C was nearly equivalent to
Method D. It is observed by visual inspection of Figs. 7–8 that
both motion tasks were characterized by levels of external acceleration comparable to gravity: The manual routine task were
characterized by smaller mean values of the external acceleration norm compared with the locomotion task, although with
higher values of the maximum values (on average). Another
difference was that resting periods where the algorithms can
recover accuracy were absent over a quite prolonged period of
time for the locomotion task.
It is worth noting that Method C, in its original formulation,
did not implement gyro-bias compensation [14]. However, it
is known that gyro-bias compensation can help increasing the
accuracy of attitude (orientation) estimation according to the
principle of pseudonoise injection, even when gyro-bias is not
given time to change significantly, namely when the duration
of the tracked motion does not exceed, say, few minutes. The
feature of gyro-bias compensation was enabled for processing
the manual routine task data (see Table II). Although it should
be feasible and technically straightforward, we decided not to
implement the gyro-bias compensation for Method A, given that
Method B was originally developed without it [6].
The factor method was significant when Method A and
Method B (RMSEt ) were submitted to statistical analysis. However, the significant differences were only about 0.02 m/s2 (locomotion task) and 0.04 m/s2 (manual routine task). The marginal
means of RMSEt for Method A were 1.31 ± 0.28 m/s2 (locomotion task) and 1.72 ± 0.46 m/s2 (manual routine task). The
only relevance of the significance of the factor method may
be that the KF prediction-update mechanism is more effective
when the external acceleration is incorporated in the system’s
state, with beneficial effects possibly on the attitude estimation
accuracy.
The expedient to describe the external acceleration using the
GM model was helpful to squeeze information from the acceleration measurements, in situations where a threshold-based
approach performed very poorly. It is questionable that the GM
model is well suited to describe the external acceleration; it is
also questionable whether a stochastic modeling approach is
appropriate, tout court. In some previous work, a deterministic
approach has been successfully pursued as for the discrimination between the external acceleration and the gravity acceleration [26]: However, the deterministic approach applied only
to cyclical patterns of motion. An advantage of the stochastic
approach lies in its flexibility and capability of handling a variety of patterns of motion, including those that are noncyclical.
At the present stage of our research, the GM model is considered a reasonable and parsimonious choice for modeling the
external acceleration, which matches the approach of [6] and
delivers a solution that can accommodate both cyclical and noncyclical patterns of motion. Prospectively, it will be interesting

2042

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

to consider other stochastic models, such as the higher-order
autoregressive model adopted, e.g., in [5].
The factor task was significant when we submitted all methods (RMSEatt ) and Methods A–B (RMSEt ) to statistical
analysis. The results of this analysis show that all methods
tended to be more accurate during the locomotion task than
during the manual routine task. Under this regard, the manual routine task would be considered more challenging than
the locomotion task. However, it comes as a surprise that
Method D performed differently in the two motion tasks: The
marginal means were RMSEatt = 2.50◦ ± 0.91◦ (locomotion
task) and RMSEatt = 9.29◦ ± 4.51◦ (manual routine task), in
spite that random walk integration of gyroscope measurement
noise would have had a slightly greater effect on the longer
locomotion task (lasting about 90 s) rather than on the manual
routine task, which lasted about 60–70 s. As shown in Figs. 7–8,
the dynamic range of attitude was much larger for the manual
routine task than for the locomotion task, which may explain
the different level of performance in the presence of residual
calibration errors of the gyro.
Finally, the plots in Fig. 9 reveal the extent to which the
accuracy of Method A was restored when the external acceleration was small, namely when conditions of slow motions were
met during the motion task. Our results confirm those reported
by [6]. The Test B in [6] was characterized by a reference
acceleration norm with mean value 3.06 m/s2 and maximum
value 16.71 m/s2 , which are comparable to those measured for
the manual routine task, although the duration of Test B was
limited to about 10 s. The plots in Fig. 9 also show that the
acceleration estimation error is not negligible with respect to
the norm of the reference external acceleration. In addition to
the aforementioned problem of adopting a stochastic approach
to modeling the external acceleration, we have also to consider
that the accelerometer output is influenced by jolting shocks and
vibrations from impacts of the body with the ground and tremulous motions of the body, which can add to the error budget of
the external acceleration estimates since the stereophotogrammetric reference data are much less affected by them.
V. CONCLUSION
In this paper, a KF-based method was proposed to discriminate between the external acceleration and the gravity acceleration. The main feature of the proposed method lies in the
incorporation of the external acceleration into the system’s state
(via a first-order GM stochastic model), together with the gravity acceleration, both resolved in the body frame. This choice of
system’s state variables leads to design a linear Kalman-based
estimator. An important limitation of the proposed approach lies
in the difficulty to use a stochastic model for describing the acceleration of human motions. Consequently, the prediction of
the components of the state vector describing the external acceleration may be inaccurate, although useful from the viewpoint
of estimating the attitude.
When tested in conditions of dynamic motions, i.e., manual
routine and locomotion tasks, with subjects wearing the IMU

at the wrist, the proposed method achieved good attitude estimation accuracy: on average, RMSEatt = 3.6◦ (about 60-s
long sequence of various manual activities of daily living) and
RMSEatt = 1.8◦ (90-s long walking at natural speed).
Further developments of the present study are in the following directions: 1) to assess the effects of using higher-order
autoregressive models for the external acceleration; 2) to perform gyro-bias compensation for tracking longer motion tasks;
3) to extend the proposed approach to magneto/inertial measurement units in order to encompass other reference and measured
vectors, i.e., the earth’s magnetic field.

ACKNOWLEDGMENT
The authors would like to thank A. Cappozzo and his colleagues at the Department of Movement, Human and Health
Sciences, University of Rome “Foro Italico,” where the experiments providing the data for this paper were planned and performed. They would also like to thank them for the intensely
stimulating discussions during the progress of the study.

REFERENCES
[1] H. Zhou and H. Hu, “Human motion tracking for rehabilitation—A survey,” Biomed. Signal Process. Control, vol. 3, pp. 1–18, 2008.
[2] W. Tao et al., “Gait analysis using wearable sensors,” Sensors, vol. 12,
pp. 2255–2283, 2012.
[3] A. M. Sabatini, “Quaternion-based extended Kalman filter for determining
orientation by inertial and magnetic sensing,” IEEE Trans. Biomed. Eng.,
vol. 53, no. 7, pp. 1346–1356, Jul. 2006.
[4] X. Yun and E. R. Bachmann, “Design, implementation, and experimental results of a quaternion-based kalman filter for human body motion
tracking,” IEEE Trans. Robot., vol. 22, no. 6, pp. 1216–1227, Dec. 2006.
[5] H. J. Luinge and P. H. Veltink, “Inclination measurement of human movement using a 3-D accelerometer with autocalibration,” IEEE Trans. Neural
Syst. Rehabil. Eng., vol. 12, no. 1, pp. 112–121, Mar. 2004.
[6] J. K. Lee et al., “Estimation of attitude and external acceleration using
inertial sensor measurement during various dynamic conditions,” IEEE
Trans. Instrum. Meas., vol. 61, no. 8, pp. 2262–2273, Aug. 2012.
[7] G. Wu and X. Shuwan, “Portable preimpact fall detector with inertial sensors,” IEEE Trans. Neural Syst. Rehabil. Eng., vol. 16, no. 2,
pp. 178–183, Apr. 2008.
[8] A. M. Sabatini, “Inertial sensing in biomechanics: A survey of computational techniques bridging motion analysis and personal navigation,” in
Computational Intelligence for Movement Sciences: Neural Networks and
Other Emerging Techniques. Hershey, PA, USA: Idea Group, 2006.
[9] X. Yun et al., “A simplified quaternion-based algorithm for orientation
estimation from earth gravity and magnetic field measurements,” IEEE
Trans. Instrum. Meas., vol. 57, no. 3, pp. 638–650, Mar. 2008.
[10] J. K. Lee and E. J. Park, “A fast quaternion-based orientation optimizer via
virtual rotation for human motion tracking,” IEEE Trans. Biomed. Eng.,
vol. 56, no. 5, pp. 1574–1582, May 2009.
[11] Y. S. Suh, “Orientation estimation using a quaternion-based indirect
Kalman filter with adaptive estimation of external acceleration,” IEEE
Trans. Instrum. Meas., vol. 59, no. 12, pp. 3296–3305, Dec. 2010.
[12] S. O. Madgwick et al., “Estimation of IMU and MARG orientation using
a gradient descent algorithm,” in Proc. IEEE Rehabil. Robots Int. Conf.,
2011, pp. 1–7.
[13] R. Mahony et al., “Nonlinear complementary filters on the special orthogonal group,” IEEE Trans. Autom. Control, vol. 53, no. 5, pp. 1203–1218,
Jun. 2008.
[14] A. M. Sabatini, “Estimating three-dimensional orientation of human body
parts by inertial/magnetic sensing,” Sensors, vol. 11, pp. 1489–1525, 2011.
[15] P. H. Veltink et al., “Detection of static and dynamic activities using uniaxial accelerometers,” IEEE Trans. Rehabil. Eng., vol. 4, no. 4,
pp. 375–385, Dec. 1996.

LIGORIO AND SABATINI: NOVEL KF FOR HUMAN MOTION TRACKING WITH AN INERTIAL-BASED DYNAMIC INCLINOMETER

[16] J. K. Lee and E. J. Park, “Minimum-order kalman filter with vector selector
for accurate estimation of human body orientation,” IEEE Trans. Robot.,
vol. 25, no. 5, pp. 1196–1201, Oct. 2009.
[17] T. Harada et al., “Development of a tiny orientation estimation device
to operate under motion and magnetic disturbance,” Int. J. Robots. Res.,
vol. 26, pp. 547–559, 2007.
[18] R. Zhu and Z. Zhaoying, “A real-time articulated human motion tracking
using tri-axis inertial/magnetic sensors package,” IEEE Trans. Neural Syst.
Rehabil. Eng., vol. 12, no. 2, pp. 295–302, Jun. 2004.
[19] D. Choukroun et al., “Novel quaternion Kalman filter,” IEEE Trans.
Aerosp. Electron. Syst., vol. 42, no. 1, pp. 174–190, Jan. 2006.
[20] Y. Bar-Shalom et al., Estimation With Applications to Tracking and Navigation: Theory Algorithms and Software. New York, NY, USA: Wiley,
2004.
[21] M. D. Shuster, “A survey of attitude representations,” Navigation, vol. 8,
pp. 439–517, 1993.

2043

[22] E. Bergamini et al., “Estimating orientation using magnetic and inertial
sensors and different sensor fusion approaches: Accuracy assessment in
manual and locomotion tasks,” Sensors, vol. 14, pp. 18625–18649, 2014.
[23] J. Chardonnens et al., “An effortless procedure to align the local frame of
an inertial measurement unit to the local frame of another motion capture
system,” J. Biomechanics, vol. 45, pp. 2297–2300, 2012.
[24] G. S. Faber et al., “A novel method for assessing the 3-D orientation accuracy of inertial/magnetic sensors,” J .Biomechanics, vol. 46,
pp. 2745–2751, 2013.
[25] L. Chiari et al., “Human movement analysis using stereophotogrammetry:
Part 2: Instrumental errors,” Gait Posture, vol. 21, pp. 197–211, 2005.
[26] R. Takeda et al., “Gait analysis using gravitational acceleration measured
by wearable sensors,” J. Biomechanics, vol. 42, pp. 223–233, 2009.
Authors’ photographs and biographies not available at the time of publication.

