IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 10, OCTOBER 2015

2369

In Silico Closed-Loop Control Validation Studies for
Optimal Insulin Delivery in Type 1 Diabetes
Stamatina Zavitsanou, Athanasios Mantalaris, Michael C. Georgiadis, and Efstratios N. Pistikopoulos∗

Abstract—This study presents a general closed-loop control
strategy for optimal insulin delivery in type 1 Diabetes Mellitus
(T1DM). The proposed control strategy aims toward an individualized optimal insulin delivery that consists of a patient-specific
model predictive controller, a state estimator, a personalized
scheduling level, and an open-loop optimization problem subjected to patient-specific process model and constraints. This
control strategy can be also modified to address the case of
limited patient data availability resulting in an “approximation”
control strategy. Both strategies are validated in silico in the
presence of predefined and unknown meal disturbances using
both a novel mathematical model of glucose–insulin interactions
and the UVa/Padova Simulator model as a virtual patient. The
robustness of the control performance is evaluated under several
conditions such as skipped meals, variability in the meal time, and
metabolic uncertainty. The simulation results of the closed-loop
validation studies indicate that the proposed control strategies can
potentially achieve improved glycaemic control.
Index Terms—Model predictive control (MPC), optimal insulin
delivery, optimization problem, scheduling, state estimation, type
1 Diabetes Mellitus (T1DM).

I. INTRODUCTION
ATIENTS with type 1 diabetes rely on exogenous insulin
administration to maintain their blood glucose concentration within a normal range (80–140 mg/dl). Insulin is administered either with daily subcutaneous insulin injections or with
an insulin pump. However, exogenous insulin treatment subjects to several limitations, such as the requirement for patient’s
appropriate education and adherence to a specific lifestyle while
the risk of poor glycaemic control is very high. Inevitably patient quality of life is significantly affected by the treatment.
Motivated by the challenge to improve the living conditions of
a diabetic patient, the idea of an artificial pancreas (AP) that
mimics the endocrine function of a healthy pancreas is well established [1]. An AP involves a control algorithm that calculates
the optimal insulin infusion rate to be delivered with an insulin
pump according to real-time blood glucose measurements re-

P

Manuscript received November 29, 2014; revised March 25, 2015 and February 17, 2015; accepted April 25, 2015. Date of publication April 29, 2015; date
of current version September 16, 2015. This work was supported in parts by the
European Research Council (MOBILE, ERC Advanced Grant 226462) and the
CPSE Industrial Consortium.” Asterisk indicates corresponding author.
S. Zavitsanou and A. Mantalaris are with the Centre for Process Systems
Engineering, Department of Chemical Engineering, Imperial College London.
M. C. Georgiadis is with the Department of Chemical Engineering, Aristotle
University of Thessaloniki.
∗ E. N. Pistikopoulos is with the Artie McFerrin Department of Chemical
Engineering, Texas A&M University, College Station, TX 77843, USA (e-mail:
stratos@tamu.edu).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2015.2427991

ported by continuous glucose monitoring systems (CGMs). The
Model-based control design is a suitable control method for
the underlying system [2], since it can handle constraints, timedelayed systems, and disturbances. Therefore, there has been a
wide use of model predictive control (MPC) in the context of
glucose regulation and many MPC strategies have been clinically evaluated [3]–[7]. Recent promising results indicate that
MPC can be a potential strategy toward the AP, and therefore, the
research on this field has been intensified. Although the applied
MPC theory for glucose regulation has reduced the occurrence
of hypoglycaemic episodes in most clinical studies [8], several
challenges remain when the patient is examined in free living
conditions [1], subjected to unannounced disturbances such as
a meal. This involves the risk of direct prandial hyperglycaemia
that leads to aggressive control action and possible postprandial
hypoglycaemia due to insulin after effect. Another important
issue is the high intra and interpatient variability that dominates
all biomedical systems. To address this problem, patient specific approximations of the original system [9], [10], and control specifications are considered. Although this approach has
minimized the effect of intrapatient variability on the prediction
ability of the internal model, interpatient variability remains an
important source of uncertainty that requires advanced control
techniques [11]–[13] or complementary components [6] to incorporate the effect of uncertainty and control its impact on the
system.
In this paper, a generalized control framework is proposed
that involves four parts, an MPC controller, a state estimator, an
optimizer/or a second MPC controller, and a scheduling level. A
detailed analysis of three potential control designs is provided.
In an effort to develop delivery systems tailored to each patient as highlighted in [14], two general strategies based on the
proposed framework are investigated: 1) a systematic strategy
that aims toward an individualized closed-loop insulin delivery
and 2) an “approximation” strategy that aims toward a generalized applicability of the closed-loop system. The novelty of this
paper is the consideration of the predefined disturbance rejection problem as a personalized nonlinear optimization problem
in contrast to the conventional insulin treatment. Compared to
similar control approaches reported in the literature [14], [15]
for the case of unknown meal disturbances that combine conventional insulin therapy with a closed-loop part, this paper addresses the delayed insulin effect by incorporating in the general
closed loop the solution of the nonlinear open-loop optimization problem for a predefined reference meal plan. In the case of
limited patient data, the feedforward action of the controller is
enhanced with the inclusion of an additional MPC, aiming at the
same time to overcome the effect of inaccurate modeling with
feedback. The proposed control designs are validated in silico

0018-9294 © 2015 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

2370

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 10, OCTOBER 2015

TABLE I
DEFINITIONS OF SYMBOLS FOR MPC PROBLEM

Fig. 1. General proposed control strategy that consists of three blocks, MPC
controller, state estimator, and optimization/MPCre f that are activated depending on the nature of the meal disturbances. In the case of predefined disturbances
(dp), the problem of optimal insulin delivery is an output optimization problem
or a state feedback MPC re f . For unknown disturbances (du), the entire strategy
is activated involving an output feedback MPC.

against two models. The first is a proposed model of glucose–
insulin interactions that is validated using ten adult data from
the UVa/Padova Simulator [16] and summarized in Appendix
A. The second is UVa/Padova Simulator model [17] for ten adult
patients. Both models are implemented in gPROMS [18].
II. CONTROL OBJECTIVES
The objective of the developed control designs, which are
presented in the following sections, is to tightly maintain the
blood glucose concentration within 80–140 mg/dl. But due to
the inherent complications of the system, we aim toward the
1) development of personalized insulin delivery systems;
2) consideration of the involved time delays;
3) compensation for the unknown meal disturbances and
metabolic uncertainty.
III. CLOSED-LOOP CONTROL STRATEGY
The general proposed control framework for the closed-loop
insulin delivery system is presented in Fig. 1. Two strategies
are studied. The first or systematic strategy assumes that informative patient data are available; the original model parameters
can be estimated individually and patient specific approximate
models are derived. Therefore, the systematic strategy uses the a
priori knowledge of the patient dynamics to enhance the closedloop performance by incorporating the solution of an open-loop
optimization problem. The second strategy, the “approximation” strategy, considers adjustable mean internal models. An
additional MPC controller is included to improve the effect of
delayed insulin action.
The parameters of the control formulation that are individually specified for both cases are the body weight, the total
insulin daily dose, the upper insulin constraint, the weights of
the objective function and the prediction horizon.
A. Approximate Linear Model
The model used for closed-loop validation studies is summarized in Appendix A. The original model is linearized at

Symbol

Definition

N
M
QR
R
y
yR
x
d
dc o n s t
A,B,C,E
Bd

Prediction Horizon
Control Horizon
Weight Matrix for the output (blood glucose concentration)
Weight Matrix for the input (insulin infusion rate)
System output (blood glucose concentration)
Reference point
System states
Meal disturbance
Constant term ( = 1)
State space model matrices
Matrix considering constant terms of the states that cannot be
omitted in the linearization (specifies basal conditions)
Control input (insulin infusion rate)

u

basal state in a state-space formulation, assuming that kem pt =
(km ax −km in )/2 (Ra in (A.4)) and p = pb (A.6.2). The 16 states
model is then reduced to 10 states using the redmod function
in MATLAB. Further reduction decreases the model’s prediction ability. The discretized, with sampling time 5 min, reduced
linear model is used as the internal model in MPC. In the case
of systematic strategy, the exact model parameters are used for
each patient. In the case of “approximation” strategy, the approximate model with mean values of the parameters is used
but adjusted accordingly for the specific patient. The adjustable
parameter is kp1 , parameter of EGP (A.3) and an element of Bd
matrix (1), which determines the constant terms of the linearized
states.
B. MPC
At each time step, the optimal insulin infusion is calculated
by solving online the finite horizon open-loop optimal control
problem (1). The optimal sequence of the future control laws
is determined for the entire control horizon but only the first
value is applied on the system and the optimization problem is
then reformulated and solved at the next time instant, when new
information of the system is available.
min J =

x,y ,u

s.t.

N
−1
k =1

−1



 M
yk − ykR QRk yk − ykR +
uk Rk uk
k =1

xk +1 = Axk + Buk + Bd dconst + Edk
yk = Cxk
ym in ≤ yk ≤ ym ax
um in ≤ uk ≤ um ax .

(1)
The various symbol definitions are summarized in Table I.
C. Prediction Horizon
The system involves high input and disturbance delays, due
to delayed insulin absorption from the subcutaneous tissue and
glucose absorption through the gastrointestinal tract after meal
consumption. Therefore, in order to predict the after effect of a
given input the prediction horizon should be at least equal to the

ZAVITSANOU et al.: In Silico CLOSED-LOOP CONTROL VALIDATION STUDIES FOR OPTIMAL INSULIN DELIVERY IN TYPE 1 DIABETES

TABLE II
PREDICTION HORIZON FOR THE TEN PATIENTS
Patient

OH
Δ

Patient 1

13 = 65 min

Patient 2

11 = 55 min

Patient 3

7 = 35 min

Patient 4
Patient 5

Δ

Δ

Δ

10 = 50 min
Δ

13 = 65 min

Patient

OH

Patient 6

10 = 50 min

Patient 7

8 = 40 min

Patient 8

11 = 55 min

Patient 9

14 = 70 min

Patient 10

13 = 65 min

Δ

Δ

Δ
Δ
Δ

TABLE III
GLUCOSE REGULATION DESIGNS
Control Designs
CD 1
CD 2
CD 3

Description

Disturbance type

Dynamic Optimization-Open loop Control
Optimization and Correction MPC
Online MPC with scheduling level

Predefined (d p )
Unknown (d u )
Unknown (d u )

2371

where tf is the 24-h time horizon, G is the blood glucose concentration described by the nonlinear process model (Appendix
A) for every patient, and Gm ax (140 mg/dl) and Gm in (80 mg/dl)
are the maximum and minimum glucose concentration bounds.
The optimal amount of insulin, u2 , appropriate to compensate
for the forthcoming glucose increase due to the meal intake can
change every 5 min, therefore, the time intervals are N = 288.
The TDD is the total daily insulin dose for every patient. The
optimization studies were formed and solved in gPROMS [18].
The advantages and disadvantages of CD1 are summarized
as follows:
1) personalized insulin delivery;
2) feedforward insulin action for delayed insulin effect;
3) no compensation for unknown disturbances;
4) metabolic uncertainty is not considered.

B. Optimization and Correction MPC (CD2 ): Unknown
Disturbances (du )
time lag. However, every patient has different glucose-insulin
dynamics and the time delay factor should be considered patient
specific. Although the time lag is dependent on the insulin dose
[19] for the insulin infusion rates considered in the closed-loop
system, an assumption of constant patient specific time delays
is reasonable. Table II shows the prediction horizon of the ten
patients that is calculated as the average time to observe a 1 mg/dl
change in blood glucose concentration when simulation studies
of a step change of 0.5 U/h insulin dose from 0 to 5 U/h are
performed.
IV. SYSTEMATIC STRATEGY (I): CONTROL DESIGNS
The following control designs, as presented in Table III are
evaluated for different types of meal disturbances, di .
A. Dynamic Optimization (CD1 ): Predefined
Disturbance (dp )
When a patient follows an exact meal plan, meaning that the
exact amount and the time of the meal is known in advance, then
this information is introduced in the general regulation strategy
as a predefined meal plan and the optimization block in Fig. 1 is
activated. Hence, when considering that the only uncertainty in
the system is caused by the meal disturbances, then in the case
of predefined meal plan the feedback control and the open-loop
control are equivalent [20]. The following optimization problem
is thus solved:
 tf
(w1 + w2 ) dt
(2)
min
ui

0
,

s.t. G = f (x (t) x (t) , y (t) , u (t))
N


u2 i = TDD

(3)
(4)

i=1

w1 ≥ 0,

w1 ≥ G − Gm ax and w2 ≥ 0,

w2 ≥ Gm in − G
(5)

In the case of unmeasured meal disturbances, there is no information concerning the amount or the time of the meal. In
this case, a nominal controller reacts aggressively to regulate
the glucose deviation from the reference point, which means
increased insulin infusion as long as glucose violates the constraints. But this control action involves the risk of postprandial
hypoglycaemia due to insulin after effect and also immediate
prandial hyperglycaemia. Therefore, a different control design is
proposed for unmeasured disturbances as illustrated in Fig. 1. It
consists of the patient model, an optimizer, acting as a reference
regulator, an MPC controller, acting as the correction control,
and a state estimator. The proposed control design regulates the
glucose concentration when a reference meal plan is considered
and additionally responds appropriately to compensate for the
deviation from the reference meal when a different meal size is
consumed.
1) Optimizer: Reference Regulator: The desired glucose
value Gref is set for every patient. A predefined reference meal
plan is considered to trigger the control action. Feedback about
the current state is obtained by the approximate model output
yopt , which is calculated by solving an optimization problem
using the original nonlinear model and for the predefined meal
plan (described in Section A). The optimal insulin infusion is
then applied to the approximate model.
2) MPC: Correction Control: MPC aims to calculate the optimal insulin infusion rate to regulate the difference of glucose
as a real measurement coming from the patient, G, and glucose
as calculated when solving the reference optimization problem,
yopt . This difference can be regarded as an unknown disturbance of the system, that leads to an offset in the set point,
Gref ,2 = 0. So the correction control is described as a disturbance rejection problem. In order to remove the offset and the
nonzero disturbances, the original system is augmented with a
disturbance model, described with an additional state as presented in (6). The output feedback of the patient is obtained as
the difference of the actual measurement and the reference control output (G − yopt ), from which the states and the integrating

2372

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 10, OCTOBER 2015

TABLE IV
SPECIFICATIONS OF MPC AND THE KALMAN FILTER
Variable

Value

Variable

Value

y 2 , m i n (mg/dl)
Y 2 , m a x (mg/dl)
u m i n (U/min)

−10
10
0

u m a x (U/min)
QK F
RK F

0.2 TDD
100
5

3) compensation for unknown disturbances;
4) account for metabolic uncertainty as unmeasured disturbance;
5) a reference meal plan is always considered.
C. Online MPC With Scheduling Level: Unknown
Disturbances (du )

disturbance are estimated using a state estimator.
 

  

A Bd
xk
B
xk +1
=
+
uk + wk
xd,k +1
0 Ad
xd,k
0


xk
+ υk .
yk = [CCd ]
xd,k

(6)

In which xd,k is the integrating disturbance. The matrix Bd ∈
Rn ×n d is the Bd matrix of (1), matrix Ad = I ∈ Rn d ×n d , matrix
Cd = I ∈ Rn d ×n d , and xd,k = dk is the disturbance state. It is
assumed that the difference between the predicted output (yopt )
and the real measurement (G) is caused by an input disturbance
that enters the states and output equations [21]. A different
disturbance model is tested in Appendix B. The variances of
variables w and υ are adjusted according to output data [22].
The new derived augmented linear model (n = 10, nd = 1) is
detectable (7), which means that the states will converge to the
real states when a Kalman filter is used, hence, this strategy can
be employed


I − A −Bd
(7)
= n + nd = 11.
rank
C
Cd
The objective function is modified accordingly to include the
nonzero disturbance d as follows:
min J =

x,y ,u

N
−1


V. PERFORMANCE ANALYSIS OF CD1 − CD3

(Cxk + Cd xd,k − Gref ,2 )

A. Control Design 1 (CD1 ): Dynamic Optimization

k =1

QR (Cxk + Cd xd,k − Gref ,2 ) +

M
−1


u1,k Ru1,k

(8)

k =1

s.t. x̂k +1 = Ax̂k + Bu1,k + wk

(9)

y2,k = C x̂k + υk

(10)

y2,m in ≤ y2,k ≤ y2,m ax

(11)

um in ≤ uk ≤ um ax

(12)

where the estimated states are
d ]
(13)
and y2 = G − yopt . The control specifications for MPC are presented in Table IV.
The advantages and disadvantages of CD2 are summarized
as follows:
1) personalized insulin delivery (patient-specific approximate model, Kalman Filter);
2) feedforward insulin action for delayed insulin effect;
x̂ = [ x1

x2

x3

x4

x5

x6

x7

x8

x9

The Control design CD3 applies the same principles of zerooffset design as CD2 , but instead of the optimizer, it includes a
scheduling level to enhance the control performance. The day is
divided in four periods, and at each period (sleeping, breakfast,
lunch, dinner), the upper insulin limit is changed, and therefore,
a different optimization problem is solved in each interval. It is
assumed that the meal plan follows a specific trend in terms of
carbohydrates consumption, and for this case, it is considered
that the maximum carbohydrates amount is consumed in lunch
according to Fig. 1. The amount of the maximum delivered
insulin as determined in the scheduling level is tailored to every
patient according to their diet. This information aims to facilitate
the prediction beyond the considered horizon and to improve
glucose regulation.
The unknown disturbances are estimated using again the augmented system in the state estimator, but now the output and
input used for the estimation is the glucose measurement, G,
and u1 , respectively. The advantages and disadvantages of CD3
are summarized as follows:
1) personalized insulin delivery (patient-specific approximate model, Kalman Filter, scheduling level tailored to
patient’s diet);
2) compensation for unknown disturbances;
3) metabolic uncertainty as unmeasured disturbance;
4) no compensation for delayed insulin effect.

x10

A predefined meal plan of 45, 70, and 70 g of carbohydrates
for breakfast, lunch, and dinner is considered to be given at
420, 720, and 1080 min and the optimization problem is solved
for the entire 24-h horizon. A piecewise constant infusion rate
that holds a constant value for 5-min time intervals is calculated with the optimization criterion being the minimum range
of glucose outside the normal bounds. The TDD is an endpoint constraint and is set individually for every patient. The
optimization problem is solved in gPROMS. The results for all
patients are illustrated in Fig. 2. It can be concluded that very
tight glycaemic control can be achieved for most of the patients
when the meals are known in advance and the patient follows
the exact predefined plan.
In more detail, the percentage of the time spent outside the
euglycaemic range is presented in Table V for all adults. As
confirmed by Fig. 2 for adults no. 4 and no. 10 it is difficult
to maintain their blood glucose levels within the normal range
with the specified TDD. However, if these results are compared
to the time spent in normoglycaemia when the conventional optimal insulin dosing is applied [23], it can be stated that superior

ZAVITSANOU et al.: In Silico CLOSED-LOOP CONTROL VALIDATION STUDIES FOR OPTIMAL INSULIN DELIVERY IN TYPE 1 DIABETES

2373

TABLE VI
MEAN PERCENTAGE OF TIME GLUCOSE SPENT IN SPECIFIED RANGES FOR CD 2
AND CD 3 VALIDATED AGAINST THE PROPOSED MODEL AND THE
UVA/PADOVA SIMULATOR
Percentage of time

% time < 70
% time < 80
% time 80< G < 140
% time 140< G < 180
% time 180< G < 250
% time > 250
Gm in
Gm ax
U t o t (U)

Against Proposed Model

Against Simulator

CD 2
(mean ± SD)

CD 3
(mean ± SD)

CD 2
(mean ± SD)

CD 3
(mean ± SD)

0 ±0
1.6 ± 1.6
58.3 ± 16.9
24.9 ± 13.1
14.0 ± 6.5
1.2 ± 2.4
78 ± 7.4
224 ± 27.7
58.4 ± 12.5

0.18 ± 0.52
3.6 ± 3.3
53.6 ± 7.0
20.6 ± 8.2
16.6 ± 6.0
5.6 ± 5.3
76 ± 7.1
269 ± 13.9
61.2 ± 13.8

0 ±0
2.4 ± 2.8
56.1 ± 13.3
25.6 ± 12.4
14.7 ± 7.8
1.3 ± 2.4
76 ± 7
229 ± 24.5
58.8 ± 12.2

0.9 ± 1.3
4.6 ± 4.5
49.0 ± 7.8
22.2 ± 6.9
16.7 ± 5.4
7.5 ± 5.6
73 ± 5.9
288 ± 42.3
61.6 ± 13.6

Min &max glucose value-total Insulin(U).

of patient individual dynamics and that there is no intrapatient
variability. But, free living conditions deviate significantly from
the simulated conditions. These assumptions are relaxed and
reconsidered in the following sections.
B. Control Design 2 (CD2 ) Versus Control Design 3 (CD3 )
Fig. 2. Glucose profiles for the ten adults (upper graph) when optimal insulin
infusion (lower graph) is delivered.

TABLE V
COMPARISON OF THE TIME SPENT OUTSIDE THE NORMAL GLUCOSE RANGE
WHEN OPTIMIZATION OF INSULIN INFUSION IS PERFORMED AND
CONVENTIONAL OPTIMAL INSULIN DOSING IS ADMINISTERED
TDD (U)
Optimized Insulin Infusion

Ad 1
Ad 2
Ad 3
Ad 4
Ad 5
Ad 6
Ad 7
Ad 8
Ad 9
Ad 10
Mean

50
58
56
34
68
61
42
43
67
64
54.5

Conventional Optimal
Insulin Dosing

%time
< 70

%time
> 140

%time
> 150

%time
< 70

%time
> 150

%time
> 140

0
0
0
0
0
0
0
0
0
0
0

0
0
3.9
32.7
23.7
9.9
0.9
9.9
4.9
50.5
13.64

0
0
0
16.9
0
0
0
0
0
6.9
2.38

0
0
0
0
0
0
0
0
0
0
0

47.8
26.2
57.2
51.3
50.1
47.2
24.15
49.2
73.3
69
49.54

41.08
8.9
14.7
29.8
11.9
37.8
12.6
11.5
36.9
58.5
26.37

glucose control can be achieved by optimizing insulin infusion
for all patents. More specifically, no event of hypoglycaemia
occurs for both the optimized insulin infusion and the conventional optimal insulin dosing. The time glucose is spent above
140 mg/dl, for the conventional insulin dosing is 36% more than
for optimized insulin infusion. Similarly the time spent above
150 mg/dl is 24% more for the conventional insulin dosing.
However, this approach assumes that not only the meal plan
is known in advance, something which is not always easy to
predefine, but also that there is no model mismatch in terms

In this section, CD2 and CD3 control designs as detailed
previously are evaluated. The ability of the controller to maintain
the blood glucose concentration in the normal range is tested
for large meal sizes of 75, 100, and 90 g of carbohydrates
given for breakfast at 420 min, lunch at 720 min, and dinner
at 1080 min, respectively. The reference meal plan is 20, 30,
and 25 g, respectively. The total insulin amount does not exceed
the TDD for each patient plus approximately 6U to compensate
for the large meal sizes. These two control designs are validated
both against the proposed model and the UVa/Padova model in
order to evaluate the efficiency of glucose regulation using two
different modeling and simulation environments. The patient
models are developed in gPROMS, while the control design in
MATLAB; gO:MATLAB [24] is used to exchange data between
the two environments. The sensor error of the CGMs devices
is described with Gaussian white noise with standard deviation
of 10%.
Table VI presents the percentage of time that blood glucose
concentration is within specified ranges during the experiment.
It is shown that for CD2 when tested against the proposed model,
on average 58.3% of the time is spent within the normal glucose
values, while for CD3 , the percentage of time spent in the normal
range is 53.6%. With CD2 , there is no event of hypoglycaemia
and the minimum observed glucose value is 71 mg/dl, in opposition to CD3 that an average 0.18% of the time is spent in hypoglycaemia with a minimum observed glucose value of 63 mg/dl.
Additionally, the time spent in hyperglycaemia (>180 mg/dl)
is much higher for CD3 with 22.2% of the total time, while
for CD2 , the respective percentage is 15.2%. The ten adults respond, as expected, relatively different from each other, but as
it can be observed from Table VI there is no event of hypoglycaemia in all the studied adults and only a mean of 1.2% of the

2374

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 10, OCTOBER 2015

Fig. 3. Comparison of closed-loop control performance with CD 2 and CD 3
validated against the proposed model for adult 1.
Fig. 5. Cumulative distribution of blood glucose concentration. The light
gray area shows the range of closed-loop glucose distribution when the mean
approximate model is used for the ten patients; whereas the dark gray area shows
the range of closed-loop glucose distribution when the exact patient model is
used (Strategy I). The dashed line is the mean cumulative glucose distribution
of the light gray area, while the dash-dot line the mean of the dark gray area.

VI. “APPROXIMATION” STRATEGY (II) CONTROL DESIGN

Fig. 4. Comparison of closed-loop control performance with CD 2 and CD 3
validated against the UVa/Padova model for adult 1.

In this section the “approximation” strategy is evaluated
and compared with the systematic strategy using the proposed
model. The general control design is presented in Fig. 1. In
this design, the gray box instead of an optimization problem
involves a second MPC. Additionally, the yopt becomes yref ,
as calculated when the reference tracking problem with known
meal disturbance is solved and the optimal insulin infusion is
applied. Finally, CD3 is the same as presented previously.
A. Effect of Mean Approximate Model

time is spent above 250 mg/dl. However, for CD3 , the results
indicate that although the time spent in hypoglycaemia is not
significant, the glucose values are distributed toward the upper
extremes for most of the adults. Similar conclusions are drawn
for both designs when the closed-loop control performance is
evaluated against the UVa/Padova model. This suggests that the
proposed control designs are reliable since analogous results are
concluded when tested in different models. It is also illustrated
that the proposed approximate model can efficiently predict the
dynamics of the underlying system, which strengthens the confidence in the original proposed model.
The glucose profile and the control action for CD2 and CD3
are presented in Fig. 3 for the proposed model and in Fig. 4 for
the UVa/Padova model both for adult 1. The graphs are very similar as expected from Table VI, which increases the confidence
for the proposed model (Appendix A) used for validation studies. The large meal sizes result in pronounced prandial hyperglycaemia. The challenge is to prevent a severe hypoglycaemia that
may follow. It can be noticed that better glycaemic control can
be achieved for CD2 with a mean 83% of the time spent near normoglycaemia and with no event of hypoglycaemia, compared
to 74% with CD3 .

In order to illustrate the effect of using the mean approximate
model instead of the patient-specific approximate model, we
consider the control design CD2 but assuming that the internal
control model is now the mean approximate model. This assumption in the context of strategy I is not correct, since if there
is no information of the exact patient dynamics the optimization
problem will not calculate the optimal insulin infusion for each
patient. However, for the sake of analysis purposes, assuming
that u2 is available and can be applied, we investigate the effect
of using mean approximate internal models rather than the exact
ones in the control design.
Fig. 5 shows the cumulative distribution of the glucose data
for both cases when tested against the proposed model. It can be
seen that the data coming from the patient-specific model produce a more sharp profile indicating that the patients are within
tight glycaemic control for most of the time. The other area,
the light gray, representing the profiles from the mean model
is wider which implies that the results are more distributed.
Hence, this graph demonstrates the importance of using accurate internal models. Even if feedback overcomes some issues
of inaccurate modeling, to achieve efficient control the internal
model should be carefully considered.

ZAVITSANOU et al.: In Silico CLOSED-LOOP CONTROL VALIDATION STUDIES FOR OPTIMAL INSULIN DELIVERY IN TYPE 1 DIABETES

Fig. 6. CVGA of CD 2 for patient specific approximate model (black dots),
Strategy I, versus mean approximate model (white dots) and versus CD 2 Strategy II (white circus).

1) Comparison of CD2 : Strategy I and Strategy II: The performance of CD2 for Strategy I and Strategy II is compared in
Fig. 6 for all patients. This figure illustrates a control variability grid analysis (CVGA) plot, which has been established as a
very useful tool to evaluate the performance of different control
strategies in a population of patients [25]. The area is divided in
zones, each one representing the level of euglycaemic maintenance. For each patient, a dot is plotted that shows the extreme
glucose excursions for a given control strategy applied over a
specific period. The performed closed-loop experiment involves
the consumption of 45, 70, and 60 g at 420, 720, and 1080 min
for all patients.
The black dots represent the CD2 closed-loop performance
with the patient-specific internal model, while the white dots
represent the same closed-loop experiment but for the mean
approximate model. The white circles represent the CD2 closedloop performance for “approximation” strategy.
We can see that the white dots (effect of mean model) are
more distributed indicating that there are patients residing in
zone upper B and lower D in opposition to the black dots that
are mostly found in zone A and lower B. It can be noticed that
the results of Strategy II are undoubtedly satisfactory since all
patients are in zones A and B. When Strategy II is compared
to the results from CD2 of Strategy I with mean model (white
dots), we can see that the additional MPC acts efficiently to
compensate for the effects of poor model and tighter glycaemic
control can be achieved.
Fig. 7 shows the cumulative distribution of CD2 for Strategies
I and II. We can observe that both areas are very sharp and tight
indicating that glucose is maintained tightly within the range.
B. Case Study: Skipped Meal
In this section, the case of a skipped meal at 720 min is evaluated for both the systematic strategy and the “approximation”
strategy, as shown in Fig. 8.

2375

Fig. 7. Cumulative distribution of blood glucose concentration. The light gray
area shows the range of closed-loop glucose distribution of Strategy II for the
ten patients; whereas the dark gray area shows the range of closed-loop glucose
distribution for Strategy I. The dashed line is the mean cumulative glucose
distribution of the light gray area, while the dash-dot line the mean of the dark
gray area.

Fig. 8.

Skipped lunch for adult 1; 45 g of breakfast and 60 g of dinner.

This graph shows the advantage of Strategy I over Strategy II.
It is noted that the optimization of the insulin delivery over the
entire horizon is more efficient than over the prediction horizon
in such an unstable system with long time delays. The insulin
action proposed by the solution of the optimization problem is
adequate for each sampling period since the reference meal disturbance is known in advance and insulin is delivered smoothly
long before the occurrence of glucose fluctuation. Therefore, in
the case of a skipped meal, the drop in glucose profile is not as
severe as in the “approximation” strategy because the compensation for a meal disturbance starts early having a smooth effect
on glucose. On the other hand, in the “approximation” strategy,
the reference meal announcement is obtained within the framework of the prediction horizon and the action of the controller
although it is produced earlier than the meal disturbance, it is
sharper than in Strategy I, causing a big drop on blood glucose
concentration.

2376

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 10, OCTOBER 2015

Fig. 9. Evaluation of CD 2 with systematic strategy (I) when a meal of 50 g
is given 30 min in advance, 30 min after and simultaneous with the reference
meal of 30 g, adult 1.

Fig. 11. CD 2 performance in the presence of intrapatient variability for Strategy I and Strategy II, comparison of glucose profile when CD 1 is applied with
no considered variability and CD 1 in the presence of variability for Scenario 2
adult 1.

Fig. 10. Evaluation of CD 3 with “approximation” strategy (II) when a meal
of 50 g is given 30 min in advance, 30 min after and simultaneous with the
reference meal of 30 g, adult 1.

C. Case Study: Variable Meal Time
Fig. 9 shows the glucose profile for adult 1 for the systematic
strategy when a meal of 50 g is given 30 min before, 30 min
after, and simultaneously, with the predefined 30-g reference
meal. Good glycaemic control is achieved even at the case when
a meal is consumed 30 min before the considered reference
meal, which triggers the control action. The results of Fig. 9
are compared with Fig. 10 for the exact conditions, and for
the “approximation” strategy. We can see that good glycaemic
control is achieved and no event of hypoglycaemia is occurring.
Additionally, we can observe the benefit of considering the
systematic strategy since it can maintain glucose tightly within
the range, although the increased postprandial glucose values
observed in the “approximation” strategy are acceptable.

concentration profile when CD1 is applied with no intrapatient
variation considered. This profile is compared to the darker gray
line that shows the influence of intrapatient variation on glucose
profile, when no further control action is applied, but only CD1 .
It can be noticed that the profile changes according to the sinusoidal variation with increased values of glucose concentration
when the value of k1 decreases and low values of glucose concentration with the increase of k1 . To address this fluctuation in
the case of predefined meal plan, CD2 is applied with the predefined meal plan as the reference meal for both the systematic and
“approximation” strategy. It can be observed that both control
strategies respond accordingly to decrease the glucose concentration, which tends to increase due to the imposed variability
and also to maintain the concentration above the hypoglycaemic
level when glucose tends to decrease. Additionally, the “approximation” strategy presents flexibility in this case due to the combined action of the two controllers, whereas in the “systematic”
strategy, the reference insulin delivery is precalculated and administered anyway. However, the controller maintains glucose
concentration within the normal range.

D. Case Study: Intrapatient Variability
The impact of intrapatient variability on glucose regulation
is assessed by imposing a circadian sinusoidal variation on the
parameter k1 (A.6.3), which is related to insulin-dependent glucose absorption. The choice of the parameter as well as the
imposed variation is in good accordance to the literature [26].
The amplitude of the wave is 30% of the nominal value of k1 ,
according to
	
	 


2π
k1 = k1,m ean 1 − 0.3sin
, 0 ≤ t ≤ 24.
(14)
24
The effect of parameter k1 variation on glucose concentration is shown in Fig. 11. The light gray line shows the glucose

VII. CONCLUSION AND FINAL REMARKS
This paper presents a systematic model-based framework for
glucose control in type 1 Diabetes Mellitus. Three main objectives of the proposed approach can be highlighted. The first is
related to the personalization of the closed-loop insulin delivery
system. Toward this direction, two general strategies of glucose regulation are proposed. The systematic strategy involves
a number of steps for patient-specific optimal insulin delivery
involving: 1) the development of individual approximate models
that take advantage of the a priori knowledge of the underlying
dynamics, 2) consideration of individual prediction horizons,
3) scheduling level tailored to patient’s diet, and 4) solution of

ZAVITSANOU et al.: In Silico CLOSED-LOOP CONTROL VALIDATION STUDIES FOR OPTIMAL INSULIN DELIVERY IN TYPE 1 DIABETES

patient-specific optimization problems. The “approximation”
strategy, on the other hand, compensates for the effect of poor
knowledge of the patient’s dynamics with the inclusion of an additional controller. Flexibility to individually specify the critical
parameters such as body weight, total insulin dose, and control
specifications is considered. The second objective addresses the
delayed insulin effect, which can lead to poor control performance. The feedforward ability of MPC that acts in anticipation
of the future fluctuations due to disturbances is enhanced when
considering a reference meal plan of specific size and time that
is always given to the patient. Thus, the system is ready to provide the optimal insulin infusion to compensate for a small in
size reference meal, in order to overcome the effect of long
time delays and to prevent the prandial hyperglycaemia induced
by a large meal. The third objective is to address the effect of
unknown meal disturbances and metabolic uncertainty. For this
case, an augmented state-space system is considered to describe
the unknown disturbance as extra states using a Kalman filter.
The robustness of the control performance is evaluated under
several conditions, indicating efficient glucose control in most
cases. The validation of the two proposed control designs for
unknown disturbances against the UVa/Padova model demonstrates the reliability of the proposed control strategy. On-going
work involves further in silico validation of the proposed control
designs and formulation of the system as a robust MPC problem.
APPENDIX A
1) Model Equations:
dCB
= QB (CH − CB ) − uB
Vg ,B
dt
dCk
= QK (CH − CK )
Vg ,K
dt
− uK − excretion

Brain (B)
Kidney (K)

Liver (L)

Gut (G)

Vg ,L

(A.1)

(A.2)

dCL
= QL · CH + QG · CG − QL
dt
· CL − uL + EGP
(A.3)

dCG
= QG (CH − CG ) − uG + Ra (A.4)
dt
dCH
= QB · CB + QL · CL + QP · CP
Vg ,H
dt
+ QK · CK − QCO · CH − uH
(A.5)

Periphery (P)

dCP c
= QP (CH − CP c )
Vg ,P c
dt
−p(CP c − CP t )

Vg ,P ,ISF

(A.6)

p = QP · (1 − exp(−PS/QP ))

Qi = rCO,i · QCO

(A.6.3)
(A.6.4)

(A.7)

and
ui = ru ,i · Total uptake

(A.8)

where Ci is glucose concentration (mg/dl) in i compartment,
Vg ,i the accessible glucose volume (dl) of i compartment, Qi
the blood flow (dl/min), ui the glucose uptake (mg/min), and
λo the rate of glucose uptake (dl/min). The models describing
endogenous glucose production (EGP), rate of glucose appearance (Ra ) and insulin kinetics are adapted from [17], [27], and
[28].
2) Adaptation to the Individual Patient:
TBVM = 0.285h + 0.316m − 2.82

(A.9)

TBVF = 0.1652h + 0.3846m − 1.36

(A.10)

Vg ,i = (1 − (0.08 · (1 − Hemat) + 0.38 Hemat))
· (VV ,i + VC ,i )

(A.11)

VV ,i = rf ,i · 0.6TBV

rf ,i = Qi /
Qi

(A.13)

VC ,i = rc,i · 0.1TBV

(A.14)

(A.12)

di = mi /Vi

(A.15)
(A.16)

VP = VC ,P + VIntst,P + VIntrac,P

VIntrst = 0.47 VIntrac

(A.17)

[28]

QCO = 224BW3/4
(A.18)

mAT = 1.2 BMI − 10.8 sex + 0.23 age

− 5.4 0.01m
(A.19)
mmuscles = 0.4BW with mintrst,muscles
= 0.1mmuscles

(A.20)

where VV ,i and VC ,i are the venous and capillary compartmental
volumes. All model parameters are estimated using glucose data
of UVa/Padova T1DMS as clinical data.
APPENDIX B

dCP t
= p(CP c − CP t ) − uP
dt

uP = (λo + λbasal ) · CP t

dλo
= −k2 λo + k1 · Ip
dt
dPS
= −k2,PS PS + k1,PS · Ip
dt

Vg ,P ,ISF = VIntrst,A T + VIntrst,musc

Vg ,G

Heart (H)

2377

(A.6.1)
(A.6.2)

A. Augmented System With Disturbance Model: The augmented disturbance model has to reflect the dynamics of the
effect of the real disturbance on the system in order to obtain
accurate estimates of the states of the augmented system [21].
In this section, an alternative to constant disturbance model, as

2378

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 10, OCTOBER 2015

Fig. 12. Closed-loop control performance for CD 3 . With d1 and d2 referring
to constant and linear disturbance model.

described with (6) is investigated. The real meal disturbance
as described at the original model holds a constant value for
specified meal duration. In the augmented state-space model,
the effect of unmeasured meal disturbances on glucose is included in the effect of the disturbance state. The structure is
described with the following linear system [28] that represents
the dynamics of meal absorption:


−k 0
with
Ad (t) =
(B.1)
ẋd = Ad (t) xd
k
k


d (t) = Cd xd (t)
with
Cd (t) = 0 1 . (B.2)
The new augmented system is observable and the closed-loop
performance is presented and compared with the performance
of the constant disturbance model in Fig. 12, both for the general
case of CD3 .
Fig. 12 also shows the estimates of the disturbance states
and the control action. It can be seen that the controller generally achieves tracking of the reference point (100 mg/dl) and
rejection of the unmeasured meal disturbance of 75 g of carbohydrates for both cases. The comparison of the estimated disturbance states (d1 and d2 ) and the performance of the closed-loop
systems show that the constant disturbance model provides better results, and therefore, is sufficient to be used in the augmented
system. Alternative disturbance models were tested (sinusoidalbased) presenting poor closed-loop results.
ACKNOWLEDGMENT
The financial support from the European Research Council
(MOBILE, ERC Advanced Grant, No: 226462), and the CPSE
Industrial Consortium is thankfully acknowledged.
REFERENCES
[1] B. W. Bequette, “Challenges and recent progress in the development of
a closed-loop artificial pancreas,” Annu. Rev. Control, vol. 36, no. 2, pp.
255–266, Dec. 2012.
[2] P. Dua et al., “Model-based blood glucose control for type 1 diabetes via
parametric programming,” IEEE Trans. Biomed. Eng., vol. 53, no. 8, pp.
1478–1491, Aug. 2006.
[3] R. Hovorka et al., “Overnight closed-loop insulin delivery in young people
with type 1 diabetes: A free-living, randomized clinical trial,” Diabetes
Care, vol. 37, no. 5, pp. 1204–1211, May 2014.

[4] S. Del Favero et al., “First use of model predictive control in outpatient
wearable artificial pancreas,” Diabetes Care, vol. 37, no. 5, pp. 1212–1215,
2014.
[5] M. L. Yoeri et al., “Day and night closed loop control in adults with
type 1 diabetes mellitus: A comparison of two closed loop algorithms
driving continuous subcutaneous insulin infusion versus patient self management,” Diabetes Care, vol. 36, pp. 3882–3887, 2013.
[6] M. Breton et al., “Fully integrated artificial pancreas in type 1 diabetes:
Modular closed-loop glucose control maintains near normoglycemia,”
Diabetes, vol. 61, no. 9, pp. 2230–7, Sep. 2012.
[7] R. Harvey et al., “Clinical evaluation of an automated artificial pancreas using zone-model predictive control and health monitoring system,”
Diabetes Technol. Ther, vol. 16, no. 6, pp. 348–357, Jan. 2014.
[8] F. J. Doyle et al., “Closed-loop artificial pancreas systems: Engineering
the algorithms,” Diabetes Care, vol. 37, no. 5, pp. 1191–1197, May 2014.
[9] L. Magni et al., “Model predictive control of glucose concentration in type
I diabetic patients: An in silico trial,” Biomed. Signal Process. Control,
vol. 4, no. 4, pp. 338–346, Oct. 2009.
[10] K. van Heusden et al., “Control-relevant models for glucose control using
a priori patient characteristics,” IEEE Trans. Biomed. Eng., vol. 59, no. 7,
pp. 1839–49, Jul. 2012.
[11] V. Sakizlis et al., “Robust model-based tracking control using parametric
programming,” Comput. Chem. Eng., vol. 28, no. 1–2, pp. 195–207, Jan.
2004.
[12] E. N. Pistikopoulos et al., “Explicit robust model predictive control,” in
Proc. Int. Symp. Adv. Control Chemical Process, 2009, pp. 243–248.
[13] C. M. Ionescu et al., “Robust predictive control strategy applied for
propofol dosing using BIS as a controlled variable during anesthesia,”
IEEE Trans. Biomed. Eng., vol. 55, no. 9, pp. 2161–2170, Sep. 2008.
[14] P. Soru et al., “MPC based artificial pancreas: Strategies for individualization and meal compensation,” Annu. Rev. Control, vol. 36, pp. 118–128,
2012.
[15] S. D. Patek et al. “Modular closed-loop control of diabetes,” IEEE Trans.
Biomed. Eng., vol. 59, no. 11, pp. 2986–2999, Nov. 2012.
[16] B. P. Kovatchev et al., “In silico preclinical trials: A proof of concept in
closed-loop control of type 1 diabetes,” J. Diabetes Sci. Technol., vol. 3,
no. 1, pp. 44–55, 2009.
[17] C. Dalla Man et al., “Meal simulation model of the glucose-insulin
system,” IEEE Trans. Biomed. Eng., vol. 54, no. 10, pp. 1740–1749, Oct.
2007.
[18] PSE. (2009, Jun.). gPROMS Model Validation Guide. [Online]. Available:
http://www.psenterprise.com
[19] S. Zavitsanou et al., “Optimisation of insulin dosing in patients with type
1 diabetes mellitus,” in Proc. 24th Eur. Symp. Comput. Aided Process
Eng., 2014, pp. 1459–1464.
[20] J. B. Rawlings and D. Q. Mayne, Model Predictive Control: Theory and
Design. Madison, WI, USA: Nob Hill Publishing, 2009.
[21] D. Nagrath et al., “A model predictive formulation for control of openloop unstable cascade systems,” Chem. Eng. Sci., vol. 57, pp. 365–378,
2002.
[22] B. J. Odelson et al., “A new autocovariance least-squares method for
estimating noise covariances,” Automatica, vol. 42, no. 2, pp. 303–308,
Feb. 2006.
[23] J. Walsh and R. Roberts. Pumping Insulin: Everything You Need for Success on a Smart Insulin Pump. San Diego, CA, USA: Torrey Pines, 2006,
pp. 117–127.
[24] PSE. (2011, Aug.). gO: MATLAB User Guide. [Online]. Available:
http://www.psenterprise.com.
[25] L. Magni et al., “Evaluating the efficacy of closed-loop glucose regulation
via control-variability grid analysis,” J. Diabetes Sci. Technol., vol. 2, no.
4, pp. 630–635, Jul. 2008.
[26] P. G. Fabietti et al., “Control oriented model of insulin and glucose
dynamics in type 1 diabetics,” Med. Biol. Eng. Comput., vol. 44, no. 1–2,
pp. 69–78, Mar. 2006.
[27] C. Dalla Man et al., “Mixed meal simulation model of glucose-insulin
system,” in Proc. IEEE Eng. Med. Biol. Soc. Conf., Jan. 2006, vol. 1, pp.
307–10.
[28] M. E. Wilinska et al., “Simulation environment to evaluate closed-loop
insulin delivery systems in type 1 diabetes,” J. Diabetes Sci. Technol., vol.
4, no. 1, pp. 132–44, Jan. 2010.
Authors’ photographs and biographies are not available at the time of
publication.

