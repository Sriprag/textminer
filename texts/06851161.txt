IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 12, DECEMBER 2014

2939

Reducing Risks in Type 1 Diabetes Using
H∞ Control
Patricio Colmegna, Ricardo S. Sánchez Peña∗ , Senior Member, IEEE, Ravi Gondhalekar, Senior Member, IEEE,
Eyal Dassau, Senior Member, IEEE, and Francis J. Doyle III, Fellow, IEEE

Abstract—A control scheme was designed in order to reduce the
risks of hyperglycemia and hypoglycemia in type 1 diabetes mellitus (T1DM). This structure is composed of three main components:
an H∞ robust controller, an insulin feedback loop (IFL), and a
safety mechanism (SM). A control-relevant model that is employed
to design the robust controller is identified. The identification procedure is based on the distribution version of the UVA/Padova
metabolic simulator using the simulation adult cohort. The SM
prevents dangerous scenarios by acting upon a prediction of future
glucose levels, and the IFL modifies the loop gain in order to reduce postprandial hypoglycemia risks. The procedure is tested on
the complete in silico adult cohort of the UVA/Padova metabolic
simulator, which has been accepted by the Food and Drug Administration (FDA) in lieu of animal trials.
Index Terms—H∞ control, hyperglycemia, hypoglycemia,
Type 1 diabetes.

I. INTRODUCTION
YPE 1 diabetes mellitus (T1DM) is an autoimmune disease
which is characterized by the destruction of the pancreatic
β-cells and consequently, insulin deficiency. This pathology has
been increasing 3–4% per year in youths, making diabetes one of
the most common childhood diseases [1]. In order to avoid being
exposed to prolonged hyperglycemia and ketoacidosis, a T1DM
patient is dependent on insulin injections and self-monitoring
of blood glucose throughout his/her life. Therefore, the selfmanagement of this disease is extremely demanding and does
not reliably lead to effective glycemic control. Consequently, the
problem of automatically controlling the blood glucose level in
T1DM patients is a long standing problem [2]–[8].

T

Manuscript received January 24, 2014; revised May 13, 2014; accepted June
25, 2014. Date of publication July 9, 2014; date of current version November
18, 2014. The work of P. Colmegna and R. S. Sanchez Peña were supported
by the Program PRH 71 (PICT 290 and PFDT) of the Ministry of Science,
Technology, and Innovation of Argentina, and since August 2013, by Nuria
(Argentina) and Cellex (Spain) Foundations. The work of R. Gondhalekar, E.
Dassau, and F. J. Doyle III were supported by the Grants NIH DP3DK094331
and R01DK085628. Asterisk indicates corresponding author.
P. Colmegna is with the Centro de Sistemas y Control, Instituto Tecnológico
de Buenos Aires, Buenos Aires C1106ACD, Argentina (e-mail: pcolme@
itba.edu.ar).
∗ R. S. Sánchez Peña is with the Centro de Sistemas y Control, Instituto
Tecnológico de Buenos Aires, Buenos Aires C1106ACD, Argentina, and is also
with the CONICET, Buenos Aires C1033AAJ, Argentina (e-mail: rsanchez@
itba.edu.ar).
R. Gondhalekar, E. Dassau, and F. J. Doyle III are with the Department
of Chemical Engineering, University of California, Santa Barbara, CA 93106
USA, and are also with the Sansum Diabetes Research Institute, Santa Barbara, CA 93105 USA (e-mail: gondhalekar@engineering.ucsb.edu; dassau@
engineering.ucsb.edu; doyle@engineering.ucsb.edu).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2014.2336772

An artificial pancreas consist of a continuous subcutaneous
insulin infusion (CSII) pump, a continuous glucose monitoring (CGM), and a control algorithm which closes the loop. A
variety of model predictive control (MPC) strategies and proportional integral derivative (PID) controllers have been extensively
tested both in silico and also in clinical trials [9]–[15]. Furthermore, other control techniques like adaptive control [16], linear
parameter-varying (LPV) control [17], H∞ control [18]–[20],
and even fuzzy-logic theory [21], [22] have also been considered. However, both LPV and also H∞ control have not been
tested in clinical trials yet. In addition, the feasibility of safe
blood glucose control with subcutaneous delivery of both insulin and glucagon has been demonstrated in several works
[23]–[25].
In any artificial pancreas scheme based on subcutaneous insulin delivery and/or glucose measurement, there is great difficulty in dealing with the long actuation/sensing delays, and also
the large inter and intrapatient variability. Due to the fact that
the system is highly uncertain and time-varying, it is clear that
some tuning to patient-specific characteristics is necessary to
achieve high closed-loop performance [26]. One way to tune or
adapt to a particular patient would be to perform an in-depth a
priori identification procedure [27], although the complexity of
such a procedure, and the time required to perform it, are likely
to render such an individualization infeasible in practice. Nevertheless, a general model structure could be adapted to a particular patient by using certain a priori clinical information that
is easily obtainable, e.g., the patient’s total daily insulin (TDI)
amount. Here, only adult patients are considered to present the
first results of this algorithm, because a lack of efficacy in adults
could lead to dismissal of possible therapies that could benefit
children, the highest-risk population [28]. In this study, a control model is synthesized by performing system identification
on the ten adult in silico subjects of the UVA/Padova simulator.
A third-order model was chosen, and the model gain is personalized by means of the subjects’ TDI. That personalized model,
whose parameters lack physiological meaning because the socalled black-box procedures were used to identify the model, is
employed to synthesize an H∞ controller by solving a mixedsensitivity problem. The H∞ control, which to our knowledge
has never before been tested on the complete adult cohort of the
UVA/Padova metabolic simulator, represents an alternative approach to other well-known control algorithms. This technique
provides a good balance between insulin dosing and glucose
tracking, by a practical, low-order controller.
In order to achieve safe hypoglycemia control, an insulin
feedback loop (IFL) has been added to adequately regulate an

0018-9294 © 2014 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

2940

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 12, DECEMBER 2014

estimate of the patient’s insulin on board (IOB). In addition, a
safety mechanism (SM) is used to perform better control based
on a prediction, over a 20-min horizon, of future glucose levels. Auxiliary modules that modify insulin dosing when safety
alarms are detected have been applied in several papers, demonstrating their importance in achieving safe blood glocuse control
[29]–[33].
This study is organized as follows. The model identification
is performed in Section II. An explanation about how the controller is designed, and how it works, is presented in Section III.
Results of numerical simulations are provided in Section IV,
and conclusions are presented in Section V.
II. MODEL IDENTIFICATION AND PATIENT TUNING
Several models that describe the glucose–insulin dynamics
have been developed [15], [34], [35]. However, the model parameters typically have physiological significance and cannot
easily be estimated in real patients. In addition, for control synthesis a simple, low-order model is frequently more desirable
than a complex, sophisticated model [36]. Therefore, a loworder control-relevant model is identified using a black-box
approach, and subsequently adjusted based solely on a priori
patient data, as in [37]. The procedure is described next.
For each in silico adult of the distribution version of the T1DM
simulator, a linear model of the transfer characteristics from the
insulin delivery (pmol/min/kg) to the deviation from a particular
glucose concentration (mg/dl) is identified. Three different interstitial glucose concentrations1 are considered here: 90, 120,
and 150 mg/dl to capture the frequency response at different
operating points. Hence, three linear models are obtained for
each patient.
The identification process for a particular glucose concentration is as follows. First, the basal insulin (Ib ) that produces
the particular glucose concentration at steady state is obtained.
Then, Ib is added to a sinusoidal insulin sweep. Over 12 h,
and with a sampling time of Ts = 10 min, this signal is infused
through a CSII pump, and the glucose deviation is captured.
Third-order models were obtained in all 30 cases using subspace identification algorithms [38], [39]. Considering these
models, the following discrete-time transfer function is defined:
G0 (z) = −

c0 z −3
(1 − z −1 p1 )(1 − z −1 p2 )(1 − z −1 p3 )

(1)

where c0 = 0.132 and the poles are: p1 = 0.965, p2 = 0.95, and
p3 = 0.93. Fig. 1 depicts the Bode diagrams of G0 (z) and all
identified models. The gain of G0 (z) is intentionally overestimated, and its phase is purposefully chosen lower than the phase
of all identified models, in order to obtain robust controllers as in
[37]. From previous experience, a controller based on this nominal model could be too conservative and consequently may
lead to poor performance. In order to limit this conservatism, an

1 The simulator has access to that particular variable without the CGM measurement noise.

Fig. 1. Bode diagram of all ten virtual adult patients at three different glucose
levels (thin lines) and G 0 (z).

Fig. 2.

Block diagram of the closed loop.

individualized transfer function G0,j (z) is defined:
G0,j (z) = −

crj z −3
.
(1 − z −1 p1 )(1 − z −1 p2 )(1 − z −1 p3 )

(2)

Here, as in [37], rj = 1800/TDIj is based on the 1800 rule (see
[40]) and represents the gain, which adapts to the patient’s TDI,
where the TDI of the patient with index j is denoted by TDIj ,
and
60
(1 − p3 )(1 − p2 )(1 − p1 )Ts
c=
(3)
100
is a constant that scales units. Therefore, crj is adapted to each
patient instead of using the constant value c0 .
III. CONTROLLER DESIGN
The glucose controller consists of three parts:
1) an H∞ controller;
2) a SM;
3) an IFL.
A schematic of the closed-loop system, considering one adult
from the simulator database, is depicted in Fig. 2, in which KSM,j

COLMEGNA et al.: REDUCING RISKS IN TYPE 1 DIABETES USING H∞ CONTROL

2941

is the H∞ controller modified by the SM, g is the measured
glucose concentration, usm is the control signal proposed by
KSM,j , u is the insulin input that is finally commanded to the CSII
pump, r and e are, respectively, the reference and error signals,
and σ is a switching signal, which is defined in Section III-B.
Fig. 3. Block diagram of the SM including the decision (DA) and prediction
(E and F) algorithms.

A. H∞ Controller
H∞ has proven to be a practical controller synthesis approach
when using LTI plant models. The low-order robust controller
characterized by H∞ naturally performs an effective tradeoff
between the strength of control action and the tracking error.
This compromise is known as the mixed-sensitivity problem
and the optimal solution in terms of the lowest gain between
the input disturbance and the output errors is achieved by this
optimal control procedure.
Consider Adult #j from the simulator database and let G0,j (z)
be its nominal model. A discrete H∞ controller Kj is synthesized solving a mixed-sensitivity problem with a performance
objective defined as




Wp (z)S0,j (z)


min γ such that 

 WΔ ,j (z)Kj (z)S0,j (z) 





<γ

. (4)

∞

Here, S0,j (z) = (1 + G0,j (z)Kj (z))−1 is the sensitivity function, Wp (z) and WΔ ,j (z) are the performance and control
weights, respectively, and the sample-period is 10 min.
To reduce the risk of hypoglycemia, WΔ ,j (z) resembles a
derivative in order to penalize fast changes in the insulin delivery. Regarding Wp (z), it is chosen to be close to an integrator,
i.e., large at low frequencies, to induce fast tracking of the safe
blood glucose levels.
In all cases, Wp (z) and WΔ ,j (z) are as follows:
Wp (z) =

0.01434z − 0.01365
z − 0.9993

WΔ ,j (z) = ISj ×

0.001992(z − 1)
z − 0.992

(5)
(6)

where ISj is the individualized gain based on the subject’s sensitivity to insulin, which is related to the following a priori clinical
information:
1) the average TDI regimen, in units of insulin;
2) the correction factor (CF), which is the maximum drop in
mg/dl per unit of insulin;
3) the carbohydrate ratio (CR), which is used to compute the
meal bolus as a function of the meal size.
IS values greater than unity are desired for patients with high
insulin sensitivity, in order to increase the weighting on the
control signal, and thereby reduce the amount of insulin infused.
In general:
↓ TDI and ↑ {CF, CR} ⇒ ↑ insulin sensitivity ⇒ IS > 1
and vice versa. It means that low TDI and high CF and CR
are likely related to patients with high insulin sensitivity, and

therefore, IS should be defined greater than unity, and vice
versa. In order to quantify the effect of CR and CF, we define
Cav = αCR + βCF, with α ≥ 0, β ≥ 0, and α + β = 1. Units
of α and β are [U/g] and [UdL/mg], respectively. Here, the solution is obtained choosing α = 0.5 U/g, and β = 0.5 UdL/mg.
However, if one coefficient (CR or CF) needs to be emphasized
because it is more important or accurate than the other, then α
and β can be selected with different weightings.
The TDI and the Cav of any one adult from the simulator
database, should be selected as the reference values: TDIr , Cavr ,
and ISr = 1. Due to the fact that both the patient’s model and
also its design weight WΔ ,j (z) both depend on its a priori TDIj ,
any adult from the database can be selected as the reference.
Without loss of generality, patient #9 has been considered as
a starting point. Finally, for Adult #j the ISj is calculated as
follows:
TDIr Cavj
.
(7)
ISj =
TDIj Cavr
Therefore, if Adult #j is likely to be more sensitive to insulin
than Adult # 9, ISj will be greater than unity, otherwise it will
be less than unity.
B. Safety Mechanism
In order to reduce the risk of hypoglycemia and hyperglycemia, a SM is included to modify the H∞ controller output
(uK ). As shown in Fig. 3, the SM is composed of a decision
algorithm (DA) and two prediction strategies:
1) linear extrapolation (E) to predict future glucose levels
considering the last three glucose measurements;
2) Kalman filtering (F) to predict the levels, rates of change,
and acceleration, of future glucose concentrations.
Any one prediction strategy has disadvantages compared to
others, and a safety module based on only one single strategy would suffer from these weaknesses as a consequence. In
this study, the use of parallel prediction strategies E and F, in
conjunction with a DA, allows us to exploit the strengths of the
individual algorithms, to better predict dangerous future glucose
scenarios, and thereby to create a more robust system [41].
Both E and F have a sample-period Ts = 10 min and a forecasting horizon of 20 min. In [41], a similar approach is presented, but considering a greater number of prediction algorithms and a different DA. Here, the SM process is described as
follows.
1) At every sampling time k, the glucose is measured (g) and
the prediction algorithms estimate the future glucose level
(ĝ). According to the following four regions:

2942

Fig. 4.

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 12, DECEMBER 2014

Block diagram of K S M , j and the IFL.

a) Region λ1 : ĝ < 90 mg/dl
b) Region λ2 : 90 ≤ ĝ ≤ 110 mg/dl
c) Region λ3 : 110 < ĝ ≤ 220 mg/dl
d) Region λ4 : ĝ > 220 mg/dl
the DA defines the variables

1 if ĝp,k  Region λi
ni,p,k =
0 otherwise
∀ i  {1, . . . , 4} and p  {E, F }. The variable ĝp,k
represents the estimated glucose value at step k + 2
(2 · Ts = 20 min later) by the prediction algorithm p as
predicted at actual step k.
2) Finally, the switching signal σ is defined in the following
MATLAB-like code.
if n1,F ≥ 1 && n1,E ≥ 1 || g < 90 mg/dl
σ = 1;
elseif n2 ≥ n3 && n2 > 0
σ = 2;
elseif n3 ≥ n4 && n3 > 0
σ = 3;
else
σ = 4;
end
usm = ρσ uK ;


where ni = p,m ni,p,m , ni,p = m ni,p,m , ρ1 = 0,
ρ2 = 0.5, ρ3 = 1, ρ4 = 1.25, and m = {k − 2, k − 1, k}.
Therefore, if low glucose values are predicted, the insulin
delivery is either suspended or attenuated. On the other hand, if
high glucose values are predicted, the insulin delivery proposed
by the H∞ controller is increased.
C. Insulin Feedback Loop
The main risks of insulin therapy are an overdose of insulin
and a high level of IOB in the body. An estimate of IOB is made
and employed to prevent insulin stacking due to frequent insulin
boluses. Therefore, an IFL as shown in Fig. 4 is included at the
KSM,j output to inhibit the insulin infusion when the plasma
insulin concentration is estimated to be excessive [32], [33].
The SIM block is the subcutaneous insulin model presented in
Appendix A and employs the mean population values for all its
parameters. The model is discretized with a sample-period of
Ts = 10 min and it is used to estimate the plasma insulin relative
to the basal conditions. The parameter μ is a tuning gain, fixed
to 7.5 for all subjects according to the magnitude of the signals
involved and the desired closed-loop performance. Its selection
depends on the compromise between having a slow (high μ)
or a more aggressive and fast (low μ) response, after verifying

Fig. 5. Closed-loop responses for the 101 in silico adults to protocol #1.
Above: blood glucose [mg/dl]. Below: insulin [U/h].

the closed-loop stability. Consequently, if the estimated insulin
concentration is higher than its nominal value, the control signal
is reduced by an amount proportional to that difference.
IV. RESULTS
The complete UVA/Padova T1DM simulator, which is accepted by the Food and Drug Administration (FDA) in lieu of
animal trials in the development of an artificial pancreas [42], is
used to test the closed-loop performance. Simulations are performed for all 101 in silico adults (one is an average patient),
considering unannounced meals, a CSII pump, CGM as sensor, and two different protocols, which are presented in Table I.
Protocol #1 includes three meals per day, while protocol #2 is
used to evaluate the safety of the algorithm when long fasting
periods appear.
In addition, in both protocols, the simulation starts in the fasting state of each subject, and the basal insulin is infused during
the first 4 hours. Then, the glucose controller takes over the
insulin delivery considering a constant setpoint. A postprandial
period (PP) is defined as the 5 hr interval following the start
of a meal, and night (N) is defined as the period from 00:00 to
7:00 AM.
The glucose responses to protocol #1 are depicted in Fig. 5,
employing differing colors to differentiate between risky and
safe situations. Note that the glucose graph is mainly green
and the insulin graph blue, which means that glucose levels are
mostly near the safe values, and that the insulin delivery rate is
generally low.

COLMEGNA et al.: REDUCING RISKS IN TYPE 1 DIABETES USING H∞ CONTROL

2943

TABLE I
PROTOCOL #1 AND #2
Breakfast 1

#1
#2

Lunch 1

Dinner 1

Breakfast 2

Lunch 2

Dinner 2

Breakfast 3

Lunch 3

Dinner 3

Time

Size

Time

Size

Time

Size

Time

Size

Time

Size

Time

Size

Time

Size

Time

Size

Time

Size

7 AM
7 AM

50 g
50 g

2 PM
−

60 g
−

8 PM
8 PM

50 g
60 g

6 AM
−

50 g
−

1 PM
12 PM

70 g
55 g

7 PM
9 PM

50 g
50 g

7 AM
7 AM

50 g
50 g

1 PM
2 PM

65 g
55 g

9 PM
8 PM

55 g
50 g

Fig. 6. Average closed-loop responses for the 101 in silico adults to protocol #1 (left) and to protocol #2 (right). The mean ±1 STD values are represented by
vertical bars, every 30 min.

The average time responses to both protocols are depicted
in Fig. 6. As shown in that figure, large insulin spikes appear
after meals. Then, the insulin infused is reduced and thereafter,
a constant amount of insulin is administered on average.
Although meals are unannounced and there is not any particular adjustment for any patient, besides the automatic one at
the controller design stage, a minimal High BG Index (HBGI <
5.0) and a minimal Low BG Index (LBGI < 1.1) were achieved
in both protocols as shown in Fig. 6. As shown in Table II, for
both protocols the proposed controller achieves meal glucose
values that are less than, or equal to, 154 mg/dl, which is in
accordance with recommendations made by the American Diabetes Association (ADA) [43]. Therefore, due to the fact that
hypoglycemia occurs only for one subject, we conclude that
safe hyperglycemic control has been achieved.
The control variability grid analysis (CVGA) and the average
results for both protocols are presented in Fig. 7 and Table II,
respectively. In Table II, the overall (O), PP, and N time intervals are analyzed separately. Because of the high measurement
noise,2 a reduced closed-loop bandwidth has been proposed.
2 In [42], it is anticipated that the real sensor errors would tend to be smaller
during controlled inpatient clinical trials.

Fig. 7. CVGA of all the 101 closed-loop responses to protocol #1 (circles)
and protocol #2 (stars).

Therefore, higher blood glucose peaks appear during the first
day of trial. Consequently, and furthermore, because each day of
the protocol has similarly sized meals, both the CVGA plot, as
well as the average results, related to protocol #1 are computed
based on the results of the third day. On the other hand, the
CVGA plot and the average results related to protocol #2 are

2944

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 12, DECEMBER 2014

TABLE II
AVERAGE RESULTS FOR THE 101 ADULTS TO PROTOCOL #1 AND #2
Mean BG

#1
#2

Max BG

Min BG

% > 300

% in [70 180]

% > 180

% < 70

O

PP

N

O

PP

N

O

PP

N

O

PP

N

O

PP

N

O

PP

N

O

PP

N

148
154

176
177

116
135

226
220

229
224

142
183

96
108

108
114

100
107

75.9
75.5

54.2
54.4

99.5
91.4

0.1
0.0

0.3
0.1

0.0
0.0

24.0
24.5

45.8
45.6

0.4
8.6

0.1
0.0

0.0
0.0

0.0
0.0

Fig. 8. Left: Average IFL signal for the 101 in silico adults to the third day of protocol #1. The mean ± 1 STD bar is plotted every 30 min. Right: The mean
minus one STD value of the 101 closed-loop night response to protocol #1 with (continuous line) and without (dashed line) the SM.

Fig. 9. Percentage of time each value of σ is selected. Left: protocol #1.
Right: protocol #2.
Fig. 10. CVGA of all the 101 closed-loop responses to protocol #1. (Circles)
PA. (Stars) OBT overestimating the bolus sizes by 30%.

obtained considering the data from the second day, to include
its long fasting period. In order to reflect how the IFL helps
to avoid postprandial hypoglycemia, the IFL signal obtained
considering the last day of protocol #1 is depicted in Fig. 5.
As mentioned previously, a large insulin spike appears after a
meal. Consequently, as uifl starts to increase the insulin infused
u = usm − uifl starts to be reduced. This process avoids insulin
overdosing, and therefore mitigates postprandial hypoglycemia.
The usefulness of the SM is also reflected in Fig. 8. For protocol
#1, the mean minus one STD value obtained every 30 min for
all 101 adults, both with and without the SM, are compared.
As illustrated, the SM assists the algorithm in preventing low
glucose outcomes.
For how long each value of σ is selected is represented in
Fig. 9. According to this figure, the algorithm settles on σ = 3,
the unscaled H∞ controller, more than 70% of the time in both
protocols. The last situation is also reflected in Table II in which
the percentages of time in the range [70, 180] mg/dl are presented. This is a desirable situation, because the selection of
this control implies that the glucose values tend to remain in a

safe region. Hence, according to the results obtained, it could be
concluded that a safe hyper- and hypoglycemia blood glucose
control has been achieved. Because the UVA/Padova metabolic
simulator does not include intrapatient variations, that scenario
could not be tested. However, the proposed approach (PA) has
proved robust to large interpatient variations. In addition, parameter ISj could also be modified to a controller that is either
more, or less, aggressive, depending on whether the subject’s
sensitivity to insulin changed drastically over time.
Finally, results for the standard open-loop basal–bolus treatment, with boluses delivered at the time of meal ingestion, are
presented in Table III for comparison. As expected, because
the PA considers unannounced meals, better performance is
obtained with an optimal bolus treatment (OBT). However, in
practice, the meal is sometimes wrongly estimated, and as a
result, the bolus size is not appropriate. In order to illustrate the
risk of that situation, the CVGA obtained with the PA and with
a 30% overestimated OBT is presented in Fig. 10.

COLMEGNA et al.: REDUCING RISKS IN TYPE 1 DIABETES USING H∞ CONTROL

2945

I˙p = −(m2 + m4 )Ip + m1 Il + ka1 Isc1 + ka2 I2

TABLE III
COMPARISON BETWEEN THE AVERAGE RESULTS FOR THE 101 ADULTS TO
PROTOCOL #1 OBTAINED WITH THE PA, WITH AN OBT, WITH A 30%
UNDERESTIMATED OBT, AND WITH A 30% OVERESTIMATED OBT
Control Strategy
Mean BG [mg/dl]

Max BG [mg/dl]

Min BG [mg/dl]

% time in [70 180] mg/dl

% time > 300 mg/dl

% time > 180 mg/dl

% time < 70 mg/dl

O
PP
N
O
PP
N
O
PP
N
O
PP
N
O
PP
N
O
PP
N
O
PP
N

PA

70% of OB

OBT

130% of OB

148
176
116
226
229
142
96
108
100
75.9
54.2
99.5
0.1
0.3
0.0
24.0
45.8
0.4
0.1
0.0
0.0

144
165
119
199
202
129
115
119
115
86.5
73.6
100
0.0
0.0
0.0
13.5
26.5
0.0
0.0
0.0
0.0

127
143
109
175
178
117
99
105
101
95.9
91.8
100
0.0
0.0
0.0
4.1
8.2
0.0
0.0
0.0
0.0

110
125
99
162
164
115
73
80
76
92.2
94.6
91.2
0.0
0.0
0.0
1.9
3.7
0.0
5.9
1.7
8.8

I = Ip /VI .
Variables
Isc1
Isc2

(8)

Amount of nonmonomeric insulin in the subcutaneous space [pmol/l].
Amount of monomeric insulin in the subcutaneous
space [pmol/l].
Insulin mass in plasma [pmol/l].
Insulin mass in liver [pmol/l].
Plasma insulin concentration [pmol/l].
Exogenous insulin infusion rate [pmol/kg/min].

Ip
Il
I
IIR
Parameters
Rate constant of insulin dissociation [min−1 ].
kd
Rate constant of nonmonomeric insulin absorption
ka1
[min−1 ].
Rate constant of monomeric insulin absorption
ka2
[min−1 ].
Rate parameters [min−1 ], i = 1, . . . , 4.
mi
Distribution volume of insulin [l/kg].
VI
REFERENCES

V. CONCLUSION
A controller structure is designed focused on hyper– and hypoglycemia protection. The system identification is based on
the ten subject cohort, in order to mimic a reduced spectrum
of information present for controller design, and to design a
controller that is suitably safe. The robust H∞ controller is synthesized via a mixed-sensitivity problem with weights focused
on maintaining the glucose level near to the reference value
while being cautious with the insulin injection. The IFL is intended as a postprandial hypoglycemia risk reduction based on
the IOB estimation. Finally, the SM considers an estimation of
future glucose levels in order to maintain the patient’s glucose
concentration in a safe region. The method is practical because
it only uses a priori patient information that is easily obtainable,
and works for both different patients and unannounced meals.
For validation purposes, the full cohort of the 101 subject simulator was employed to rigorously test the proposed control
strategy, showing good performance and minimal hyper– and
hypoglycemia risks.

APPENDIX A
SUBCUTANEOUS INSULIN MODEL
The insulin model employed in the IFL is presented in [35]
and the subcutaneous insulin kinetics, which complete the model
equations, are introduced in [44].
I˙sc1 = −(kd + ka1 )Isc1 (t) + IIR(t)
I˙sc2 = kd Isc1 (t) − ka2 Isc2 (t)
I˙l = −(m1 + m3 )Il (t) + m2 Ip

[1] F. R. Kaufman, Medical Management of Type 1 Diabetes. Alexandria, VA,
USA: American Diabetes Association, 2012.
[2] C. Cobelli, C. Dalla-Man, G. Sparacino, L. Magni, G. De Nicolao, and B.
P. Kovatchev, “Diabetes: Models, signals, and control,” IEEE Rev. Biomed.
Eng., vol. 2, pp. 54–96, 2009.
[3] M. Wilinska and R. Hovorka, “Simulation models for in silico testing
of closed-loop glucose controllers in type 1 diabetes,” Drug Discovery
Today: Disease Models, vol. 5, no. 4, pp. 289–298, 2008.
[4] J. Bondı́a, J. Vehı́, C. Palerm, and P. Herrero, “El páncreas artificial:
Control automático de infusión de insulina en Diabetes Mellitus tipo I,”
Revista Iberoamericana de Automática e Informática Industrial, vol. 7,
no. 2, pp. 5–20, 2010.
[5] C. Cobelli, E. Renard, and B. Kovatchev, “Artificial pancreas: Past, present,
future,” Diabetes, vol. 60, no. 11, pp. 2672–2682, 2011.
[6] E. Atlas, A. Thorne, K. Lu, M. Phillip, and E. Dassau, “Closing the loop,”
Diabetes Technol. Therapeutics, vol. 16, pp. S23–S33, 2014.
[7] B. W. Bequette, “Challenges and progress in the development of a closedloop artificial pancreas,” in Proc. Am. Control Conf., Montreal, Canada,
2012, pp. 4065–4071.
[8] F. J. Doyle III, L. M. Huyett, J. B. Lee, H. C. Zisser, and E. Dassau,
“Closed-loop artificial pancreas systems: Engineering the algorithms,”
Diabetes Care, vol. 37, no. 5, pp. 1191–1197, 2014.
[9] G. Steil, K. Darwin, F. Hariri, and M. Saad, “Feasibility of automating
insulin delivery for the treatment of type 1 diabetes,” Diabetes, vol. 55,
no. 12, pp. 3344–3350, 2006.
[10] B. Grosman, E. Dassau, H. C. Zisser, L. Jovanovič, and F. J. Doyle III,
“Zone model predictive control: A strategy to minimize hyper- and hypoglycemic events,” J. Diabetes Sci. Technol., vol. 4, no. 4, pp. 961–975,
2010.
[11] M. Breton, A. Farret, D. Bruttomesso, S. Anderson, L. Magni, S. Patek, C.
Dalla-Man, J. Place, S. Demartini, S. D. Favero, C. Toffanin, C. HughesKarvetski, E. Dassau, H. Zisser, F. J. Doyle III, G. De Nicolao, A. Avogaro,
C. Cobelli, E. Renard, and B. Kovatchev, on behalf of The International
Artificial Pancreas Study Group, “Fully integrated artificial pancreas in
type 1 diabetes: Modular closed-loop glucose control maintains near normoglycemia,” Diabetes, vol. 61, no. 9, pp. 2230–2237, 2012.
[12] C. Cobelli, C. Dalla-Man, G. Sparacino, L. Magni, G. De Nicolao, and
B. P. Kovatchev, “Multinational study of subcutaneous model-predictive
closed-loop control in type 1 diabetes mellitus: summary of the results,”
J. Diabetes Sci. Technol., vol. 4, no. 6, pp. 1374–1381, 2010.
[13] C. S. Hughes, S. D. Patek, M. Breton, and B. P. Kovatchev, “Anticipating the next meal using meal behavioral profiles: A hybrid model-based
stochastic predictive control algorithm for T1DM,” Comput. Methods Programs Biomed., vol. 102, no. 2, pp. 138–148, 2011.

2946

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 12, DECEMBER 2014

[14] K. Zarkogianni, A. Vazeou, S. G. Mougiakakou, A. Prountzou, and K. S.
Nikita, “An insulin infusion advisory system based on autotuning nonlinear model-predictive control,” IEEE Trans. Biomed. Eng., vol. 58, no. 9,
pp. 2467–2477, Sep. 2011.
[15] M. Wilinska, L. Chassin, C. Acerini, J. Allen, D. Dunger, and R. Hovorka,
“Simulation environment to evaluate closed-loop insulin delivery systems
in type 1 diabetes,” J. Diabetes Sci. Technol., vol. 4, no. 1, pp. 132–144,
2010.
[16] K. Turksoy, E. S. Bayrak, L. Quinn, E. Littlejohn, and A. Cinar, “Multivariable adaptive closed-loop control of an artificial pancreas without meal and
activity announcement,” Diabetes Technol. Therapeutics, vol. 15, no. 5,
pp. 386–400, 2013.
[17] R. S. Sánchez Peña, A. S. Ghersin, and F. D. Bianchi, “TimeVarying Procedures for Insulin-Dependent Diabetes Mellitus Control,”
J. Electr. Comput. Eng., vol. 2011, Art. No. 697543, 10p, 2011.
Doi:10.1155/2011/697543.
[18] P. Colmegna and R. Sánchez Peña, “Analysis of three T1DM simulation
models for evaluating robust closed-loop controllers,” Comput. Methods
Programs Biomed., vol. 113, no. 1, pp. 371–382, 2014.
[19] E. Ruiz-Velázquez, R. Femat, and D. Campos-Delgado, “Blood glucose
control for type I diabetes mellitus: A robust tracking H∞ problem,”
Control Eng. Practice, vol. 12, pp. 1179–1195, 2004.
[20] R. S. Parker, F. J. Doyle III, J. H. Ward, and N. A. Peppas, “Robust
H∞ glucose control in diabetes using a physiological model,” Journal
A.I.Ch.E., vol. 46, no. 12, pp. 2537–2549, 2000.
[21] E. Atlas, R. Nimri, S. Miller, E. A. Grunberg, and M. Phillip, “MD-logic
artificial pancreas system. A pilot study in adults with type 1 diabetes,”
Diabetes Care, vol. 33, no. 5, pp. 1072–1076, 2010.
[22] R. Nimri, E. Atlas, M. Ajzensztejn, S. Miller, T. Oron, and M. Phillip,
“Feasibility study of automated overnight closed-loop glucose control
under MD-logic artificial pancreas in patients with type 1 diabetes: the
DREAM Project,” Diabetes Technol. Therapeutics, vol. 14, no. 8, pp. 728–
735, 2012.
[23] F. H. El-Khatib, J. Jiang, and E. R. Damiano, “A feasibility study of
bihormonal closed-loop blood glucose control using dual subcutaneous
infusion of insulin and glucagon in ambulatory diabetic swine,” J. Diabetes
Sci. Technol., vol. 3, no. 4, pp. 789–803, 2009.
[24] F. H. El-Khatib, S. J. Russell, D. M. Nathan, R. G. Sutherlin, and E.
R. Damiano, “A bihormonal closed-loop artificial pancreas for type 1
diabetes,” Sci. Translational Med., vol. 2, no. 27, pp. 1–12, 2010.
[25] S. J. Russell, F. H. El-Khatib, D. M. Nathan, K. L. Magyar, J. Jiang,
and E. R. Damiano, “Blood glucose control in type 1 diabetes with a
bihormonal bionic endocrine pancreas,” Diabetes Care, vol. 35, no. 11,
pp. 2148–2155, 2012.
[26] S. D. Patek, B. W. Bequette, M. Breton, B. A. Buckingham, E. Dassau,
F. J. Doyle III, J. Lum, L. Magni, and H. Zisser, “In silico preclinical
trials: Methodology and engineering guide to closed-loop control in type
1 diabetes mellitus,” J. Diabetes Sci. Technol., vol. 3, no. 2, pp. 269–282,
2009.
[27] P. Colmegna and R. Sánchez Peña, “Personalized glucose control based
on patient identification,” in Actas Reuniones de Procesamiento de la
Informacin y Control, Bariloche, Argentina, 2013, pp. 397–402.
[28] A. Peters and L. Laffel, Type 1 Diabetes Sourcebook. Alexandria, VA,
USA: American Diabetes Association, 2013.
[29] C. Ellingsen, E. Dassau, H. Zisser, B. Grosman, M. W. Percival, L. Jovanovič, and F. J. Doyle III, “Safety constraints in an artificial pancreatic
β cell: An implementation of model predictive control with insulin on
board,” J. Diabetes Sci. Technol., vol. 3, no. 3, pp. 536–544, 2009.
[30] H. Lee, B. A. Buckingham, D. M. Wilson, and B. W. Bequette, “A closedloop artificial pancreas using model predictive control and a sliding meal
size estimator,” J. Diabetes Sci. Technol., vol. 3, no. 5, pp. 1082–1090,
2009.
[31] B. Kovatchev, S. Patek, E. Dassau, F. J. Doyle III, L. Magni, G. De Nicolao,
and C. Cobelli, “Control to range for diabetes: Functionality and modular
architecture,” J. Diabetes Sci. Technol., vol. 3, no. 5, pp. 1058–1065,
2009.
[32] G. M. Steil, C. C. Palerm, N. Kurtz, G. Voskanyan, A. Roy, S. Paz, and F. R.
Kandeel, “The effect of insulin feedback on closed loop glucose control,”
J. Clin. Endocrinology Metabolism, vol. 96, no. 5, pp. 1402–1408, 2011.
[33] P. Herrero, P. Georgiou, N. Oliver, D. G. Johnston, and C. Toumazou, “A
bio-inspired glucose controller based on pancreatic β-cell physiology,” J.
Diabetes Sci. Technol., vol. 6, no. 3, pp. 606–616, 2012.
[34] J. T. Sorensen, “A physiologic model of glucose metabolism in man and
its use to design and asses improved insulin therapies for diabetes,” Ph.D.
dissertation, Massachusetts Inst. Technol., Cambridge, MA, USA, 1985.

[35] C. Dalla-Man, R. Rizza, and C. Cobelli, “Meal simulation model of
the glucose-insulin system,” IEEE Trans. Biomed. Eng., vol. 54, no. 10,
pp. 1740–1749, 2007.
[36] R. Snchez Pea, and F. Bianchi, “Model selection: From LTI to switchedLPV,” in Proc. Am. Control Conf., Montreal, Canada, 2012, pp. 1561–66.
[37] K. van Heusden, E. Dassau, H. C. Zisser, D. E. Seborg, and F. J. Doyle
III, “Control-relevant models for glucose control using a priori patient
characteristics,” IEEE Trans. Biomed. Eng., vol. 59, no. 7, pp. 1839–1849,
Jul. 2012.
[38] P. V. Overschee and B. de Moor, “N4SID: Subspace algorithms for the
identification of combined deterministic and stochastic systems,” Automatica, vol. 30, no. 1, p. 7593, 1994.
[39] M. Cescon, F. Sthl, M. Landin-Olsson, and R. Johansson, “Subspacebased model identification of diabetic blood glucose dynamics,” in Proc.
15th IFAC Symp. Syst. Identification, 2009, vol. 15, no. 1, pp. 233–238.
[40] J.Walsh and R. Roberts, Pumping Insulin. San Diego, CA, USA: Torrey
Pines Press, 2006.
[41] E. Dassau, F. Cameron, H. Lee, B. W. Bequette, H. Zisser, L. Jovanovič,
H. P. Chase, D. M. Wilson, B. A. Buckingham, and F. J. Doyle III, “Realtime hypoglycemia prediction suite using continuous glucose monitoring,”
Diabetes Care, vol. 33, no. 6, pp. 1249–1254, 2010.
[42] B. Kovatchev, M. Breton, C. Dalla-Man, and C. Cobelli, “In silico preclinical trials: A proof of concept in closed-loop control of type 1 diabetes,”
J. Diabetes Sci. Technol., vol. 3, no. 1, pp. 44–55, 2009.
[43] American Diabetes Association, “Standards of Medical Care in
Diabetes—2014,” Diabetes Care, vol. 37, pp. S14–S80, 2014.
[44] C. Dalla-Man, D. Raimondo, R. Rizza, and C. Cobelli, “GIM, simulation
software of meal glucose-insulin model,” J. Diabetes Sci. Technol., vol. 1,
no. 3, pp. 323–330, 2007.

Patricio Colmegna received the B.S. degree in automation and control engineering from the Universidad Nacional de Quilmes (UNQ), Buenos Aires,
Argentina, in 2010. He is currently working toward
the Ph.D. degree in automatic control at the Instituto
Tecnológico de Buenos Aires, Buenos Aires, being
supported by a research scholarship from the Agencia Nacional de Promoción Cientı́fica y Tecnológica,
Ministerio de Ciencia y Tecnologı́a e Innovación Productiva, Argentina.
He is also working as a Teaching Assistant at control systems courses at UNQ. His current research interests include modeling,
identification, and robust control for type 1 diabetes mellitus and mechatronics
systems.

Ricardo S. Sánchez Peña (S’86–M’88–SM’00) received the Electronic Engineer degree from the University of Buenos Aires (UBA), Buenos Aires, Argentina, in 1978, and the M.Sc. and Ph.D. degrees,
both in electrical engineering, from the California Institute of Technology, Pasadena, CA, USA, in 1986
and 1988.
In Argentina, he worked in CITEFA, CNEA,
and the space agencies CNIE and CONAE. He collaborated with NASA in aeronautical and satellite
projects and with the German (DLR) and Brazilian
(CTA/INPE) space agencies. He was a Full Professor at UBA from 1989 to
2004, an ICREA Senior Researcher at the Universitat Politécnica de Catalunya,
Barcelona, Spain, from 2005 to 2009, and a Visiting Prof./Researcher at several
Universities in the USA and the EU. He has consulted for ZonaTech (USA), STI,
and VENG (Argentina) in aerospace applications and with Alstom-Ecotecnia
(Spain) in wind turbines applications. He has applied Identification and Control
techniques to acoustical, mechanical, and aero and astronautical engineering
and also to type 1 diabetes.
Dr. Sánchez Peña is the recipient of the Premio Consagración in Engineering
by the National Academy of Exact, Physical, and Natural Sciences (ANCEFN,
Argentina) and the Group Achievement Award fom NASA as a Review Board
member for the Aquarius/SAC-D satellite. Since 2009, he is the Director of the
Ph.D. Department in Engineering at the Buenos Aires Institute of Technology
and a CONICET Principal Investigator.

COLMEGNA et al.: REDUCING RISKS IN TYPE 1 DIABETES USING H∞ CONTROL

Ravi Gondhalekar (M’10–SM’13) received the
M.Eng. and B.A. degrees in engineering from the
University of Cambridge, Cambridge, U.K., in 2002.
He received the Ph.D. degree in informatics from the
Tokyo Institute of Technology, Tokyo, Japan, in 2008.
He is currently a Project Scientist at the University of California Santa Barbara (UCSB), Santa Barbara, CA, USA. His current research interests include
model predictive control, and constrained control and
optimization. At UCSB, he is applying constrained
model predictive control techniques to an artificial
pancreas that performs automated delivery of insulin to people with type 1 diabetes. From 2008 to 2012, he was an Assistant Professor at Osaka University,
Osaka, Japan. Prior to that, he held short-term positions at the Massachusetts
Institute of Technology, Cambridge, MA, USA; the University of Cambridge,
U.K.; Princeton University, Princeton, NJ, USA; Pi Technology, Cambridge,
U.K.; the Rutherford Appleton Laboratory, Oxfordshire, U.K.; and the United
Kingdom Atomic Energy Authority, Oxfordshire.

Eyal Dassau (M’08-SM’12) received the B.Sc.,
M.Sc., and Ph.D. degrees in chemical engineering,
in 1999, 2002, and 2006, respectively, all from Technion Israel Institute of Technology, Haifa, Israel.
He is currently a Senior Investigator and Diabetes
Research Manager with the University of California,
Santa Barbara, CA, USA. He is also an Adjunct Senior Investigator with the Sansum Diabetes Research
Institute, Santa Barbara, CA. His current research
interests include modeling, design, and control of
an artificial pancreas for type 1 diabetes mellitus,
and process and product design with emphasis on medical and biomedical
applications.
Dr. Dassau is a Senior Member of the American Institute of Chemical Engineering and a member of the American Diabetes Association.

2947

Francis J. Doyle III (M’02–SM’04–F’08) received
the B.S.E. degree from Princeton University, Princeton, NJ, USA, in 1985, the C.P.G.S. degree from the
University of Cambridge, Cambridge, U.K., in 1986,
and the Ph.D. degree from the California Institute
of Technology, Pasadena, CA, USA, in 1991, all in
chemical engineering.
He holds the Duncan and Suzanne Mellichamp
Chair in process control in the Department of Chemical Engineering, University of California, Santa Barbara, CA, as well as appointments in the Department
of Electrical Engineering and the Biomolecular Science and Engineering Program. He is also a Guest Investigator with the Sansum Diabetes Research Institute, Santa Barbara. His research interests include systems biology, network
science, modeling and analysis of circadian rhythms, drug delivery for diabetes,
model-based control, and control of particulate processes.
Dr. Doyle is a Fellow of a number of societies including the International
Federation of Automatic Control, the American Institute of Medical and Biological Engineering, and the American Association for the Advancement of
Science. In 2005, he was awarded the Computing in Chemical Engineering
Award from the American Institute of Chemical Engineers for his innovative
research in systems biology.

