IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 3, MAY 2014

855

An Automated Screening System for Tuberculosis
Ricardo Santiago-Mozos, Member, IEEE, Fernando Pérez-Cruz, Senior Member, IEEE, Michael G. Madden,
and Antonio Artés-Rodrı́guez, Senior Member, IEEE

Abstract—Automated screening systems are commonly used to
detect some agent in a sample and take a global decision about
the subject (e.g., ill/healthy) based on these detections. We propose a Bayesian methodology for taking decisions in (sequential)
screening systems that considers the false alarm rate of the detector. Our approach assesses the quality of its decisions and provides
lower bounds on the achievable performance of the screening system from the training data. In addition, we develop a complete
screening system for sputum smears in tuberculosis diagnosis, and
show, using a real-world database, the advantages of the proposed
framework when compared to the commonly used count detections
and threshold approach.
Index Terms—Automated screening, Bayesian, decision making,
sequential analysis, tuberculosis.

I. INTRODUCTION
UBERCULOSIS (TB) is a contagious illness caused by
the Mycobacterium Tuberculosis, better known as Koch
bacillus. In 2011, there were an estimated nine million incident
cases of TB, 0.99 million deaths from TB among HIV-negative
people and an additional 0.43 million TB deaths among HIVpositive people (classified as HIV deaths in the International
Statistical Classification of Diseases) [1].
To diagnose TB, the following methods are used: thorax radiography [2]; biological culture [2], [3]; the Mantoux (tuberculine sensitivity/skin) test [4]; interferon-γ tests [5]; amplified
nucleic acids-based tests [6] (which allow lab-on-chip platforms
[7], [8]); and sputum smear microscopy [8], [9]. Of these tests,

T

Manuscript received April 15, 2013; revised July 7, 2013; accepted September 13, 2013. Date of publication October 11, 2013; date of current version May
1, 2014. This work was supported in part by the Ministerio de Economı́a of
Spain (under Projects “DEIPRO,” TEC2009-14504-C02-01, and “COMONSENS,” CSD2008-00010, “ALCIT,” TEC2012-38800-C03-01, “COMPREHENSION,” TEC2012-38883-C02-01), the Ministerio de Industria of Spain
(project ‘CDTEAM’ of CENIT-Ingenio 2010), the EU Marie Curie Transfer of
Knowledge Fellowship (CT-2005-029611), the Marie Curie ITN FP7-PEOPLE2012-ITN-316861 (Machine Learning for Personalized Medicine 2012), and the
Universidad Carlos III (CCG10-UC3M/TIC-5304). The work of R. SantiagoMozos was supported in part by the Ministerio de Educación of Spain (EX20090681) and the Juan de la Cierva Program of the Ministerio de Ciencia e Innovación of Spain (JCI-2011-11150).
R. Santiago-Mozos is with the Department of Signal Theory and Communication, Universidad Rey Juan Carlos, 28943 Fuenlabrada, Spain (e-mail:
rsmozos@gmail.com).
F. Pérez-Cruz is with the Department of Signal Theory and Communication,
Universidad Carlos III de Madrid, 126–28903 Getafe, Spain. He is also a Machine Learning Researcher at Amazon (e-mail: fernando@tsc.uc3m.es).
A. Artés-Rodrı́guez is with the Department of Signal Theory and Communication, Universidad Carlos III de Madrid, 126–28903 Getafe, Spain (e-mail:
antonio@tsc.uc3m.es).
M. G. Madden is with the College of Engineering and Informatics, National
University of Ireland, Galway, Ireland (e-mail: michael.madden@nuigalway.ie).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/JBHI.2013.2282874

the two most commonly used to check whether a subject is contagious are biological culture and sputum smear microscopy [10].
Biological culture is generally accepted as the gold standard,
but the test can take up to four weeks [11]. Sputum smear
microscopy is typically used to make a decision based on a
quick examination. However, smear microscopy has a low sensitivity and is expensive, as an expert microbiologist is needed
to diagnose the sputum. Therefore, automatic systems to aid
the diagnosis have been proposed [12]–[17] for both auraminestained and Ziehl–Neelsen-stained sputum smears (fluorescence
and conventional microscopy, respectively). These systems are
focused on the classification of the TB bacillus by applying segmentation techniques to the images and report high sensitivities
when classifying segmented objects as bacillus (e.g., 94% [13]
or 95% [14]), which clearly renders them useful to assist the
expert by finding objects that are likely to be bacilli, which
accelerates the time needed to process slides. But, despite having good accuracy in identifying the bacillus in small object
databases, their false alarm rate (1-specificity) (e.g., 1% [13]
or 2% [14]) is too high to analyze subject images where the
proportion of bacilli is low.
The examples of automated systems considered previously
have reported to need three detections or more [13] or two or
more [14] to declare a TB-positive smear. Roughly, taking into
account their false alarm rate, these systems declare a false bacillus per 100 objects examined. If bacilli are scarce, TB-smear
might be declared positive after only analyzing nonbacilli objects. Bacilli scarceness is usually the case as World Health
Organization recommends that at least 100 fields (nonoverlapped images from the sample) have to be examined and one
bacillus in 100 images is enough to declare a positive sputum
smear [18], [19]. The problem of the false alarm rate has been
pointed out in [20], who devised a sequential test to manage
the false alarm rate by augmenting the number of images until
a performance criterion is met, which continued our previous
approaches to this problem [21].
As no classifier is likely to have specificity equal to one, two
important questions arise: can we trust these screening systems
for making decisions about smears? what is the quality of these
decisions based on the bacilli classifier performance (specificity
and sensitivity)? The main contribution of this paper is filling
the gap that exists between classifying bacilli and subjects, i.e.,
between classifying objects as bacilli and classifying smears as
TB-positive. We propose an automatic screening system for TB
and evaluate its performance in a real-life database. We address
both the bacilli classifier (detector) and the subject classifier.
Our system sequentially analyzes images from a subject until enough bacilli are detected or enough images are analyzed
without detecting any bacilli according to the decision quality requirements. The number of images to be examined and

2168-2194 © 2013 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

856

Fig. 1.

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 3, MAY 2014

Bacilli Classifier. This cascade represents the processing steps for each image patch in order to detect bacilli objects.

the maximum attainable performance of the subject classifier
are related to the bacilli classifier performance in the training
set, and each subject (smear) diagnosis is given a quality measure. The bacilli detector architecture is constrained for real-time
amenable operation. The subject classifier is automatically adjusted given the training set and it has only three parameters:
the thresholds for stopping the analysis for each kind of decision (TB-positive, TB-negative) and the a priori probability of
being TB-negative, whose setting is straightforward. Its design
is addressed from a Bayesian point of view and compared with
the commonly used count detections and threshold approach.
II. MATERIALS AND METHODS
A. Image Acquisition and Database
We have access to auramine-stained images of the subjects’
sputum that were acquired from a 20× fluorescence Nikon microscope with a Prior automatic slide loader and a Retiga 2000R
camera. We have around 300 1200 × 1600 RGB images (8 bits
per color) using manual focus for each one of 61 subjects, 12
of which are TB-positive (have TB bacilli in the sputum). In
addition, we have access to around 90 images per subject for
12 TB-positive subjects acquired with an autofocus algorithm.
All the images are unlabeled. The type of subject (TB-negative
or TB-positive) was confirmed by culture (even though culture
is an imperfect tool to determine the existence of bacilli in the
extreme low range, as it uses a decontamination procedure that
may result in killing some bacilli [19]).
In addition, we have around 5000 labeled patches with bacilli
from previous subjects. This database provides help to identify
the bacilli in our automatic detection algorithm. Unfortunately,
these patches are low quality, some only containing partial bacillus or several parts of them, or they are overlapping, or even controversial images of bacillus (not all doctors agree if the mass
in the patch is a bacillus). After a careful preprocessing we are
left with 1258 “mug shots”. We also have nonbacillus patches
that contain the objects that would pass the Bacilli Preprocessor
(see below) and have been collected from training TB-negative
subjects.
We randomly split the TB-negative subjects into training and
testing sets fixing a 30% for testing purposes. For the TBpositive subjects we randomly take seven subjects for testing
from the ones that have been manually acquired and six from
the automatically acquired (we put a larger percentage of TBpositive subjects in the test set because we have other database
for identifying bacilli and we want to have a similar number
of positive and negative test subjects). Finally, 45 subjects are
selected for training (34 TB-negative and 11 TB-positive) and
28 for testing (15 TB-negative and 13 TB-positive).

Fig. 2. Image division. Each grid outputs its patches to be analyzed but all
detections are assigned to the continuous grid.

Solving this problem accurately is extremely difficult: first,
because we have a global decision (whether the subject culture
has TB bacilli) that might not be error free, but we need to seek
for individual bacillus in the acquired images, which are not
labeled; furthermore, a dead bacillus in a TB-negative subject
(e.g., cured or with latent TB) looks as the same as a bacillus; and
an TB-positive subject might not have any bacilli in the acquired
images (a little as one bacilli per 100 images is considered as
enough to declare a positive sputum smear). We need to be able
to extrapolate from bacilli finding to subject classification with
high sensitivity and specificity.
B. Bacilli Classifier
The bacilli classifier has the cascade structure shown in Fig. 1.
It has two parts: the bacilli preprocessor, which is fast and discards the patches that cannot contain a bacilli (see below), saving
processing time; and the main processing for bacilli, which performs object segmentation and analyzes these objects. An object
is only declared as a bacillus if it reaches the pixels classifier
and is declared bacillus.
1) Bacilli Preprocessor: The image is divided into patches
as shown in Fig. 2. We use several overlapping grids to avoid
the situation where a bacillus is located on the edge of a patch;
ultimately, a bacillus detection is assigned to the patch of the first
grid where most of its body lies. For the preprocessor, we end up
with a simple classifier that focuses on the green component of
RGB images because the auramine tincture is basically green.
It sends to the next step any patch whose minimum greencolor value exceeds a threshold T1 , and has P or more pixels
exceeding a threshold T2 , and discards the rest of patches. T1 ,
T2 , and P are selected to ensure that all bacilli on the training
set are not discarded.
2) Main Processing for Bacilli: In the patches selected by
the Bacilli Preprocessor we perform object detection. We use
Canny edge detection [22], using the green color for segmentation. Then, following [14] and [16], we extract a set of rotation
and translation invariant features of each candidate object (see
Table I) and classify the objects using them. This intermediate

SANTIAGO-MOZOS et al.: AUTOMATED SCREENING SYSTEM FOR TUBERCULOSIS

TABLE I
ROTATION AND TRANSLATION INVARIANT FEATURES

857

1) Desired Quantity: p(H0 |z), is the probability of the test
subject being TB-negative given the outputs of the bacilli classifier. We compute the posterior for hypothesis H ,  = {0, 1}
by applying Bayes rule
p(H |z) =

classifier is tuned for sensitivity close to 1. Finally, the objects
classified as nonbacillus are discarded, and the objects classified
as bacilli are rotated and centered, following the procedure used
by [25], and classified using their pixels as features. Both, the
invariant feature and the pixels classifiers are implemented using
a support vector machine (SVM) [26], [27].
C. Subjects Classifier
The bacilli classifier provides an output zi ∈ {0, 1} for each
analyzed patch that identifies whether a bacilli was detected
(zi = 1). We define z = {z1 , z2 , . . . , zK } as the K outputs of
the bacilli classifier for all the patches of the analyzed
 images of
zi approxia test subject. The rate of bacilli declarations K1
mates the probability of declaring a bacillus in this test subject,
which is the sum of the unknown probabilities of detection (PD )
and false alarm (PFA ) of the bacilli classifier in that subject.
We formalize the global decision about the smear as a binary
hypothesis testing problem [28] that decides between two alternative hypotheses H0 (TB-negative) and H1 (TB-positive),
which, respectively, state that an independent and identically
distributed (i.i.d.) set of samples z (the outputs of the bacilli classifier) has been generated according to a distribution p(z; θ0 ) or
p(z; θ1 ). We model these samples using a Bernoulli distribution
p(zi ; θ ) = θz i (1 − θ )1−z i , where the success probabilities θ0
and θ1 are the probabilities of declaring a bacillus in a TBnegative and TB-positive smear, respectively.
We consider this binary decision when θ0 and θ1 are fixed
but unknown, and they are described by two i.i.d. sets x =
{x1 , . . . , xN } and y = {y1 , . . . , yM }, respectively, drawn from
p(z; θ0 ) and p(z; θ1 ). Here, x (y) are the outputs of the bacilli
classifier for all the patches of the images of a prototype subject
for the TB-negative (TB-positive) smear class. A prototype for
each class can be chosen as a typical subject or as a limiting
subject (the one that is closest to the other class). We stress
that we only know θ0 (θ1 ) through x (y), and therefore, some
uncertainty will always remain about θ0 (θ1 ) true value. We
propose to address this decision problem following a Bayesian
sequential approach.
In Bayesian statistics, variables and parameters are treated
as random variables and our objective is to obtain the posterior
distribution of the desired quantity conditioned on the observed
variables (and integrating out the unknowns) [29]. Next, we
detail our desired quantity, how to define the hypotheses and
how to bind our confidence on the decision.

p(z|H )p(H )
p(z|H0 )p(H0 ) + p(z|H1 )p(H1 )

(1)

where p(z|H ) are the likelihoods for each hypothesis and
p(H ) their a priori probabilities (i.e., the probability of a
generic patient being TB-negative or TB-positive).
2) Hypotheses Definition and Likelihoods: If θ0 and θ1 were
known

θ z i (1 − θ )1−z i .
p(z|H ) = P (z|θ ) =
i

However, the only information we have for each hypothesis are
the sets x and y. Therefore, the likelihood should be computed,
by integration of the unknown random variable θ0 , as

p(z|H0 ) = p(z|x) = p(z|θ0 )p(θ0 |x) dθ0
(2)
where p(θ0 |x) is the posterior of θ0 with respect to the known
set x
p(x|θ0 )p(θ0 )
p(x|θ0 )p(θ0 )
=
p(θ0 |x) =
p(x)
p(x|θ0 )p(θ0 ) dθ0
and the prior of θ0 , p(θ0 ), is selected as a beta distribution
p(θ0 ) = beta(θ0 |a, b) =

Γ(a + b) a−1
θ0
(1 − θ0 )b−1
Γ(a)Γ(b)

where Γ(·) is the gamma function. The beta distribution is flexible and allows a noninformative prior by setting a = b = 1,
which results in a uniform distribution between 0 and 1. Other
values of a and b can be used to incorporate different prior
knowledge. The beta distribution is also a conjugate prior
for the Bernoulli distribution, which makes the selection of a
beta prior convenient from an analytic point of view: p(θ0 |x)
becomes a beta distribution p(θ0 |x) = beta(θ0 |a0 , b0 ), where
a0 = n1 + a; b0 = N − n1 + b; N is the number of samples
of x and n1 is the number of “1”s (bacilli declarations) in x.
Finally, for any posterior of θ0 with the form of beta(θ0 |a0 , b0 ),
the likelihood for H0 becomes
p(z|H0 ) =

Γ(K − k1 + b0 )Γ(a0 + b0 )Γ(k1 + a0 )
Γ(a0 )Γ(b0 )Γ(K + a0 + b0 )

(3)

where K and k1 are, respectively, the number of samples and the
number of “1”s in the test sample z. An equivalent expression
can be computed for p(z|H1 ).
3) Bounds for the Achievable p(z|H0 ): When the number
of test samples tends to infinity, the likelihood p(z|θ0 ) tends
to a Dirac delta function δ(θ0 − θ∗ ), where θ∗ is the true value
of the success probability of the Bernoulli for the test sample.
Therefore, (2) simplifies to



p(z|H0 )as = p(z|θ0 )p(θ0 |x) dθ0 = p(θ0 |x)
∗
θ 0 =θ

where “as ” stands for asymptotic.
An analogous reasoning gives

p(z|H1 )as = p(θ1 |y)θ 1 =θ ∗ and by substituting these values

858

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 3, MAY 2014

TABLE II
TB-NEGATIVE TRAINING SUBJECTS

into (1) we attain
p(H0 |z)as =

p(H0 )p(θ0 |x)|θ 0 =θ ∗
.
(p(H0 )p(θ0 |x) + p(H1 )p(θ1 |y))| θ 0 = θ ∗

(4)

θ1 =θ∗

P (H0 |z)as only depends on the a priori probabilities of the hypotheses, the sets of samples which characterize the hypotheses
x, y and the prior distributions on θ0 and θ1 , and is limited by
the initial uncertainty in the hypotheses no matter how many
test samples are used. These bounds help to set the stopping
threshold probabilities (see below).
The Bayesian test may be applied sequentially. We only
need to use the recursive rule for the Gamma function, i.e.,
log Γ(n + 1) = log n + log Γ(n), each time a new sample from
z is processed.
III. RESULTS
A. Bacilli Classifier
The bacilli classifier was developed using MATLAB and LIBSVM [30] package for SVM. The bacilli classifier sensitivity is
obtained by tenfold cross validation from the training labeled
bacilli. It is found to be 73.53%. On the other hand, we can
obtain the specificity from the complete analysis of 15 TBnegative test subjects and it works out as 99.999% (28 “false
alarms” in 6288320 patches). The operation time of the bacilli
classifier is around a second per image, which is the time needed
for acquiring an image (operation is pipelined: when an image
is being acquired, the bacilli classifier is processing the last
one). If faster processing is needed, the Invariant Feature Classifier and the Pixel Classifier can be deployed as cascade classifiers [31] and/or the complexity of the SVM boundaries can be
reduced [32], with almost no penalty in accuracy. If even faster
processing is required, the sensitivities of the Bacilli Preprocessor and the Invariant Feature Classifier can be reduced, which
adds a penalty in the overall bacilli classifier sensitivity.

TABLE III
TB-POSITIVE TRAINING SUBJECTS

B. Subjects Classifier
When running the bacilli classifier over all the patches of the
images of the training subjects, we obtain the bacillus declarations (number of patches that contain bacillus) summarized in
Tables II and III for the TB-negative and the TB-positive, where
“Subject ID” is the identifier of subject; “#patches” stands for
the total number of patches available; “#bacilli” for the number of patches that contain a bacillus; and “pdecl.bac. ” for the
observed probability of declaring a bacillus.
1) Count and Threshold Approach: This is the most common approach in the literature [8], [9], [19]. It establishes a
threshold on the number of bacilli detections. Any smear with as
many or more detections is declared TB-positive. After carefully
considering the number of detections in the training subjects in
Tables II and III, we choose to establish the threshold in six
bacilli. Therefore, two out of 34 TB-negative training subjects
will be misclassified and the maximum attainable specificity
of the global decision should be lowered by 2/34. Also, five
out 11 TB-positive training subjects will be misclassified and
the maximum attainable sensitivity should be lowered by 5/11.

On the other hand, we fix the number of images to analyze to
300 (412 800 patches) or as many as have been acquired when
300 images are not available. If we reach the threshold before
analyzing 300 images, we stop early.
With this strategy (tables not shown) we get the same decisions than with the Bayesian approach (see below). For the
TB-positive test subjects we get seven out of 13 correct decisions. The test finishes early in the seven subjects with six or
more bacilli detections (subject 6 in Table IV has a total of 123
bacilli declarations in 151 360 patches but the Bayesian test finishes after considering 2752 patches), on the rest, the test runs
until 300 images are examined (the number of bacilli detections

SANTIAGO-MOZOS et al.: AUTOMATED SCREENING SYSTEM FOR TUBERCULOSIS

859

TABLE IV
TB-POSITIVE TEST SUBJECTS

TABLE V
TB-NEGATIVE TEST SUBJECTS

for these later subjects are shown in Table IV [column #bacilli]
but for subject 56 036, where the number of bacilli detected in
300 images increases to 1). For the TB-negative test subjects,
we get 15 out of 15 correct decisions. The test runs until 300
images are analyzed (the bacilli detections for these subjects
are the same than in Table V but for subject 36 856 where the
number of bacilli detected in 300 images increases to 3).
2) Bayesian Approach: In the Bayesian approach, we can
easily incorporate the information of all our training subjects. We propose to use a beta distribution as posterior for
each class (TB-positive, TB-negative) and compute the maximum likelihood estimates of its parameters from the maximum
likelihood estimates of the declaring-a-bacillus probabilities
of the subjects that belong to that class. Therefore, from the
numbers of Table II, we obtain p(θ0 |all TB-negative subjects)
as a beta(θ0 |0.20753,35033) (having replaced zero values by
1 × 10−6 to avoid numerical problems) and plug it into (3).
We calculate from Table III p(θ1 |all TB-positive subjects) as a
beta(θ1 |0.20583,305.71). We fix the a priori probability of subject being TB-negative, p(H0 ) = 0.5, in order to not favor any
class.
We first explore our training data by obtaining the asymptotic
posterior of being a TB-negative subject p(H0 |z)as , shown in
Fig. 3, where we can observe that the maximum of p(H0 |z)as is
bounded for the TB-negative subjects (low probability of declar-

Fig. 3. Probability of being a TB-negative subject as function of the asymptotic
probability of declaring a bacillus.

Fig. 4. Probability of TB-negative subject as function of the number of samples
using an all zeros sequence.

ing a bacillus): it does not rise much beyond 0.72. On the other
hand, for TB-positive subjects (high probability of declaring
a bacillus), p(H0 |z)as drops exponentially from probabilities
of declaring a bacillus greater than 10−5 . Therefore, with the
available training data and detector capability, we can attain
high confidence in declaring a subject TB-positive, but not so
much in declaring one TB-negative. This is because the posterior of θ1 for TB-positive subjects captures the fact that some of
them have no or very few bacilli declarations, as is the case with
TB-negative subjects. On the other hand, when a sufficient number of bacilli are declared, the test is very confident in deciding
that a subject is TB-positive.
Fig. 3 helps to select the probability thresholds for stopping
the Bayesian test. But we have to be careful as the asymptotic
procedure assumes that an infinite number of samples have been
analyzed. Therefore, we test a sequence with no bacilli declarations z zero , to see which probability threshold is adequate to stop
analyzing a TB-negative subject. Fig. 4 shows that after around
2 × 105 samples, the probability p(H0 |z) reaches the value
0.72. This corresponds to 180 images without a bacilli declaration and seems an appropriate moment to stop. Therefore, we set

860

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 3, MAY 2014

IV. DISCUSSION
A. Image Acquisition and Database

Fig. 5. Patient Classifier Algorithm. If p(H 0 |z) < 0.5 we decide subject is
TB-positive, otherwise we decide subject is TB-negative.

TH = 0.72 as the first stopping threshold, which corresponds to
an asymptotic probability of declaring bacilli of 10−6 . We set
the stopping threshold for a TB-positive subject to TL = 10−3 ,
which seems a good compromise between early stopping and
decision quality. Fig. 3 shows that this threshold is equivalent
to stop analyzing any subject with asymptotic probability of
declaring a bacillus higher than 2.25 × 10−4 . The minimum
number of patches analyzed is 1376, which corresponds to one
image. Otherwise, the test stops when the maximum number
of images is reached. See Fig. 5 for a summary of the patient
classifier procedure.
The results of this procedure for the test subjects are presented
in Tables IV and V, where “stop” column informs whether
the test has stopped before analyzing all the available images;
“#patches” are the number of patches analyzed by the test (which
is different to the number of patches available), and “#bacilli” the
number of detected bacilli in the analyzed patches (again, this
can be lower than the number of bacilli in the available images).
On the one hand, Subjects 50 304 and 55 798 in Table IV have
a similar number of detections, but the first has a higher rate
of bacilli and its probability touches the TB-positive threshold
whereas the second has its detections in the last images, which
makes the test to be more cautious. Similarly, subjects 6 is
decided a TB-positive patient after only two images because of
its five detections, but the test needs more images (not available)
for subject 2 to meet the requirement of p(H0 |z) ≤ TL and it is
decided to be TB-positive but with less certainty. Table V shows
the effect of detections on early stopping: with the available data
and threshold choices, the test only stopped for subjects with
no detections, but those with one detection were about to stop.
We also see how detections lower the confidence on the TBnegative decision. Globally, the hard decisions for the subjects,
i.e., the result of thresholding p(H0 |z) at 0.5, are the same than
in the count-and-threshold case. We observe that TB-positive
subjects can attain a high confidence value. However, without a
high a priori probability for H0 increasing the probability for
the TB-negative subjects, our confidence for one of these will
never be high, as we have already observed in the asymptotic
analysis.

In this application, we face a challenging problem because the
bacilli rate can be very low in some TB-positive subjects (e.g.,
training subject with ID 7 has been declared TB-positive by the
culture method but no bacillus where detected by our bacillus
classifier). There are several reasons for this: bacilli live in a
3-D volume and they can be orthogonal to the slide; the image
acquisition process does not capture bacilli, or only very few of
them; lack of focus in both manual (because of lack of training or
excess of work) and automatic image acquisition; bacilli weakly
tinted due to nonuniform tincture application or degradation of
it, or due to antibiotics that degrade bacilli walls and less tincture
get attached to them. These factors and the bacilli classifier
capabilities condition the maximum performance of the system,
but the proposed subjects classifier accounts for these sources of
uncertainty in a principled way. It does not matter whether the
detector fails to detect bacilli or they have not been captured,
the proposed subject classifier deals with all previous system
errors.
The magnification used in this database is 20×; this is the
magnification used in the standard practice among microbiologists in Madrid as a good tradeoff between the time required to
analyze a subject and the discrimination capability (40× is the
recommended setting by WHO [8]). Other authors have used
larger magnifications like 630× [13], 250× [14], or 100× [16].
It is possible that the magnification of 20× is lower than optimum for automatic recognition, and better results could be
achieved with larger magnifications.
B. Subjects Classifier
The methodology presented here is general and can be applied to problems where the classes overlap and are defined by
several collections of samples. The Bayesian approach demonstrates how to incorporate the uncertainty of the hypotheses in a
closed-form expression that can be updated sequentially using
sums for each new test sample. We also show that the maximum
performance of the Bayesian test is limited by these uncertainties.
Common practice in TB screening systems is to declare a
positive smear if the number of TB bacilli detections exceeds a
threshold [9], [19]. In the case of humans, this number depends
on the experience of the microbiologist and the type of tincture/microscope. On automated systems, this number is fixed to
classify the subjects in the database balancing sensitivity and
specificity of the decision about the smear. In real databases
of sputum smears some TB-positive subjects might have less
bacilli detections than some TB-negative subjects, therefore,
some training subjects are going to be misclassified, which must
be noted in the specificity and sensitivity of the global decision.
Real detectors also have a false alarm probability, which must
be considered because it might render the system decisions useless. Our methodology takes into account all these issues and
bounds the maximum quality of the system decisions from the
available training data and, at the same time, avoids the need of

SANTIAGO-MOZOS et al.: AUTOMATED SCREENING SYSTEM FOR TUBERCULOSIS

fixing a threshold, by incorporating all the available information of the training patients in the decision process. In addition,
the sequential nature of the decision mitigates to some extent
the deficiencies of the detector and the image acquisition process. We have also developed a frequentist approach for this
problem [33].
C. Experiments
The count and threshold approach obtains the same decisions
than the Bayesian approach in our test patients but gives no quality measures with the decisions. In our experiments, by using the
former approach with a threshold of six detections we ignore the
quality (i.e., if we can trust) of a TB-negative decision with five
detections or a TB-positive decision with six detections. In addition, with this approach, the system is not capable of stopping
early in a negative test or examining a different number of images for cases with different number of detections, which does
not happen with the sequential analysis. The Bayesian procedure
is straightforward to adjust, and only the probability thresholds
for the sequential test and the a priori probability of being TBnegative, has to be specified (for example, p(H0 ) = 0.92 is the
a priori probability of a TB-negative subject in Madrid hospitals). The experiments show that the global performance can be
estimated from the training data. They stress the importance of
having a good bacilli classifier and show how to penalize our
confidence in the decisions, taking into account all the steps of
the decision process.
V. CONCLUSION
Screening systems need to provide not only a decision, but
also an estimate of its quality. We have shown how to provide
this quality and how to bind its maximum from the training data
and bacilli classifier performance. This allows knowing what the
strengths and weakness of the decision system are, and points
toward further improvement in its parts. The described decision
methodology is general and can be applied to any screening
system. In addition, our subject classifier is straightforward to
use and its computing requirements are negligible as it has a
closed-form expression, which can be sequentially updated.
We have illustrated this framework with a screening system
for TB, which can be trained for any type of microscope/tincture
combination. The proposed system combines a bacilli classifier
amenable for real-time operation (processing images at the rate
they are captured) with sequential analysis, which stops the
screening when the quality of the decision has reached the requirements. The evaluation of the quality of the decisions of this
system on real data shows that the system is only confident in
declaring TB-positive subjects. This opens up the opportunity
of further research for the bacilli classifier.
ACKNOWLEDGMENT
The authors would like to thank M. Desco for his considerable
support in all this project and M. J. R. Serrano for her supervision
in the gathering of the database. They would also like to thank

861

the Irish Centre for High-End Computing for allowing them to
use their computing facilities.
REFERENCES
[1] World Health Organization, “Global tuberculosis report,” Rep.
WHO/HTM/TB/2012.6, 2012.
[2] V. Kumar, A. K. Abbas, and J. C. Aster, Robbins Basic Pathology.
Philadelphia, PA, USA: Saunders, 2012.
[3] R. S. Wallis, M. Pai, D. Menzies, T. M. Doherty, G. Walzl, M. D. Perkins,
and A. Zumla, “Biomarkers and diagnostics for tuberculosis: Progress,
needs, and translation into practice,” Lancet, vol. 375, no. 9729, pp. 1920–
1937, Jun. 2010.
[4] R. Diel, R. Loddenkemper, K. Meywald-Walter, R. Gottschalk, and
A. Nienhaus, “Comparative performance of tuberculin skin test,
QuantiFERON-TB-Gold In Tube assay, and T-Spot.TB test in contact
investigations for tuberculosis,” Chest, vol. 135, no. 4, pp. 1010–1018,
Apr. 2009.
[5] A. Zwerling, S. van den Hof, J. Scholten, F. Cobelens, D. Menzies, and
M. Pai, “Interferon-gamma release assays for tuberculosis screening of
healthcare workers: A systematic review,” Thorax, vol. 67, no. 1, pp. 62–
70, Jan. 2012.
[6] M. Pai, J. Minion, H. Sohn, A. Zwerling, and M. D. Perkins, “Novel
and improved technologies for tuberculosis diagnosis: Progress and challenges,” Clin. Chest Med., vol. 30, no. 4, pp. 701–16, Dec. 2009.
[7] C. C. Boehme, P. Nabeta, D. Hillemann, M. P. Nicol, S. Shenai,
F. Krapp, J. Allen, R. Tahirli, R. Blakemore, R. Rustomjee, A. Milovic,
M. Jones, S. M. O’Brien, D. H. Persing, S. Ruesch-Gerdes, E. Gotuzzo,
C. Rodrigues, D. Alland, and M. D. Perkins, “Rapid molecular detection
of tuberculosis and rifampin resistance,” New Engl. J. Med., vol. 363,
no. 11, pp. 1005–1015, Sep. 2010.
[8] D. Boyle and M. Pai, “Tuberculosis: Diagnostic technology landscape,”
UNITAID Secretariat, World Health Organization, Geneva, Switzerland,
Tech. Rep., Jul. 2012.
[9] K. Steingart, M. Henry, V. Ng, P. Hopewell, A. Ramsay, J. Cunningham,
R. Urbanczik, M. Perkins, M. Aziz, and M. Pai, “Fluorescence versus
conventional sputum smear microscopy for tuberculosis: A systematic
review,” Lancet Infect. Dis., vol. 6, no. 9, pp. 570–581, 2006.
[10] M. Pai, J. Minion, K. Steingart, and A. Ramsay, “New and improved
tuberculosis diagnostics: Evidence, policy, practice, and impact,” Curr.
Opin. Pulmon. Med., vol. 16, no. 3, pp. 271–284, May 2010.
[11] J. A. Robledo, G. I. Mejia, N. Morcillo, L. Chacon, M. Camacho, J. Luna,
J. Zurita, A. Bodon, M. Velasco, J. C. Palomino, A. Martin, and F. Portaels,
“Evaluation of a rapid culture method for tuberculosis diagnosis: A Latin
American multi-center study,” Int. J. Tuberc. Lung Dis., vol. 10, no. 6,
pp. 613–619, 2006.
[12] B. Yu, F. B. Dazzo, R. Srivatsa, T. Zhang, and A. K. Jain, “A computeraided system for image analysis of morphological diversity, abundance and
spatial distribution,” Department of Computer Science, Michigan State
University, East Lansing, MI, USA, Tech. Rep. MSU-CPS-97-24, Jul.
1997.
[13] K. Veropoulos, G. Learmonth, C. Campbell, B. Knight, and J. Simpson,
“The automated identification of tubercle bacilli in sputum: A preliminary
investigation,” Anal. Quantitat. Cytol. Histol., vol. 21, no. 4, pp. 277–281,
Aug. 1999.
[14] M. G. Forero, G. Cristobal, and M. Desco, “Automatic identification of
mycobacterium tuberculosis by Gaussian mixture models,” J. Microsc.,
vol. 223, no. 2, pp. 120–132, 2006.
[15] R. Khutlang, S. Krishnan, A. Whitelaw, and T. Douglas, “Automated
detection of tuberculosis in Ziehl-Neelsen-stained sputum smears using
two one-class classifiers,” J. Microsc., vol. 237, no. 1, pp. 96–102, 2010.
[16] R. Khutlang, S. Krishnan, R. Dendere, A. Whitelaw, K. Veropoulos,
G. Learmonth, and T. S. Douglas, “Classification of Mycobacterium tuberculosis in images of ZN-stained sputum smears,” IEEE Trans. Inf.
Technol. Biomed., vol. 14, no. 4, pp. 949–957, Jul. 2010.
[17] J. Chang, P. Arbeláez, N. Switz, C. Reber, A. Tapley, J. L. Davis,
A. Cattamanchi, D. Fletcher, and J. Malik, “Automated tuberculosis diagnosis using fluorescence images from a mobile microscope,” in Proc. Mid.
Image Comput. Comput.-Assisted Intervention Conf., Jan. 2012, vol. 15,
pp. 345–52.
[18] Treatment of Tuberculosis: Guidelines, 4th ed., World Health Organization, Geneva, Switzerland, 2009.
[19] H. L. Rieder and A. V. Deun, “Proposal for a revision of the
case definition of “sputum smear-positive tuberculosis”,” World Health

862

[20]

[21]

[22]
[23]
[24]
[25]
[26]
[27]
[28]
[29]
[30]
[31]

[32]
[33]

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 3, MAY 2014

Organization, Geneva, Switzerland, WHO Policy background document.
(2007). [Online]. Available: http://www.who.int/entity/tb/laboratory/
proposed_reduction_hravd.pdf
R. Santiago-Mozos, R. Fernández-Lorenzana, F. Pérez-Cruz, and A. ArtésRodrı́guez, “On the uncertainty in sequential hypothesis testing,” in Proc.
IEEE 5th Int. Symp. Biomed. Imag., Paris, France, May 14–17, 2008,
pp. 1123–1126.
R. Santiago-Mozos and A. Artés-Rodrı́guez, “Uncertainty-based censoring scheme in distributed detection using learning techniques,” in Proc.
Inf. Process. Manag. Uncert. Knowl.-Based Syst., Jul. 2006, pp. 2027–
2034.
J. F. Canny, “A computational approach to edge detection,” IEEE Trans.
Pattern Anal. Mach. Intell., vol. PAMI-8, no. 6, pp. 679–698, Nov. 1986.
F. Mindru, T. Tuytelaars, L. V. Gool, and T. Moons, “Moment invariants
for recognition under changing viewpoint and illumination,” Comput. Vis.
Image Understand., vol. 94, no. 1, pp. 3–27, 2004.
R. C. González and R. E. Woods, Digital Image Processing. Englewood
Cliffs, NJ, USA: Pearson Prentice-Hall, 2008.
S. C. Pei and C. N. Lin, “Image normalization for pattern recognition,”
Image Vis. Comput., vol. 13, no. 10, pp. 711–723, 1995.
B. E. Boser, I. M. Guyon, and V. N. Vapnik, “A training algorithm for optimal margin classifiers,” in Proc. 5th Annu. Workshop Comput. Learning
Theory, 1992, pp. 144–152.
B. Schölkopf and A. Smola, Learning With Kernels. Cambridge, MA,
USA: MIT Press, 2001.
E. L. Lehmann, Testing Statistical Hypotheses, 2nd ed. New York, NY,
USA: Springer-Verlag, 1997.
J. O. Berger, Statistical Decision Theory and Bayesian Analysis, 2nd ed.
New York, NY, USA: Springer-Verlag, 1985.
C. C. Chang and C. J. Lin. (2001). LIBSVM: A library for support vector machines, [Online]. Software Available: http://www.csie.ntu.edu.tw/
∼cjlin/libsvm
P. Viola and M. Jones, “Robust real-time object detection,” in Proc. 2nd
Int. Workshop Statist. Comput. Theory Vis.—Model., Learn., Comput.,
Sampl., (Jul. 2001). [Online]. Available: http://www.stat.ucla.edu/∼sczhu/
Workshops/sctv01/Viola_Jones.ps.gz
S. S. Keerthi, O. Chapelle, and D. DeCoste, “Building support vector
machines with reduced classifier complexity,” J. Mach. Learn. Res., vol. 7,
pp. 1493–1515, 2006.
R. Santiago-Mozos, M. G. Madden, F. Pérez-Cruz, and A. ArtésRodrı́guez. (2012). “On the screening of tuberculosis,” Universidad
Carlos III de Madrid, Tech. Rep., [Online]. Available: http://www.tsc.
uc3m.es/∼rsmozos/screening.pdf

Ricardo Santiago-Mozos (S’02–M’09) received the
Ph.D. degree in signal processing and communications from the Carlos III University of Madrid,
Getafe, Spain, in 2009.
He is a Postdoctoral Fellow of the Spanish Program for Recruitment and Incorporation of Human
Resources at the University Rey Juan Carlos of
Madrid, Fuenlabrada, Spain. He has been a Spanish
Foundation for Science and Technology Postdoctoral
Fellow at the Machine Learning and Data Mining
Group in National University of Ireland, Galway, Ireland, where he had also completed a Marie Curie Fellowship. His research
interests include machine learning, medical applications, genetic algorithms,
and communications, and he has coauthored more than 20 papers appearing in
refereed journals and conference proceedings. A detailed CV and list of publications can be accessed at http://www.tsc.uc3m.es/∼rsmozos.

Fernando Pérez-Cruz (SM’06) was born in Sevilla,
Spain, in 1973. He received the B.Sc./M.Sc. degree in
electrical engineering from the University of Sevilla,
Sevilla, Spain, in 1996, and the Ph.D. degree in electrical engineering from the Technical University of
Madrid, Madrid, Spain.
He is a Machine-Learning Scientist at Amazon and
an Associate Professor with the Department of Signal
Theory and Communication at University Carlos III
in Madrid, Madrid, Spain. He has been a Visiting Professor at Princeton University under the sponsorship
of a Marie–Curie Fellowship. He has held position at the Gatsby Unit (London), Max Planck Institute for Biological Cybernetics (Tuebingen), BioWulf
Technologies (New York), and the Technical University of Madrid and Alcalá
University (Madrid). His current research interests include machine learning and
information theory and its application to signal processing and communications.
He has authored more than 90 contributions to international journals and conferences. He has also coauthored a book in Digital Communications. A detailed
CV and list of publications can be accessed at http://www.tsc.uc3m.es/fernando.

Michael G. Madden received the Ph.D. degree in
mechanical engineering from the National University of Ireland (NUI), Galway, Ireland, in 1998.
He is a Senior Lecturer in the College of Engineering and Informatics in the NUI, which he joined
in 2000. In 2006–2007, he spent a year as a Visiting Research Scientist in the University of Helsinki,
the University of California Irvine, and the University of California Berkeley. He previously worked in
professional software R&D. He established and leads
the Machine Learning & Data Mining Group in NUI
(http://datamining.it.nuigalway.ie). His interdisciplinary research focuses on the
development of new machine learning methods (Bayesian, SVMs, and others)
and their application to scientific, medical and other domains, and includes contributions in theoretical algorithms and practical applications. He has published
more than 80 papers and has received seven publication awards. He has three
patent filings, and he cofounded a spin-out company, Analyze IQ Limited, based
on research that he led.

Antonio Artés-Rodrı́guez (S’89–M’93–SM’01)
was born in Alhama de Almerı́a, Spain, in 1963.
He received the Ingeniero de Telecomunicación and
Doctor Ingeniero de Telecomunicación degrees from
the Universidad Politécnica de Madrid, Madrid,
Spain, in 1988 and 1992, respectively.
He is a Professor in the Department of Signal Theory and Communications, Universidad Carlos III de
Madrid, Getafe, Spain. Prior to this, he has occupied
different teaching positions at Universidad de Vigo,
Universidad Politécnica de Madrid, and Universidad
de Alcalá, all of them in Spain. He has participated in more than 60 projects
and contracts and he has coauthored more than 40 journal papers and more than
100 international conference papers. His research interests include signal processing, learning, and information theory methods, and its application to sensor
networks, communications, and medical applications.

