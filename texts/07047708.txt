1918

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

On the Design and Implementation of a Highly
Accurate Pulse Predictor for Exercise Equipment
Steven Kay, Fellow, IEEE, Quan Ding‚àó , Member, IEEE, and Dongyang Li

Abstract‚ÄîGoal: This study aims to develop highly accurate
heart rate monitoring from the hand-held contact signal within
a noisy environment during exercise. Methods: The periodic pattern and uncertainties of a physiological signal are modeled by a
Laplacian random process. Based on this statistical model, a highly
accurate pulse predictor (HAPPEE) is derived and implemented in
real-time on a Cypress PSoC 5LP development board. A real-time
experiment is designed to compare HAPPEE with a commercial
heart rate monitor from POLAR. The percentage of credible estimates and the mean square error (MSE) of credible estimates are
reported for experiments with seven healthy subjects. Results: The
overall percentage of credible estimates is 99.2% for HAPPEE
and 93.6% for POLAR. The overall MSE of credible estimates
is 3.1 for HAPPEE and 7.7 for POLAR. These results show that
HAPPEE is more accurate than POLAR. Conclusion: HAPPEE is
able to accurately monitor heart rate within a noisy environment
during exercise. Significance: Unlike existing heart rate estimation methods, HAPPEE does not require pulse detection or tuning
parameters. It can be easily implemented in real-time on a low
power and low cost development board for exercise equipment and
outperforms a commercial heart rate monitor.
Index Terms‚ÄîExercise equipment, generalized likelihood ratio
test (GLRT), heart rate monitoring, maximum likelihood estimator
(MLE).

I. INTRODUCTION
HE heart rate provides certain information about a person‚Äôs
fitness level and health conditions. It is among the primary
four vital signs in physiology. A heart rate monitor takes continuous physiological signals such as the electrocardiogram (ECG)
as the input and outputs estimated heart rate in real-time. Since
the heart rate is defined as the inverse of the RR interval, many
efforts have been made on beat to beat QRS detection. Pan and
Tompkins proposed a real-time QRS detection algorithm using slope, amplitude, and width information [1]. Li et al. used
wavelet transforms to detect ECG characteristic points including QRS [2], and Bahoura et al. implemented the algorithm in
real-time [3]. Martƒ±ÃÅnez et al. generalized Li‚Äôs method based on
wavelet transforms and evaluated the performance on various
standard ECG databases [4]. Zong et al. developed an opensource QRS detection algorithm based on nonlinearly scaled
ECG curve length feature [5]. All these methods achieved accu-

T

Manuscript received July 17, 2014; revised October 14, 2014, January 8,
2015, and February 18, 2015; accepted February 21, 2015. Date of publication
February 24, 2015; date of current version July 15, 2015.
S. Kay and D. Li are with the Department of Electrical, Computer, and
Biomedical Engineering, University of Rhode Island.
* Q. Ding is with the Department of Physiological Nursing, University of
California, San Francisco, CA, USA (e-mail: Quan.Ding@nursing.ucsf.edu).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2015.2407155

racies of more than 99% on the MIT/BIH arrhythmia database
[6]. However, they still require a high quality ECG signal and
may not work well when noise and artifacts are significant, such
as muscle noise and electrode motion artifacts. Therefore, QRS
detection is still a challenging problem for poor quality signals,
and the recent Physionet Challenge 2014 [7] shows that it is
a problem still not solved. Although ECG is the most popular
signal for bedside heart rate monitoring, other physiological signals such as arterial blood pressure (ABP) and pulse oximetry
can be used as well. Similar to QRS detection, pulse detection
on these signals can be used for heart rate estimation. Zong et al.
developed an open-source ABP pulse onset detection algorithm
which used the slope sum function to enhance the upslope of
the ABP pulse and to suppress the remainder of the pressure
waveform [8]. Stetson proposed a two-layer fuzzy logic system
for heart rate estimation from the pulse oximetry signal [9].
Even though QRS or pulse detection is the most straightforward
method for heart rate monitoring, heart rate can also be estimated without it. For example, one can estimate the RR interval
by detecting the peak of the estimated autocorrelation sequence
(ACS) [10].
To people who exercise, heart rate monitoring is of great
importance, since it is the most convenient way to assess the exercise intensity [11]. Exercising without accurately monitoring
the intensity poses uncertainty, risk, and may lead to serious injuries or even death [12]. In this paper, we consider the problem
of heart rate monitoring from the hand-held contact signal for
exercise equipment. Even though many commercial devices are
available, they are known to be error prone when strong noise or
artifacts are caused by excessive body movement [13], [14]. We
propose a model based on a modulated random signal using the
Laplacian distribution and derive a highly accurate pulse predictor for exercise equipment (HAPPEE) algorithm (patent pending [15]). This model statistically quantifies the periodic pattern
of a physiological signal while not making any morphological
assumptions, which makes HAPPEE robust to departures from
the modeling assumptions. The HAPPEE algorithm does not require pulse detection or peak detection to estimate the heart rate,
which distinguishes it from existing heart rate monitoring methods for exercise equipment [16]‚Äì[18]. This property is important
for noisy environments when pulses can be corrupted by noise
and are impossible to visualize. Furthermore, HAPPEE does not
require tuning parameters while existing methods based on beat
detection all use prescribed thresholds [16]‚Äì[18]. We implement
HAPPEE on a Cypress PSoC 5LP development board, which
is centered about a low power and low cost chip. To evaluate
the performance of HAPPEE, we compare it with a commercial
heart rate monitor from POLAR. The ECG signal from lead II

0018-9294 ¬© 2015 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

KAY et al.: ON THE DESIGN AND IMPLEMENTATION OF A HIGHLY ACCURATE PULSE PREDICTOR FOR EXERCISE EQUIPMENT

1919

Note that we can choose 0 ‚â§ n0 ‚â§ P ‚àí 1 if we allow n0 < 0.
The limits for the pulse period P corresponds to a minimum
and maximum heart rate, typically 40 beats per minute (BPM)
to 220 BPM. The value of M , the pulse width, will be assumed
to be known and corresponds to a time duration of 0.1 s. This is
a typical value for QRS duration. Note that we have not made
any assumptions that would require us to ‚Äútrain‚Äù HAPPEE for
each person. It should be able to be used for a population of
individuals, without training or calibration.
Fig. 1.

Modeling assumptions for Laplacian variance.

B. Derivation
of a 12-lead ECG machine, Burdick E350, is also collected as a
high quality signal to estimate the true heart rate as a reference.
Results show that HAPPEE is more accurate than the POLAR
monitor.
The paper is organized as follows. We describe the model for
the sensed pulse using the hand-held sensors of typical exercise
equipment, derive the HAPPEE algorithm, and present a simulated example in Section II. The signal collection, preprocessing,
and analysis procedures are described in Section III. In Section
IV, we introduce several computational tricks which allow us
to implement HAPPEE on the PSoC 5LP development board in
real-time. Results of performance comparison of HAPPEE and
POLAR are presented in Section V, followed by discussion in
Section VI. Finally, Section VII draws some conclusions.
II. HAPPEE ALGORITHM

To derive the maximum likelihood estimator (MLE) of P ,
which is our goal, we must maximize the likelihood function
with respect to all unknown parameters. If we view the problem
as one of detection that a sequence of pulses are present versus
just a background level of variance œÉ12 , then the generalized
likelihood ratio (GLRT) will yield a good detection statistic as
well as the MLE [20]. This will have the advantage of not only
estimating the pulse rate but also of being able to determine
when there is inadequate discrimination for determining the
presence of a pulse. Such might be the case for poor data, such
as when a person is moving their hands excessively, etc.
The hypothesis test then becomes
H0 : œÉ22 = œÉ12 = œÉ 2
H1 : œÉ22 > œÉ12
and the GLRT statistic is

A. Modeling Assumptions
Let x[n] be the samples of a periodic pulse signal for 0 ‚â§ n ‚â§
N ‚àí 1. They are assumed to be zero mean random variables that
have a Laplacian probability density function (PDF), which is
 

2
1
exp ‚àí
|x|
‚àí‚àû<x<‚àû
pX (x) = ‚àö
œÉ2
2œÉ 2
where œÉ 2 can be shown to be the variance [19]. Furthermore,
all samples are assumed to be statistically independent. The
discriminating feature between the heart beat and the always
accompanying background muscle noise is the increased variance, i.e., power, of the heart beat and its assumed periodicity.
The time variation of the variance is shown in Fig. 1, along with
the definitions of the various parameters.
We will assume that œÉ22 > œÉ12 and that M < P . Note that the
time until the first pulse is at most P ‚àí M samples. Also, we will
ignore the possibility that n0 , the arrival time of the first pulse,
satisfies n0 < 0 since this will be an infrequent occurrence and
should not greatly affect the accuracy. Hence, we have that the
constraints on the unknown parameters {n0 , P, œÉ12 , œÉ22 } are as
follows:
0 ‚â§ n0 ‚â§ P ‚àí M ‚àí 1
Pm in ‚â§ P ‚â§ Pm ax
œÉ22 > œÉ12 > 0.

T =

pX (x; nÃÇ0 , PÃÇ , œÉÀÜ12 , œÉÀÜ22 )
.
pX (x; œÉÀÜ2 )

(1)

Let S1 , S2 be the sets of samples whose variances are œÉ12 and
œÉ22 , respectively, and |S1 |, |S2 | be the number of samples. This
will of course depend on P . Then, the PDF under H0 is
pX (x; œÉ 2 ) =

N
‚àí1


pX (x[n]; œÉ 2 )

n =0
N
‚àí1


 

1


2
|x[n]|
œÉ2

‚àö
exp ‚àí
2œÉ 2
  N ‚àí1

2 
1
exp ‚àí
|x[n]| . (2)
=
œÉ 2 n =0
(2œÉ 2 )N /2
=

n =0

Maximizing this with respect to œÉ 2 by taking the derivative and
setting it equal to zero produces

œÉÀÜ2 = 2

2
N ‚àí1
1 
|x[n]|
N n =0

(3)

and substituting into the PDF of (2) produces
pX (x; œÉÀÜ2 ) =

1
(2œÉÀÜ2 )N /2

exp(‚àíN ).

(4)

1920

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

Next, under H1 we have the PDF
pX (x; n0 , P, œÉ12 , œÉ22 ) =
|S 2 |





i=1

 

1
2œÉ22

exp ‚àí

|S 1 |




i=1

 

1
2œÉ12

exp ‚àí



2
|x1 [i]|
œÉ12


2
|x2 [i]|
œÉ22

where x1 [i], x2 [i] are the samples corresponding to the interpulses and pulses, respectively. For a given P and n0 we have
given S1 and S2 sets of samples. Hence, for a fixed n0 and P
we can maximize the likelihood function over œÉ12 and œÉ22 . As
before this yields the estimates

2

2


1
1
œÉÀÜ12 = 2
|x1 [i]| , œÉÀÜ22 = 2
|x2 [i]| (5)
|S1 |
|S2 |
i‚ààS 1

i‚ààS 2

and when substituted back into the likelihood function yields
pX (x; n0 , P, œÉÀÜ12 , œÉÀÜ22 )
=
=

1
1
exp(‚àí|S1 |)
exp(‚àí|S2 |)
ÀÜ
ÀÜ
2
2
|S
|/2
1
(2œÉ1 )
(2œÉ2 )|S 2 |/2
1
|S 1 |/2
|S 2 |/2
2N /2 œÉÀÜ12
œÉÀÜ22

exp(‚àíN )

(6)

(œÉÀÜ2 )N /2
.
(œÉÀÜ2 )|S 1 |/2 (œÉÀÜ2 )|S 2 |/2
1

(7)

2

We have added arguments to T to indicate its dependence on n0
and P . Note that T (n0 , P ) > 1 since the numerator in (1) is an
unconstrained maximization, while in the denominator we can
view it as a constrained maximization since œÉ12 = œÉ22 . Also, it
was assumed that œÉ22 > œÉ12 and therefore (5) is correct as long
as œÉÀÜ22 > œÉÀÜ12 . If this is not the case, the MLE of œÉ22 becomes
œÉÀÜ22 = œÉÀÜ12 for whatever value œÉÀÜ12 takes on. Then, we have that
T (n0 , P ) = 1, and will indicate a problem condition.
Also, note that the test statistic T (n0 , P ) has the useful property of scale invariance, in that any scaling of the data will not
change the value of T (n0 , P ). Finally, we have that the GLRT
is given as
T (nÀÜ0 , PÃÇ ) =

=

pX (x; nÃÇ0 , PÃÇ , œÉÀÜ12 , œÉÀÜ22 )
pX (x; œÉÀÜ2 )
max

0 ‚â§n 0 ‚â§P ‚àíM ‚àí1
P m i n ‚â§P ‚â§P m a x

(œÉÀÜ2 )N /2
(œÉÀÜ2 )|S 1 |/2 (œÉÀÜ2 )|S 2 |/2
1

(8)

2

where the maximization is done over all possible values of n0
and P . It is more convenient for computational and theoretical
purposes to use the statistic
	
N log œÉÀÜ2
T  (nÀÜ0 , PÃÇ ) = 2 ln T (nÀÜ0 , PÃÇ ) =
max
0 ‚â§n 0 ‚â§P ‚àíM ‚àí1
P m i n ‚â§P ‚â§P m a x



‚àí |S1 | log œÉÀÜ12 ‚àí |S2 | log œÉÀÜ22 u(œÉÀÜ22 ‚àí œÉÀÜ12 )

C. Simulated Example
In the simulation to follow we have chosen the following
parameter values: Fs = 500 samples/sec, M = 50, 136 ‚â§ P ‚â§
750 (corresponds to BPM in the range [40, 220]), 0 ‚â§ n0 ‚â§ 699
(the maximum value of n0 corresponds to minimum heart rate),
N = 1500 (3 s of data). The true values of the parameters are
P = 333 (BPM = 90), n0 = 100, œÉ12 = 1, œÉ22 = 4. Note that
with values the test statistic at its maximum can be found as
follows. First note that
 N ‚àí1
2

1
|x[n]|
œÉÀÜ2 = 2
N n =0


since for any S1 and S2 we have |S1 | + |S2 | = N . Substituting
(4) and (6) back into (1) produces
T (n0 , P ) =

where u(¬∑) denotes the unit step function. This requires a twodimensional search. The term œÉÀÜ2 , however, needs only be computed once. Note that HAPPEE does not require tuning parameters since the maximization in (9) does not.
It is conceivable that if necessary the computation can be reduced by searching over less samples of n0 and P in {n0 , P :
0 ‚â§ n0 ‚â§ P ‚àí M ‚àí 1, Pm in ‚â§ P ‚â§ Pm ax } or by some computational tricks.

(9)

= 2

= 2

= 2

1
N
1
N





|S1 |
N



|x1 [i]| +

i‚ààS 1



2

|x2 [i]|

i‚ààS 2

2


|S1 | œÉÀÜ12 /2 + |S2 | œÉÀÜ22 /2



|S2 |
œÉÀÜ12 /2 +
N



œÉÀÜ22 /2

2
.

Assuming perfect estimates, it can be shown that |S1 | = 1300,
|S2 | = 200 and, therefore, we should have

2
1300 
200 
1/2 +
4/2 = 1.28.
œÉÀÜ2 = 2
1500
1500
Next inserting this into (9) produces
T  (100, 333) = 1500 log(1.2844)
‚àí 1300 log(1) ‚àí 200 log(4) = 98.17.

(10)

A threshold can be set depending upon the value of this statistic
since when there are no pulses, its value will be zero, but positive
otherwise. Also, possibly the asymptotic theoretical results for
a GLRT under H0 might be used to establish a threshold [20].
Continuing with the simulation description, to generate a sequence of independent Laplacian random variable outcomes we
use the approach described in [19]. A realization of the Laplacian random process is shown in Fig. 2. From the figure it is clear
that by inspection it would be exceedingly difficult to detect any
heart beats. In Fig. 3 we display the test statistic T  (n0 , P ) versus n0 and P . It can be seen that there are several peaks. In
Fig. 4 we display the same test statistic but when maximized
over n0 or we have T  (nÃÇ0 , P ), which allows one to determine
visually the peaks versus pulse period.
The estimate of the pulse period is PÃÇ = 332 for an estimated
heart rate of 90.36 BPM (true BPM is 90). However, there are

KAY et al.: ON THE DESIGN AND IMPLEMENTATION OF A HIGHLY ACCURATE PULSE PREDICTOR FOR EXERCISE EQUIPMENT

Fig. 2. Realization of Laplacian random process with pulse period of P = 333
samples and starting time at n 0 = 100.

Fig. 3. Test statistic for data with pulse period of P = 333 samples and
starting at n 0 = 100.

also local maxima at P = 166 497 659 corresponding to half,
one and a half, and twice the pulse period, respectively. A color
plot of the two-dimensional statistic is shown in Fig. 5. If the
local maximum became the global maximum through statistical
error, then the estimator would ‚Äúpick up‚Äù the true pulses but
could possibly also add in some samples for which there is no
pulse or ignore some samples for which there is a pulse. So far,
this condition has not been observed. The actual values of the
estimated variances and other parameters at the maximum of
the test statistic were
nÃÇ0 = 102

PÃÇ = 332

œÉÀÜ2 = 1.38

œÉÀÜ12 = 1.01

œÉÀÜ22 = 4.06

and the value of the test statistic at its maximum is 116.18, not
far from the value obtained for errorless estimates of 98.17 as
given by (10).

1921

Fig. 4. Test statistic for data with pulse period of P = 333 samples and
starting at n 0 = 100 but maximized over n 0 for each assumed P .

Fig. 5. Test statistic for data with pulse period of P = 333 samples and
starting at n 0 = 100.

III. SIGNAL COLLECTION, PREPROCESSING, AND ANALYSIS
In order to design and test heart rate estimators we need to
record signals from real subjects. In this study, we collect contact
signals from hand-held electrodes in a high-end elliptical, Precor 576i, that represents what is commonly available in fitness
centers. This device comes with a built in commercial heart rate
estimator from POLAR, whose performance will be compared
with that of HAPPEE. The elliptical uses hand-held electrodes
to measure the voltage being induced across the limbs of the
body by heartbeats. The signal is carried from the electrodes to
the POLAR board, whose analog front end differentially amplifies the signal to create a single ended voltage. The POLAR
board then produces and outputs a heart rate estimate to the main
board of the elliptical which displays the estimate to the user.
We collect the signal after the analog front end of the POLAR

1922

Fig. 6.

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

Example of raw hand-held contact signal and lead II ECG signal.

board, using an analog-to-digital converter (ADC) with a sampling rate of 360 Hz. This implies that the HAPPEE algorithm
uses exactly the same input signal for heart rate estimation as
POLAR does.
Since a reference heart rate is needed to compare the performance of HAPPEE and the POLAR heart rate monitor, we
also collect the ECG signal simultaneously from a 12-lead ECG
machine, Burdick E350. The ECG machine has an option to
output ECG signals as analog voltages between 0 and 5 V. We
collect the signal from lead II, and use the heart rate estimated
from the ECG signal as the true heart rate. The sampling rate of
the ADC is also 360 Hz.
Examples of the hand-held contact signal and the lead II ECG
signal are plotted in Fig. 6. It is observed that both signals are
corrupted by baseline wonder and high frequency noise. Therefore, a band-pass filter is needed to preprocess the raw signal.
A 75th order finite impulse response (FIR) band-pass filter with
cutoff frequencies of 9 and 39 Hz is selected in our study. Such
a band-pass filter is commonly used for preprocessing an ECG
signal [21]. The resulting band-pass filtered signals are shown
in Fig. 7. Note that the band-pass filtered signals in Fig. 7 are
shifted back by 38 samples to make them synchronized to the
raw signals in Fig. 6 because an N th order FIR filter introduces
a delay of N/2 samples. It is observed that the filtered hand-held
contact signal is still much noisier than the filtered lead II ECG
signal. This is because the contact between the hands and electrodes are of poor quality compared to clinical use of adhesive
electrodes with conductive gel on prepared skin. This ultimately
leads to a lower signal-to-noise ratio for the hand-held contact
signal.
The filtered signals are then divided into overlapped processing windows and the heart rate is estimated from each window.
Note that we need to observe at least two pulses or R peaks
within the window to determine the pulse period P or the RR
interval. For a minimum heart rate of 40 BPM, the window

Fig. 7. Example of band-pass filtered hand-held contact signal and lead II
ECG signal.

Fig. 8. Framework of the signal collection, preprocessing, and analysis procedures.

length is selected to be 3 s and it can be easily shown that this is
the minimum window length to guarantee two observed pulses.
The processing windows are overlapped by 75% so that the
window increment is 0.75 s, which implies that the heart rate is
updated every 0.75 s.
The HAPPEE algorithm is used for the hand-held contact signal processing windows to estimate the heart rate. Since the lead
II ECG signal has a high signal-to-noise ratio, the true heart rate
can be accurately estimated from the lead II ECG signal using
state-of-the-art methods. The autocorrelation method is shown
to be effective for heart rate estimation [10] and, therefore, is
used for the ECG signal processing windows. It first calculates the ACS by taking the inverse Fourier transform of the
periodogram of the signal, and then estimates the RR interval
in samples corresponding to the index of the maximum of the
ACS. The framework of the signal collection, preprocessing,
and analysis procedures is illustrated in Fig. 8.
IV. REDUCED HAPPEE
For real-time implementation, the execution time of preprocessing and HAPPEE should be less than the window increment,
which is 0.75 s. The original implementation of HAPPEE takes

KAY et al.: ON THE DESIGN AND IMPLEMENTATION OF A HIGHLY ACCURATE PULSE PREDICTOR FOR EXERCISE EQUIPMENT

about 30 s to run on the PSoC 5LP development board because it
is low power, and therefore, we need to reduce computations in
HAPPEE to implement it in real-time. We introduce the reduced
HAPPEE with the following computational tricks.
1) Instead of searching over all the samples of P in {P :
Pm in ‚â§ P ‚â§ Pm ax }, we search over a nonuniform grid of
P with much less samples. Since most heart rate monitors
will display the heart rate in BPM in integer format, the
nonuniform grid can be generated by


60Fs
P = round
(11)
hr
where hr is the heart rate in BPM on a uniform grid of
integers in [hrm in , hrm ax ]. For example, if the heart rate
is assumed to be within [40, 220] BPM, then P ranges
from 98 to 540 with a sampling rate of Fs = 360 samples/sec. For the reduced HAPPEE, we only need to search
over 220 ‚àí 40 + 1 = 181 samples of P , while the original HAPPEE searches over 540 ‚àí 98 + 1 = 443 samples
of P .
2) HAPPEE requires many logarithm calculations and the
logarithm is computationally intensive. We reduce the
computations of logarithm by using a logarithm lookup
table. For example, we generate a logarithm lookup table LT (x) of 256 values over the range of [0, 255] where
LT (0) is set to zero. The following pseudo code explains
how to calculate ln(x) for any x > 0.
Pseudo code to calculate ln(x) for any x > 0 using the
lookup table.
Round x to its nearest integer.
Let result= 0.
while x > 255 do
result = result+LT (255)
x = round(x/255)
end while
return result
Note that computations are reduced at a cost of performance
loss. Thus, we want to evaluate the performance loss by comparing the mean square error (MSE) of the original HAPPEE
and the reduced one. Since what we are interested in is the heart
rate in BPM, the MSE is defined as


ÀÜ ‚àí hr)2
MSEHAPPEE = E (hr
60F s
s
ÀÜ
where hr = 60F
is the
P true is the true heart rate, and hr = PÃÇ
HAPPEE heart rate. Simulation results show that for Ptrue =
351, n0 = 70, we have

MSEoriginal HAPPEE = 0.01, MSEreduced HAPPEE = 0.27.
For Ptrue = 200, n0 = 100, we have
MSEoriginal HAPPEE = 0.29, MSEreduced HAPPEE = 1.19.
Furthermore, we have recorded ECG signal and the hand-held
contact signal simultaneously for 5 minutes from two male sub-

1923

jects during different workout intensities. Both original and reduced HAPPEEs are implemented on the contact signal and
their MSEs are
MSEoriginal HAPPEE = 0.25, MSEreduced HAPPEE = 0.91
where the true heart rate was based on ECG signal annotations
by a human expert. These results imply that the performance
degradation of the reduced HAPPEE is negligible for exercise
heart rate monitor.
After implementing the reduced HAPPEE, the execution time
is reduced to 0.6 s. Since the window increment is 0.75 s, the reduced HAPPEE allows real-time implementation. Note that the
execution time of the FIR band-pass filter is negligible as compared to that of reduced HAPPEE, because the computational
complexity of an FIR filter is much lower.
V. RESULTS
In this section, we will compare the performance of HAPPEE
and POLAR and discusses the results. Since the POLAR algorithm is unknown, a theoretical comparison is impossible. In
this application the data often deviates significantly from the
model and we are interested in how robust each estimator is to
these deviations. To this end, we have gathered real data from
seven males with ages ranging from mid-twenties to early sixties
during various workout intensities for 165‚Äì220 s.
When deriving HAPPEE, our assumption is that the people
using the exercise equipment have no significant abnormalities.
Certain abnormalities would significantly violate the data model
we use but very little could be gained by accommodating them.
This is due to the low occurrence of abnormalities as well as their
unpredictability. The seven subjects were all healthy individuals
with no known heart abnormalities. Upon visual inspection of
certain sections of the truth data no arrhythmia was observed.
As such, our algorithm has not been tested against patients with
an arrhythmia.
The actual utility of an estimate to someone exercising is
dependent upon the accuracy of the estimate. For an analysis of
the performance of heart beat period estimators we have found
it necessary to separate estimates into two categories. The first
are credible estimates that are ‚Äúclose enough‚Äù to the true period.
The second are outliers which are so far from the true period that
they are of no use to someone using the equipment. To discern
between a credible estimate and an outlier, we have chosen to
define a credible estimate as having a period estimate within
20 samples of the true period [22]. This choice was guided by
the accuracy obtainable from both the POLAR and HAPPEE
estimators. Fig. 9 demonstrates this region.
The majority of outliers are a result of choosing the wrong
peak instead of an error in estimating the maximum of the correct
peak. Estimating the period of a signal typically results in a
test statistic with multiple peaks. This is because there is often
ambiguity between integer multiples (also known as harmonics)
of the period. If the correct peak is higher, the additive noise
only locally affects the period estimate. This is the case in Fig. 4.
In particularly noisy data a harmonic can become dominant, and
this is when we produce an outlier by choosing the wrong peak.

1924

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

TABLE I
PERFORMANCE COMPARISON OF HAPPEE AND POLAR
Percentage of
Credible Estimates

Subject 1
Subject 2
Subject 3
Subject 4
Subject 5
Subject 6
Subject 7
Overall

Fig. 9.

HAPPEE
99.3%
98.7%
99.6%
99.2%
99.2%
99.1%
99.4%
99.2%

POLAR
96.4%
92.8%
94.6%
94.0%
91.3%
93.7%
92.1%
93.6%

MSE of
Credible Estimates
HAPPEE
3.1
3.4
2.9
3.2
3.1
3.2
3.0
3.1

POLAR
7.8
7.9
8.0
7.6
7.4
7.7
7.4
7.7

Definition of credible estimates.

This would occur if noise and artifacts caused the peak in Fig. 4
at P = 659 to exceed that at P = 332.
Next we describe the metrics based on credible estimates
which together summarizes the performance of a heart rate estimator [22].
1) Percentage of Credible Estimates. We have defined a
credible estimate as a period estimation with an error less
than 20 samples. The percentage of credible estimates
is simply the number of credible estimates produced by
an estimator divided by the total number of estimates
produced. The concept is to determine what percentage of
the time a user can expect to receive credible estimates.
2) MSE of Credible Estimates. In our application we have
determined that outliers are useless. In this vein we will
only therefore consider the MSE of the credible estimates.
The MSE of credible estimates is defined as
K
2
1 
PÃÇk ‚àí Pk
(12)
MSE =
K
k =1

where PÃÇk is the kth estimated period, Pk is the kth true
period, and K is the number of credible estimates.
To validate that the autocorrelation method produces a reliable estimate of the true heart rate, the QRS positions of the
ECG signals from the seven subjects have been manually annotated by domain experts. The true heart rate for each processing
window is derived from the average RR interval from this window. The heart rate produced by the autocorrelation method is
compared with the true heart rate and the percentage of credible
estimates is 100% while the MSE of credible estimates is 0.3.
Therefore, the results show that the autocorrelation method can
be used to generate the true heart rate in real time.
The results of HAPPEE and POLAR are shown in Table I. We
can see that HAPPEE outperforms POLAR in both percentage
of credible estimates and MSE of credible estimates. We also
plot HAPPEE, POLAR, and true heart rates for each individual
in Fig. 10. It is observed that POLAR has an obvious delay as the

Fig. 10. Plots of HAPPEE, POLAR and the true heart rates (a) Subject 1 (b)
Subject 2 (c) Subject 3 (d) Subject 4 (e) Subject 5 (f) Subject 6 (g) Subject 7.

KAY et al.: ON THE DESIGN AND IMPLEMENTATION OF A HIGHLY ACCURATE PULSE PREDICTOR FOR EXERCISE EQUIPMENT

heart rate is changing fast while HAPPEE is able to accurately
track the heart rate.
VI. DISCUSSION
We have studied the problem of heart rate estimation for
exercise equipment and proposed a statistical model for physiological signals with a periodic pattern. The model does not
make any assumptions on the morphology of the signal. Based
on the model, we have derived the HAPPEE algorithm. Even
though HAPPEE is computationally expensive, we have shown
that we can reduce the computation at the cost of a negligible
performance loss, which allows HAPPEE to be implemented
in a low power and low cost Cypress PSoC 5LP development
board in real time. Experiments show that HAPPEE is robust
to a departure from modeling assumptions and outperforms the
POLAR commercial heart rate monitor in terms of percentage
of credible estimates and MSE of credible estimates. This is
because POLAR is only able ‚Äúto track‚Äù a changing heart rate
with a substantial lag, since it needs to wait for more data for
smoothing the heart rate estimates.
In our framework, a band-pass filter is necessary for preprocessing the signal. This is because the raw signal always contains low-frequency baseline wonder and high-frequency noise.
In fact, signals are band-pass filtered in existing QRS detection algorithms, either explicitly or implicitly. For example, a
band-pass filter is designed in [1] to preprocess the signal. In
References [2]‚Äì[4], there are no band-pass filters, but the detectors are based on different scales of the wavelet transform, which
correspond to different bandwidths. Therefore, these approaches
still have an implicit band-pass filtering mechanism. The QRS
detector in [5] uses a low-pass filter because its nonlinearly
scaled curve length transformation will substantially suppress
low frequency components. In our design, an FIR band-pass filter is used because it only requires the calculation of a weighted
sum, whose computational complexity is low for real-time
implementation.
There are some limitations of our study. Since we focus on the
problem of heart rate monitoring for exercise equipment, only
healthy subjects are recruited in our experiments. Experiments
of patients with arrhythmia are required to assess the performance of HAPPEE in the presence of an arrhythmia. Furthermore, HAPPEE is only compared with a POLAR commercial
heart rate monitor to test its performance. There may be other
exercise heart rate monitors that outperform POLAR. Finally,
HAPPEE is only tested on seven subjects. In these experiments,
we have not observed the situations when POLAR produced a
doubled or halved heart rate. It would be meaningful if such
situations could be recorded and a closer look into the signal
could provide more insights for the comparison of HAPPEE and
POLAR.
VII. CONCLUSION
This papers considers the problem of heart rate estimation
within a noisy environment during exercise. We propose a statistical model based on the Laplacian distribution to quantify
the periodic pattern of a physiological signal without making

1925

any assumptions on the morphology of the signal. The derived
HAPPEE algorithm does not rely on pulse detection or tuning
parameters and is implemented on a Cypress PSoC 5LP development board. Several computational tricks are introduced for
real-time implementation of HAPPEE on the low power board.
Performance comparison of HAPPEE and a commercial heart
rate monitor shows that HAPPEE is more accurate in terms of
the percentage of credible estimates and the MSE of credible
estimates.

REFERENCES
[1] J. Pan and W. J. Tompkins, ‚ÄúA real-time QRS detection algorithm,‚Äù IEEE
Trans. Biomed. Engineering, vol. 32, no. 3, pp. 230‚Äì236, Mar. 1985.
[2] C. Li et al., ‚ÄúDetection of ECG characteristic points using wavelet transforms,‚Äù IEEE Trans. Biomed. Eng., vol. 42, no. 1, pp. 21‚Äì28, Jan. 1995.
[3] M. Bahoura et al., ‚ÄúDSP implementation of wavelet transform for real time
ECG wave forms detection and heart rate analysis,‚Äù Comput. Methods
Programs Biomed., vol. 52, no. 1, pp. 35‚Äì44, 1997.
[4] J. P. Martƒ±ÃÅnez et al., ‚ÄúA wavelet-based ECG delineator: Evaluation
on standard databases,‚Äù IEEE Trans. Biomed. Eng., vol. 51, no. 4,
pp. 570‚Äì581, Apr. 2004.
[5] W. Zong et al., ‚ÄúA robust open-source algorithm to detect onset and
duration of QRS complexes,‚Äù in Proc. IEEE Comput. Cardiol., 2003,
pp. 737‚Äì740.
[6] A. L. Goldberger et al., ‚ÄúPhysiobank, physiotoolkit, and physionet components of a new research resource for complex physiologic signals,‚Äù
Circulation, vol. 101, no. 23, pp. e215‚Äìe220, 2000.
[7] (2014). Robust detection of heart Beats in multimodal data: The physioNet/computing in cardiology challenge 2014. [Online]. Available:
http://physionet.org/challenge/2014/
[8] W. Zong et al., ‚ÄúAn open-source algorithm to detect onset of arterial blood
pressure pulses,‚Äù in Proc. Comput. Cardiol., 2003, pp. 259‚Äì262.
[9] P. F. Stetson, ‚ÄúDetermining heart rate from noisy pulse oximeter signals
using fuzzy logic,‚Äù in Proc. 12th IEEE Int. Conf. Fuzzy Syst., 2003, vol.
2, pp. 1053‚Äì1058.
[10] J. ParaÃÅk and J. Havlƒ±ÃÅk, ‚ÄúECG signal processing and heart rate frequency
detection methods,‚Äù Proc. Tech. Comput., p. 2011, vol. 8, 2011.
[11] J. Karvonen and T. Vuorimaa, ‚ÄúHeart rate and exercise intensity during
sports activities,‚Äù Sports Med., vol. 5, no. 5, pp. 303‚Äì311, 1988.
[12] R. S. Paffenbarger et al., ‚ÄúPhysical activity as an index of heart attack
risk in college alumni,‚Äù Amer. J. Epidemiol., vol. 108, no. 3, pp. 161‚Äì175,
1978.
[13] C. M. Lee and M. Gorelick, ‚ÄúValidity of the Smarthealth watch to measure
heart rate during rest and exercise,‚Äù Meas. Phys. Educ. Exercise Sci.,
vol. 15, no. 1, pp. 18‚Äì25, 2011.
[14] M. Lee and A. Mendoza, ‚ÄúAccuracy of handgrip sensors to measure heart
rate during rest and exercise,‚Äù J. Phys. Activity, Sports Exercise, vol. 1,
no. 1, pp. 49‚Äì55, 2013.
[15] S. Kay, ‚ÄúHighly accurate pulse predictor for exercise equipment
(HAPPEE),‚Äù US Patent 14/136,459 (pending).
[16] Method and apparatus for measuring heart rate, by M. Hannula. (2003, Jun. 24), US Patent 6 584 344. [Online]. Available:
http://www.google.com/patents/US6584344
[17] EKG based heart rate monitor with digital filter and enhancement signal
processor, by T. Lo and Y. Tsai. (1999, Mar. 2) US Patent 5 876 350.
[Online]. Available: http://www.google.com/patents/US5876350
[18] EKG based heart rate monitor, by T. Lo and Y. Tsai. (1998, Apr.
14) US Patent 5 738 104. [Online]. Available: http://www.google.
com/patents/US5738104
[19] S. Kay, Intuitive Probability and Random Processes using MATLAB. New
York, NY, USA: Springer, 2006.
[20] S. Kay, Fundamentals of Statistical Signal Processing: Detection Theory.
Englewood Cliffs, NJ, USA: Prentice-Hall, 1998.
[21] J. Van Alste and T. Schilder, ‚ÄúRemoval of base-line wander and powerline interference from the ECG by an efficient FIR filter with a reduced number of taps,‚Äù IEEE Trans. Biomed. Eng., vol. BME-32, no. 12,
pp. 1052‚Äì1060, Dec. 1985.
[22] A. P. O‚ÄôShea, ‚ÄúHighly accurate pulse prediction for exercise equipment,‚Äù
Master‚Äôs thesis, Dept. Comput. Biomed. Eng., Univ. Rhode Island, RI,
USA, 2011.

1926

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

Steven Kay (F‚Äô89) was born in Newark, NJ, USA, on
April 5, 1951. He received the B.E. degree from the
Stevens Institute of Technology, Hoboken, NJ, USA,
in 1972, the M.S. degree from Columbia University,
New York, NY, USA, in 1973, and the Ph.D. degree
from the Georgia Institute of Technology, Atlanta,
GA, USA, in 1980, all in Electrical Engineering.
From 1972 to 1975, he was with Bell Laboratories, Holmdel, NJ, USA, where he was involved
with transmission planning for speech communications and simulation and subjective testing of speech
processing algorithms. From 1975 to 1977, he attended the Georgia Institute of
Technology to study communication theory and digital signal processing. From
1977 to 1980, he was with the Submarine Signal Division, Portsmouth, RI, USA,
where he was engaged in research on autoregressive spectral estimation and the
design of sonar systems. He is currently a Professor of Electrical Engineering at
the University of Rhode Island, Kingston, USA, and a Consultant to numerous
industrial concerns, the Air Force, the Army, and the Navy. As a Leading Expert
in statistical signal processing, he has been invited to teach short courses to scientists and engineers at government laboratories, including NASA and the CIA.
He has written numerous journal and conference papers and is a contributor to
several edited books. He is the author of the textbooks Modern Spectral Estimation (Prentice-Hall, 1988), Fundamentals of Statistical Signal Processing,
Vol. I: Estimation Theory (Prentice-Hall, 1993), Fundamentals of Statistical
Signal Processing, Vol. II: Detection Theory (Prentice-Hall, 1998), and Intuitive Probability and Random Processes using MATLAB (Springer, 2005). His
current interests include spectrum analysis, detection and estimation theory, and
statistical signal processing.
Dr. Kay is a Member of Tau Beta Pi and Sigma Xi. He has been a Distinguished Lecturer for the IEEE signal processing society. He has been an
Associate Editor for the IEEE Signal Processing Letters and the IEEE TRANSACTIONS ON SIGNAL PROCESSING. He has received the IEEE signal processing
society education award ‚Äúfor outstanding contributions in education and in writing scholarly books and texts...‚Äù He has recently been included on a list of the
250 most cited researchers in the world in engineering.

Quan Ding (M‚Äô11) received the B.S. degree from
Shanghai Jiao Tong University, Shanghai, China, in
2006, the M.S. and Ph.D. degrees from the University of Rhode Island, Kingston, RI, USA, in 2008
and 2011, respectively, all in Electrical Engineering.
Since 2011, he has been a Postdoctoral Research
Associate at the University of Rhode Island, and a
Research Associate at Harvard Medical School. He
is currently a Postdoctoral Scholar at the University
of California, San Francisco, USA. He has been an
Associate Editor for the IEEE Signal Processing eNewsletter since July 2014.
His primary research interests include statistical signal processing, detection and
estimation theory, machine learning, biomedical signal processing, and physiological/clinical data mining.

Dongyang Li received the B.S. and M.S. degrees in
electrical engineering from the Beijing University of
Technology, Beijing, China, in 2008 and 2012, respectively. He has been working toward the Ph.D.
degree in Electrical Engineering at the University of
Rhode Island, RI, USA.
His primary research interests include embedded
system, high performance storage system, and computer architecture.

