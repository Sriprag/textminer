1728

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 7, JULY 2015

Photoacoustic-Based-Close-Loop Temperature
Control for Nanoparticle Hyperthermia
Feng Xiaohua, Gao Fei, Member, IEEE, and Zheng Yuanjin∗ , Member, IEEE

Abstract—Goal: Hyperthermia therapy requires tight temperature control to achieve selective killing of cancerous tissue with minimal damage on surrounding healthy tissues. Methods: To this end,
accurate temperature monitoring and subsequent heating control
are critical. However, an economic, portable, and real-time temperature control solution is currently lacking. To bridge this gap, we
present a novel portable close-loop system for hyperthermia temperature control, in which photoacoustic technique is proposed for
noninvasive real-time temperature measurement. Exploiting the
high sensitivity of photoacoustics, the temperature is monitored
with an accuracy of around 0.18 °C and then fed back to a controller implemented on field programmable gate array (FPGA) for
temperature control. Dubbed as portable hyperthermia feedback
controller (pHFC), it stabilizes the temperature at preset values by
regulating the hyperthermia power with a proportional-integralderivative (PID) algorithm; and to facilitate digital implementation, the pHFC further converts the PID output into switching
values (0 and 1) with the pulse width modulation (PWM) algorithm.
Results: Proof-of-concept hyperthermia experiments demonstrate
that the pHFC system is able to bring the temperature from baseline to predetermined value with an accuracy of 0.3° and a negligible temperature overshoot. Conclusion: The pHFC can potentially
be translated to clinical applications with customized hyperthermia system design. Significance: This paper can facilitate future
efforts in seamless integration of close-loop temperature control
solution and various clinical hyperthermia systems.
Index Terms—Feedback system, hyperthermia, magnetic
nanoparticles, photoacoustic (PA), temperature control, thermoacoustic.

I. INTRODUCTION
HERE are tremendous interests in applying hyperthermia
therapy with magnetic nanoparticles for cancer treatment
[1]–[4]. In this method, magnetic nanoparticles are introduced
to tumor and then heated under an external alternating magnetic
field. Such heating of magnetic nanoparticles raises the temperature of tumor beyond 42 °C and causes apoptosis of targeted
cancer cells, achieving thus therapeutic effects. However, due to
heat diffusion, healthy surrounding tissue could also get damaged under excessive tumor heating during therapy, which can

T

Manuscript received September 17, 2014; revised December 29, 2014;
accepted January 20, 2015. Date of publication February 13, 2015; date
of current version June 16, 2015. This work was supported by the Singapore National Research Foundation under Exploratory/Developmental Grant
(NMRC/EDG/1062/2012) and administered by the Singapore Ministry of
Health’s National Medical Research Council. Asterisk indicates corresponding author.
∗ Z. Yuanjin is with the School of Electrical and Electronic Engineering,
Nanyang Technological University, 6973628, Singapore (e-mail: yjzheng@
ntu.edu.sg).
F. Xiaohua and G. Fei are with the School of Electrical and Electronic Engineering, Nanyang Technological University.
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2015.2403276

lead to serious complications for patients. To circumvent such
side effects, the tumor therapy temperature needs be tightly controlled. This requires both accurate temperature measurement
and subsequent automatic control of hyperthermia heating.
The first task is temperature measurement. Although plenty
of techniques exist, it is still challenging to achieve accurate
temperature measurement at depths economically and noninvasively. Tiny thermometer is accurate [5], [6] and economical,
but its invasiveness limits its practical usages in clinical settings.
Ultrasound method, though portable and noninvasive, provides
limited accuracy due to its weak temperature sensitivity [7], [8]
or requires sophisticated imaging procedures [9] to boost the
accuracy. Magnetic resonance imaging (MRI) can give accurate
temperature reading [10], but it is bulky and costprohibitive.
Optical methods like near infrared spectroscopy (NIRS) [11],
[12] are generally portable and sensitive to temperature. Yet
the strong scattering of light inside tissue limits either their
achievable penetration depth (e.g., infrared thermometry) or the
probing resolution (e.g., NIRS).
Ensuing temperature measurement, the second equally important task is automatic stabilization of the temperature at therapy
sites. To this end, various close-loop techniques had been proposed [6], [13], [14], clustered majorly in MRI-guided HIFU
therapy [14]–[17]. Yet, few reports were devoted to develop
close loop temperature control systems for magnetic nanoparticle hyperthermia therapy, partly due to the inherent difficulty to
integrate nanoparticle hyperthermia with MRI [18] and partly
due to the aforementioned difficulties in accurate noninvasive
temperature measurement. This leads to growing efforts in developing smart nanoparticles [19], [20], which stabilize temperature by ceasing energy absorption when its temperature exceeds
a preset value.
Here, we propose a novel photoacoustic (PA) technique for
accurate noninvasive temperature measurement and present furthermore the portable hyperthermia feedback controller (pHFC),
an economical FPGA-based close-loop control system, for temperature control in nanoparticle hyperthermia therapy. PA [21]–
[23] is an emerging hybrid sensing method that combines the
optical contrast of materials and excellent resolution of ultrasound, and owing to its capability in utilizing diffused photons, it
can achieve penetration up to several centimeters, while maintaining submillimeter resolution. These features, coupled further with its high sensitivity on temperature measurement [24],
[25], make PA particularly appealing for noninvasive temperature measurement. Indeed, preliminary deep tissue temperature
measurement with subdegree accuracy had been achieved by
PA [26]. Though magnetic nanoparticles might possess weaker
absorption at infrared wavelengths, strong signal-to-noise ratio

0018-9294 © 2015 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

XIAOHUA et al.: PHOTOACOUSTIC-BASED-CLOSE-LOOP TEMPERATURE CONTROL FOR NANOPARTICLE HYPERTHERMIA

(SNR) and hence good accuracy are still achievable by selecting
judiciously the wavelength at the visible range [27]. Also, the
engineering of novel magnetic nanoparticles that endows them
with good light absorption at desired wavelengths [28], [29]
can facilitate further the utilization of PA technique in magnetic
nanoparticle-based applications. In this paper, it is shown that
PA system is well suited to be integrated with magnetic nanoparticle hyperthermia system and can provide accurate temperature
measurement. Empowered by this, the proposed pHFC can automatically stabilize the temperature at predetermined values with
an accuracy of 0.3 °C. It thus represents a portable, economical, and powerful temperature control solution for nanoparticle
hyperthermia therapy.
The paper is organized as follows. A briefing is given first in
Section II on the theories for PA temperature measurement and
nanoparticle hyperthermia effects under alternating magnetic
field. Then, Section III begins to deal with analytical model developments for nanoparticle hyperthermia system and based on
the models, proceeds to present controller algorithm design and
their implementation on FPGA. Ensuing this, the entire system
realization and phantom experimental results with the pHFC
for temperature control are addressed extensively in Section IV.
Finally, the paper is closed by discussions and conclusion in
Section V.
II. THEORY
A. PA Temperature Monitoring
PA refers to the phenomenon of acoustic wave generation
in matter through thermal expansion effect upon absorption of
modulated light. At temperature T , the generated PA signal
amplitude P is calculated as [25]
P = μa Γ(T )F

(1)

where F is optical fluence, μa and Γ are the absorption coefficient and Grueneisen parameter of the matter, respectively. The
temperature measurement is based on the fact that Γ(T ) is linearly related to absolute temperature: Γ(T ) = A + BT , where
A and B are constants determined by material properties. The
sensitivity S of PA on temperature, defined as PA signal amplitude’s change in percentage per degree temperature variation,
can be derived from the (1) to be S = 1/(T + A/B). S is about
3–5% for most materials [25] and is at least one order of magnitude larger than the sensitivity in ultrasound technique. With a
known reference point P (T0 ) obtained from calibration for the
PA measurement, absolute temperature can be calculated from
measurement result P as


A
A
P
+ T0 − .
(2)
T =
P (T0 ) B
B
Equation (2) assumes that the temperature dependence of absorption coefficient is negligible compared to that of Grueneisen
parameter, which is generally valid [24].
The accuracy of temperature measurement is determined directly by the accuracy of amplitude extraction from the PA
signal, which is in turn dictated by SNR of the PA signal. Denoting the PA signal-to noise-ratio as SNR, the temperature

1729

Fig. 1. (a) SPIONs volumetric power deposition and penetration versus frequency. (b) Volumetric power deposition versus volume concentration.

measurement accuracy δT is related to SNR by δT = 1/(S ×
SNR). Therefore, with adequate laser energy monitoring and
compensation like using a photodiode and sufficient number of
temporal averaging, the accuracy of temperature measurement
by PA can be improved at the expense of measurement latency.
B. Heating of Magnetic Nanoparticles Under an Alternating
Magnetic Field
Consider using magnetic nanoparticles in ferrofluid form for
hyperthermia therapy. Under an alternating magnetic field, magnetic nanoparticles will undergo Brownian and Neel relaxation
processes, which causes energy absorption from the magnetic
field and heats up the ferrofluid. The volumetric power deposition U is [30]
U=

ω2 τ
μ0 2
H 0 χ0
2
1 + (ωτ )2

(3)

where ω is the radian frequency of magnetic field, μ0 is the permeability of free space, H0 is the magnetic field strength, τ and
χ0 are the effective relaxation time and magnetic susceptibility
of the ferrofluid, respectively. Eddy current heating is negligible
for ferrofluid here since the size of magnetic nanoparticles is
very small (<100 nm).
The volume power deposition depends both on the alternating
magnetic field frequency ω and nanoparticle concentration, with
the latter entering U by affecting equilibrium magnetic susceptibility χ0 . Regarding alternating magnetic field frequency ω,
U shows a high-pass filtering characteristic: it is ineffective at
low frequencies (ωτ  1) whereas saturates at high frequency
end (ωτ  1). This is best illustrated by a representative theoretical calculation of its frequency response, along with its
volume concentration dependence. Assuming a τ of 100 ns (in
the typical range of magnetic nanoparticles) and taking other
typical parameters for the SPIONs given in [30], the volumetric
power deposition and penetration versus frequency are shown
in Fig. 1(a). After the frequency becomes higher than about
10 MHz, the power deposition ceases to increase whereas the
penetration depth degrades steadily. To strike a balance between
penetration and heating efficiency, frequencies of several tens
megahertz are suitable. The concentration dependence of volume power deposition is given in (b), which predicts superior heating at larger concentration, conforming to the general

1730

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 7, JULY 2015

Fig. 2. Block diagram for the entire close loop system. FG: signal generator;
AMP: power amplifier; MFH: magnetic ferrofluid heating; BioHeat: Biological
heating process; PAM: photoacoustic measurement.

observations [30], [31]. It should be noted that higher concentration, though desirable, is difficult to achieve in vivo.
III. SYSTEM MODEL DEVELOPMENT
AND CONTROLLER DESIGN
The proposed close-loop system for regulating temperature
is represented in the block diagram in Fig. 2. A function generator (FG) produces signal according to the controller (CON)
output and feeds the power amplifier (AMP), which controls
the magnetic ferrofluid heating (MFH) process inside tissue.
The tissue temperature consequently changes according to the
bioheating process (BioHeat) and is continuously monitored by
photoacoustic system (PAM). The controller monitors the error signal (set point temperature Tr (t) minus actual measured
temperature T (t)) and yields a corresponding signal for controlling the FG block to bring the actual temperature T (t) toward
Tr (t), achieving therefore tight temperature control inside tissue. From the prospective of the controller (CON), the function
generator, power amplifier, MFH process, BioHeat process, and
PA measurement form together the plant model.
A. System Model
As the FG simply reads the power value specified by the controller and produces correspondingly physical radio frequency
signal to feed the power amplifier, it is equivalently a unity gain
amplifier in terms of power transfer. Thus, it can be combined
with the power amplifier into a single block with a power gain of
G1 . The MFH described in (3) states essentially U ∝ H02 when
the magnetic frequency for heating is fixed. Since H02 is proportional to the output power ψ(t) of the amplifier, U can be related
to the instantaneous power of the amplifier by U (t) = G2 ψ(t)
with G2 as a constant. In Laplace domain, it is Ũ (s) = G2 ψ̃(s),
in which the convention of using F̃ (s) to represent the Laplace
transform of a general function F (t) is employed and will be
used hereafter.
The bioheating process is more complicated. Factoring in
nanoparticles heating, heat diffusion, and blood convection for
in vivo scenarios, it can be characterized by the bioheat transfer
equation (BHTE) [32]:
ρ(r)c(r)

∂T (r, t)
= ∇ · k(r)∇T (r, t) + U (r, t),
∂t
+ cb w(Ta − T (r, t))

(4)

where ρ(r), c(r), k(r) are the mass density, specific heat, and
thermal conductivity of the nanoparticles laden tissues. cb , w,

Fig. 3. Illustration of temperature profile of MNP laden region and surrounding tissue. MNP: magnetic nanoparticles.

and Ta are the specific heat, local perfusion rate, and temperature of the blood, respectively. This differential equation needs
be simplified in order to get an analytical solution for temperature. To this end, the thermal conduction/diffusion between
nanoparticles laden region and surrounding tissue is approximated with the lumped system analysis [33]. This translates
to a sharp temperature roll-off between nanoparticles laden region and its surrounding tissue as illustrated in Fig. 3(a), though
the actual temperature roll-off is much slower like in (b). This
approximation can significantly reduce the BHTE complexity
and still model adequately the nanoparticles hyperthermia process, as validated by later experiments. The BHTE is hence
now
ρc

∂T (t)
= −R(T (t) − Ta ) + U (t) + cb w(Ta − T (t)) (5)
∂t

where R is the characteristic time constant of the tissuenanoparticles system for the lumped system analysis. Further
reduction gives
ρc

∂ΔT (t)
= −βΔT (t) + U (t)
∂t

(6)

with β = (R + cb w) and ΔT (t) = T (t) − Ta . β is an unknown constant since the local blood perfusion and the characteristic time constant of the tissue-nanoparticles system are
not obtainable. The Laplace transfer function of the BHTE is
then
 (s)
1/ρc
1
ΔT
=
.
=
sρc + β
s + β/ρc
Ũ (s)

(7)

Like other temperature sensors such as thermometer, PA temperature measurement has an inherent time delay (latency).
With N times averaging and a laser firing repetition rate of
PRF, the latency is L = N/PRF. Its transfer function is thus
M̃ (s) = exp(−sL). Generally, the delay is on the order of 1 s.
For instance, for measurement with eight times averaging and
a laser with PRF of 10 Hz, the delay is 0.8 s. Compared to tissue temperature response time during nanoparticle hyperthermia
that are on the order of several minutes, the delay is negligibly
small.
With each block modeled, the entire system can be compactly
represented in Laplace domain as shown in Fig. 4(a), with the
plant model given as
Q̃(s) =

G1 G2 /ρc −sL
e
.
s + β/ρc

(8)

XIAOHUA et al.: PHOTOACOUSTIC-BASED-CLOSE-LOOP TEMPERATURE CONTROL FOR NANOPARTICLE HYPERTHERMIA

1731

Fig. 5. System implementation based on FPGA. MAF: moving average filter;
ADC: analog to digital converter; UST: ultrasound transducer; LNA: low noise
amplifier; PLL: phase lock loop; FG: function generator; AMP: power amplifier.
SYS: system.

Fig. 4. (a) Entire system model in Laplace domain. (b) PID implementation
with only proportional and integration term. AMP: power amplifier; MFH: magnetic fluid hyperthermia; PAM: photoacoustic measurement; CON: controller.

B. Controller Design
Lots of algorithms are available for the controller design.
Here, PID algorithm is chosen owing to its simplicity and robustness. The general form for PID controller is [34]:
C̃(s) = Kp +

1
+ td × s
ti s

(9)

where Kp , ti , and td are the proportional gain, integration time,
and derivative time, respectively. To achieve stable, accurate and
fast control, the three parameters need be determined based on
the theoretical plant model. However, the constant G2 and β
in the plant model are unknown due to unknown local thermal
diffusion and blood perfusion. The common solution is tuning,
which experimentally measures the plant’s step response and
then calculates the PID parameters, with necessary iterations to
get optimum results.
However, using PA temperature measurement that has negligible latency, the plant model developed above can be approximated to be
G
G1 G2 /ρc
=
(10)
Q̃(s) =
s + β/ρc
1 + sτ
with G = G1 G2 /β as the gain of the plant and τ = ρc/β as
the plant time constant. Without the long latency (dead-time)
that complicates the traditional tuning, a simpler yet robust PID
control design can be achieved. As shown in Fig. 4(b), only
proportional term Kp and integral ti term are adopted since
the derivative term is inherently sensitive to noise. The output temperature T (t) is related to Tr (t) in Laplace domain as
˜ T̃r (s), where
T̃ (s) = J(s)
˜ =
J(s)

Kp Gs + G/ti
τ s2 + (Kp G + 1)s + G/ti

(11)

is the transfer function. With input being Heaviside step function
Tr (t) = u(t), the steady-state value output is T (t → ∞) = 1
regardless the value of G and τ . It thus indicates a tight tracking

of T (t) to Tr (t) upon reaching steady state. Under the form of
(11), a wide range of values of Kp and ti are allowed for the
controller design without inducing stability issues. Employing
only the Kp term ensures unconditional system stability and
leads to
T (t → ∞) = Kp G/(Kp G + 1),

(12)

which prefers larger Kp in order to obtain faster tracking and
minimal steady-state error. Using only ti term, one gets
T (t → ∞) = 1.

(13)

To avoid stability issues, large value of ti (hence small gain
for the integrator) can be used. One attractive aspect of fast
PA temperature measurement is that it allows nonoptimum PID
controller parameters to be used without much knowledge on
the plant parameters and still delivers satisfying performance.
C. FPGA-Based pHFC Controller System Implementation
The FPGA-based portable hyperthermia feedback controller
(pHFC) is shown diagrammatically in Fig. 5. It triggers a laser to
illuminate the object and receives the generated PA signal from
an ultrasound transducer (UST), which directs at the magnetic
nanoparticles laden region. PA signal is amplified by 54 dB with
a compact amplifier (Model 5662, Olympus) and then sampled
by a analog to digital converter (ADC) before entering FPGA
(Cyclone II starter board, Altera). The 5-MHz bandwidth for the
amplifier also functions as the antialiasing filter for the ADC.
All backend processing are realized in the FPGA board. An internal phase lock loop (PLL) generates a 30-MHz system clock
(clk) and feeds it into the system (SYS) timer and ADC control
block (ADC Ctrl). The timer produces a 10-Hz synchronization
signal to trigger laser and initiates the ADC Ctrl module. Upon
the rising edge of each sync signal, the laser fires once and ADC
Ctrl module commands the ADC to acquire the incoming signal at a sampling rate of 30 MHz for a fixed time interval. The
sampling duration is determined by the desired imaging depth.
During the PA signal acquisition period, the PWM heating is
disabled for 50 μs to avoid the electromagnetic interferences
(EMI). Such short period (thus high frequency) disturbances in
PWM heating will not affect the tissue temperature increase,

1732

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 7, JULY 2015

which responds to the PWM heating in essentially a low-pass
filtering manner as will be illuminated shortly. The sampled signals are low-pass filtered with an eight stage moving average
filter (MAF) to eliminate high-frequency noises. The “Average”
module then performs eight times averaging of the low-pass
filtered signal to improve the SNR and feeds the results to the
temperature calculation module (Tm Calc), which extracts temperature by detecting the peak-to-peak value of averaged PA
signal and doing conversion according to (2). No laser energy
compensation is adopted in current PA temperature measurement since measuring laser energy will need another channel
of ADC. The measured temperature is compared with preset
temperature and generates an error signal that feeds to the PID
controller. Since the temperature is updated at the rate of sync
signal, the PID controller, which is implemented with a parallel
structure, works at this rate as well.
The PID controller output is converted to PWM signal
(PWMs) by the pulse width modulation (PWM) core to facilitate hyperthermia power control. Compared with solutions
using digital to analog converter that reverts the PID output back
to analog domain, PWM that outputs switching values (0 and 1)
allows purely digital implementation and therefore more economical and robust control. Denoting the resultant PWM signal
as Ym (t) with a modulation frequency ωm and duty cycle of
D, the temperature increase can be derived from (8), which relates the temperature increase to the final controller output [see
Fig. 4(a)], as follows:
 (s) = G1 G2 /ρc e−sL Ỹm (s) = G e−sL Ỹm (s), (14)
ΔT
s + β/ρc
1 + sτ
with G = G1 G2 /β and τ = ρc/β. Its corresponding frequency
response is
 (jω) =
ΔT

G
e−j ω L Ỹm (jω).
1 + jωτ

(15)

Expand the PWM signal into Fourier series
∞
1 
Ym (t) = D +
[sin(nωm t) − sin(nωm t − 2nπD)].
nπ n =1
(16)
It is observed that, as long as the PWM frequency ωm is
chosen to be much larger than the cutoff frequency 1/τ of
the plant model (ωm τ  1 with τ on the order of seconds), the
high-frequency components of PWM signal (including the 50 μs
disturbance of PWM heating for EMI issue) will essentially be
eliminated and leave only the dc component intact. This renders
a linear tuning characteristic with respect to the duty cycle

 (s) = DG e−sL .
ΔT
1 + sτ

Fig. 6. (a) Experiment setup. (b) photography of the pHFC system. (c) Timing
sequence for data collection and imaging. FG: function generator; Amp: power
amplifier, UST: transducer.

amplifier (ZHL-100W-GAN+, Mini-circuits) at 20.1 MHz,
which is produced by a FG and is the resonance frequency
of the coil network. A tube with 3-mm-inner diameter is filled
with magnetic nanoparticles and immersed inside the water tank
as the phantom. The coil is placed directly 2 mm beneath it. The
magnetic field strength at the tube is estimated to be 6 kA/m.
The 532-nm Q-switched pulsed laser (1.2 ns pulse width, 1 mJ
energy) illuminates the phantom with a spot size of 4 mm radius at a repetition rate of 10 Hz. The light fluence is around
2 mJ/cm2 and the irradiance is smaller than 20 mW/cm2 , far below the American National Standards Institute safety standards
[24]. A 1-MHz flat UST (Olympus, V303) detects the generated
PA signal and feeds it to the pHFC system board, which controls the laser firing and data acquisition. The low-quality factor
1 MHz transducer is selected here because the absorber phantom (tube with nanoparticles) is at millimeter size and the light
is expanded to an almost 1-cm diameter spot, which generates
PA signals majorly falling below 1.5 MHz. The detailed timing
sequence for the entire close-loop system is given in Fig. 6(c).
The magnetic heating dose is controlled by the PWM modulation scheme. The pHFC outputs a 10-Hz sync signal to initiate
laser firing and PA signal reception of UST, which updates measured temperature at the rate of sync (10 Hz) and since there
are eight times of signal averaging, the latency is 8 sync periods
(0.8 s). This speed is fast enough to capture the transient dynamics of hyperthermia process, as explained in Section III-A.
With faster laser that can operate at higher repetition rate, the
measurement speed will be shortened correspondingly.

(17)

IV. EXPERIMENTAL RESULTS
The experimental setup shown in Fig. 6(a) is used to demonstrate the PA powered pHFC for precise temperature control of
nanoparticle hyperthermia. In this proof of concept work, a customized small coil driven at power of 20 W is used for heating
the magnetic nanoparticles. The coil has a ferrite core, 10 turns
(660 turns/m), and a diameter of 8 mm. It is driven by a power

A. Heating of Magnetic Nanoparticles
A commercial spherical SPION (3327NG, Skyspring Nanomaterials Inc.) is used for nanoparticle hyperthermia considering
it is FDA approved. It has an average particle size of 10–15 nm
and a specific saturation magnetization of 43.8 emu/g. The effective relaxation time for SPIONs of this size falls on the order
of 1 μs [20], with the exact value depending on various parameters including the viscosity of ferrofluid. Three different

XIAOHUA et al.: PHOTOACOUSTIC-BASED-CLOSE-LOOP TEMPERATURE CONTROL FOR NANOPARTICLE HYPERTHERMIA

Fig. 8.

1733

(a) Representative time domain signal. (b) Associated spectrum.

Fig. 7. Temperature rise of SP1 (100 mg/ml), SP2 (10 mg/ml), SP3 (1 mg/ml)
and water under hyperthermia heating.

concentrations of SPIONs at 100 mg/mL (SP1), 10 mg/ml
(SP2), 1 mg/ml (SP3) are tested, with water (conductivity about
0.02 S/m) used as the reference. SP1 has a calculated number concentration of ∼ 2.1 × 1016 /ml and an equilibrium magnetic susceptibility of 4.5 × 10−2 H/m. At heating frequency of
20.1 MHz (ωτ  1), the heating is saturated according to (3).
The SPIONs fluid is poured into the 3-mm diameter tube and
a K-type thermometer (±0.1 °C accuracy) is inserted directly
inside it to monitor the temperature. It should be noted that as
human body is mostly water based, water inside the tank can
account well thermal diffusions of tissues.
The heating experiment of the SPIONs is conducted by disabling the PWM signal so that the heating is continuous. To
avoid thermometer malfunction under RF radiation, the heating is turned off by 5 s for temperature reading at interval of
35 s. Meanwhile, the PA signals during heating are continuously
recorded. The 5 s disturbance for thermometer reading ceases
naturally upon termination of the heating. The thermometer
reading results are shown in Fig. 7. The temperature initially
increases asymptotically toward steady state and then decreases
monotonically upon termination of heating. All three SPIONs
concentrations deliver consistently larger temperature increase
than water: SP1, SP2, and SP3 give respectively 1.9, 1.0, and
0.5 °C lager temperature increase than water. Two factors limit
the achieved heating difference between nanoparticles and background water. The first is heat diffusion, which is more efficient
for the small tube phantom (3 mm) used in the experiment. The
second is that, at several tens megahertz, substantial nonspecific
heating of water occurs [35]. By using lower frequencies below 1 MHz, nonspecific heating can be largely circumvented.
On the other hand, heat diffusion issue is more challenging to
deal with and it is proved in the literature [36] that nanoparticle
hyperthermia is more effective for larger cancer lesions.
B. PA Temperature Measurement
PA temperature measurements, as described above, are conducted in conjunction with SPIONs heating experiment. One
representative PA signal trace for 100 mg/ml magnetic nanoparticle (SP1) and its associated spectrum are shown in Fig. 8(a) and
(b), respectively, where the achieved SNR is at least 42 dB (126).
Assuming a sensitivity S of 5% for the magnetic nanoparticles

under room temperature, the theoretical temperature measurement accuracy is at least 0.16 °C. The corresponding PA signals
(peak-to-peak value) for SP1, SP2, and SP3 during the heating
process are given in Fig. 9(a), (b), and (c), respectively. The
PA readings show similar behavior with the thermometer measurements in Fig. 7, except that there are periodic saw-tooth
like signals on PA readings during heating, as indicated in the
insets. This is caused by the periodic operation of 5 s heating
shutdown in order to acquire thermometer readings, as stated
previously. The temperature variations during the 5 s are not
captured by the thermometers, but are faithfully recorded by the
fast PA measurements, which update the temperature readings
at 10 Hz rate with a latency of only 0.8 s. The saw-tooth like signals thus demonstrate the real-time capability of PA temperature
measurements.
The linear dependence of PA signals on temperature is demonstrated by relating the PA readings to thermometers measurements. To avoid the discrepancies between PA and thermometer
readings caused by the saw-tooth signals, the falling edge (upon
termination of heating) of thermometer and corresponding PA
signals are utilized. Since thermometer reading is only updated
every 35 s whereas PA signals continuously update at 10 Hz,
thermometer readings in Fig. 7 are interpolated before being
matched to its PA reading counterparts. The results are given in
Fig. 9(d)–(f) for SP1, SP2, and SP3, respectively. It is clearly
observed that PA signals show linear dependence on temperature and indeed, linear regression analysis in all three cases
gives R2 larger than 0.98.
It should be noted that the inherent slow thermometer response to temperature renders less temperature details and hence
hampers the matching accuracies between thermometer reading
and PA measurements carried out herein. It is thus anticipated
that the true accuracy of PA temperature measurement could be
better than presented here. The temperature measurement accuracy achieved for three SPIONs samples is characterized by root
mean error (RMS) and maximum deviation between measured
data and linear fitting. They are shown as insets in Fig. 9(d)–
(f). Overall, PA temperature measurement accuracy is smaller
than 0.5 °C for maximum deviation and 0.18 °C for RMS in
these experiments, which agrees well with the theoretically estimated value. The accuracy can be further improved by more
times of signal averaging at the expense of larger measurement
latency.

1734

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 7, JULY 2015

Fig. 9. (a) PA amplitude during the magnetic heating experiment for SP1. (b) PA amplitude during the magnetic heating experiment for SP2. (c) PA amplitude
during the magnetic heating experiment for SP3. (d) PA for temperature measurement for SP1. (e) PA for temperature measurement for SP2. (f) PA for temperature
measurement for SP3.

C. Close-Loop Control
Realistic concentration of 1 mg/ml (SP3) is selected for the
close loop control experiments. An open loop experiment is
conducted first to calibrate the PA temperature measurement. In
practice, such open loop response measurement needs only be
done with a small temperature increase in order to avoid safety
concerns. Here, for facilitating direct comparison with ensuing
close loop temperature control experiments, the open loop measurement is carried out following the same procedures described
above at full 20 W power. Since PA depends on temperature linearly and two points define a linear function, the temperature
extraction by PA is achieved by relating the maximum PA amplitude to maximum temperature increase and minimum PA
amplitude to minimum temperature increase. The measurement
results are shown in Fig. 10(a), with PA readings on the left
axis and extracted temperature by PA on the right axis. Similar
saw-tooth signals are observed in the PA readings, as expected.
To verify the developed theoretical plant model Q̃(s), its
theoretical open loop response is fitted in time domain with
the measured results. Q̃(s) is expressed in time domain as
Q(t) = a (1 − exp(−bt)) + c, where c is the introduced residual to account for imperfect calibration between PA signals
and thermometer readings. The curve fitting result is shown in
Fig. 10(a), which gives R2 over 0.97 and a system time constant
τ of 2.3 min, far larger than the 0.8 s latency. Thus, the developed “dead-time” free plant model fits well with the experiment
measurements.

Close-loop experiments are then conducted to demonstrate
the effectiveness of designed controller, and two sets of PID parameters (listed in Table I) are implemented with FPGA to verify
that PID controller is relatively insensitive to plant parameter
variations. Using set one parameters and making the set point
temperature Tr (t) to be 3.6 u(t), 5.0 u(t),5.8 u(t) °C above the
baseline temperature, the corresponding close-loop controlled
temperature monitored by PA is shown from Fig. 10(b)–(d), respectively. Compared with open-loop response, the temperature
is tightly controlled to follow the set point temperature upon
reaching steady state and no significant temperature overshoots
are induced.
When set point temperature is fixed at 5.8 °C and the PID parameters are changed to set two, the close-loop response changes
only slightly, as depicted together with close-loop response of
set one PID parameters in Fig. 10(e). The steady-state value
is not affected and the major difference is the slightly smaller
settling time for PID controller with set two parameters, which
features a smaller gain. A plausible reason is that the set two
parameters are closer to optimum PID parameters, which not
necessarily requires higher gain. Other combinations have also
been simulated, which give similar results.
The accuracy of temperature control is analyzed for the four
close-loop measurements using data set in steady-state spanning
from 12 to 16 min. The mean value in this interval is the achieved
temperature increase and the standard deviation denotes the
accuracy. The results are presented in Fig. 10(f), where the red

XIAOHUA et al.: PHOTOACOUSTIC-BASED-CLOSE-LOOP TEMPERATURE CONTROL FOR NANOPARTICLE HYPERTHERMIA

1735

Fig. 10. (a) Open-loop hyperthermia experiment results with SP3. Left axis: PA amplitude, Right axis: extracted temperature by PA. (b) Close-loop experiment
with the preset temperature increase at 3.6°. (c) Close-loop experiment with the preset temperature increase at 5.0°. (d) Close-loop experiment with the preset
temperature increase at 5.8°. (e) Close-loop experiment with the preset temperature increase at 5.8° and set two PID parameters. (f) Accuracy analysis results for
the close-loop control.

TABLE I
PID CONTROLLER PARAMETERS
Parameter

KP

ti

td

Set One
Set Two

400
256

2
2

0
0

error bar is for set two PID parameters whereas the black one for
set one parameters. It is observed that the measured temperature
increase follows tightly with the preset values and the maximum error is about 0.3 °C, close to the achieved PA temperature
measurement accuracy (0.18 °C in RMS). Since the PID parameters are determined without knowing plant parameters, the PID
controller demonstrated here can accommodate plant parameter
variations well.
V. DISCUSSION AND CONCLUSION
Noninvasive PA temperature measurement demonstrated here
provides 0.18° monitoring accuracy, high update rate at 10 Hz
and a latency of only 0.8 s. Such fast measurement enables the
approximately dead-time free plant model, and consequently
enables general PID controller that features high proportional
gain and small integrator gain to be used for satisfying control without much tuning. Further improvements can be made
with advanced PID-based algorithms such as self-tuning regulator [15], which can deliver near-optimum performance without

knowing the plant model parameters. Meanwhile, with laser
that works at higher repetition rate, the measurement can be
accelerated further and by using near infrared wavelength, deep
penetration could be attained for in vivo applications. However, when employing near infrared wavelengths on magnetic
nanoparticles, the SNR of generated PA signals and consequent
temperature measurement accuracy could be degraded as the
absorption at those wavelengths is several times weaker than that
at visible wavelengths. For instance, the magnetic nanoparticles
absorption is inferred from [27] to be about ten times smaller
at 1064 nm than that at 532 nm, indicating a proportional ten
times decrease of temperature measurement accuracy (1.8 °C).
Fortunately, near infrared wavelengths allow larger laser exposure and by using faster laser that enables more averaging
in time domain, subdegree measurement accuracy could still
be obtained without sacrificing the measurement speed. Even
deeper penetration can be achieved by thermoacoustic imaging
that uses microwave [37]–[39] or alternating magnetic field [40]
for excitation to probe the temperature. Specifically for the latter
approach, there exists a potential to use a single coil for both
hyperthermia therapy and thermoacoustic temperature sensing
by interleaving the two processes. This will enable a very compact close-loop hyperthermia system with minimal overhead.
Due to inferior SNR of the thermoacoustics signals when using
microwave or alternating magnetic field for excitation, larger
number of time domain averaging or frequency domain solution [40] may be necessary. The proposed close loop solution

1736

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 7, JULY 2015

could also be applied to different hyperthermia methods, such
as RF ablation and photothermal therapy that employing other
nanoparticles like carbon nanotubes [41] or gold nanoparticles
[42] by adapting accordingly the heating methods.
There are several challenges to be addressed to bring this
work toward practical fruition in clinical settings, which require
generally three-dimensional (3-D) temperature monitoring and
controlling. The first challenge is the need of larger number of
USTs [43] for fast 3-D PA imaging. One promising method is
to perform 3-D temperature mapping using two dimensional
(2-D) ultrasound arrays and the development of high-density 2D transducer arrays using technologies like capacitive machined
UST [44] or piezoelectric-machined UST [45] could solve this
issue in the future. The second challenge is to process huge
data rate for 3-D imaging. For instance, a 64 × 64 2-D array
could lead to 1.5 T bit per second data rate under a digital
sampling of 30 MHz with 12 bit accuracy. Such high data rate
would pose significant challenges not only for data transfer
but also for signal processing, which will necessitate parallel
processors (like FPGA) and a large trunk of memories. The
third but not the least challenge is the hardware and algorithm
extensions needed in order to control the temperature of multiple
points or even multiple regions. The simplest solution is to
identify the critical region, which could be the hottest spot, and
then employ proposed solution to control its temperature. For
more sophisticated solutions that involve concurrent controlling
of the temperature of multiple points or regions, the system
need to adopt phase array coils like in conventional RF ablation
[46] to dynamically switch the RF heating focus among those
points/regions by electronic steering. Making such switching
fast enough but with different weights (duty cycle) for each
region, simultaneous but varied heating on multiple regions with
focused energy is achievable, like in phased array ultrasound
hyperthermia [13].
To conclude, a portable and economical hyperthermia feedback controller (pHFC) has been presented in this paper. With
accurate PA temperature measurement, the PID controller implemented on FPGA is able to tightly stabilize the hyperthermia
temperature at preset values with an accuracy of 0.3 °C. Such
pHFC solution with PA or thermoacoustic temperature measurement can potentially fulfill the task for noninvasive and deep
penetration temperature control in nanoparticle hyperthermia
therapy.
REFERENCES
[1] S. Bae et al., “AC magnetic-field-induced heating and physical properties
of ferrite nanoparticles for a hyperthermia agent in medicine,” IEEE Trans.
Nanotechnol., vol. 8, no. 1, pp. 86–94, Jan. 2009.
[2] X. Q. Liu et al., “Surface functionalized biocompatible magnetic
nanospheres for cancer hyperthermia,” IEEE Trans. Magn., vol. 43, no. 6,
pp. 2462–2464, Jun. 2007.
[3] S. Laurent et al., “Magnetic fluid hyperthermia: Focus on superparamagnetic iron oxide nanoparticles,” Adv. Colloid Interface Sci., vol. 166,
no. 1/2, pp. 8–23, Aug. 2011.
[4] Q. A. Pankhurst et al., “Applications of magnetic nanoparticles in
biomedicine,” J. Phys. D, Appl. Phys., vol. 36, no. 13, pp. R167–R181,
Jul. 7, 2003.
[5] P. Vanbaren and E. S. Ebbini, “Multipoint temperature control during
hyperthermia treatments—Theory and simulation,” IEEE Trans. Biomed.
Eng., vol. 42, no. 8, pp. 818–827, Aug. 1995.

[6] D. E. Kruse et al., “Spatial and temporal-controlled tissue heating on a
modified clinical ultrasound scanner for generating mild hyperthermia in
tumors,” IEEE Trans. Biomed. Eng., vol. 57, no. 1, pp. 155–166, Jan.
2010.
[7] C. Simon et al., “Two-dimensional temperature estimation using diagnostic ultrasound,” IEEE Trans. Ultrason., Ferroelectr. Freq. Control, vol. 45,
no. 4, pp. 1088–1099, Jul. 1998.
[8] R. MaassMoreno et al., “Noninvasive temperature estimation in tissue
via ultrasound echo-shifts—Part 2: In vitro study,” J. Acoust. Soc. Amer.,
vol. 100, no. 4, pp. 2522–2530, Oct. 1996.
[9] M. Pernot et al., “Temperature estimation using ultrasonic spatial compound imaging,” IEEE Trans. Ultrason., Ferroelectr. Freq. Control,
vol. 51, no. 5, pp. 606–615, May 2004.
[10] C. Mougenot et al., “Automatic spatial and temporal temperature control
for MR-guided focused ultrasound using fast 3D MR thermometry and
multispiral trajectory of the focal point,” Magn. Reson. Med., vol. 52,
no. 5, pp. 1005–1015, Nov. 2004.
[11] M. Bakhsheshi et al., “Monitoring brain temperature by time-resolved
near-infrared spectroscopy: Pilot study,” J. Biomed. Opt., vol. 19, no. 5,
pp. 057005-1–057005-9, May 2014.
[12] S. M. Nikitin et al., “Temperature dependence of the optoacoustic transformation efficiency in ex vivo tissues for application in monitoring thermal therapies,” J. Biomed. Opt., vol. 17, no. 6, pp. 061214-1–061214-9,
Jun. 2012.
[13] A. Casper et al., “Realtime control of multiple-focus phased array heating
patterns based on noninvasive ultrasound thermography,” IEEE Trans.
Biomed. Eng., vol. 59, no. 1, pp. 95–105, Jan. 2012.
[14] J. K. Enholm et al., “Improved volumetric MR-HIFU ablation by robust binary feedback control,” IEEE Trans. Biomed. Eng., vol. 57, no. 1,
pp. 103–113, Jan. 2010.
[15] L. Sun et al., “Adaptive real-time closed-loop temperature control for ultrasound hyperthermia using magnetic resonance thermometry,” Concept.
Magn. Reson. B., vol. 27B, no. 1, pp. 51–63, Oct. 2005.
[16] B. Z. Fite et al., “Magnetic resonance thermometry at 7T for real-time
monitoring and correction of ultrasound induced mild hyperthermia,”
PLOS ONE, vol. 7, no. 4, pp. e35509-e35509–10, Apr. 2012.
[17] C. Mougenot et al., “Three-dimensional spatial and temporal temperature
control with MR thermometry-guided focused ultrasound (MRgHIFU),”
Magn. Reson. Med., vol. 61, no. 3, pp. 603–614, Mar. 2009.
[18] P. Cantillon-Murphy et al., “Proposing magnetic nanoparticle hyperthermia in low-field MRI,” Concept. Magn. Reson. A., vol. 36A, no. 1,
pp. 36–47, Jan. 2010.
[19] H. Hejase et al., “MnZnFe nanoparticles for self-controlled magnetic
hyperthermia,” J. Magn. Magn. Mater., vol. 324, no. 22, pp. 3620–3628,
Nov. 2012.
[20] H. A. Hejase et al., “Self-controlled hyperthermia characteristics
of ZnGdFe nanoparticles,” IEEE Trans. Magn., vol. 48, no. 9,
pp. 2430–2439, Sep. 2012.
[21] L. H. V. Wang and S. Hu, “Photoacoustic tomography: In vivo imaging
from organelles to organs,” Science, vol. 335, no. 6075, pp. 1458–1462,
Mar. 2012.
[22] D. Razansky et al., “Multispectral opto-acoustic tomography of deepseated fluorescent proteins in vivo,” Nature Photon., vol. 3, no. 7,
pp. 412–417, Jul. 2009.
[23] Z. Yuan and H. B. Jiang, “Quantitative photoacoustic tomography: Recovery of optical absorption coefficient maps of heterogeneous media,”
Appl. Phys. Lett., vol. 88, no. 23, pp. 231101–23110–3, Jun. 2006.
[24] M. Pramanik and L. V. Wang, “Thermoacoustic and photoacoustic sensing
of temperature,” J. Biomed. Opt., vol. 14, no. 5, Sep./Oct. 2009.
[25] J. Shah et al., “Photoacoustic imaging and temperature measurement for
photothermal cancer therapy,” J. Biomed. Opt., vol. 13, no. 3, May/Jun.
2008.
[26] J. J. Yao et al., “Absolute photoacoustic thermometry in deep tissue,” Opt.
Lett., vol. 38, no. 24, pp. 5228–5231, Dec. 2013.
[27] E. I. Galanzha et al., “In vivo magnetic enrichment and multiplex photoacoustic detection of circulating tumour cells,” Nature Nanotechnol.,
vol. 4, no. 12, pp. 855–860, Dec. 2009.
[28] Y. D. Jin et al., “Multifunctional nanoparticles as coupled contrast agents,”
Nature Commun., vol. 1, no. 41, Jul. 2010.
[29] M. F. Kircher et al., “A brain tumor molecular imaging strategy using
a new triple-modality MRI-photoacoustic-Raman nanoparticle,” Nature
Med., vol. 18, no. 5, pp. 829–U235, May 2012.
[30] R. E. Rosensweig, “Heating magnetic fluid with alternating magnetic
field,” J. Magn. Magn. Mater., vol. 252, no. 1/3, pp. 370–374, Nov.
2002.

XIAOHUA et al.: PHOTOACOUSTIC-BASED-CLOSE-LOOP TEMPERATURE CONTROL FOR NANOPARTICLE HYPERTHERMIA

[31] X. Feng et al., “Thermally modulated photoacoustic imaging with superparamagnetic iron oxide nanoparticles,” Opt. Lett., vol. 39, no. 12,
pp. 3414–3417, Jun. 2014.
[32] M. E. Kowalski and J. M. Jin, “A temperature-based feedback control
system for electromagnetic phased-array hyperthermia: theory and simulation,” Phys. Med. Biol., vol. 48, no. 5, pp. 633–651, Mar. 2003.
[33] F. P. Incropera et al., “Transient conduction,” in Fundamentals of Heat
and Mass Transfer, 6th ed. Hoboken, NJ, USA: Wiley, 2006, pp. 256–270.
[34] K. J. Åström and T. Hägglund, “PID control,” in Advanced PID Control.
ISA-The Instrumentation, Systems, and Automation Society, NC, USA:
Research Triangle Park, 2005, pp. 64–93.
[35] C. Cervadoro et al., “Design maps for the hyperthermic treatment of
tumors with superparamagnetic nanoparticles,” PLOS ONE, vol. 8, no. 2,
pp. e57332-1–e57332-14, Feb. 2013.
[36] R. Hergt et al., “Magnetic particle hyperthermia: nanoparticle magnetism
and materials development for cancer therapy,” J. Phys., Condens. Matter.,
vol. 18, no. 38, pp. S2919–S2934, Sep. 2006.
[37] D. R. Bauer et al., “Spectroscopic thermoacoustic imaging of water and fat
composition,” Appl. Phys. Lett., vol. 101, no. 3, pp. 033705-1–003705-4,
Jul. 2012.
[38] G. Ku and L. H. V. Wang, “Scanning thermoacoustic tomography in
biological tissue,” Med. Phys., vol. 28, no. 7, pp. 1519–1524, Jul. 2001.
[39] F. Gao et al., “Microwave-acoustic phasoscopy for tissue characterization,” Appl. Phys. Lett., vol. 101, no. 04, pp. 043702-1–043702-5, Jul.
2012.
[40] X. H. Feng et al., “Magnetically mediated thermoacoustic imaging toward deeper penetration,” Appl. Phys. Lett., vol. 103, no. 8,
pp. 083704-1–083704-4, Aug. 2013.
[41] C. J. Gannon et al., “Carbon nanotube-enhanced thermal destruction of
cancer cells in a noninvasive radiofrequency field,” Cancer, vol. 110,
no. 12, pp. 2654–2665, Dec. 2007.
[42] J. W. Shao et al., “Photothermal nanodrugs: Potential of TNF-gold
nanospheres for cancer theranostics,” Sci. Rep., vol. 3, no. 1293,
pp. 01293-1–01293-9, Feb. 2013.
[43] L. Z. Xiang et al., “4-D photoacoustic tomography,” Sci. Rep., vol. 3,
no. 1113, pp. 01113-1–01113-8.
[44] J. K. Chen et al., “A photoacoustic imager with light illumination through
an infrared-transparent silicon CMUT array,” IEEE Trans. Ultrason., Ferroelectr. Freq. Control, vol. 59, no. 4, pp. 766–775, Apr. 2012.
[45] D. E. Dausch et al., “In vivo real-time 3-D intracardiac echo using PMUT
arrays,” IEEE Trans. Ultrason., Ferroelectr. Freq. Control, vol. 61, no. 10,
pp. 1754–1764, Oct. 2014.
[46] A. J. Fenn and G. A. King, “Experimental investigation of an adaptive
feedback algorithm for hot spot reduction in radio-frequency phased-array
hyperthermia,” IEEE Trans. Biomed. Eng., vol. 43, no. 3, pp. 273–280,
Mar. 1996.

1737

Feng Xiaohua received the B.S. degree in electrical
engineering from Xidian University, Xi’an, China,
in 2011. He is currently working toward the Ph.D.
degree at the School of Electrical and Electronic Engineering, Nanyang Technological University, Singapore.
His research interests include microwave-induced
thermoacoustic imaging, photoacoustic imaging,
pulsed radio frequency pain relief therapy, and
biomedical circuits and system design.

Gao Fei (M’12) received the B.S. degree in electrical
engineering from Xi’an Jiaotong University, Xi’an,
China. Since 2010, he has been working toward the
Ph.D. degree in electrical and electronic engineering
at Nanyang Technological University, Singapore.
His research interests include fundamental study
and system development of thermoacoustic and photoacoustic imaging modalities, circuit and system for
biomedical applications.

Zheng Yuanjin (M’02) received the B.Eng. and
M.Eng. degrees from Xi’an Jiaotong University,
Xi’an, China, in 1993 and 1996, respectively, and
the Ph.D. degree from the Nanyang Technological
University, Singapore, in 2001.
From July 1996 to April 1998, he was with the
National Key Laboratory of Optical Communication
Technology, University of Electronic Science and
Technology of China. In 2001, he joined the Institute
of Microelectronics, Agency for Science, Technology and Research (A∗STAR), and had been a Principle Investigator and Group Leader. With the IME, he has led and developed
various projects on CMOS RF transceivers, ultra-wideband (UWB), and lowpower biomedical ICs, etc. In July 2009, he joined the Nanyang Technological
University, as an Assistant Professor and the Program Director for Bio-imaging
program. His research interests include biomedical sensors and imaging, thermoacoustic and photoacoustic imaging, and SAW/BAW/MEMS sensors. He
has authored or coauthored more than 100 international journal and conference
papers, 16 patents filed, and several book chapters.

