IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 10, OCTOBER 2013

2783

Time-Varying Coherence Function for Atrial
Fibrillation Detection
Jinseok Lee∗ , Member, IEEE, Yunyoung Nam, David D. McManus, and Ki H. Chon, Senior Member, IEEE

Abstract—We introduce a novel method for the automatic detection of atrial fibrillation (AF) using time-varying coherence functions (TVCF). The TVCF is estimated by the multiplication of two
time-varying transfer functions (TVTFs). The two TVTFs are obtained using two adjacent data segments with one data segment as
the input signal and the other data segment as the output to produce
the first TVTF; the second TVTF is produced by reversing the input and output signals. We found that the resultant TVCF between
two adjacent normal sinus rhythm (NSR) segments shows high
coherence values (near 1) throughout the entire frequency range.
However, if either or both segments partially or fully contain AF,
the resultant TVCF is significantly lower than 1. When TVCF was
combined with Shannon entropy (SE), we obtained even more accurate AF detection rate of 97.9% for the MIT-BIH atrial fibrillation
(AF) database (n = 23) with 128 beat segments. The detection
algorithm was tested on four databases using 128 beat segments:
the MIT-BIH AF database, the MIT-BIH NSR database (n = 18),
the MIT-BIH Arrhythmia database (n = 48), and a clinical 24-h
Holter AF database (n = 25). Using the receiver operating characteristic curves from the combination of TVCF and SE, we obtained
a sensitivity of 98.2% and specificity of 97.7% for the MIT-BIH AF
database. For the MIT-BIH NSR database, we found a specificity
of 99.7%. For the MIT-BIH Arrhythmia database, the sensitivity
and specificity were 91.1% and 89.7%, respectively. For the clinical database (24-h Holter data), the sensitivity and specificity were
92.3% and 93.6%, respectively. We also found that a short segment
(12 beats) also provided accurate AF detection for all databases:
sensitivity of 94.7% and specificity of 90.4% for the MIT-BIH AF,
specificity of 94.4% for the MIT-BIH-NSR, the sensitivity of 92.4%
and specificity of 84.1% for the MIT-BIH arrhythmia, and sensitivity of 93.9% and specificity of 84.4% for the clinical database. The
advantage of using a short segment is more accurate AF burden
calculation as the timing of transitions between NSR and AF are
more accurately detected.
Index Terms—Atrial fibrillation (AF), cardiac arrhythmia,
ECG, parametric time-frequency spectra, Shannon entropy (SE),
short physiological time series, time-varying coherence function,
time-varying transfer function.

Manuscript received April 17, 2013; revised May 20, 2013; accepted May
20, 2013. Date of publication May 22, 2013; date of current version September
14, 2013. This work was supported in part by the office of Naval Research work
unit under Grant N00014-08-1-0244. Asterisk indicates corresponding author.
∗ J. Lee is with the Department of Biomedical Engineering, Wonkwang
University School of Medicine, Iksan, Jeonbuk, Korea (e-mail: gonasago@
wku.ac.kr).
Y. Nam and K. H. Chon are with the Department of Biomedical Engineering,
Worcester Polytechnic Institute, Worcester, MA 01609 USA (e-mail: yynams@
gmail.com; kichon@wpi.edu).
D. D. McManus is with the Cardiology Division, Departments of Medicine
and Quantitative Health Sciences, University of Massachusetts Medical Center,
Worcester, MA 01605 USA (e-mail: mcmanus.dave@gmail.com).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2013.2264721

I. INTRODUCTION
TRIAL fibrillation (AF) is the most common sustained
dysrhythmia in the U.S. More than 2.3 million Americans
are currently diagnosed, and the prevalence of AF is increasing
rapidly with the aging of the U.S. population [1]. Through its
association with increased risk for stroke, heart failure, and mortality, AF has a profound impact on the longevity and quality
of life of a growing number of people [2], [3]. Although AF
treatment strategies are available, a major challenge facing clinicians and researchers is the oftentimes paroxysmal and minimally symptomatic nature of AF, particularly in its early stages.
Since even short episodes of AF are associated with adverse
health outcomes, there is a pressing need to develop methods
for the accurate detection of paroxysmal AF. Such a method
would have important clinical applications for use of anticoagulants, antiarrhythmic agents, and ablative therapies to abrogate
the effects of AF and its complications. For these reasons, the
importance of developing new AF detection technologies has
been emphasized [1]–[3].
Many algorithms have been developed to detect AF and can
be categorized as being based on 1) P-wave detection or 2) RR
interval (RRI) variability [4]–[12]. AF detection based on the
absence of electrocardiographic P-waves has not gained wide acceptance because the determination of the P-wave fiducial point
localization is challenging, especially for Holter monitoring applications. Indeed, for Holter monitoring, it is difficult to find
uncontaminated RRIs due to motion and noise artifacts that can
confound accurate P-wave detection. Subsequently, many studies have used the variability of RRI time series instead [8]–[12].
Specifically, the aim is to quantify markedly increased beatto-beat variability RRI time series in AF. Consequently, most
algorithms show higher sensitivity and specificity values than
the methods that screen for the absence of P-waves. However,
most of these RRI methods are based on comparing the density histogram of the data segment with previously compiled
standard density histograms of RR segments during AF using
the Kolmogorov–Smirnov test [12]. The main disadvantage of
this approach is that it requires storage of large amounts of histogram data and threshold values of various characteristics of
AF.
In this paper, we use our previously developed time-varying
coherence function (TVCF) approach [13] to discriminate between AF and nonfibrillatory cardiac rhythms. Note that Sarraf
et al. [14] have used a time-invariant coherence function approach to discriminate between AF and non-AF rhythms with
good results. To account for nonstationary dynamics of AF as
well as to capture transitions from AF to sinus rhythms, Lovett
and Ropella [15] have used a spectrogram approach. However,

A

0018-9294 © 2013 IEEE

2784

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 10, OCTOBER 2013

the study was not intended for the AF detection; hence its accuracy value is not known. Further, because the spectrogram does
not provide the best time and frequency resolution, its ability
to find the transition between AF and normal sinus rhythms
(NSRs) is not optimal.
In general, the higher time and frequency resolutions offered
by the parametric approaches, as compared to nonparametric approaches, are well documented [16]. Hence, our autoregressive
moving average (ARMA) model-based TVCF offers higher time
and frequency resolutions than do nonparametric approaches.
Specifically, an ARMA model-based time-varying transfer function (TVTF) is calculated between two adjacent data segments
with one data segment as the input and the other as the output.
We then reverse the input and output signals and compute the
second TVTF, and then multiply the two TVTFs to obtain the
TVCF [13]. Our underlying hypothesis for the use of the TVCF
approach is that if the two adjacent segments are NSRs, the resultant TVCF will have values close to one throughout the entire
frequency range. However, if either or both segment(s) partially
or fully contains AF, the coherence values will dip significantly
below one at the time instant AF occurs. Finally, to increase
the accuracy of our AF detection, we combined TVCF results
with Shannon entropy (SE) as the latter has been shown to be
useful for the AF detection [8]. Note a preliminary version of
this paper has been reported [32].
II. METHODS
A. Databases
We used five databases to test the method on: the MIT-BIH
AF, the MIT-BIH NSR, the MIT-BIH Arrhythmia (Arr) [17],
a 24-h AF database from The Scottcare Corporation and preand postcardioversion clinical trial data from the University of
Massachusetts Medical Center (UMMC) to detect AF and NSR,
respectively, using an iPhone 4S camera. For all databases, we
used RRI series. The MIT-BIH AF database contains 25 ECG
recordings in which there are a total of 299 AF episodes. Each
ECG recording is approximately 10 h in duration. The data sets
4936 and 5091 were excluded from our study due to incorrect
AF annotations. Based on the MIT-BIH AF database (n = 23,
1 131 097 beats), threshold values were determined. The MITBIH NSR database contains 18 ECG recordings (1 729 629
beats), and the duration of each ECG record is approximately
24 h. The NSR data do not contain AF episodes; hence, they were
used for the evaluation of the specificity value of AF detection.
The MIT-BIH Arr database consists of 48 half-hour annotated
ECG recordings sampled at 360 Hz; 100 series (n = 23, 47 891
beats) contain both sinus rhythm and arrhythmias without AF
episodes while 200 series (n = 25, 64 101 beats) contain AF,
various arrhythmias, and sinus rhythm. The clinical AF database
consists of 24-h Holter monitor data collected from 25 subjects
using ScottCare’s RZ153 series recorders. Data were acquired
at 180 samples per second with 10-bit resolution. The AF annotation was performed by ScottCare Corporation technicians,
and the analysis for R-wave peak detection was done using
ScottCare’s HolterCare software. The extracted RRIs were then
analyzed by the authors using MATLAB 2010a. For the iPhone

4S data collection, 74 patients with AF who presented for electrical cardioversion to the UMMC cardiac electrophysiology
laboratory were recruited by trained study personnel. The camera of an iPhone 4S was placed on either the index or middle
finger of study participants for 2 min prior to, and again immediately after, cardioversion. Data were recorded in the supine
position (to minimize motion artifacts) with spontaneous breathing, with the assistance of a physician. These studies including
data analysis were approved by the UMMC Institutional Review
Board.
B. Time-Varying Coherence Function
We have previously shown that the TVCF can be obtained
by the multiplication of the two time-varying transfer functions [14]. Thus, we will briefly describe the approach. To
demonstrate the use of the TVTF in obtaining the TVCF, we
first define the TVCF via the nonparametric time-frequency
spectra as
|γ(t, f )|4 =

|Sy x (t, f )|2
|Sxy (t, f )|2
Sxx (t, f )Sy y (t, f ) Sy y (t, f )Sxx (t, f )

(1)

where Sxy (t, f ) and Sy x (t, f ) represent the time-frequency
cross spectrum, and Sxx (t, f ) and Sy y (t, f ) represent the auto
spectra of the two signals x and y, respectively. Specifically, the
first factor in (1) is the coherence function when x is considered
as the input and y as the output. Similarly, the second factor
in (1) is the coherence function when y is considered as the
input and x as the output. For a linear TV system with x as the
input and y as the output, the TVTF in terms of time-frequency
spectra can be obtained as
Hx→y (t, f ) =

Sxy (t, f )
Sxx (t, f )

(2)

where Hx→y (t, f ) is the TVTF from the input x to the output y
signal. Similarly, for a linear TV system with y as the input and
x as the output, the TVTF can be obtained as
Hy →x (t, f ) =

Sy x (t, f )
.
Sy y (t, f )

(3)

Thus, the time-varying magnitude |γ (t, f )|2 is obtained by
multiplying the two transfer functions
|Hx→y (t, f ) Hy →x (t, f )| .

(4)

Given the relationship of (4), a high resolution TVCF can be
obtained from ARMA models
y (n) = −

P1


a (n, i) y (n − i) +

i=1

x (n) = −

P2

i=1

Q1


b (n, j) x (n − j) (5.1)

j =0

α (n, i) x (n − i) +

Q2


β (n, j) y (n − j) (5.2)

j =0

where (5-1) represents y(n) as the output and x(n) as the input.
Similarly, (5-2) represents x(n) as the output and y(n) as the
input. Given the ARMA models of (5), the two transfer functions

LEE et al.: TIME-VARYING COHERENCE FUNCTION FOR ATRIAL FIBRILLATION DETECTION

2785

of (4) can be obtained as [13]


Q 1
−j w l

 B n, ej w
jw
l=0 b (n, j) e
=
=
Hx→y n, e

1
A (n, ej w )
1 + Pi=1
a (n, i) e−j w i


Q 2
−j w l

 β n, ej w
l=0 β (n, j) e
=
Hy →x n, ej w =
. (6)

P
j
w
2
α (n, e )
1 + i=1 α (n, i) e−j w i
Finally, we can obtain the TVCF by multiplying the two transfer functions as described in (6). For the parameter estimation,
we can use the time-varying optimal parameter search (TVOPS)
criterion [18], which has been shown to be accurate when applied to many diverse physiological signals [19]–[21]. For the
physiological signals considered, the TVOPS has been shown
to be more accurate than the AIC, minimum description length,
and the fast orthogonal search criterion [19]–[21]. For TVOPS,
time-varying coefficients are expanded onto a set of basis functions. By expanding each time-varying (TV) coefficient onto
a finite set of basis functions, the model order selection criterion of TV systems becomes equivalent to determining model
order for time-invariant ARMA. We have previously demonstrated that Legendre polynomials are a good choice for capturing dynamics that are smoothly changing with time. Details
concerning the parameter selection are described in our previous
publication [18].
C. New Approach for AF Detection: Variance of TVCF
For AF detection, we formulated two adjacent beat segments
(RRI series) with the length denoted as seg using the following
ARMA models:
Si+1:i+ seg (n) = −

P1


g1 (n, i) Si+1:i+ seg (n − i)

i=1

+

Q1


h1 (n, j) Si+ seg+1:i+2·seg (n − j)

j =0
P1

Si+ seg+1:i+2·seg (n) = −
g2 (n, i) Si+ seg+1:i+2·seg (n − i)
i=1

+

Q1


h2 (n, j) Si+1:i+ seg (n − j)

(7)

j =0

where Si+1:i+seg (n) and Si+seg+1:i+2·seg (n) are two adjacent
RRI time series from the (i + 1)th to the (i + seg)th and from the
(i + seg + 1)th to the (i + 2·seg)th, respectively. By substituting
(7) into (6), the two transfer functions are obtained and the TVCF
is obtained by the multiplication of the two TVCFs.
In order to illustrate AF detection, we calculated the TVCF
using ARMA (P1 = 5, Q1 = 5) with the first order Legendre
function for subject 8455 of the MIT-BIH AF database. We used
the first order of Legendre polynomials as this choice resulted
in the best accuracy for the MIT-BIH AF database (N = 23).
Further, use of one Legendre function resulted in poles to be
within the unit circle, hence, all coherence values were bounded
between 0 and 1. The optimal ARMA model order was found to
be P1 = 5 and Q1 = 5 with seg = 128, which will be explained

Fig. 1. Resultant TVCF of subject 8455 of the MIT-BIH AF database according to each beat and normalized frequency.

in detail in the following section. We used a 128 beat segment,
which was then shifted by 128 beats. We used a 64-point FFT,
which resulted in a frequency resolution of 0.0156 Hz. Fig. 1
shows the resultant TVCFs according to each beat and normalized frequency (assuming a Nyquist frequency of 0.5 Hz). As
shown in Fig. 1, the TVCF values are close to one throughout the
entire frequency range for the two adjacent NSR data segments.
However, the TVCF values significantly decreased when either
or both segments partially or fully contained AF.
As shown in Fig. 1, we observe that the TVCF values are
highly varying for different frequencies when the patient is in
AF. That is, high frequencies tend to have lower coherence
values than lower frequencies, in AF (see Fig. 2). To illustrate
this phenomenon in more detail, we show some of the TVCF
values selected at various frequencies from Fig. 1 as a function
of time in Fig. 2(a). Fig. 2(b) shows the corresponding average
values of TVCF according to each normalized frequency and
each 128-beat segment for both the AF and NSR databases.
We note that for AF data, TVCF values start close to one at
low frequencies but they drop to low values quickly as the
frequency increases. However, for NSR data, the TVCFs are
nearly constant (slightly decreasing) at near unit values for all
frequencies. This can be explained by the fact that the selected
ARMA model terms for AF include largely self and its delay of
one lag terms [e.g., x(n), x(n–1), y(n), and y(n–1)], as expected,
thus, TVCF values will be high only at the low frequencies
and decreases as frequencies increase. Our results for AF is
expected since AF is known to have near random dynamics,
hence, ARMA model parameters are limited to only low lag
terms. Also note in the Fig. 2(a), we observe that the variance
of TVCF values is significantly high for AF but nearly constant
for NSR.
Based on the latter observation as described above, we propose AF detection by examining the variance of TVCF through
the entire frequency range. For each beat, we calculate the variance of TVCF values, termed the frequency variations (FV),

2786

Fig. 2.

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 10, OCTOBER 2013

TVCF at different frequencies with AF annotation and the mean of the TVCF with AF and NSR according to normalized frequency.

Fig. 3. True AF annotation; the values of FV. (a) MIT-BIH AF 4048.
(b) MIT-BIH AF 735. (c) MIT-BIH AF 7162.

among all frequencies. Using FV-TVCF, we investigated the
AF detection performance on the entire MIT-BIH AF database.
Fig. 3 shows FV-TVCF values and true AF annotation for three
representative subjects 4048, 735, and 7162 of the MIT-BIH
AF database. In Fig. 3(a), the data set 4048 contains seven AF
episodes with lengths of 206, 66, 37, 34, 388, 40, and 42 beats,
and the values of FV-TVCF increase in the beats where AF occurs. In Figs. 3(b), the data set 735 contains one AF episode with
a length of 332 beats whereas for the data set 7162 in Fig. 3(c),
AF episodes persist for the entire time segment shown. The
FV-TVCF values reflect this by never returning to a value of
zero.

Fig. 4. TVCF value distribution of the entire MIT-BIH AF database according
to each normalized frequency: (a) AF beats (b) NSR beats. The diamond above
and below represent the 95th and the 5th percentiles of TVCF values according
to each normalized frequency, and the square above and below represent the
90th and the 10th percentiles. Whiskers above and below represent the 75th and
the 25th percentiles, respectively. The circle indicates the median value.

In Fig. 4, we show the distribution of TVCF value for the
entire MIT-BIH AF database. Specifically, Fig. 4(a) and (b)
shows the distribution of TVCF value for AF and NSR beats,
respectively. The diamonds above and below represent the 95th
and the 5th percentiles of TVCF values according to each normalized frequency, and the squares above and below represent
the 90th and the 10th percentiles. Whiskers above and below

LEE et al.: TIME-VARYING COHERENCE FUNCTION FOR ATRIAL FIBRILLATION DETECTION

2787

the 1st, 25th, and 99th percentiles based on a histogram of the
RRI values, respectively. Note this strategy will remove some
but not all complex arrhythmia patterns.
We also combined SE as in (8) with FV-TVCF, to increase
the accuracy of AF detection. Specifically, the condition for AF
detection is given by a simple logical AND condition
1 If (FV-TVCF ≥ THvar ) AND (SE ≥ THSE ), then classify
it as AF.
2 Else classify it as non-AF (NSR),
where THvar and THSE are threshold values of FV-TVCF and
SE, respectively.
SE has been shown to be a robust detector of AF [8] and is
estimated according to the following calculation:
SE = −

N
b in

u =1

p (u)

log (p (u))

.
log N 1b i n

(8)

Note that the optimal Nbin varies with the segment lengths.
Hence, we also optimized the Nbin selection as well as the
selection of the threshold parameters THvar and THSE using the
receiver operating characteristic (ROC) curves as detailed in the
Section III.
III. RESULTS
A. MIT-BIH AF Database

Fig. 5.

Illustrative summary of TVCF for AF detection.

represent the 75th and the 25th percentiles, respectively. The
circle indicates the median value.
Fig. 5 shows an illustrative summary of the procedures involved in the calculation of TVCF for AF detection. Fig. 5(a)
shows an example of ECG signal from the data set 8455 of the
MIT-BIH AF database. After R peaks have been determined,
we calculate TVCF from the two adjacent beat segments (RRI
series) as shown in Figs. 5(b) and (c), where in this case seg
= 64. From the resultant TVCF, shown in Fig. 5(d), we then
calculate FV-TVCF for the AF detection.
D. Ectopic Beat Elimination and Shannon Entropy
Combination
A NSR segment including premature or ectopic beats may
also result in lower TVCF values. In order to reduce the effect of
the premature and ectopic beats, we eliminated outliers and filtered ectopic beats, as proposed in our earlier work [8]. To summarize, premature or ectopic beats can be recognized by their
signature short-long RR sequence between normal RRIs. For
each RRI in the time series, we computed the ratio RR(i)/RR(i–
1), where RR(i) is the ith beat, and eliminated RR(i) and RR(i
+ 1) when the following three conditions were satisfied: 1)
RR(i)/RR(i–1)<perc1, 2) RR(i + 1)/RR(i)>perc99 and 3) RR(i
+ 1)/RR(i + 2)>perc25, where perc1, perc25, and perc99 are

The top and bottom panels of Fig. 6 show the ROC curves
with 1 minus specificity versus sensitivity for THvar and THSE ,
respectively, with seg = 128 and P1 = Q1 = 5. For the ROC
evaluation, we found the number of True Positives (TP), True
Negatives (TN), False Positives (FP), and False Negative (FN),
and then calculated the sensitivity [TP/(TP+FN)], specificity
[TN/(TN+FP)], and accuracy [(TP+TN)/(TP+TN+FP+FN)].
The best accuracy was found to be 0.9791 with THvar = 0.019
and THSE = 0.79. We repeated the procedure by varying ARMA
model orders from (2, 2) to (10, 10) and segment lengths from 12
to 128; the results are shown in Fig. 7. Seg = 128 provided the
highest accuracy of all the segment length choices, but its result
was not much different than with seg = 96. Interestingly, short
segment lengths also provided high accuracy values (0.9222
with seg = 12 and 0.9421 with seg = 16). As for optimal
ARMA model order, the accuracies were almost constant for
(3,3) to (10,10) when seg = 128 or seg = 96. On the other
hand, when seg = 12 or seg = 16, the order (2,2) provided the
highest accuracy value. The detailed results for seg, (P1 ,Q1 ),
accuracy, sensitivity, specificity, THvar , and THSE are shown
in Table I. Using these optimal threshold values for seg = 128
[THvar = 0.019, THSE = 0.79, (p,q) = (5,5)] and seg = 12
(THvar = 0.000076, THSE = 0.38, (p,q) = (2,2), and seg = 12),
we applied them to other databases (e.g., Arr, Holter data, and
NSR). We are interested in short segment AF detection since
92.2% accuracy using only 12 beats is clinically significant as
some of the paroxysmal AF episodes can be as short as 12
beats [22]. Table II shows sensitivity, specificity, and accuracy
values with SE, FV-TVCF, and the combination of FV-TVCF
with SE when seg = 12 and seg = 128. Comparisons to the
recently published AF algorithms are presented in Table III. As

2788

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 10, OCTOBER 2013

Fig. 6. ROC curves (1-specificity versus sensitivity) by changing THva r from 0 to 0.1 and THS E from 0 to 0.1 where seg = 128, p = q = 5. (a) THva r =0.019
and (b) THS E = 0.79 .

Fig. 7.

Highest accuracy values according to model and segment length.

shown in Table III, our proposed algorithm provides the best
accuracy for the MIT-BIH AF database. In addition, we found
that the positive predictive values (PPVs) were 87.85% with seg
= 12 and 96.89% with seg = 128.
Clinically, it is important to detect the presence of AF episodes
in a given segment, not necessarily in every beat. Using this criterion on the MIT-BIH AF database (excluding files 4936 and
5091), the total number of true AF episodes is 255 and our algorithm with either seg = 12 or seg = 128 beats correctly detected
the presence of all AF episodes. This result outperforms other
recently published algorithms: 88.2% and 89.3% AF episode detection rate in Dash et al. [8] and Huang et al. [12], respectively.
In addition, our algorithm provides one of the fastest transition
times (e.g., AF to NSR or/and NSR to AF). Fig. 8 compares
the transition time (delay beats). The median of the transition
delay with seg = 12 is only six beats, which also outperforms
any other recently published algorithm: 18 beats and 70 beats in
Dash et al. [8] and Huang et al. [12]. Note that as the segment
length decreases, the transition delay becomes better while the
overall accuracy becomes worse.

It should be noted that in the MIT-BIH AF database, seven
data sets excluding subject 4936 include 30 394 beats that have
been classified as atrial flutter (AFL). Our method incorrectly
detected only 1576 beats as AF out of 30 394 AFL beats (5.19%).
It is possible that incorrect AF detection may be due to the fact
that some of these AFL may have been classified as atypical
forms of AFL, which have irregular RRI variability [23].
Fig. 9 shows the computation time according to seg and (p,q),
where the computation time is between 20 and 30 ms with seg
= 128, and between 3 and 4 ms with seg = 12 (programs
run in MATLAB 2010a on 2.66 GHz Intel Core2 processor).
This shows that our algorithm can be realizable in real time for
practical applications, and it is faster than other algorithms: 5.2 s
with seg = 128 in Lake and Moorman [24], 200 ms with seg
= 128 in Dash et al. [8], and 3 s with seg = 100 in Tateno and
Glass [11].

B. MIT-BIH NSR Database, MIT-BIH Arr Database, and
Clinical AF Database
We applied the optimal parameters mentioned above with seg
= 12 and seg = 128 to the MIT-BIH NSR database, MIT-BIH
Arr Database and Clinical AF Database. For the MIT-BIH NSR
database the specificity was 94.37% with seg = 12 and 99.7%
with seg = 128, which compares favorably to other published
results: 99.7% with seg = 128 in Dash et al. [8], 97.9% with
seg = 100 in Huang et al. [12], and 96.9% with seg = 500 in
Kikillus et al. [9]. For the 100 series MIT-BIH Arr database,
the specificity was 91.8% with seg = 12 and 99.7% with seg
= 128, whereas it was 99.5% in Dash et al. [8] with seg =
128. Note that the 100 series contains no true AF beats. For the
200 series MIT-BIH Arr database, the sensitivity and specificity
were 92.4% and 76.5% with seg = 12, and 91.1% and 89.7%
with seg = 128 which compares well with 90.2% and 91.2%
in Dash et al. [8] using seg = 128. In the 200 series MIT-BIH
Arr database, the total number of true AF episodes is 79, and
our algorithm with seg = 12 correctly detected 73 AF episodes

LEE et al.: TIME-VARYING COHERENCE FUNCTION FOR ATRIAL FIBRILLATION DETECTION

2789

TABLE I
FV-TVCF WITH SE-BASED ACCURACY, SENSITIVITY, AND SPECIFICITY ARE LISTED WITH OPTIMUM THRESHOLD VALUES

TABLE II
COMPARISON OF SENSITIVITY, SPECIFICITY, AND ACCURACY ON THE MIT-BIH
AF DATABASE; SE, FV-TVCF, AND FV-TVCF WITH SE

TABLE III
COMPARISON OF RECENT ALGORITHMS ON THE MIT-BIH AF DATABASE AND
THE MIT-BIH NSR DATABASE

(92.4%) which is better than the 73.4% in Dash et al. [8]. For the
clinical AF database, the sensitivity and specificity were 93.9%
and 84.4% with seg = 12, and 92.3% and 93.6% with seg =
128. Table IV summarizes the sensitivity and specificity values
for SE, FV-TVCF, and the combination of FV-TVCF with SE
when seg = 12 and seg = 128 based on MIT-BIH NSR, MITBIH Arr, and the Holter clinical databases. In addition, the PPVs
were 45.17% with seg = 12 and 64.93% with seg = 128 for the

MIT-BIH Arr 200 series. For the Holter clinical data, the PPVs
were 90.51% with seg = 12 and 95.61% with seg = 128. Note

2790

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 10, OCTOBER 2013

Fig. 8.

Comparison of transition delay (beats).

Fig. 9.

Computation time according to seg and (p,q).

TABLE IV
COMPARISON OF SENSITIVITY AND SPECIFICITY ON THE MIT-BIH NSR, ARR
AND CLINICAL DATABASE: SE, FV-TVCF, AND RV-TVCF WITH SE

that for the MIT-BIH Arr 200 series, the number of AF beats
(9282 beats) is much smaller than the number of NSR beats
(44 272 beats).
C. Smartphone Camera Data
We tested the algorithm with seg = 12, and obtained the sensitivity, specificity, and accuracy values of 91.40%, 93.93%, and
92.48%, respectively. These results show that highly accurate
AF detection can be achieved with short duration data from a
smartphone camera. With seg = 64, the sensitivity, specificity,
and accuracy were found to be 97.16%, 95.39%, and 96.45%,
respectively.
D. AF Surrogate Using White Noise
It is well accepted that dynamics of AF are random [25].
To examine if white noise dynamics has similar TVCF values
as that of AF, we generated 128 000 samples from a normal
distribution with mean 800 (ms) and standard deviation 30 (ms),
and statically added varying levels of white Gaussian noise.

Fig. 10. TVCF of simulated white noise: (a) TVCFs of the signal with the
–30 dB SNR according to each sample and normalized frequency, (b) Means of
TVCFs according to normalized frequency and SNR.

The values of mean and standard deviation were selected to
replicate the mean HR. The same ARMA model parameters for
the calculation of TVCF on MIT-BIH databases were used: seg
= 128 and P1 = Q1 = 5. Fig. 10(a) shows the TVCFs of the
signal with the SNR of −30 dB for each of the 128 data segment.
Similar to AF data [Figs. 1 and 2(b)], the TVCF values are close
to one at zero frequency, and then decays quickly to low values
with high degree of variability at high frequencies. Fig. 10(b)
shows the average values of TVCF as a function of different
SNR ranging from 0 to −40 dB. As expected, with the lowest
SNR, the TVCF values are the lowest.
To examine if TVCF is also a better white noise detector than
either the sample entropy or RMSSD, we show in Fig. 11simulation results based on varying levels of GWN. The rationale
for this simulation is under the supposition that AF dynamics
are similar to white noise. To each of the three plots, we provide AF detection threshold values for each of the method. The
sample entropy and RMSSD/mean threshold values were set to
−1.4 [24] and 0.1 [8], respectively, whereas the TVCF value of
0.019 was determined in the current study. As shown in Fig. 11,
the sample entropy detects the white noise or AF when the SNR
was –20 dB or lower. The RMSSD/mean could detect the white
noise when the SNR was −25 dB or lower. On the other hand,
FV-TVCF could detect the white noise when the SNR is either
greater than or equal to −15 dB. Thus, the FV-TVCF is more a
robust detector of white noise or AF since it has a wider dynamics range than either sample entropy or RMSSD approaches.

LEE et al.: TIME-VARYING COHERENCE FUNCTION FOR ATRIAL FIBRILLATION DETECTION

2791

Fig. 11. Comparison of sample entropy, RMSSD/mean, and FV-TVCF for the white noise detection (a) Sample entropy, (b) RMSSD/mean, (c) FV-TVCF. For
both RMSSD and sample entropy, any values above the defined threshold values are considered as AF detector whereas for TV-TVCF, it is below the defined
threshold value of 0.019.

Fig. 12.

Case study: TP (a,e), FN (b,f), TN (c,g), FP (d,h). Top panel shows RRI series and bottom panel shows FV-TVCF.

E. Ectopic Beat and Motion/Noise Artifact Elimination for the
AF Detection Enhancement
We can increase the AF detection accuracy on all databases
tested in this paper by eliminating ectopic beats albeit their
presence was minimal especially for the MIT-BIH AF, NSR,
and Arr 100 series data sets. The accuracy of AF detection on
the MIT-BIH AF improved from 91.2% to 92.2% and from
97.1% to 97.9% with ectopic beat elimination when seg = 12
and seg = 128, respectively. For the MIT-BIH NSR, the accuracy
improvement was negligible as ectopic beats were minimal. For
the MIT-BIH Arr 100 series, the accuracy improved from 88.4%
to 91.8% with seg = 12, and from 96.8% to 99.7% with seg =
128. For the MIT-BIH Arr 200 series, the accuracy improved
from 72.4% to 79.2% with seg = 12, and from 78.6% to 89.9%
with seg = 128. For the Holter clinical database, the accuracy
improved from 89.9% to 90.1% with seg = 12 and from 92.4%
to 92.9% with seg = 128.
Motion and noise artifact contamination is a significant problem for Holter recordings and they can result in false positive
detection of AF. Indeed, some portions of Holter data were affected by motion and noise artifacts, and subsequently have led
to incorrect R-wave peak location and AF detection. We recently
developed the automatic motion and noise artifact detection in
Holter ECG data [26], and used the algorithm for AF detection. Subsequently, by deleting the portions of data that were
deemed to be contaminated with motion and noise artifacts, the
specificity improved to 87.6% and 95.2% with seg = 12 and

seg = 128, respectively. The increase in the sensitivity values
was minor, however, for both data segment length.

F. Performance Analysis With Arrhythmias Other Than AF
In this study, the results from the MIT-BIH Arr 200 series
and the clinical AF database show decreased specificity when
compared to other databases (e.g., Arr 100), suggesting that
the presence of many arrhythmias other than AF in these two
databases are the culprit for the increased false positive rate. In
order to investigate the effect of arrhythmias other than AF (e.g.,
premature atrial and ventricular contractions) on the accuracy
of our algorithm, we further examined the specificity values
of AF detection for both the MIT-BIH 200 series and Holter
clinical data. For the MIT-BIH Arr 200 series, the specificity
values were 94.4% for the NSR and 81.2% for the arrhythmias
with seg = 128. For the Holter clinical database, the specificity
values were 94.1% for the NSR and 86.3% for the arrhythmias with seg = 128. These results indicate that arrhythmias
other than AF degrade the specificity of our algorithm due to
increased false positive rates. Upon further examination of the
reason for the decreased performance of our algorithm, what
we found was that most of these data segments contained more
than 50% arrhythmias other than AF. For example, of the 35 data
segments from MIT-BIH Arr 200 series and 23 segments from
the Holter clinical database with seg = 128 points, we found
that 49 segments of these databases included more than 50%

2792

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 60, NO. 10, OCTOBER 2013

arrhythmias (more than 64 beats). The remaining nine segments
contained at least 25% arrhythmias. Hence, this suggests that
our algorithm suffers in decreased specificity when arrhythmias
other than AF are present for more than 50% of the data length.
Certainly, the degradation of the specificity with our algorithm
is to be expected since the TVCF is not specifically designed to
discriminate other arrhythmias from the AF.
G. Additional Limitations
Fig. 12 shows the four cases of TP, FN, TN, and FP. The top
panel shows RRI series and the bottom panel shows the corresponding FV-TVCF. The TP, FN, TN, and FP are shown in
Fig. 12(a, e), (b, f), (c, g), and (d, h), respectively. As shown
in Fig. 12(b), RRI randomness or high variability is not always
associated with AF. This is the main limitation which affects
most, if not all algorithms that look for RRI variability. In addition, as shown in Fig. 12(d), frequent ectopic beats may lead to
a high false positive rate.
IV. DISCUSSION AND CONCLUSION
In this paper, we present a novel AF detection method by
using an ARMA model-based approach to calculate the TVCF.
The rationale for using the TVCF is twofold. First, AF dynamics
are known to be highly random [8], [27], thus, the coherence
function should be significantly lower than for NSR. Second, in
cases of paroxysmal AF, AF dynamics are not only nonstationary, but they also transition frequently between NSR and AF.
Indeed, Lovette and Roppella have applied the spectrogram approach to estimate TVCF and found that AF episodes have lower
coherence values than NSR [15]. Note that because the aim of
the study by Lovette and Ropella was not to detect AF episodes,
their method’s accuracy value was not reported [15]. Further,
because the spectrogram does not provide the best time- and
frequency resolution, its ability to find the transition between
AF and NSRs is not as optimal as that of our high-resolution
ARMA model-based TVCF [28]. Certainly, higher sampling
rate can lead to improved results for the spectrogram but it
may not be possible using certain recording device (e.g., smart
phone) [29]. The dominant AF frequency is known to be time
varying [30], thus, our use of TVCF is warranted. As noted in
our previous development of the TVCF algorithm, the accuracy
depends on the level of broadband characteristics of the signals.
Certainly, AF which has random dynamics is well suited for the
estimation of TVCF using our algorithm. Note also that NSR
broadband characteristics [15], [31] make it well suited for the
estimation by TVCF.
Utilizing our previously developed TVCF algorithm for AF
detection, the AF detection accuracy was better than that reported in most previous studies [8]–[12]. Using our TVCF approach, the accuracy values with seg = 128 were 97.9%, 100%,
94.3%, and 92.2% on the MIT-BIH AF, the MIT-BIH NSR, the
MIT-BIH Arr and clinical databases, respectively. While these
accuracy values are noteworthy, the most attractive feature of the
TVCF is that it can be used to accurately find AF onset and the
transition to NSR since our approach provides good accuracy
even with short data segments (seg = 12). This is important

in order to accurately calculate AF burden, a measure of the
percent of time a patient spends in AF.
Furthermore, our method is applicable for a Holter system
as it is real-time realizable. The computation time was approximately 3–4 ms with seg = 12 and 20–30 ms with seg = 128
running MATLAB 2010a on a 2.80 GHz Intel Core2 processor.
Real-time realizable capability is important not only for Holter
monitoring, but also for AF detection using mobile devices [29].
We have recently shown that RRI data can be derived from a
video camera that resides in a smart phone [29]. Given this new
capability, AF detection is possible using a smart phone and the
need for a real-time detection AF algorithm becomes even more
evident.
REFERENCES
[1] A. S. Go, E. M. Hylek, K. A. Phillips, Y. Chang, L. E. Henault, J. V. Selby,
and D. E. Singer, “Prevalence of diagnosed atrial fibrillation in adults:
National implications for rhythm management and stroke prevention: The
AnTicoagulation and Risk Factors in Atrial Fibrillation (ATRIA) Study,”
J. Amer. Med. Assoc., vol. 285, no. 18, pp. 2370–5, May 2001.
[2] I. Hajjar and T. A. Kotchen, “Trends in prevalence, awareness, treatment,
and control of hypertension in the United States, 1988–2000,” J. Amer.
Med. Assoc., vol. 290, no. 2, pp. 199–206, Jul. 2003.
[3] T. S. Tsang, G. W. Petty, M. E. Barnes, W. M. O’Fallon, K. R. Bailey,
D. O. Wiebers, J. D. Sicks, T. J. Christianson, J. B. Seward, and
B. J. Gersh, “The prevalence of atrial fibrillation in incident stroke cases
and matched population controls in Rochester, Minnesota: Changes over
three decades,” J Amer. Coll. Cardiol., vol. 42, no. 1, pp. 93–100, Jul.
2003.
[4] M. Fukunami, T. Yamada, M. Ohmori, K. Kumagai, K. Umemoto,
A. Sakai, N. Kondoh, T. Minamino, and N. Hoki, “Detection of patients
at risk for paroxysmal atrial fibrillation during sinus rhythm by P wavetriggered signal-averaged electrocardiogram,” Circulation, vol. 83, no. 1,
pp. 162–9, Jan. 1991.
[5] G. Opolski, P. Scislo, J. Stanislawska, A. Gorecki, R. Steckiewicz, and
A. Torbicki, “Detection of patients at risk for recurrence of atrial fibrillation after successful electrical cardioversion by signal-averaged P-wave
ECG,” Int. J. Cardiol., vol. 60, no. 2, pp. 181–5, Jul. 25, 1997.
[6] M. Budeus, M. Hennersdorf, C. Perings, and B. E. Strauer, “Detection
of atrial late potentials with P wave signal averaged electrocardiogram
among patients with paroxysmal atrial fibrillation,” Z. Kardiol., vol. 92,
no. 5, pp. 362–9, May 2003.
[7] D. Michalkiewicz, M. Dziuk, G. Kaminski, R. Olszewski, M. Cholewa,
A. Cwetsch, and L. Markuszewski, “Detection of patients at risk for paroxysmal atrial fibrillation (PAF) by signal averaged P wave, standard ECG
and echocardiography,” Pol. Merkur. Lekarski., vol. 20, no. 115, pp. 69–72,
Jan. 2006.
[8] S. Dash, K. H. Chon, S. Lu, and E. A. Raeder, “Automatic real time detection of atrial fibrillation,” Annu. Biomed. Eng., vol. 37, no. 9, pp. 1701–9,
Sep. 2009.
[9] N. Kikillus, G. Hammer, N. Lentz, F. Stockwald, and A. Bolz, “Three
different algorithms for identifying patients suffering from atrial fibrillation during atrial fibrillation free phases of the ECG,” Comput. Cardiol.,
vol. 34, pp. 801–804, 2007.
[10] B. Logan and J. Healey, “Robust detection of atrial fibrillation for a long
term telemonitoring system,” Comput. Cardiol., vol. 32, pp. 619–622,
2005.
[11] K. Tateno and L. Glass, “Automatic detection of atrial fibrillation using
the coefficient of variation and density histograms of RR and deltaRR
intervals,” Med. Biol. Eng. Comput., vol. 39, no. 6, pp. 664–71, Nov.
2001.
[12] C. Huang, S. Ye, H. Chen, F. He, and Y. Tu, “A novel method for detection
of the transition between atrial fibrillation and sinus rhythm,” IEEE Trans.
Biomed. Eng., vol. 58, no. 4, pp. 1113–9, Apr. 2011.
[13] H. Zhao, S. Lu, R. Zou, K. Ju, and K. H. Chon, “Estimation of timevarying coherence function using time-varying transfer functions,” Annu.
Biomed. Eng., vol. 33, no. 11, pp. 1582–94, Nov. 2005.
[14] L. S. Sarraf, J. A. Roth, and K. M. Ropella, “Differentiation of atrial
rhythms from the electrocardiogram with coherence spectra,” J. Electrocardiol., vol. 35, no. 1, pp. 59–67, Jan. 2002.

LEE et al.: TIME-VARYING COHERENCE FUNCTION FOR ATRIAL FIBRILLATION DETECTION

[15] E. G. Lovett and K. M. Ropella, “Time-frequency coherence analysis of
atrial fibrillation termination during procainamide administration,” Annu.
Biomed. Eng., vol. 25, no. 6, pp. 975–84, Nov.-Dec. 1997.
[16] S. L. Marple, Digital Spectral Analysis With Applications. Englewood
Cliffs, NJ,, USA: Prentice-Hall, 1987.
[17] A. L. Goldberger, L. A. Amaral, L. Glass, J. M. Hausdorff, P. C. Ivanov,
R. G. Mark, J. E. Mietus, G. B. Moody, C. K. Peng, and H. E. Stanley,
“PhysioBank, PhysioToolkit, and PhysioNet: Components of a new research resource for complex physiologic signals,” Circulation, vol. 101,
no. 23, pp. E215–20, Jun. 2000.
[18] R. Zou, H. Wang, and K. H. Chon, “A robust time-varying identification
algorithm using basis functions,” Annu. Biomed. Eng., vol. 31, no. 7,
pp. 840–53, Jul./Aug. 2003.
[19] J. Lee and K. H. Chon, “Time-varying autoregressive model-based multiple modes particle filtering algorithm for respiratory rate extraction from
pulse oximeter,” IEEE Trans. Biomed. Eng., vol. 58, no. 3, pp. 790–4,
Mar. 2011.
[20] L. Faes, G. Nollo, and K. H. Chon, “Assessment of Granger causality by
nonlinear model identification: Application to short-term cardiovascular
variability,” Annu. Biomed. Eng., vol. 36, no. 3, pp. 381–95, Mar. 2008.
[21] X. Xiao, Y. Li, and R. Mukkamala, “A model order selection criterion with
applications to cardio-respiratory-renal systems,” IEEE Trans. Biomed.
Eng., vol. 52, no. 3, pp. 445–53, Mar. 2005.
[22] G. Y. Lip and F. L. Hee, “Paroxysmal atrial fibrillation,” QJM, vol. 94,
no. 12, pp. 665–78, Dec. 2001.
[23] D. E. Krummen, G. K. Feld, and S. M. Narayan, “Diagnostic accuracy
of irregularly irregular RR intervals in separating atrial fibrillation from
atrial flutter,” Amer. J. Cardiol., vol. 98, no. 2, pp. 209–14, Jul. 2006.
[24] D. E. Lake and J. R. Moorman, “Accurate estimation of entropy in very
short physiological time series: The problem of atrial fibrillation detection
in implanted ventricular devices,” Amer. J. Physiol. Heart Circ. Physiol.,
vol. 300, no. 1, pp. H319–25, Jan. 2011.

2793

[25] M. A. Allessie, C. J. Kirchhof, K. T. Konings et al., “Unravelling the
electrical mysteries of atrial fibrillation,” Eur. Heart J., vol. 17, pp. 2–9,
Jul. 1996.
[26] J. Lee, D. McManus, S. Merchant, and K. H. Chon, “Automatic motion
and noise artifact detection in Holter ECG data using empirical mode
decomposition and statistical approaches,” IEEE Trans. Biomed. Eng.,
vol. 59, no. 6, pp. 1499–506, Jun. 2012.
[27] K. M. Stein, J. Walden, N. Lippman, and B. B. Lerman, “Ventricular response in atrial fibrillation: Random or deterministic?,” Amer. J. Physiol.,
vol. 277, no. 2, pp. H452–8, Aug. 1999.
[28] S. Lu, K. H. Ju, and K. H. Chon, “A new algorithm for linear and nonlinear
ARMA model parameter estimation using affine geometry,” IEEE Trans.
Biomed. Eng., vol. 48, no. 10, pp. 1116–24, Oct. 2001.
[29] C. G. Scully, J. Lee, J. Meyer, A. M. Gorback, D. Granquist-Fraser, and
K. H. Chon, “Physiological parameter monitoring from optical recordings
with a mobile phone,” IEEE Trans. Biomed. Eng., vol. 59, no. 2, pp. 303–6,
Feb. 2012.
[30] R. Alcaraz, F. Sandberg, L. Sornmo, and J. J. Rieta, “Classification of
paroxysmal and persistent atrial fibrillation in ambulatory ECG recordings,” IEEE Trans. Biomed. Eng., vol. 58, no. 5, pp. 1441–9, May 2011.
[31] K. H. Chon, Y. M. Chen, N. H. Holstein-Rathlou, and V. Z. Marmarelis,
“Nonlinear system analysis of renal autoregulation in normotensive and
hypertensive rats,” IEEE Trans. Biomed. Eng., vol. 45, no. 3, pp. 342–53,
Mar. 1998.
[32] J. Lee, D. McManus, and K. Chon, “Atrial fibrillation detection using
time-varying coherence function and Shannon entropy,” in Proc. IEEE
Conf. Eng. Med. Biol. Soc., 2011, pp. 4685–8.

Authors’ photographs and biographies not available at the time of publication.

