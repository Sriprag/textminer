1644

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 6, JUNE 2015

Analysis of Forced Expiratory Flow Signals Using
the New Luus–Jaakola Optimization Procedure
Zijun He, Zuchang Ma, Yubing Xu, Yongliang Zhang, Fusong Hu, Yining Sun, and Duoqi Zhou∗

Abstract—Objective: The aim of this study was to estimate forced
vital capacity (FVC) by analyzing incomplete forced expiratory
flow–time (FEFT) curves using the new Luus–Jaakola (NLJ) optimization procedure. Methods: Complete FEFT curves from 90
subjects with and without respiratory disease were used to validate the method, and its application performance was evaluated
by FEFT curves containing incomplete curves from nine obstructive patients. First, a lumped parameter model of the FEFT curve,
taking FVC as one of the model parameters, is chosen. The 0–
1 s, 0–1.5 s, . . . , 0–6 s curves chosen from the accepted FEFT
curves are, respectively, taken as the local system observations.
Then, the NLJ optimization procedure was used to get the estimate
of FVC (FVCe st ) by estimating the model parameters. Finally,
FVCe st was compared with the measured FVC (FVCm e a ).
Results: The difference between FVCe st and FVCm e a decreased
with the lengths of observed curves increasing. When the lengths of
observed curves reached 3 s, the mean difference (±SD) between
FVCe st and FVCm e a was −11 ± 58 mL. Estimated FVC derived from the incomplete curves were close to FVC from accepted
maneuvers. Conclusion: The method can be used to estimate FVC
by analyzing an incomplete FEFT curve, providing the length of
the curve is more than 3 s. Significance: This method can help the
subjects who cannot complete the forced expiratory maneuver to
provide a reliable estimate of FVC and also can be used to analyze the unacceptable spirometry because of early termination of
exhalation.
Index Terms—Forced vital capacity (FVC), mathematical model,
new Luus–Jaakola (NLJ) optimization procedure, spirometry, system identification.

I. INTRODUCTION
ESTRICTIVE and obstructive ventilatory defects are becoming a major public health problem. In particular, more
and more people are suffering from chronic obstructive pulmonary disease (COPD) or have died [1]. Today, COPD is the
fourth-leading cause of death worldwide, and it is predicted to
become the third within the next decade [2]. Although COPD
is one of main causes of death, many patients with COPD are

R

Manuscript received July 3, 2014; revised January 30, 2015, January 19,
2015, and November 11, 2014; accepted January 30, 2015. Date of publication
February 4, 2015; date of current version May 18, 2015. This work was supported
by National Natural Science Foundation of China under Grant 61301059 and by
National Science and Technology Pillar Program under Grant 2013BAH14F01.
Asterisk indicates corresponding author.
Z. He, Y. Xu, Y. Zhang, F. Hu, and Y. Sun are with the Research Center for
Information Technology of Sports and Health, Institute of Intelligent Machines,
Chinese Academy of Science.
Z. Ma is with the Research Center for Information Technology of Sports and
Health, Institute of Intelligent Machines, Chinese Academy of Science, and also
with Jiangsu Research Institute of Sports Science.
∗ D. Zhou is with the Department of Physical Education, Anqing Teachers
College, Anqing 246011, China (e-mail: zuoqizhou@163.com).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2015.2400227

underdiagnosed [3]. Several studies have shown that the COPD
can be diagnosed early, and prevented from developing by early
diagnosis and management [4], [5]. Therefore, lung function
test is needed to diagnose COPD patients early [5].
Spirometric examination is an essential tool in the diagnosis
of airway obstruction and to some extent in the detection of
restriction [6], [7]. The significant parameters measured using
spirometer are forced vital capacity (FVC), forced expiratory
volume in 1 s (FEV1 ), and the ratio of FEV1 /FVC. Obstructive pulmonary diseases are characterized by a small value of
FEV1 /FVC, whereas small values of FVC and normal ratios
FEV1 /FVC indicate restrictive pulmonary diseases [8]. Obviously, FVC is a key indicator to quantify the severity of disease.
In order to obtain an accurate value of FVC, spirometry can
be demanding, often requiring prolonged exhalation time to
achieve a plateau on the volume–time curve, indicating fulfilling the end-of-test (EOT) criteria, which is recommended by
the American Thoracic Society/European Respiratory Society
(ATS/ERS) [9]. EOT criteria have put forward strict requirements on equipment, operators, and subjects. Many tests fail
in the spirometric examination because of EOT criteria [10].
Therefore, the National Heart, Lung, and Blood Institute recommended the replacement of FVC with forced expiratory volume
in 6 s (FEV6 ) to simplify spirometry in 2000 [11]. However,
elder subjects or patients with severely impaired lung function
are often unable to perform full spirometry [12], [13]. Moreover,
it is not easy for subjects, who have never been trained, especially the people with poor understanding and less education, to
achieve 6 s of exhalation [14]. To further simplify spirometry,
Ioachimescu et al. proposed a regression equation for estimating
FVC from measured values of the forced expiratory volume in
2 s (FEV2 ) and the forced expiratory volume in 3 s (FEV3 ).
However, because the equation is only the result of statistical
analysis based on a large number of acceptable spirometric examinations, there is a bigger difference between the estimated
and measured FVC in practice [15].
The aim of this study was to propose a new method for estimating FVC by analyzing incomplete forced expiratory flow–
time (FEFT) curves due to failing to meet the EOT criteria using
the new Luus–Jaakola (NLJ) optimization procedure. System
identification can be identified as “to find a model with adjustable parameters and then to adjust them so that the predicted
output matches the measured output” [16]. The lumped parameter model of FVC maneuver, proposed by Abboud et al., uses
a theoretical approximation of an activating function representing the lung’s pressure-volume relationship during maximally
forced expiration [17]. Because FVC is one of the model parameters, the model is suitable for getting the estimate of FVC by

0018-9294 © 2015 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

HE et al.: ANALYSIS OF FORCED EXPIRATORY FLOW SIGNALS USING THE NEW LUUS–JAAKOLA OPTIMIZATION PROCEDURE

estimating the model parameters. The first part of the accepted
FEFT curve is taken as the local system observation. Then,
system identification is used to estimate the model parameters.
Because FVC-parameter of the model parameters represents the
FVC of the whole accept FEFT curve, FVC can be taken as the
estimate of FVC by analyzing the first part of the FEFT curve.
There have been several system identification methods. The
Luus–Jaakola (LJ) optimization procedure was first proposed
by Luus and Jaakola [18]. It can be applied to various systems
model parameter identification and exhibits a high reliability of
obtaining the global optimum. Moreover, it is easy to program
[19]. The NLJ optimization procedure retains the advantage of
the LJ algorithm, and speed up the convergence [20]. Therefore,
it is considered to be the research method in this study.
In order to validate this method for estimating FVC, the 0–1 s,
0–1.5 s, . . . , 0–6 s curves chosen from accepted FEFT curves
were, respectively, taken as the local system observations. Then,
the NLJ optimization procedure was used to get the estimate of
FVC by estimating the model parameters. Finally, estimated
FVC was compared with the measured FVC.
II. MATERIALS AND METHODS
A. Data Selection
Recording of forced expiratory flow signals was performed
using a pulmonary function electronic monitoring device (PVF100; Institute of Intelligent Machines, Hefei, China) that measures flow rates with an orifice plate pneumotachometer, digitizes and stores flow data with a resolution of 7 mL/s and a
sampling frequency of 200 Hz.
To validate the method for estimating FVC, spirometric data
sets came from the tests performed by PVF-100 between June
2012 and November 2013 (data I). The performance of the
method for estimating FVC based on incomplete FEFT curves
was evaluated by the data sets, containing incomplete data,
performed by PVF-100 between January 2014 and July 2014
(data II). Every subject signed an informed consent form before
the test.
The selection criterion of FEFT curves in data I was that the
curves satisfied the ATS/ERS acceptability and reproducibility
criteria [9]. For improving the reliability of this method, FEFT
curves were rejected if at least one of the following conditions
was observed: 1) any discernible cough or varying effort during
the forced expiratory maneuver; 2) the length of the FEFT curve
was less than 6 s except that the forced expiratory time of the
patients with restrictive ventilatory defect can be more than
5 s; 3) a poor start of test, or back-extrapolated volume >5%
of total expiratory volume or 0.15 L, whichever was greater;
(4) end-of-test volume >25 mL.
The selection criteria of FEFT curves in data II were described
as follows: 1) all the data came from patients with obstructive
ventilatory defect; 2) the accepted complete curves should satisfy the criteria of data I; 3) the difference between FEV1 from
the incomplete curve and the corresponding best accepted curve
was less than 150 mL; 4) the length of the incomplete curve
was more than 3 s; 5) there was no discernible cough or varying
effort observed by the incomplete curves.

1645

B. Model Selection
Several mathematic model and computer simulations of respiratory mechanics have been developed to study the shape of the
maximum expiratory flow-volume curve [21], [22]. However,
these models are complicated and involve demanding computations. Abboud et al., proposed a lumped parameter model of the
FVC maneuver. This model used a theoretical approximation of
an activating function representing the lung’s pressure–volume
relationship during maximally forced expiration [17]. The core
of the model was based on Poiseuille’s law that the flow Q(t) was
calculated as the ratio of the driving pressure P(t) and airways
resistance R
Q(t) =

P (t)
R

(1)

The pressure P(t) developed in the lung can be expressed as
follows:
P (t) = Em ax (1 − e−t/τ )(FVC − Ve (t))

(2)

where Em ax is the maximum level of contraction expressed as
a pressure ratio in units of mmHg/mL and the time constant of
contraction τ is a parameter in units of second; Ve (t) is expressed
as the flow integrated from the beginning of expiration to time
t, and FVC can be expressed as the flow integrated from the
beginning to the end of the forced expiration (te )


te

FVC =

Q(ε)dε
0


Ve (t) =

t

Q(ε)dε.

(3)

0

The airways resistance R was represented by a volumedependent piecewise-linear function with several segments having different coefficients for each volume range limited by Vj
R1 (Ve ) = a1 Ve , q = 1
Rq (Ve ) = R0 +

q


(ai−1 − ai )Vi−1 + ai Ve , q ≥ 2 (4)

i=1

Using (1), (2), and (4), we can write the flow Q(t) as
Q(t) =

Em ax
(1 − e−t/τ )(FVC − Ve (t)
R(Ve )

(5)

The model was used to exact airways resistance and other
information about lung by the model parameters [23]. In this
study, (5) is taken as the mathematical model of FEFT curves,
of which the parameters are a0 , a1 , . . . , aq , Em ax , τ , and FVC.
The first part of the accepted FEFT curve is taken as the local
system observation. Then, system identification is used to estimate the model parameters. According to (3), FVC denotes the
flow integrated from the beginning to the end of the forced expiration. Therefore, the FVC-parameter estimated by the system
identification based on the local system identification, can be
taken as the estimate of FVC.

1646

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 6, JUNE 2015

C. NLJ Optimization Procedure
The NLJ optimization procedure is one of the simplex random
number direct search optimization methods, which narrows the
search regularly after each search, and does not stop searching
until finding the optimal result by satisfying desired condition.
It does not need a lot of mathematic foundation and can be
programmed easily. The direct search optimization is straightforward:
1) Determine the number of parameters (n). We assume that
the volume interval is 1 L in (4). For example, there are
no more than ten parameters for a flow–time curve with
the value of FVC under 7 L.
2) Initialize the random matrix Ym ×n , of which all the element values yk i (k = 1, 2, . . . , m; i = 1, 2, . . . , n) range
in [−0.5, 0.5]. Usually, the value of m is greater than 2n .
The larger the value of m is, the higher the computation
complexity of the NLJ optimization procedure is. Therefore, we set m to 1500.
3) Choose a reasonable initial parameter vector


a(0) = a(0) (1) a(0) (2) a(0) (3) ... a(0) (n)
(6)
where a(j) (i) denotes the search result of the ith parameter
by searching j times. The region-size vector r(1) can be
the a multiple of a(0) :
(1)

r

= Con · a

(0)

where Con is a constant and usually taken as 2.
4) Determine the performance index P
 te
[Q(t) − f (t)]2 dt
P =

(8)

where f(t) is measured flow at time t and Q(t) is the output
of the model.
5) Iterative calculations. Calculate the values of parameters
as follows:
(j )

(j −1)

(i) + yk i r(j ) (i)

Flowchart of the NLJ optimization procedure.

(7)

0

ak (i) = ak

Fig. 1.

(9)

where k = 1, 2, . . . , m. Calculate the output of the model
(j )
((5)) using the parameter ak (i). Then, the initial values
of the parameter vector for next calculation are selected
from the m groups of performance indexes to meet the
constraints and the minimum P value

(j )
(10)
a(j ) (i) = ak (i) m in[P (a ( j ) (i))]
6) Reduce the region-size vector r by ψ through r(j +1) =
ψ · r(j ) .
7) Go to step 5) and continue until the performance index
P is no longer reduced or some convergence criterion is
satisfied.
8) Print the results.
Fig. 1 shows the flowchart of the NLJ optimization procedure.
There are four points that need to be emphasized: 1) the core
of the NLJ algorithm is the selection of ψ. The value of ψ,
varying according to the following formula ((11)), can speed
up the convergence of the NLJ optimization procedure with a
good result [20], [31]; 2) f(t) denotes the observed curve; 3) in

order to improve the accuracy of the model parameter vector
estimated by the NLJ optimization procedure, the flow will be
multiplied by a magnification factor λf (λ∗f FVC < 7 L) for the
curve with FVC < 3.5 L; 4) since mixed pulmonary disease
is characterized by low FEV1 /FVC and FVC, patients with
mixed pulmonary disease, of which FVC is multiplied by λf ,
can merge with patients with obstructive ventilatory defect
⎧
1.0,
J =1
⎪
⎪
⎨
0.95,
1<J <6
ψ=
(11)
0.76,
6 ≤ J ≤ 11
⎪
⎪
⎩
0.475,
J > 11

D. Statistical Analyses
In order to validate this method, one accepted FEFT curve
with the measured FVC (FVCm ea ) was selected from each subject in data I. The 0–1 s, 0–1.5 s, . . . , 0–6 s curves chosen from
the accepted FEFT curves were, respectively, taken as the local system observations. Then, the NLJ optimization procedure
was used to get the estimate of FVC (FVCest ) by estimating the
model parameters.
All subjects in data I were classified into three groups by
the test results: normal group, mixed or obstructive pulmonary
disease group, and restrictive disease group. Then, statistical
analysis of the absolute difference |FVCest − FVCm ea | was
to evaluate the effect of the lengths of observed curves on the
estimation accuracy. To further investigate the accuracy and reliability of the estimate of FVC derived from the 0–3 s curves,
only the FEFT curve, of which the length is more than 6 s,

HE et al.: ANALYSIS OF FORCED EXPIRATORY FLOW SIGNALS USING THE NEW LUUS–JAAKOLA OPTIMIZATION PROCEDURE

1647

Fig. 2. Examples of analysis of forced expiratory flow signals using the NLJ optimization procedure. All the four curves, respectively, came from (a) a normal
subject, (b) a patient with restrictive ventilatory defect, (c) a patient with asthma, and (d) a patient with emphysema. The 0–3 s curve chosen from the measured
flow–time curve (dotted line) with measured FVC m e a was taken as the local system observations. Then, the NLJ optimization procedure was used to get the
estimate of FVC (FVC e st ) by estimating the model parameters. The solid lines were generated by the model. FEV 1 forced expiratory volumes in 1 s; FEV 3 ,
forced expiratory volumes in 3 s.

is taken as the system output. The 0–3 s curves chosen from
the selected curves were considered as the local system observations. Then, Pearson correlation coefficient (R) between the
estimate of FVC (FVC3 ) obtained by the NLJ optimization procedure and FVCm ea was calculated. The mean of the difference
FVC3 − FVCm ea was calculated as described by Bland and
Altman.
To further evaluate the performance of the method for estimating FVC based on incomplete FEFT curves, two FEFT
curves were selected from each patients in data II. One satisfied the ATS/ERS acceptability criteria with the best FVC value
(FVCm ea ), and the other failed to meet the EOT criteria recommended by ATS/ERS with the measured FVC value FVCfail .
The whole complete curve, 0–3 s curve chosen from the incomplete curve, and the whole incomplete curve were, respectively,
taken as the system observations, and then the respective values of FVC parameter were obtained (FVCm est for FVCm ea ,
FVC3 est for FVCfail when the length of the chosen curve is 3 s
and FVCf est for FVCfail when choosing the whole incomplete
curve). The application performance of this method was evaluated by the differences between measured FVC and estimated
FVC.
III. RESULTS
Table I presents the demographic and spirometric characteristics of the 90 subjects whose spirometric examination satisfied

the selection criteria of data I. All data are presented as mean ±
SD or number.
Fig. 2 presents some examples of analysis of forced expiratory flow signals using the NLJ optimization procedure. The
NLJ optimization procedure can always find the optimal parameter vector, and get the estimate of FVC, when the 0–3 s curves
chosen from the accepted FEFT curves with different shapes
were taken as the local system observations. All the four curves
came from a normal subject (a), a patient with restrictive ventilatory defect (b), a patient with asthma (c), and a patient with
emphysema (d), and their lengths were all over 6 s.
The relationship between the absolute difference |FVCest −
FVCm ea | with the lengths of observed curves is depicted in
Fig. 3. The absolute difference |FVCest − FVCm ea | decreased
with the lengths of observed curves increasing in each group. Restrictive disease group performed the best [see Fig. 3(c)], while
mixed or obstructive pulmonary group performed the worst [see
Fig. 3(b)]. When the lengths of observed curves were over 3 s,
the absolute difference |FVCest − FVCm ea | can be predominantly below 150 mL.
Fig. 4 displays the correlation of measured FVCm ea and
estimated FVC3 derived from 74 accepted FEFT curves, of
which the lengths were all over 6 s. The estimated FVC3
and FVCm ea had a significantly high correlation (R2 = 0.996,
p < 0.001). Moreover, the differences between estimated FVC3
and FVCm ea did not increase with the FVCm ea as shown in the
Bland–Altman plot [see Fig. 4(b)], which satisfied the condi-

1648

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 6, JUNE 2015

TABLE I
DEMOGRAPHIC AND SPIROMETRIC CHARACTERISTICS OF THE 90 SUBJECTS IN DATA I
Characteristics
Number
Female/male gender
FET ≥ 6 s/FET < 6 s
Age (years)
Height (cm)
Weight (kg)
BMI
FVC (L)
Estimated FVC3 (L)

Normal

Obstructive or mixed

Restrictive

All

44
12/32
44/0
47.2 ± 20.4
168.6 ± 6.3
68.6 ± 10.0
24.0 ± 2.7
3.79 ± 0.92
3.77 ± 0.91

20
9/11
20/0
59.3 ± 14.6
165.3 ± 9.2
62.9 ± 11.4
22.9 ± 2.5
2.93 ± 0.90
2.93 ± 0.91

26
14/12
10/16
56.9 ± 15.0
164.9 ± 7.7
67.0 ± 9.9
24.6 ± 3.0
2.45 ± 0.56
2.45 ± 0.56

90
35/55
74/16
52.7 ± 18.5
166.8 ± 7.6
66.8 ± 10.4
23.9 ± 2.8
3.21 ± 1.01
3.21 ± 1.00

Values are mean ± SD or number.
FET, forced expiratory time; BMI, body mass index; FVC, forced vital capacity.

Fig. 4. (a) Regression plots and (b) Bland–Altman plots of the estimated
FVC e st and measured FVC m e a .

Fig. 3. Relationship between the absolute difference |FVC e st − FVC m e a |
with the lengths of observed curves in (a) normal group, (b) mixed or obstructive
pulmonary disease group, and (c) restrictive disease group. Values represent
means ± SD. ∗ The lengths of some curves are < 6 s. ∗∗ The lengths of some
curves are < 5.5 s.

tion of the analysis of the limits of agreement. The analysis of
the limits of agreement for FVC values indicates that the mean
bias of FVC is close to zero, the value of the standard deviation
is 58 mL, and the 95% limit of agreement is in the range of
−127 to 105 mL, which is within the limits of reproducibility
suggested by the ATS/ERS [9].

To further evaluate the performance of the method for estimating FVC, complete and incomplete FEFT curves from nine
patients with obstructive ventilatory defect, were analyzed by
the method described earlier. The demographic and spirometric
characteristics of the nine patients are presented in Table II.
Fig. 5 shows an example of analysis of complete and incomplete FEFT curves using the NLJ optimization procedure. All
the curves came from a light obstructive patient. The estimated
FVCm est derived from the complete FEFT curve was close
to the measured FVCm ea . The measured FVCfail from the incomplete FEFT curve was obviously less than FVCm ea , leading
to the overestimate of FEV1 /FVCfail , whereas the estimated
FVC (FVC3 est and FVCf est ) derived from the incomplete

HE et al.: ANALYSIS OF FORCED EXPIRATORY FLOW SIGNALS USING THE NEW LUUS–JAAKOLA OPTIMIZATION PROCEDURE

1649

TABLE II
DEMOGRAPHIC AND SPIROMETRIC CHARACTERISTICS OF THE 9 SUBJECTS
IN DATA II
Variables

mean ± SD

Range

Age (years)
Male
Height (cm)
Weight (kg)
BMI
FVC m e a (L)
FVC m e s t (L)
FVC f a i l (L)
FVC 3 e s t (L)
FVC f e s t (L)
FEV 1 /FVC m e a (%)
FEV 1 /FVC m e s t (%)
FEV 1 /FVC f a i l (%)
FEV1/FVC 3 e s t (%)
FEV1/FVC f e s t (%)

59.6 ± 12.8
44.4%
166.6 ± 8.1
62.2 ± 8.9
22.4 ± 2.8
2.88 ± 0.88
2.89 ± 0.88
2.67 ± 0.88
2.88 ± 0.90
2.88 ± 0.87
66.0 ± 7.3
65.6 ± 7.4
69.8 ± 7.5
64.4 ± 7.3
64.4 ± 7.4

40–81
155–182
48–76
17.2–26.7
1.97–4.85
2.00–4.86
1.71–4.70
1.87–4.86
1.93–4.79
48.9–71.5
48.4–71.4
55.3–76.3
48.1–70.5
47.9–71.0

Values are mean ± SD or n%.
BMI, body mass index; FEV 1 , forced expiratory volumes in 1 s. FVC m e a is the forced
vital capacity derived from the acceptable maneuver. FVC f a i l is derived from the unacceptable maneuver because of early termination of exhalation. FVC m e s t is the estimated
FVC by analyzing the whole completed curve. FVC m e s t and FVC f e s t are, respectively, the estimated FVC by analyzing the 0–3 s of the incomplete curve and the whole
incomplete curve.

FEFT curves was close to FVCm ea . We can still identify airflow limitation by FEV1 /FVC3 est or FEV1 /FVCf est .
The comparison of estimated and measure FVC derived from data II was analyzed by the paired ttest (see Table III). The measured FVCfail from incomplete FEFT curves were less than FVCm ea from
complete FEFT curves in general (mean = −211 mL,
SD = 125 mL), leading to the overestimate of FEV1 /FVC
(mean = 3.8%, SD = 2.6%). There is no significant difference
between estimated FVC3 est and FVCm ea (p > 0.05), as well
as FVCf est and FVCm ea (p > 0.05). The mean difference between FEV1 /FVC3 est and FEV1 /FVCm ea was significantly
reduced (mean = −1.5%, SD = 1.3%). FEV1 /FVCf est performed a little better than FEV1 /FVC3 est , and the mean difference between FEV1 /FVCf est and FEV1 /FVCm ea was also
significantly reduced (mean = −1.6%, SD = 1.0%).
IV. DISCUSSION
In this study, the combination of the lumped parameter model
of FVC maneuver and the NLJ optimization procedure was applied to the estimate of FVC. The NLJ optimization procedure
can estimate FVC by analyzing the first part of the accepted
FEFT curve. The longer the length of the observed curve was,
the closer the estimated FVCest was to the measured FVCm ea .
When the length of the observed curve reaches 3 s, estimated
FVC3 was very close to FVCm ea . By comparing FVCm ea and
estimated FVC3 , we found that estimated FVC3 and FVCm ea
have fulfilled the repeatability criteria of FVC recommended by
ATS/ERS [9]. Moreover, by comparing the estimated FVC derived from the 0–3 s of the incomplete FEFT curve and the whole
incomplete curve, we found that the method described earlier

Fig. 5. Examples of analysis of complete and incomplete forced expiratory
flow signals from the same subject using the NLJ optimization procedure. The
complete measured curve (dotted line) in (a), the 0–3 s curve from the incomplete measured curve (dotted line) in (b), and the whole incomplete measured
curve (dotted line) in (c) were, respectively, taken as the system observations.
Then, the NLJ optimization procedure was used to get the estimate of FVC
(FVC m e st for the complete curve with measured FVC m e a , FVC 3 e st for
0–3 s of the incomplete curve with measured FVC fa il , and FVC f e st for the
whole incomplete curve) by estimating the model parameters. The solid lines
were generated by the model.

can get a reliable estimated FVC by analyzing the incomplete
curve when the length of the curve is more than 3 s.
Early termination of expiration causes FVC to be underestimated, which in turn can lead to false diagnosis and therapy
[24]. Therefore, ATS/ERS has proposed strict EOT criteria [9].
However, it is difficult for people to fulfill EOT criteria. In order
to make the spirometric examination simpler and more widely
used in primary health care, the utilization of FEV6 in place
of FVC has been proposed [25]. There have been several researches about FEV6 replacing FVC in recent years [26]–[28],

1650

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 6, JUNE 2015

TABLE III
COMPARISON OF ESTIMATED AND MEASURED FVC DERIVED FROM DATA II
Comparison Classified

FEV 1 /FVC m e s t versus FVC m e a (mL)
FVC f a i l versus FVC m e a (mL)
FVC 3 e s t versus FVC m e a (mL)
FVC f e s t versus FVC m e a (mL)
FEV 1 /FVC m e s t versus FEV 1 /FVC m e a (%)
FEV 1 /FVC f a i l versus FEV 1 /FVC m e a (%)
FEV 1 /FVC 3 e s t versus FEV 1 /FVC m e a (%)
FVC 1 /FVC f e s t versus FEV 1 /FVC m e a (%)

Correlation
Coefficient (r)

Differences
(mean ± SD)

0.999
0.990
0.992
0.993
0.999
0.938
0.985
0.990

16 ± 13∗
−211 ± 125∗
3 ± 114
3 ± 101
−0.4 ± 0.4∗
3.8 ± 2.6∗
−1.5 ± 1.3∗
−1.6 ± 1.0∗

Values are mean ± SD. ∗ p < 0.05 (paired t-test).
FEV1 , forced expiratory volumes in 1 s. FVC m e a is the forced vital capacity derived from
the acceptable maneuver, FVC f a i l is derived from the unacceptable maneuver because
of early termination of exhalation. FVC m e s t is the estimated FVC by analyzing the
whole completed curve. FVC 3 e s t and FVC f e s t are, respectively, the estimated FVC
by analyzing the 0–3 s of the incomplete curve and the whole incomplete curve.

and the advantages of FEV6 relative to FVC are gradually revealed. However, it is also reported that many people cannot
achieve 6 s of exhalation in primary care. For example, a study of
>1000 spirometry tests was performed by nurses in the outpatient clinics of 30 randomly selected primary-care physicians
in New Zealand [14]. About two-thirds of the maneuvers lasted
for <6 s, failing to complete emptying of the lungs, and most
of these short-duration maneuvers underestimated the FVC by
visual inspection of the volume–time curves. Therefore, our
method for estimating FVC by analyzing incomplete FEFT
curves can be a useful tool in the spirometric examination.
The lumped parameter model of FVC maneuver contains few
parameters, which is suitable for the NLJ optimization procedure to estimate the model parameters. The computations of the
NLJ optimization procedure estimating model parameters are
related to the number of the model parameters. The larger the
number is, the more computations there is a need for. If the
number is too small, the model output may not reflect the characteristic of the FVC maneuver. In this study, the number of the
model parameters depends on the volume which is calculated by
integrating the flow of the chosen curve. For a flow–time curve
with volume <7 L, the corresponding number of the model is
not more than 10. Moreover, the model can be well applied to patients with small airways disease, asthma, and emphysema [17].
The estimated FVCest is close to the measured FVC as the
length of the observed curve increases. This can be explained by
system identification theory. The FVC parameter of the model
represents the volume of a complete spirometric examination.
The parameter estimation errors are reduced as the length of
the observed curve increases [29]. Therefore, the difference
between estimated FVCest and measured FVCm ea decreases
with the length of the observed curve increasing.
There are differences among the three groups in the way the
length of the observed curve affects the accuracy of estimated
FVCest . Since the forced expiratory time of the patients with
restrictive ventilatory defect is shorter than others, the observed
curve contains the most information about the forced maneuver
when choosing the curve with the same length as the system observation. Estimated FVCest is closest to measured FVCm ea in

restrictive disease group, which can just right meet the request
of high accuracy of FVCest because of low expired volume.
By contrast, the forced expiratory time of the patients with obstructive ventilatory defect is longer. Therefore, the absolute
difference between estimated FVCest and FVCm ea decreased
slowest with the lengths of observed curves increasing. Proceeding further, the forced expiratory time may affect the accuracy of
estimated FVCest . The lengths of the chosen curves are all more
than 6 s except the restrictive disease group in this study, which
is to improve the reliability of the method for estimating FVC.
The main reason for estimated FVC3 and FVCm ea fulfilling
the repeatability criteria of FVC recommended by ATS/ERS is
that the method is based on the lumped model of FVC maneuver.
To estimate FVC, Steltner et al. used multiexponential models
to analyze forced expired volume–time curves. Because the appropriateness of the model is only considered from a statistical
point of view, there are some great differences between estimated and measured FVC [30]. Moreover, Ioachimescu et al.
proposed a regression equation for estimating FVC from measured values of FEV2 and FEV3 , and used FEV1 /estimated
FVC to detect airflow obstruction. Although this method can
be used to interpret spirometry results when the spirometric
EOT criteria are not satisfied, it does not eliminate the risk of
misclassifying the presence of obstruction [15]. This is because
the regression equation is only the result of statistical analysis
based on a large number of acceptable spirometric examinations, and there is a bigger difference between the estimated and
measured FVC in practice. Our method for estimating FVC is
to use system identification. The selected model contains the
information about airways resistance, driving pressure, etc., and
FVC parameter of the model parameters represents the FVC of
the whole accept FEFT curve. FVCest estimated by the NLJ
optimization procedure is close to measured FVCm ea when the
length of the observed curve needing to be identified is appropriate. The results prove that estimated FVCest and FVCm ea
have fulfilled the repeatability criteria of FVC recommended by
ATS/ERS when the length of the observed curve is over 3 s.
The method described earlier can be used to detect airflow
limitation by analyzing incomplete FEFT curves. Although
there is no significant difference between estimated FVC3 est
and FVCm ea , the standard deviation is obviously larger than
that displayed in Fig. 4. This may be because there are differences in FEV1 from the complete and incomplete curves
obtained by the same subject in data II. However, the difference between FEV1 /FVC3 est and FEV1 /FVCm ea remained
at low level when detecting airway obstruction, as well as
FEV1 /FVCf est and FEV1 /FVCm ea . Since FEV1 from early
terminated maneuvers is still useful [9], we can get a reliable
estimate of FVC by analyzing the incomplete FEFT curve using
the method described earlier and identify airflow limitation by
FEV1 /estimated FVC when the length of the incomplete curve
is more than 3 s. In addition, the performance of FVCf est
is a little better than FVC3 est according to the comparisons
with FVCm ea . This may be because FVCf est is evaluated by
analyzing the whole incomplete curve, and the estimation error of FVC is reduced, which is consistent with the results
shown in Fig. 3. Therefore, the optimal estimate of FVC can be

HE et al.: ANALYSIS OF FORCED EXPIRATORY FLOW SIGNALS USING THE NEW LUUS–JAAKOLA OPTIMIZATION PROCEDURE

obtained by analyzing the whole incomplete curve using the
NLJ optimization procedure.
There are two main shortcomings in this study. First, the
method for estimating model parameters needs to be optimized.
The parameters estimated by the NLJ optimization procedure
may only meet the local optimal performance index. The present
solution is that the first search results is taken as the initial search
parameter vector for the next time. The parameter vector meeting the optimal performance index is selected as the final search
results, which increases the operation time. Second, the difference between estimated FVCest and measured FVCm ea is
large for the rough FEFT curve because of significant coughing or variable effort. Therefore, our method may have a poor
application for such rough FEFT curves.
V. CONCLUSION
We proposed a new method for estimating FVC by analyzing
incomplete FEFT curves using the NLJ optimization procedure
in this study. This method can help the subjects who cannot
complete the forced expiratory maneuver to provide a reliable
estimate of FVC when the expiratory time is more than 3 s
and also can be used to analyze the unacceptable spirometry
because of early termination of exhalation, which can make the
spirometric examination more widely used in primary health.
REFERENCES
[1] A. A. Cruz et al., Global Surveillance, Prevention and Control of Chronic
Respiratory Diseases: A Comprehensive Approach. Geneva, Switzerland:
World Health Organization, 2007.
[2] J. Löndahl et al., “Experimental determination of the respiratory tract deposition of diesel combustion particles in patients with chronic obstructive
pulmonary disease,” Part. Fibre Toxicol., vol. 9, pp. 30, Jul. 28, 2012.
[3] A. S. Buist et al., “International variation in the prevalence of COPD (the
BOLD study): A population-based prevalence study,” Lancet, vol. 370,
no. 9589, pp. 741–750, Sep. 1, 2007.
[4] P. Walker et al., “Effect of primary-care spirometry on the diagnosis and
management of COPD,” Eur. Respir. J., vol. 28, no. 5, pp. 945–952, 2006.
[5] J. Vestbo et al., “Global strategy for the diagnosis, management, and
prevention of chronic obstructive pulmonary disease: GOLD executive
summary,” Amer. J. Resp. Crit. Care, vol. 187, no. 4, pp. 347–365, 2013.
[6] J. Vandevoorde et al., “FEV1 /FEV6 and FEV6 as an alternative for
FEV1 /FVC and FVC in the spirometric detection of airway obstruction
and restriction,” Chest, vol. 127, no. 5, pp. 1560–1564, 2005.
[7] M. C. Townsend et al., “Spirometry in the Occupational Health Setting—
2011 Update,” J. Occup. Environ. Med., vol. 53, no. 5, pp. 569–584, May,
2011.
[8] B. H. Culver, “Obstructive? Restrictive? Or a ventilatory impairment?”
Chest, vol. 140, no. 3, pp. 568–569, Sep. 2011.
[9] M. R. Miller, “Standardisation of spirometry,” Eur. Respir. J., vol. 26, no.
2, pp. 319–338, 2005.
[10] E. Derom et al., “Primary care spirometry,” Eur. Respir. J., vol. 31, no. 1,
pp. 197–203, Jan. 2008.
[11] G. T. Ferguson et al., “Office spirometry for lung health assessment in
adults—A consensus statement from the national lung health education
program,” Chest, vol. 117, no. 4, pp. 1146–1161, Apr. 2000.

1651

[12] S. Allen et al., “Predicting inadequate spirometry technique and the use
of FEV1 /FEV3 as an alternative to FEV1 /FVC for patients with mild
cognitive impairment,” Clin. Respir. J., vol. 2, no. 4, pp. 208–213, Oct.
2008.
[13] V. Bellia et al., “Validation of FEV6 in the elderly: Correlates of performance and repeatability,” Thorax, vol. 63, no. 1, pp. 60–66, 2008.
[14] T. Eaton et al., “Spirometry in primary care practice—The importance of
quality assurance and the impact of spirometry workshops,” Chest, vol.
116, no. 2, pp. 416–423, Aug. 1999.
[15] O. C. Ioachimescu et al., “Estimating FVC from FEV2 and FEV3 —
Assessment of a surrogate spirometric parameter,” Chest, vol. 128, no. 3,
pp. 1274–1281, Sep. 2005.
[16] L. A. Zadeh, “From circuit theory to system theory,” Proc. IRE, vol. 50,
no. 5, pp. 856–865, 1962.
[17] S. Abboud et al., “Maximum expiratory flow-volume curve—
Mathematical-model and experimental results,” Med. Eng. Phys., vol. 17,
no. 5, pp. 332–336, Jul. 1995.
[18] R. Luus and T. H. I. Jaakola, “Optimization by direct search and systematic
reduction of size of search region,” Aiche. J., vol. 19, no. 4, pp. 760–766,
1973.
[19] R. Luus and D. Hennessy, “Optimization of fed-batch reactors by the
Luus–Jaakola optimization procedure,” Ind. Eng. Chem. Res., vol. 38, no.
5, pp. 1948–1955, 1999.
[20] L. Quanshan and P. Lideng, “A modified method of predicting parameters for the lumped kinetic model of fluid catalytic cracking,” Petroleum
Process. Petrochem., vol. 35, no. 2, pp. 56–59, 2004.
[21] A. G. Polak and K. R. Lutchen, “Computational model for forced expiration from asymmetric normal lungs,” Ann. Biomed. Eng., vol. 31, no. 8,
pp. 891–907, Sep. 2003.
[22] P. Barbini et al., “A dynamic morphometric model of the normal lung
for studying expiratory flow limitation in mechanical ventilation,” Ann.
Biomed. Eng., vol. 33, no. 4, pp. 518–530, Apr. 2005.
[23] O. Barnea et al., “New model-based indices for maximum expiratory flowvolume curve in patients with chronic obstructive pulmonary disease,”
Comput. Biol. Med., vol. 26, no. 2, pp. 123–131, Mar. 1996.
[24] A. H. Mehrparvar et al., “Comparison of FEV3 , FEV6 , FEV1 /FEV3 and
FEV1 /FEV6 with usual spirometric indices,” Respirology, vol. 17, no. 3,
pp. 541–546, Apr. 2012.
[25] P. L. Enright et al., “The FEV1 /FEV6 predicts lung function decline in
adult smokers,” Respir. Med., vol. 96, no. 6, pp. 444–449, Jun. 2002.
[26] K. Nishimura et al., “Case identification of subjects with airflow limitations using the handheld spirometer “Hi-Checker (TM)”: Comparison
against an electronic desktop spirometer,” COPD-J. Chronic Obstr. Pulm.
Dis., vol. 8, no. 6, pp. 450–455, Dec. 2011.
[27] D. C. L. Lam et al., “FEV3 , FEV6 and their derivatives for detecting
airflow obstruction in adult Chinese,” Int. J. Tuberc. Lung Dis., vol. 16,
no. 5, pp. 681–686, May, 2012.
[28] R. Perez-Padilla et al., “Reliability of FEV1 /FEV6 to diagnose airflow obstruction compared with FEV1 /FVC: The PLATINO longitudinal study,”
PloS One, vol. 8, no. 8, pp. e67960, 2013.
[29] L. Yu et al., “Parameter estimation error bounds for Hammerstein nonlinear finite impulsive response models,” Appl. Math. Comput., vol. 202, no.
2, pp. 472–480, Aug. 15, 2008.
[30] H. Steltner et al., “Incomplete forced expiration—Estimating vital capacity by a mathematical method,” Respiration, vol. 71, no. 4, pp. 353–359,
2004.
[31] J. Jingjie et al., “An identification method based on the improved NLJ
algorithm and its application,” Chin. J. Chem. Eng., vol. 15, no. 1, pp.
88–91, Feb. 2007.

Authors photographs and biographies not available at the time of publication.

