774

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

Motion Estimation in Cardiac Fluorescence Imaging
With Scale-Space Landmarks and Optical Flow:
A Comparative Study
M. P. Rodriguez∗ and A. Nygren

Abstract—Motion artifacts are a major disadvantage of cardiac
optical mapping studies. Pixel misalignment due to contraction is
a main cause of the presence of gross motion artifacts in action
potential recordings. This study is focused on methods for identifying landmarks and tracking the motion of cardiac tissue for
preparations in optical mapping recordings. This is a first step toward our long-term goal to implement a landmark-based image
registration technique to correct for pixel misalignment in cardiac
optical mapping fluorescence videos and, hence, for gross motion
artifacts. Preliminary results for the registration step are presented
as an initial proof of concept. The characteristics of the optical
mapping images are challenging, since their lack of contrast and
well-defined features impose a limitation on the techniques than
can be used for landmark selection and motion tracking. This paper compares results of motion estimation of the cardiac surface
with two approaches that do not rely on high-contrast features:
1) Scale-invariant feature transform (SIFT) detected “keypoints,”
to be used as landmarks for motion tracking, as well as 2) a classical
global optical flow (OF) algorithm. Both are applied to low-contrast
and low-resolution cardiac fluorescence images. We demonstrate
that the performance of SIFT is superior to that of OF for pixel
motion tracking in cardiac optical mapping images with simulated
motion. Results for action potential recovery and action potential duration calculation after landmark-based image registration
show that SIFT landmark-based registration yields superior performance in this regard as well.
Index Terms—Cardiac optical mapping, image registration, motion artifacts removal, optical flow (OF), SIFT.

I. INTRODUCTION
ARDIAC optical mapping is an important noninvasive
technique for the study of cardiac electrophysiology [1].
Data are acquired in the form of fluorescence videos from where
cardiac electrical activity can be evaluated by analyzing the optical recordings of action potentials (APs) across the complete
heart surface being imaged. However, the presence of motion
artifacts prevents the evaluation of electrophysiological parame-

C

Manuscript received July 24, 2014; revised October 1, 2014; accepted October 21, 2014. Date of publication October 23, 2014; date of current version
January 16, 2015. This work was supported in part by the Natural Sciences and
Engineering Research Council of Canada and by Colciencias. Asterisk indicates
corresponding author.
∗ M. P. Rodriguez is with the Department of Electrical and Computer Engineering, University of Calgary, Calgary, AB T2N1N4, Canada (e-mail:
mprodrig@ucalgary.ca).
A. Nygren is with the Department of Electrical and Computer Engineering,
and the Centre for Bioengineering Research and Education, Schulich School
of Engineering, University of Calgary, Calgary, AB T2N1N4, Canada (e-mail:
nygren@ucalgary.ca).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2014.2364959

ters of interest such as action potential durations (APDs). Gross
motion artifacts appear due to a misalignment of the fluorescence images forming the video and results in a distortion of the
shape of the APs and would affect the analysis of mechanisms
underlying sinus rhythm, arrhythmia, and even the effects of
antiarrhythmic drugs.
Techniques for the reduction of motion artifacts include the
use of ratiometry, chemical uncouplers, mechanical restraint of
the preparation during the experiments, and the use of postacquisition processing techniques. Ratiometry techniques are proven
to help reduce the effects of motion artifacts due to common
sources of noise in two wavelength recordings; however, the
technique does not deal with gross motion artifacts due to pixel
misalignment and cannot be considered as a comprehensive solution [2]. Excitation-contraction uncouplers typically affect the
electrophysiology of the heart [3]. Postacquisition techniques,
such as image registration, have the added benefit of not requiring interaction with the preparation. Mechanical restraint can be
combined with all the mentioned correction techniques [4]–[6].
Registration methods for cardiac optical mapping data have
been used in several studies with encouraging results. Registration of predefined regions of interests was tested in [7], [8];
however, they limit the advantages of whole organ mapping by
limiting the registered areas. The use of predefined markers have
proven to be convenient to help the registration process [7], [9]–
[11]; however, it requires interaction with the preparation and
can obscure areas of the images due to the physical presence of
the markers, which can also affect surrounding tissue depending
on how they are attached to the cardiac tissue. Some registration
methods rely on absolute pixel intensities [8], [12], which is a
disadvantage due to the change in fluorescence intensity caused
by the AP itself. Promising results for motion compensation
across the whole surface do exist in the literature, but lack quantitative information on the performance of the techniques for
different motion scenarios [8], [13].
In order to register the complete surface of the heart, we
previously proposed the automatic selection of landmarks [14]
as an alternative to physical markers. Motion tracking of these
landmarks across the whole surface would provide a clear description of the motion at different locations over the surface of
the heart and that information would improve the performance
of the registration algorithms by aiding the calculation of the
overall transformation for image registration. Scale-space algorithms are a good alternative for the calculation of landmarks
in low contrast images, including fluorescence images. Previous studies have reported interesting results in MRI images,

0018-9294 © 2014 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

RODRIGUEZ AND NYGREN: MOTION ESTIMATION IN CARDIAC FLUORESCENCE IMAGING WITH SCALE-SPACE LANDMARKS AND OF

ultrasound, CT, and artery imaging [15]–[17]. The scaleinvariant feature transform (SIFT) algorithm was implemented
in our previous study [14] and proved to be reliable for landmark detection providing a sufficient number of landmarks to
determine motion across all areas of the cardiac surface.
In this paper, we extend our previous work by exploring an
alternative approach for the detection of image motion for every
pixel of the image: The calculation of optical flow (OF). OF has
been used in the medical imaging community with encouraging
results for OF-based nonrigid registration and warping [18]–
[21]. It is our aim to evaluate the effectiveness of OF and SIFT
algorithms to calculate and track motion in cardiac fluorescence
images by exploring different amounts and types of motion. This
paper presents a comparative evaluation of the two approaches
as well as validation of the data previously published in [14]. The
SIFT and OF algorithms were tested on real and simulated data.
The results for both implementations, along with the preliminary
results of the landmark-based rigid registration are presented.
II. METHODS
A. Ethics Statement
Animal care and used procedures were approved by the University of Calgary Health Sciences Animal Care Committee
(animal protocol number AC12-0042) and conformed to the
guidelines of the Canadian Council on Animal Care. The cardiac
optical mapping data were acquired from isolated Langendorffperfused whole rat hearts from Sprague-Dawley male rats (225–
400 g). Rats were anesthetized with 5% isoflurane in oxygen
before the heart extraction.
B. Acquisition of Optical Mapping Data
The series of fluorescence images were acquired with a charge
coupled device type sensor in a high temporal resolution Dalsa
camera (CA-D1-0128T). A 250 W quartz tungsten halogen light
was used as the illumination source. The videos are composed of
5000 images; each frame is 60 × 60 pixels with a resolution of
12 bits/pixel at 950 frames/s. The pixel pitch for this application
is 250 μm with a field of view of 15 × 15 mm2 . Hearts were
allowed 20 min normalization after starting perfusion and Di4-ANEPPS was used as the voltage sensitive dye, which was
perfused for 5 min after normalization. A complete description
of the experimental methods is provided by Nygren et al. in
[22]. During the experiments, the heart is suspended inside a
chamber and pressed gently against the front glass in order to
reduce the gross 3-D rotation (a common practice in the field).
Due to the mechanical restraint of the preparation, motion tends
to be reduced in the center region compared to the perimeter of
the heart.
C. Scale-Invariant Feature Transform
The SIFT algorithm generates a stack of filtered images at
different scales in order to determine features over the images
that are invariant to rotation, scaling, and translation at different
scales. The method was implemented in MATLAB based on the
description given by Lowe in [23].

775

For landmark detection, the SIFT implementation creates the
family of derived signals by progressively convolving a series of
2-D Gaussian kernels with the original image in order to create
the scale space. The scale parameter for this implementation
is the σ value of the Gaussian function. The scale space is
divided in octaves, which can be defined as a group of filtered
images resulted from the convolution of the base image with 2-D
Gaussian filters at different scales. One octave is created once the
σ value is doubled. For this specific implementation, the initial
value of σ is 0.6 and five images are produced for every octave.
Finally, a pyramidal representation is determined by computing
the difference of Gaussian functions (DoG) of the images. The
candidate landmarks are calculated as the scale-space extrema
in a 3 × 3 × 3 neighborhood for each pixel in every layer of the
pyramidal representation.
Subpixel accuracy for landmark location, or landmark refinement, was necessary for this application due to the low resolution of the images and the smooth motion presented by the
fluorescence images at different times. Our implementation of
the subpixel localization of landmarks is calculated as a secondorder interpolation of every landmark using a Taylor expansion,
following Oyallon et al. [24]. The determinant of the DoG
at the interpolated landmark location is used to reject lowcontrast landmarks, e.g., landmarks located on features edges
that present large offsets in location after refinement.
A descriptor is calculated to characterize the surrounding
neighborhood of every landmark previously found. A SIFT descriptor is a 128 element vector containing the gradient information of the surrounding region as a concatenation of histograms
containing the orientation and cumulative gradient for four 4 × 4
pixel regions around each landmark.
The same process is repeated for each fluorescence frame.
Landmarks and descriptors are calculated, and then, the matching process is done by comparing the descriptors of every landmark in both the base (first) frame and the frame being analyzed.
A match is found by calculating the Euclidean distance between
two descriptors, the shortest distance would correspond to the
matched landmark. A restriction of distance for landmarks to be
considered a match was imposed, given that the heart preparations do not present exaggerated or abrupt movements. Several
experimentally recorded videos were analyzed and yielded a
maximum motion of internal features of a 5 pixel radius; this
restriction was implemented in the matching process. Given
that landmark calculations for each fluorescence frame are done
independently; the number and location of landmarks for each
frame will vary, hence not all landmarks found in the base frame
will have a match in a subsequent frame.
D. Optical Flow
As an alternative to scale-space approaches, OF algorithms
provide motion information for every pixel of the images instead
of information for a limited number of landmarks; this characteristic and the fact that the result is a smooth vector field makes
OF a desirable approach. We aim to determine the feasibility of
this type of algorithms to calculate accurate velocity gradients
with the characteristics of this type of fluorescence images.

776

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

OF is the pattern that describes motion of objects in a pair of
images at different times. It is defined by Horn and Schunck (HS)
in [25] as the “distribution of velocities of brightness patterns
in an image.” This pattern of distribution provides information
regarding the position of an object in frames at different times
together with the rate of change [25]. OF was chosen as an alternative method for landmark tracking, since it evaluates motion
for every pixel of the image resulting in a smooth vector field
to describe motion. An implementation of the HS method from
Sun et al. is used in this paper [26].
OF differential methods are common techniques and can be
classified in two types. Local methods define a local energy
function to be minimized, which require the motion model to
be defined for windows of specific sizes since large motions can
only be detected with larger windows [25], [27]. Global methods
(employed in this study) minimize a global energy function; this
allows evaluating motion information for the complete image.
The flow field is smooth across the image which is desirable
for our application since the motion of the heart is smooth
among frames. HS is developed on the basis of a smoothing
constraint of the velocity field, which means that neighboring
pixels will present similar velocities in the flow field that has to
be maintained for the complete image [25]. A constraint on the
brightness gradient is also introduced for the calculation of the
OF velocities in the horizontal, vertical, and time directions.
As stated by Horn in [25], the OF of a pixel cannot be calculated independently of the neighbor of such pixel, hence constraints have to be added. The aperture problem includes two of
the main assumptions of OF methods: 1) the brightness or data
conservation constraint, where it is assumed that the brightness
of a region is maintained while the location may change; and
2) the coherence constraint, where it is assumed that the flow in
a region should change smoothly; however, for a large region, it
is more likely to find multiple motions that would violate those
constraints.
The OF objective function for a classical model as HS is
composed of two terms from the work of Black in [28]
EGlobal = EData + λERegularization .

(1)

EData measures the consistency of the calculated OF field
with the movement of individual features [29], while the regularization term adds a coherence constraint [30], which restricts
to the possible solutions to the optimization problem giving a
preference for smooth solutions.
The implementation chosen utilizes the classical formulation
of energy with the utilization of median filters for the creation
of a pyramidal evaluation. The energy function (as given by Sun
et al. in [26]) is

ρD (I1 (i, j) − I1 (i + ui,j , j + vi,j ))
E(u, v) =


(ui,j − ui+1,j ) + (ui,j − ui,j +1 )+
+ λ · ρs
(vi,j − vi+1,j ) + (vi,j − vi,j +1 )
(2)
where u and v correspond to the horizontal and vertical velocities
that form the flow field, λ is a regularization parameter, and ρ
are penalty functions calculated as L2 norms.

A constraint on the brightness gradient as well as the coherence constraint are introduced for the calculation of the OF
velocities in the horizontal, vertical, and time directions in the
chosen implementation.
The penalty function ρD penalizes large differences between
image intensities, while ρS favors the smoothness requirement
of the OF field by penalizing large motions [30].

E. Simulation of APs and Motion Artifacts
1) Baseline AP Waveform: To verify the effectiveness of the
motion tracking algorithms, a known true value for the amount
of motion for every pixel in a set of frames was required; therefore, a simulated fluorescence video was created by using an
experimentally recorded base frame and applying transformations to simulate the motion of the preparation during the experiments. Affine transformations including translation, shearing,
rotation, and scaling were applied to the base fluorescence image. The transformations were chosen in an attempt to simulate
the motion that is observed in real recordings, although the values are somewhat exaggerated to evaluate the performance of
the algorithms.
Prior to applying these transformations to a set of images, the
pixel intensities were modulated with a waveform approximating a rat AP. The modulating function consisted of the product
of two sigmoid functions, which yields a realistic AP shape for
which the rates of rise and repolarization can be controlled independently. This step prevents the algorithms from relying on
absolute pixel grey level similarity to detect features, as would
be the case in real optical mapping recordings. Conduction of
the APs from the top to the bottom of the heart in the ventricular
wall was simulated by introducing a successive time delay to
the AP train in each pixel row.
2) Introduction of Motion Artifacts: Two types of motion artifacts were introduced to the modulated datasets. The baseline
of motion artifacts was introduced to the simulated AP traces as
suggested by Asfour et. al. in [31] by creating a half-rectified sinusoidal signal as a baseline for the translation pattern; Fig. 1(a)–
(c) shows the addition of this transformation. This signal was
defined to mostly affect the repolarization phase of the APs by
controlling its frequency and phase. Additional artifacts were introduced by applying successive spatial transformations to the
modulated optical frames.
Realistic-motion datasets aim to simulate real artifacts found
in experimentally recorded data; a combination of transformations was applied to each frame. Following the baseline motion,
additional translation, rotation, scaling, and shearing transformations were added in amounts selected from pseudo-random
uniformly distributed set of values, Fig. 1(c)–(f). Each transformation was initialized randomly and was restricted to produce
a maximum motion of 5 pixels to the final image. Scaling transformations aimed to simulate the contraction and relaxation of
the cardiac muscle starting from a base value in the range of
0.9 and 1.0 and progressively adding or subtracting a scaling
factor that was randomly selected drawn from a uniform distribution between 0 and 0.1. This is intended to account for the
wide range of activation and contraction patterns encountered

RODRIGUEZ AND NYGREN: MOTION ESTIMATION IN CARDIAC FLUORESCENCE IMAGING WITH SCALE-SPACE LANDMARKS AND OF

777

transformation used. Random-motion datasets consisted of 50
realizations of each type or combination of transformations.
F. Statistics
To evaluate the difference in performance between SIFT and
OF, for motion tracking in simulated datasets affected by selected transformations, a two-sample t-test for equal means was
conducted to determine the statistical difference among the average values of mean square error (MSE) for pixel tracking using
both algorithms. The same test was applied to establish the difference between the average values of mean absolute difference
(MAD) in evaluated frames at the locations determined by the
tracked landmarks.
G. APD Evaluation
The effectiveness of SIFT and OF algorithms for motion
tracking in cardiac fluorescence images was also assessed based
on the ability of a landmark-based registration algorithm to
eliminate motion artifacts, landmarks tracked with both algorithms were used. APDs were evaluated for registered simulated
datasets (from type A datasets). The transformed images were
registered with a landmark-based affine transformation
[x
Fig. 1. (a) Half-rectified sinusoidal signal baseline of motion artifacts and
temporal relationship with simulated APs. (b) Introduction of baseline motion
artifacts with translation following the pattern in (a). (c–f) Transformations
introduced to create realistic-motion datasets. (g) APs from real datasets affected
with motion artifacts. (h) APs extracted from a simulated dataset affected by
simulated motion artifacts. ∗ The dotted line inside the hearts is intended to be
used as an internal reference feature to visualize how transformations could
affect these features.

y

1] = [um

vm

1] ∗ Tinv

(3)

where [x y 1] corresponds to the coordinates of landmarks in
the base image, and [um vm 1] corresponds to the landmarks
calculated in the transformed (moved image) to be registered.
Tinv is the calculated transformation. APD90 was calculated for
the APs recovered at several pixel locations in the registered
dataset. Pixels were selected randomly across the surface of the
heart.
III. RESULTS
A. Motion Tracking With SIFT

Fig. 2. Transformations applied to the base image to create random-motion
datasets, 50 realizations of each transformation were tested. Transformations
were applied in a pseudo-random amount.

during normal activation as well as arrhythmias. The resulted
simulated data contains realistic motion artifact waveforms as
the examples shown in Fig. 1(h).
The second type of simulated datasets (random-motion
datasets) was created to test the ability of the algorithms to track
differed kind of motions, from simple translations to a complex
combination of transformation. Fig. 2 presents the ranges of the

The set of landmarks and descriptors were calculated for every frame and the matching process for every landmark was performed using the calculated descriptors [14]. Random-motion
datasets, see Methods, were used to evaluate the motion tracking and matching process. For this study, the first frame of the
video was selected to be the base image and landmark locations
were compared between the base image and subsequent frames.
The number of landmarks with matching points is higher when
a frame is closer to the base image, i.e., when the contraction of
the heart is not yet near its maximum.
To assess the performance of the SIFT algorithm, the calculated landmark locations in the base image were transformed
with the same translation, scaling, and shearing parameters applied to each frame, yielding the expected landmark locations
for the complete dataset. The complete test was performed on
three different fluorescence videos without considerable differences in results.
The number of landmarks obtained varied due to rejection
of low-contrast candidate landmarks. An average of 92 landmarks were calculated when only translation was applied, 74 for
scaling, 155 landmarks for shearing, 65 landmarks for frames

778

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

transformed by translation and scaling combined, 90 landmarks
for a combination of translation and shearing and an average
of 64 points for the three transformations combined. The maximum number of landmarks calculated was 218 for a shearing
transformation of 2.92 × 10−4 , 27 landmarks was the minimum value found in the tests and results from a combination of
4.6 pixels translation in the horizontal direction, 3 pixels in the
vertical direction, a scaling factor of 20%, and a shearing value
of 0.0012. The presented average number of landmarks was
rounded to the lower integer.
MSE values were calculated for all matched landmarks to
determine the tracking accuracy, resulting in values ranging
from 9.25 × 10−4 to 1.24 in pixel coordinates. A similarity
error measure, MAD between images at the located landmarks
was also calculated, as described by Fisher in [32] and presented
below for two images I1 and I2
MADI 1 ,I 2 =

N1 
N2

1
|I1 (x, y) − I2 (x, y)|
N1 × N2 x=1 y =1

(4)

where x and y correspond to the pixel location, and N1 and N2
refer to the region size being analyzed. Perfect tracking would
result in a MAD value equal to zero. The MAD values calculated
for SIFT ranged from 0.16 to 171.37.
B. Motion Tracking With OF
The performance of the OF algorithm was evaluated for the
same random-motion dataset (see Methods) used with SIFT
above. OF had adequate performance in test cases where the
motion was uniform over the surface of the heart like in translations and rotations of the complete image. However, incorrect
calculation of the direction of gradients was observed when
more complex motion was introduced, e.g., for a small shearing
or scaling of the image where high values for MSE and MAD
were obtained (see Fig. 3), where the velocity vectors of several regions of the flow field presented an incorrect direction
and magnitude. An example can be observed in Fig. 3(c) for
the vectors inside the green oval, this effect is more evident for
images affected with a combination of transformation.
The effect of the regularization parameter on the MSE value
was also evaluated and shown to have a small effect on the final
results. A change of less than 2% was observed for λ values in
a range from 10 to 100.
C. SIFT Versus OF Performance
The analysis of results for individual transformations, translation, shearing, and scaling alone, provided an interesting preview of the performance of both algorithms. SIFT and OF both
provided acceptable tracking of motion for translation only. On
the other hand, scaling transformations appeared to negatively
affect the results of the OF algorithm. While SIFT yielded good
tracking of the landmarks for several scaling percentages, that
was not the case for OF. An example is presented in Fig. 3,
where a single scaling transformation of 20% was applied to an
image. Fig. 3(a) and (b) shows the landmarks calculated with
SIFT and the distribution of such landmarks over the surface of

Fig. 3. Results for a single-scaling transformation where the original image
is a 60 × 60 pixel cardiac fluorescence image and the transformed image is a
48 × 48 image located at the center of the 60 × 60 frame for better comparison.
(a) results of SIFT for the detection of landmarks in the original image, (b) result
of landmark tracking over the scaled image, (c) OF field calculated with HS
algorithm based on (a) and (b), (d) and (e) the MSE error calculations for
horizontal (X) and vertical (Y) directions, respectively.

the heart. Even though the number of landmarks is lower for the
scaled image, the location of the features detected is maintained.
Fig. 3(c) presents the velocity plot resulting from the OF algorithm, in which the motion was calculated for all pixels in the
image but for clarity the velocity plot for only half of the points
is presented. Fig. 3(d) and (e) present the error results for both
SIFT and OF showing that the motion tracking for an optical
mapping image affected by a strong scaling transformation is
better described by SIFT landmarks for this specific case since
the MSE values for horizontal and vertical directions are lower
than those for OF.
Fig. 4 summarizes the error calculations for MSE and MAD
using the complete test dataset (random-motion), where it was
found that SIFT yields lower values for both types of errors
and that the difference in the values for SIFT and OF is statistically significant with p < 0.01. From Fig. 4(a) and (b), it is
observable that each algorithm (SIFT and OF) have comparable performance in the horizontal and vertical directions for the
transformations applied. It is clear, however, that the presence
of shearing and scaling significantly affects the results for OF.
This observation is supported by the MSE and MAD values for
shearing, scaling, translation + scaling and translation + shearing in Fig. 4(a)–(c). The major difference in the performance
between algorithms is observed when a scaling transformation
is applied to the images, supporting the previous results obtained
with a single example of a scaling case of 20%.
D. Motion Tracking with SIFT
1) Using Simulated Datasets: A landmark-based rigid registration method was applied to the datasets affected by motion
artifacts. Realistic-motion datasets, see Methods, were used for
motion artifact correction. APs across the surface of the heart

RODRIGUEZ AND NYGREN: MOTION ESTIMATION IN CARDIAC FLUORESCENCE IMAGING WITH SCALE-SPACE LANDMARKS AND OF

779

TABLE I
RELATED STATISTICS FOR THE CALCULATION OF APD9 0 IN REGISTERED
DATASETS FROM SIMULATED DATA TYPE A

MSE
Mean
SD
MIN
MAX

SIFT

OF

60.75
49.86
7.69
42.57
88.67

985.1
60.94
30.41
33.52
138.32

The expected APD9 0 is 51.66 ms in the complete absence of motion artifact.

Fig. 4. MSE and MAD in pixel values are shown for a set of transformations
including translation (T), scaling (S), shearing (Sh), combination of translation
and scaling (T + S), combination of translation and shearing (T + Sh), combination of translation, scaling and shearing (T + S + Sh), applied to a set of
cardiac optical mapping images with modulated amplitudes emulating the effect
of real APs.

Fig. 5. (a) and (b) present examples of APs retrieved at two locations in the
simulated datasets; the simulated AP (top), AP affected with motion artifact,
recovered AP after OF landmark-based registration and recovered AP from
SIFT landmark-based registered dataset (bottom).

were recovered from registered datasets. Results are presented
for one test dataset in Fig. 5. All frames were registered to
the first frame of the simulated dataset (realistic-motion), considered as the base frame. 18 locations were selected inside
the surface of the heart and two APs were recovered at each
location (400 ms of video were simulated). Locations were selected randomly over three simulated datasets. In general, APs
retrieved from OF landmark-registered datasets had a smoother
shape compared with those obtained from registered frames using SIFT landmarks. Smoothness is a desirable characteristic for
this specific application; however, APD90 values calculated for

the APs retrieved from the SIFT-based registered dataset were
in general closer to the true values (see statistics in Table I).
APD90 was 51.66 ms for the unaffected simulated AP and
all the calculated APDs were compared to this base value.
The tracking algorithms and the subsequent registration method
were tested with different amounts and shapes of motion artifacts. The ability of both SIFT and OF landmarks to track several
types of motion, and their ability to provide effective information to a registration method in order to reduce or eliminate
motion artifacts, were assessed.
SIFT-based registration proved to be more effective for correction of motion artifacts from the point of view of APD
calculation, one of the most important electrophysiological parameters in cardiac optical mapping studies. Even though shapes
retrieved with OF-based landmarks had a smooth shape, the
correction of motion artifacts was found to be ineffective in
several locations for the recovery of a stable baseline (resting
potential). Fig. 5(a) shows the results obtained for APs extracted
after registration using both sets of landmarks. APs retrieved using SIFT landmarks yielded better results in terms of recovering
the stable resting potential that is required for accurate determination of APD.
Fig. 5(b) presents an additional example of the performance
of both algorithms with a different shape and amplitude for
motion artifacts. Several results showed that OF was less efficient in recovering the baseline than SIFT, and this resulted in
measurements of APD90 that were distinctly different from the
expected value. Statistics shown in Table I confirm this performance showing a mean value for OF APD90 that exceeds the
expected APD value by 18%, compared to a difference of only
3.28% for SIFT landmark-based registration. The MSE for the
calculated APDs was particularly high for OF, 985 ms2 , compared to that obtained for SIFT-based registration with an MSE
value of 60.75 ms2 . Both algorithms performed relatively well
in areas where artifacts were small, but performance deteriorated in areas with more severe motion artifact, such as near the
edges of the heart.
2) Experimentally Recorded Datasets: Fig. 6 shows a set of
recovered APs from one real (experimentally recorded) dataset
before and after landmark-based rigid registration. Locations for
the retrieved APs shown were selected such that examples of
both APs affected by strong artifacts and those affected by modest motion are represented. Due to the complexity of the motion
present in experimentally recorded optical mapping videos, the

780

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

Fig. 6. APs in four different locations for experimentally recorded cardiac
optical mapping set of fluorescence images. Real AP panels correspond to
APs retrieved from the raw dataset, OF panels present APs retrieved from OF
landmark-based registered datasets, SIFT panels (bottom) correspond to APs
retrieved from SIFT landmark-based registered datasets. (a) and (b) present
examples of APs affected with modest motion artifacts, while (c) and (d) show
APs affected with stronger artifacts.

registration transformation was calculated based on a subset
of landmarks contained in a 15 × 15 pixel region around the
center of the heart. This approach aims to restrict the analysis
to the region of the heart that is being mechanically restrained
to ensure that motion with lower complexity, which may be
approximated by an affine transformation, is considered. This
test aims to evaluate the ability of SIFT and OF landmarks to
accurately track motion and be used as input for a registration
algorithm to correct for motion artifacts in real datasets.
In Fig. 6(a) and (b), the top panel shows APs retrieved from
two different locations inside the 15 × 15 pixel region, in a
real dataset. These two examples present APs affected with
modest motion artifacts. Fig. 6(a) shows slight deformation
of the repolarization phase of the AP followed by a subtle
deformation of the resting potential. Fig. 6(b) is an example
of slightly stronger deformations in both phases. Recovered
APs from the registered datasets are presented in the middle
panel (OF landmark based) and the bottom panel (SIFT landmark based). In Fig. 6(a), APs retrieved from both registered
datasets show subtle improvement during the repolarization
phase and of the resting potential baseline, SIFT-based registration resulted in a corrected AP that returned to baseline with
less presence of undershoot and overshoot after repolarization
compared to the OF-based registered AP. The original AP in
Fig. 6(b) (top panel) presents stronger deformation and both
algorithms made an acceptable attempt to recover the repolarization phase, with SIFT again performing better in terms
of the resting potential recovery, OF-recovered AP showed
an overcorrection of the deformation after repolarization,
causing the signal to return to baseline slower. Even though
the algorithms do not completely remove the motion artifacts
present in the APs, there is considerable improvement in the
shape of the signal. Furthermore, these two examples illustrate
that when an AP in the original dataset is affected by small artifacts, no obvious new artifacts are introduced to the APs by the
landmark-registration method itself.

Fig. 6(c) and (d) present APs retrieved from two additional
locations. The original APs (top panels) have stronger motion
artifacts with substantial deformations of the signal in both the
repolarization and the resting potential phases. In Fig. 6(c), a
favorable correction of the artifacts is visible, where the SIFT
landmark-based approach showed a better recovery of the repolarization phase and the resting potential; furthermore, the
presence of the strong undershoot after repolarization is more
evident in the OF-registered AP. Both OF and SIFT landmarkbased algorithms partially recovered the shape of the AP despite
the strong deformation present in the repolarization phase of the
original AP; however, a complete correction was not achieved.
Fig. 6(d) presents a case where the AP contained strong artifacts
and even though the SIFT-based method does yield some degree
of correction, the correction is far from complete.
IV. DISCUSSION
A. Motion Tracking
For the set of results presented in this paper, SIFT appeared
to perform better than OF for the simulated dataset based on
a series of affine transformations. Even though the number of
points tracked with SIFT is notably lower than those tracked
with OF, the algorithm renders a sufficient number of accurate
landmarks to allow interpolation and creation of a motion field
for the complete image. This motion field provides the required
transformation to successfully calculate an inverse transformation model to further register the set of images with the objective
of reduce pixel misalignment between frames and, therefore, reduce the motion artifacts.
The HS, OF, algorithm was successful in the calculation of the
direction and amount of the pixel motion in areas where changes
between frames are small but shows poorer performance in regions with larger motions. The velocity field generated is smooth
and provides a global perception of the motion for the complete
surface of the heart. These characteristics are desirable for this
specific application but due to the low resolution of the images,
the accuracy in calculation of the gradients is compromised.
SIFT resulted in lower MSE and MAD values than OF. The
MSE for the x-coordinate and y-coordinate for SIFT showed
similar behavior; however, the performance of OF was significantly different from that of SIFT for pixel tracking in horizontal and vertical directions for shearing and scaling. OF produces
a desirable smooth velocity field for simple transformations
like translations but the performance of the algorithm decreases
severely when more complex transformations are introduced.
The HS model includes a brightness constraint in the velocity
field, which relies on the assumption that the brightness of a
pixel and its neighborhood will remain constant in subsequent
images. However, the presence of modulated pixel intensities in
both the real and the simulated data (due to APs) as well as the
change in the shape of features over time for real cardiac optical
images cause variation in pixel intensities over time. This will
reduce performance of the OF algorithm.
The variability of the results for SIFT is small (see Fig. 4),
encouraging the use of this transform for motion tracking in cardiac optical images. On the other hand, OF resulted in substantial

RODRIGUEZ AND NYGREN: MOTION ESTIMATION IN CARDIAC FLUORESCENCE IMAGING WITH SCALE-SPACE LANDMARKS AND OF

variability in the results depending on the transformation that
was applied to the images and even for simple affine transformations (e.g., translation), the variability of the results was large
compared to the ones obtained with SIFT (see Fig. 4). Large
variability in the performance of the motion tracking algorithm
(OF) could lead to inaccurate calculation of the transformation
to register the images. Given the results obtained with simulated datasets (random-motion, see Methods), it is not expected
that the OF algorithm would perform well with experimentally
recorded cardiac optical mapping datasets; due to the complexity of the motion, where the contour of the heart present more
severe motion than the center.
Even though OF resulted in reasonable and smooth velocity
fields across the surface of the heart, the error measures and the
previous observations demonstrated that this technique should
not be applied for motion estimation in cardiac fluorescence
videos. SIFT on the other hand, has been shown by our results
to be a reliable technique for motion estimation in simulated and
real datasets. A disadvantage of this approach is that significant
computational resources have to be devoted to the interpolation
process to successfully extend the preliminary point registration
results to a landmark-based image registration process.
B. Correction of Motion Artifacts
After motion tracking, we demonstrated that the calculated
landmarks provide adequate information for a rigid registration
algorithm making it possible to recover APs that have been
affected by simulated motion artifacts with several shapes and
magnitudes. Results, as expected based on the motion tracking
results, showed that SIFT landmarks are preferable to those
from OF as input to a registration algorithm with regard to
AP recovery and APD90 calculation. SIFT landmarks proved to
provide APD calculations closer to the expected values with a
lower MSE and lower SD (see Table I) than OF. The fact that
correction was insufficient with the OF landmark-based method
is also visually apparent with OF-based registration in some
cases resulting in a barely noticeable improvement in the AP
shape (see Fig. 6), while registration based on SIFT landmarks
produced significant improvement.
Correction of motion artifacts was also evaluated in real, experimentally recorded data. Landmark-based registration using
SIFT and OF landmarks proved to reduce motion artifacts, recovering the shape of the APs, and showed promising results in
terms of recovery of the resting potential. Based on visual inspection, APs slightly affected by artifacts were recovered properly after registration and no new artifacts were introduced by
the registration method. Consistent with the assessment based on
simulated data, the results showed that SIFT landmark-based
registration outperformed the OF landmark-based method in
the correction of gross motion artifacts. These results were obtained for the neighborhood in which the heart is subjected to
a subtle mechanical restraint against the chamber. However, we
expect that the extension of the presented results, for experimentally recorded data, to the complete surface of the heart
would require the use of more complex transformations than a
simple affine transformation to accurately model the motion of
the whole surface.

781

C. Potential Improvements to the Registration Approach
The characteristics of the fluorescence images together with
the complexity of the motion present over the surface of the
heart in real, experimentally recorded, datasets call for better
modeling of the transformation for further improvements in the
registration approach. Even though the results obtained with
rigid registration are encouraging, the transformation model is
not sufficient to be used to effectively correct more complex motion and showed to be insufficient to efficiently recover APs in
those regions. Real (experimentally recorded) datasets present
different type and amount of motion for different regions of the
heart but maintains a smooth motion transition among regions
in the same frame and between subsequent frames; rigid registration approaches are not the best alternative to model such
type of motion. A nonrigid approach [33] should be explored
in future work, since it would offer a less restricted number
of degrees of freedom to model complex motions. Nonrigid
landmark-based registration aims to calculate an inverse model
to align the transformed set of landmarks to the base set of landmarks and, consequently, to use this model to register the surface
of interest. Nonrigid registration methods are more challenging
to apply than rigid transformations since once the transformation model is calculated (statistical model, transformation grid,
etc.,), an optimization process is required to vary the parameters
of the model to maximize a matching criterion and to increase
success in image matching [34]. However, overcoming the challenges of their implementation, these techniques would likely
better model the different types of motion over the surface of
the heart. Considering that the methods presented do not require
the use of artificial landmarks, the acquisition protocol is not affected; therefore, the registration technique can in principle be
combined with other techniques, i.e., ratiometry, to further control the presence of artifacts due to common noise factors at
different wavelengths e.g., dye concentration, photobleaching,
etc. The use of a ratiometric dye as Di-4-ANEPPS for the optical
mapping recordings will make the combination of techniques
possible.
D. Limitations
We recognize that out of plane motion contributes to motion
artifacts in optical data. However, the nature of the acquired
optical data is 2-D, and thus, 3-D motion correction (correction for out of plane motion) is not possible with the approach
presented here. Nonrigid registration techniques may offer a
better approximation of the projection of the out of plane motion onto the image plane and could potentially yield improved
performance.
V. CONCLUSION
The presented results demonstrate that it is feasible to estimate motion in cardiac optical images based on landmark detection using SIFT. Based on our comparative study, OF, while
computationally attractive, cannot compete with the accuracy
of SIFT for motion tracking. Preliminary results for landmarkbased registration are encouraging and suggest that this is a
feasible approach for gross motion artifact removal. This study

782

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

provides important quantitative data for further development of
SIFT landmark-based registration techniques for cardiac optical
mapping.
ACKNOWLEDGMENT
The authors would like to thank J. Yee at the University of
Calgary for the initial validation of the OF algorithm in nonfeatured images.

[15]
[16]
[17]
[18]

REFERENCES
[1] I. Efimov, V. Nikolski, and G. Salama, “Optical imaging of the heart,”
Circ. Res., vol. 95, pp. 21–33, 2004.
[2] A. Batchel, R. Gray, J. Stohlman, E. Bourgeois, A. Pollard, and J. Rogers,
“A novel approach to dual excitation ratiometric optical mapping of cardiac action potentials with di-4-ANEPPS using pulsed LED excitation,”
IEEE Trans. Biomed. Eng., vol. 58, no. 7, pp. 2120–2126, Jul. 2011.
[3] L. M. Swift, H. Asfour, N. G. Posnack, A. Arutunyan, M. W. Kay, and
N. Sarvazyan, “Properties of blebbistatin for cardiac optical mapping and
other imaging applications,” Pflugers Arch., vol. 464, no. 5, pp. 503–512,
Nov. 2012.
[4] S. B. Knisley, R. K. Justice, W. Kong, and P. L. Johnson, “Ratiometry
of transmembrane voltage-sensitive fluorescent dye emission in hearts,”
Amer. J. Physiol. Heart C., vol. 279, pp. H1421–H1433, Sep. 2000.
[5] D. C.-S. Tai, B. J. Caldwell, I. J. LeGrice, D. A. Hooks, A. J. Pullan, and
B. H. Smaill, “Correction of motion artifact in transmembrane voltagesensitive fluorescent dye emission in hearts,” Amer. J. Physiol. Heart Circ.
Physiol., vol. 287, pp. H985–H993, Sep. 2004.
[6] M. Svrcek, A. Chen, S. Rutherford, J. Sekora, I. Provaznik, and B. Smaill,
“Suppressing motion artifact in cardiac electrical optical mapping,” presented at the Biosignal Conf., Berlin, Germany, Jul. 14–16, 2010.
[7] M. Svrcek, S. Rutherford, A. Chen, I. Provaznik, and B. Smaill, “Using
image registration to reconstruct spatiotemporal electrical activity in cardiac optical mapping studies,” Comput. Cardiol., vol. 36, pp. 521–524,
Sep. 2009.
[8] G. K. Rohde, B. Dawant, and S. F. Lin, “Correction of motion artifact in
cardiac optical mapping using image registration,” IEEE Trans. Biomed.
Eng., vol. 52, no. 2, pp. 338–341, Feb. 2005.
[9] M. Svrcek, S. Rutherford, A. Chen, I. Provaznik, and B. Smaill, “Characteristics of motion artifacts in cardiac optical mapping studies,” in Proc.
IEEE Eng. Med. Biol. Soc., 2009, pp. 3240–3243.
[10] K. Seo, M. Inagaki, S. Nishimura, I. Hidaka, M. Sugimachi, T. Hisada,
and S. Sugiura, “Structural heterogeneity in the ventricular wall plays a
significant role in the initiation of stretch-induced arrhythmias in perfused
rabbit right ventricular tissues and whole heart preparations,” Circ. Res.,
vol. 106, no. 1, pp. 176–184, Jan. 2010.
[11] E. Bourgeois, A. Bachtel, J. Huang, G. Walcott, and J. Rogers, “Simultaneous optical mapping of transmembrane potential and wall motion
in isolated, perfused whole hearts,” J. Biomed. Opt., vol. 16, no. 9, pp.
096020-1–096020-11, Sep. 2011.
[12] P. Westerfaard, K. Umapathy, S. Masse, E. Sevapstisidis, J. Asta, T. Farid,
K. Nair, S. Krishnan, and K. Nanthakumar, “Non-linear image registration
for correction of motion artifacts during optical imaging of human hearts,”
in Proc. Canadian Conf. Electr. Comput. Eng., Niagara Falls, Canada,
2008, pp. 1729–1732.
[13] B. Stender, F. Ernst, B. Wang, A. X. Zhang, and A. Schlaefer, “Motion
compensation of optical mapping signals from isolated beating rat hearts,”
Proc. SPIE, Appl. Digital Image Process., vol. 8856, p. 88561C, Sep. 2013.
doi: 10.1117/12.2024847
[14] M. Rodriguez and A. Nygren, “Application of scale-space descriptors
for the reliable detection of keypoints for image registration in optical

[19]

[20]
[21]
[22]
[23]
[24]
[25]
[26]
[27]
[28]
[29]
[30]
[31]

[32]
[33]
[34]

mapping studies in whole heart preparations,” in Proc. IEEE Eng. Med.
Biol. Soc., San Diego, CA, USA, 2012, pp. 3171–3174.
M. Moradi, P. Abolmaesoumi, and P. Mousavi, “Deformable registration
using scale space keypoints,” Proc. SPIE, Med. Imag., Image Process.,
San Diego, CA, USA, p. 61442G, Feb. 2006.
C. Gatta, S. Balocco, V. Martin-Yuste, R. Leta, and P. Radeva, “Non-rigid
multi-modal registration of coronary arteries using SIFTflow,” in Proc.
Lect. Notes. Comput. Sci., Gran Canaria, Spain, 2011, pp. 159–166.
W. Cheung and G. Hamarneh, “N-SIFT: n-dimensional scale invariant feature transform,” IEEE Trans. Image Process., vol. 18, no. 9,
pp. 2012–2021, Sep. 2009.
D. Tosun and J. L. Prince, “A geometry-driven optical flow warping
for spatial normalization of cortical surfaces,” IEEE Trans. Med. Imag.,
vol. 27, no. 12, pp. 1739–1753, Dec. 2008.
M. Heinrich, J. Schnabel, F. Gleeson, J. M. Brady, and M. Jenkinson,
“Non-rigid multimodal medical image registration using optical flow and
gradient orientation,” in Proc. Med. Image Understanding, Jul. 2010,
pp. 141–145.
S. N. Gupta and J. L. Prince, “On variable brightness optical flow for
tagged MRI,” in Information Processing in Medical Imaging. Norwell,
MA, USA: Kluwer, Jun. 1995, pp. 323–334.
D. Tenbrinck, S. Schmid, X. Jiang, K. Schafers, and J. Stypmann,
“Histogram-based optical flow for motion estimation in ultrasound imaging,” J. Math Imaging Vis., vol. 47, pp. 138–150, Sep. 2013.
A. Nygren, C. Kondo, R. B. Clark, and W. R. Giles, “Voltage-sensitive
dye mapping in Langendorff-perfused rat hearts,” Amer. J. Physiol. Heart
Circulatory Physiol., vol. 284, no. 3, pp. H892–H902, Mar. 2003.
D. G. Lowe, “Distinctive image features from scale-invariant keypoints,”
Int. J. Comput. Vis., vol. 60, no. 2, pp. 91–110, 1980.
E. Oyallon and J. Rabin. (2013, Feb.). An analysis and implementation
of the SURF method, and its comparison with SIFT. Image Proc. Online
[Online]. Available: http://www.ipol.im/pub/pre/69/
B. Horn and B. Horn, “Determining optical flow,” Artif. Intell., vol. 17,
pp. 185–203, Aug. 1981.
D. Sun, S. Roth, and M. J. Black, “Secrets of optical flow estimation and
their principles,” in Proc. Comput. Vis. Pattern Recog., San Francisco, CA,
USA, 2010, pp. 2432–2439.
J. Bouguet, “Pyramidal implementation of the Lukas Kanade feature
tracker description of the algorithm,” Intel Corp. Microprocess. Res. Labs.,
Santa Clara, CA, USA, 2000.
M. J. Black, “The robust estimation of multiple motions: parametric piecewise-smooth flow fields,” Comput. Vis. Image Understanding,
vol. 63, no. 1, pp. 75–104, 1996.
S. Baker, D. Scharstein, J. P. Lewis, S. Roth, M. J. Black, and R. Szeliski,
“A database and evaluation methodology for optical flow,” Int. J. Comput.
Vis., vol. 92, pp. 1–31, 2011.
P. Krähenbühl and V. Koltun, “ Efficient nonlocal regularization for optical
flow,” Lect. Notes Comput. Sci., vol. 7572, pp. 356–369, 2012.
H. Asfour, L. M. Swift, N. Sarvazyan, M. Coroslovacki, and M. W. Kay,
“Signal decomposition of transmembrane voltage-sensitive dye fluorescence using a multiresolution wavelet analysis,” IEEE Trans. Biomed.
Eng., vol. 58, no. 7, pp. 2083–2093, Jul. 2011.
M. Fisher, “A novel visual tracking algorithm based on adaptive threestep search, hybrid correlation, and adaptive template renewal,” Stanford
Undergraduate Res. J., vol. 1, pp. 54–60, 2006.
A. Sotiras, C. Davatzikos, and N. Paragios, “Deformable medical image registration: A survey,” IEEE Trans. Med. Imag., vol. 32, no. 7,
pp. 1153–1190, May 2013.
A. Crum, T. Hartkens, and D. Hill, “Non-rigid image registration: Theory
and practice,” Brit. J. Radiol., vol. 77, pp. S140–S153, 2004.

Authors’ photographs and biographies not available at the time of publication.

