IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 10, OCTOBER 2014

2569

Automated Control of an Adaptive Bihormonal,
Dual-Sensor Artificial Pancreas and Evaluation
During Inpatient Studies
Peter G. Jacobs∗ , Member, IEEE, Joseph El Youssef, Jessica Castle, Parkash Bakhtiani, Deborah Branigan,
Matthew Breen, David Bauer, Nicholas Preiser, Gerald Leonard, Tara Stonex, and W. Kenneth Ward

Abstract—Automated control of blood glucose in patients with
type-1 diabetes has not yet been fully implemented. The aim of
this study was to design and clinically evaluate a system that integrates a control algorithm with off-the-shelf subcutaneous sensors
and pumps to automate the delivery of the hormones glucagon and
insulin in response to continuous glucose sensor measurements.
The automated component of the system runs an adaptive proportional derivative control algorithm which determines hormone
delivery rates based on the sensed glucose measurements and the
meal announcements by the patient. We provide details about the
system design and the control algorithm, which incorporates both
a fading memory proportional derivative controller (FMPD) and
an adaptive system for estimating changing sensitivity to insulin
based on a glucoregulatory model of insulin action. For an inpatient study carried out in eight subjects using Dexcom SEVEN
PLUS sensors, prestudy HbA1c averaged 7.6, which translates to
an estimated average glucose of 171 mg/dL. In contrast, during
use of the automated system, after initial stabilization, glucose averaged 145 mg/dL and subjects were kept within the euglycemic
range (between 70 and 180 mg/dL) for 73.1% of the time, indicating improved glycemic control. A further study on five additional
subjects in which we used a newer and more reliable glucose sensor
(Dexcom G4 PLATINUM) and made improvements to the insulin
and glucagon pump communication system resulted in elimination
of hypoglycemic events. For this G4 study, the system was able to
maintain subjects’ glucose levels within the near-euglycemic range
for 71.6% of the study duration and the mean venous glucose level
was 151 mg/dL.
Index Terms—Artificial pancreas, bihormonal insulin delivery,
glucagon delivery, glucose sensor.
Manuscript received January 14, 2013; revised February 4, 2014, March 25,
2014, and May 5, 2014; accepted May 9, 2014. Date of publication May 13,
2014; date of current version September 16, 2014. This work was supported
by the Juvenile Diabetes Research Foundation, by the Legacy Good Samaritan Foundation, under NIH grants 1DP3DK101044-01 and DK090133, and the
HEDCO Foundation. This work was supported by the Juvenile Diabetes Research Foundation, by the Legacy Good Samaritan Foundation, and by an NIH
K23 award to Dr. El Youssef. Asterisk indicates corresponding author.
∗ P. G. Jacobs is with the Oregon Health and Science University, Portland,
OR 97239 USA (e-mail: jacobsp@ohsu.edu).
J. E. Youssef, J. Castle, P. Bakhtiani, D. Branigan, and N. Preiser are with
the Oregon Health and Science University, Portland, OR 97239 USA (e-mail:
castleje@ohsu.edu; elyoussj@ohsu.edu; bakhtian@ohsu.edu; dbranigan@
legacyglucosesensor.org; preiser@ohsu.edu).
M. Breen, D. Bauer, G. Leonard, and T. Stonex are with the Legacy
Research Institute, Portland, OR 97232 USA (e-mail: leonarge@ohsu.edu;
tstonex@legacyglucosesensor.org; dbauer@legacyglucosesensor.org; mbreen
@legacyglucosesensor.org).
W. K. Ward is with the Oregon Health and Science University, Portland, OR
97239 USA and also with the Legacy Research Institute, Portland, OR 97232
USA (e-mail: wardk@ohsu.edu).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2014.2323248

I. INTRODUCTION
HERE has been significant progress made in recent years
in developing technology for the automated delivery of
hormones to people with type-1 diabetes. Ever since the concept of automated control of glucose was first proposed [1], [2]
there has been a steady evolution of methods for implementing
the artificial pancreas. An overview of this progress is provided
in [3] and [4] which begins by describing how the artificial
pancreas resulted from the simultaneous development of continuous glucose monitoring (CGM) techniques [5]–[7] along
with automated insulin delivery technologies.
The Biostator [8], [9] based on the work of Albisser et al.
[1], [2] was the first commercial implementation of the artificial
pancreas controller. The Biostator used an average blood glucose reading taken continuously and the delivery of insulin was
based on this average glucose reading along with the change
in blood glucose over a prior 5-min window. The Biostator
delivered insulin intravenously and blood was withdrawn intravenously for external glucose measurement. There have been
many challenges to intravenous (IV) insulin delivery and glucose measurement and most current approaches to closed loop
glucose control, including the one described in this paper, use
the subcutaneous route.
A proportional controller [1] was the first algorithm used to
control the delivery of insulin based on glucose sensor readings. This proportional controller used the difference between
a target glucose level and the sensed glucose measurement to
calculate the insulin delivery amount. A derivative component
was introduced [2] which incorporated the change in measured
glucose over time to calculate the insulin infusion amount. Steil
et al. have incorporated an integral component in the controller
that utilizes a history of proportional values to improve the performance of maintaining glucose homeostasis [10]–[12], [46].
These three components (proportional, integrative, and derivative) form the basis of many PID-based artificial pancreas delivery controllers. The one described in this paper also contains
elements of these three components.
An alternative to PID controllers is model predictive control
(MPC). MPC has been applied toward automated blood glucose control as reported by numerous groups using simulated
data [13]–[16] and also within clinical studies [17]–[19]. MPCbased approaches to glucose control use a mathematical model
of the body’s metabolism of insulin and glucose to project future glucose levels of the patient. The control variable (insulin
delivery) is then adjusted by solving an optimization problem

T

0018-9294 © 2014 IEEE. Translations and content mining are permitted for academic research only. Personal use is also permitted, but republication/redistribution
requires IEEE permission. See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

2570

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 10, OCTOBER 2014

that is designed to achieve euglycemia. The design of the cost
equation that is minimized is therefore of critical importance
in MPC approaches to glucose control. The control algorithm
that we describe in this paper also uses a physiologic model of
insulin and glucose metabolism; however, we use the model to
estimate the subject’s varying insulin sensitivity and then modify parameters within a PID controller based on this varying
sensitivity. The unique aspect of our controller is that we use
a PID-like controller in concert with a glucoregulatory mathematical model that adjusts for changing insulin sensitivity to
control blood sugar levels in patients. Comparisons between
MPC approaches and our algorithm will be discussed.
Other groups have reported alternative methods for closed
loop control of blood glucose including those using fuzzy logic,
artificial neural networks, and those which use mathematical
models of β-cells to control delivery of hormones [20]–[26].
Vigorous treatment of type-1 diabetes increases the frequency
of hypoglycemia [27]. In the setting of the artificial pancreas, attempts have been made to algorithmically predict when a patient
is approaching hypoglycemia, leading to discontinuation of insulin delivery [28]. However, subcutaneously delivered insulin
has a delayed absorption, so this approach is not always successful, even with currently available fast-acting insulin analogs
[29]. Our group [30], as well as groups from Boston University (USA) and McGill University (Canada) [31]–[34], have
addressed the issue of avoiding hypoglycemic events by incorporating a second pump that delivers glucagon in response to
impending or overt hypoglycemia. Glucagon is the natural secretory product of pancreatic alpha cells in mammals and is
normally released in response to hypoglycemia. Our algorithm
adapts to changes in insulin sensitivity, which can occur during
stress or exercise.
While we have previously reported on certain aspects of our
controller [35]–[37], we have not yet presented the entire algorithm and automated control hardware and software system. In
this paper, we describe the details of the controller, the value
of each parameter in the model, and describe how the parameters were tuned using two types of simulators. We discuss how
we integrate a control algorithm with an adaptive expert system (AES) and a physiologic glucoregulatory model to enable
automated bihormonal drug delivery (insulin and glucagon) for
the purpose of maintaining glucose homeostasis within the near
euglycemic range. The only part of the system that is not fully
closed loop is the element in which the patient must enter a
rough estimate of carbohydrate consumption to the system.

Fig. 1. System diagram of artificial pancreas hardware components. Receivers
and mobile computing devices are held in the vest.

communicates with the sensor receivers and the pump PDMs
across a USB interface. The receivers and PDMs communicate
wirelessly with the sensors and pumps, respectively. A custom
battery pack was used to power all of the system components
during the data acquisition process. Our algorithm relies on redundant sensor measurements to help mitigate the risk of sensor
drop-outs and drift. The SEVEN PLUS sensors are not capable
of interfacing with more than one computing device, and so
when the CGM was used, we used a virtual operating system
on the Viliv tablet such that one sensor communicated with the
primary operating system, while the back-up sensor communicated with the virtual operating system. We used VMWare
Workstation (VMWare, Palo Alto, CA, USA) to enable the virtual operating system and used custom software to automatically
acquire the sensors between the two operating systems. Fig. 1
shows a diagram of the system.
The system is capable of delivering both a premeal insulin
bolus and automated insulin or glucagon infusion. The premeal
insulin bolus is calculated based on the patient’s indicated carbohydrate intake, estimated to the nearest 20 g. The patient
enters this carbohydrate amount into the control software and
the controller then calculates a suggested insulin bolus amount.
The patient then acknowledges this amount of premeal insulin
and the bolus is given. The bolus is then given with the expectation that the patient will consume the meal at that time. We
believe that the pharmacodynamic properties of subcutaneously
delivered insulin are too long to enable a fully automated system
without meal announcements. While automated meal detection
algorithms have been proposed [38], [39], they may not be
able to detect the meal soon enough to optimize postprandial
glycemic control.

II. SYSTEM DESIGN
The closed loop system that we are presenting here consists of two off-the-shelf wire-based continuous glucose sensors
(SEVEN PLUS and G4 PLATINUM, Dexcom, Inc.), two offthe-shelf microdelivery pumps (Omnipod, Insulet Corporation),
and custom controller software running on a palm top tablet
computer (Viliv, Yukyung). Software was developed in C#.NET.
Each sensor interfaces with its own receiver and each pump is
controlled by its own personal diabetes manager (PDM, Insulet)
through separate wireless channels. The controller software

A. Overview of Control Algorithm
The artificial pancreas control (APC) algorithm used to regulate glucose consists of (1) a FMPD controller, and (2) an
AES that modifies the insulin delivery rates by changing the
FMPD gain factors [36]. The adaptive system is based on the
physiologic model of glucose–insulin regulation developed by
Hovorka [40] and reported by El Youssef et al. [35]. The system takes into account the subject’s HbA1c, weight, total daily
insulin requirement (TDR), as well as current and prior glucose

JACOBS et al.: AUTOMATED CONTROL OF AN ADAPTIVE BIHORMONAL, DUAL-SENSOR ARTIFICIAL PANCREAS

2571

TABLE I
APC MODEL PARAMETERS
Parameter
K PI IER
K DI IER
z PI IER
IIR
zD
E

Fig. 2. APC algorithm that consists of the FMPD control algorithm that is
updated by an adaptive expert system.

sensor readings, announced meals, rescue carbohydrate deliveries, sensor calibration history, and calculated insulin sensitivity
values. The system makes executive decisions based on the
proportional and derivative errors (DEs) (and their histories or
“fading memories”) using a target glucose. A general concept
of this control system is shown in Fig. 2.
The system of automated insulin and glucagon administration is specifically designed to minimize the risk of the two
drugs opposing one another, which would otherwise increase
the risk for system instability. For example, as discussed below
in further detail, when glucagon is given to treat impending hypoglycemia, the insulin delivery gain settings are temporarily
reduced in order to avoid triggering insulin delivery as a result
of the glucagon-induced rise in glucose. Although the system is
bihormonal in nature, it is important to emphasize that it does
not require administration of glucagon, which is only delivered
for rescue purposes.
1) Fading Memory Proportional Derivative Control Algorithm: The FMPD controller consists of a proportional error
(PE) term, a DE term, and a basal rate (BR) term. The FMPD
controller has separate parameters for controlling insulin infusion rate (IIR) as compared with glucagon infusion rate (GIR).
In this paper, the superscript for mathematical terms includes
reference to the type of hormone being infused, IIR or GIR.
The PE at time t (PE(t)) is the difference between a target glucose level (GT ) and a sensed glucose level (G). A superscript


indicates whether PE is related to IIR (PEIIR ) or GIR PEGIR .
The insulin and glucagon control algorithms use different target
glucose levels. These target values (115 mg/dL for insulin and
95 mg/dL for glucagon) have been shown to perform well as we
have demonstrated [36]. The insulin delivery target is more conservative at night to reduce the risk of nocturnal hypoglycemia.
The target values are summarized in Table I.
An exponentially weighted sum of PE terms is averaged over
the prior 90 min such that the most recent PE terms receive
the largest weighting while those from 90 min prior are least
relevant. The weighting value at a time t is adjusted by the
IIR
as shown in (1). Likewise, the entire
PE time constant zPE
IIR
. Note that
average PE is scaled by the PE gain constant KPE
the weighted PE values are only summed every 5 min such that
a total of 19 prior PE(t) readings are included. The reason for
this rule is that the sensed glucose measurements only arrive

KB
Ip
K pGeI R
K Dg iEr
z PG EI R
G IR
zD
E
IOB/
TDR
GG L M a x
GG L M i n
R
G IDI T
G INI TR
IR
GG
DT
IR
GG
NT
GG r e f

Description

Value

Insulin PE gain constant
Insulin DE gain constant
Insulin PE decay constant
Insulin DE decay constant
Basal rate multiplier
Percent pre-meal insulin
Glucagon PE gain constant
Glucagon DE gain constant
Glucagon decay constant
Glucagon DE decay constant
Max IOB/TDR ratio
Maximum glucagon limit in 50 min [μg/kg].
Minimum glucagon limit in 50 min [μg/kg]
Day target glucose level for insulin [mg/dL]
Night target glucose level for insulin [mg/dL]
Day target glucose level for glucagon [mg/dL]
Night target glucose level for glucagon [mg/dL]
Glucagon refractory period [min]

0.08
0.45
0.03
0.18
0.4
60%
−2.7
−0.6
0.3
0.4
0.20
2
0.4
115
140
95
95
50

once every 5 min from the Dexcom sensors. The term k is a
5-min increment index such that when k = 3, for example, the
PE(t–5k) term is from 15 min prior to the current time
⎛ 18
IIR
⎝
PEIIR
Avg (t) = KPE ×

k =0


⎞
IIR
PE (t − 5k) × e−z P E ×5k
⎠.
19

(1)
The DE term is defined as the slope or the change in sensed
glucose over the prior 10 min. If the subject’s glucose is changing very rapidly, the IIR will be adjusted more significantly
because the DE term will be larger. It is important to use a short
time period over which to estimate DE so as to more accurately
capture the change in glucose at a given point in time. A linear least-squares regression was done on the prior 10-min data
record to calculate this slope DE term. As was carried out with
the PE average, the DE terms are also averaged over the prior
90 min using a weighted average that is dependent on the DE
IIR
IIR
)and the DE time constant (zDE
). Using a
gain constant (KDE
weighted average of DE over 90 min minimizes the influence
of sensor noise on the IIR calculation (2). The selection of the
gain and time constants were derived empirically as previously
described [36]. Model parameters were derived within rats. For
use within humans, the model parameters were tuned using the
UVa-Padova simulator [41], [42] and separately using a simulator based on the glucoregulatory model described by Hovorka
et al. [40] implemented using visual basic for applications within
microsoft excel (Microsoft Inc., Redmond, WA, USA)
 IIR
⎞
⎛ 18
60 × DE (t − 5k) × e−z D E ×5k
t=0
IIR ⎝
⎠.
DEIIR
Avg (t) = KDE
19
(2)
The subject’s initial TDR is obtained from an interview of the
patient. Due to the fact that TDR is underestimated in patients
with poorly controlled diabetes, this TDR value is adjusted using the patient’s HbA1c according to (3). An HbA1C of 7%
is chosen as a target for the initial TDR adjustment based on

2572

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 10, OCTOBER 2014

ADA recommendations [43]. If the subject’s TDR is above 7%,
the TDR will be increased by 10% for every 1.5% increase in
HbA1C. This relationship is given in (3) whereby the constants
0.0667 and 0.5331 were selected to enable this relationship between the subject’s clinical TDR, their TDRAdj and the HbA1C

TDR,

TDR A d j =





TDR × 0.0667 × H bA1C + 0.5331 ,

TDR ≤ 7%

TDR > 7%.

(3)
TDRAdj is then used to calculate the BR of insulin delivery
which depends on the patient’s sensed glucose relative to their
target glucose level. If the sensed glucose is below 60% of the
target, then the BR is zero. If the sensed glucose is between 60%
of the target and the target, then the BR is linearly proportional
to the TDRAdj and the basal multiplier (KB ) according to
(4). Finally, if the sensed glucose is greater than or equal to the
target, then the BR is a fixed value corresponding to the TDRAdj
and the basal multiplier. The basal multiplier was selected by
running simulations using the UVa-Padova simulator [41], [42]

Fig. 3.

⎧ TDR
Adj K B
⎪
,
⎪
24
⎪
⎪
⎪
⎡
⎤
⎪
⎨
 

TDRAdj K B
(
)
2
.
5
G
t
BR (t) =
⎣
− 1.5 ⎦ ,
⎪
24
GT
⎪
⎪
⎪
⎪
⎪
⎩

Note that the glucagon PE average is dependent on the patient’s weight (W), the glucagon PE, theglucagon
 decay time
GIR
,
and
the
PE
gain
constant
K
constant ZGIR
PE
PE

0,

G T ≤ G (t)
0.6 G T ≤ G (t) < G T .
G (t) < 0.6 G T

(4)
The IIR at time t is then a sum of the weighted average PE,
weighted average DE, and BR terms according to
IIR
IIR(t) = PEIIR
Avg (t) + DEAvg (t) + BR(t).

(5)

Insulin on board at time t (IOB(t)) is a weighted sum of all
past insulin boluses (B) over the past 9 h as defined by (6). If
IOB(t) exceeds 20% of TDRadj , then IIR gets set to 0 as shown
in Fig. 3. The decay constant of IOB was selected based on data
presented by Holmes et al. [29]
IOB (t) =

18

k =0

B (t − 5k) +

108


B (t − 5k) e−z I O B ×5k . (6)

k =19

The GIR is calculated in a manner similar to that of the IIR.
GIR is calculated using a PE term and a DE term, however,
the target glucose is independent of the insulin target glucose.
This independence enables the GIR control parameters to be
adjusted without influencing the control of insulin. Unlike the
IIR calculation, the GIR calculation does not include a basal
delivery rate. Furthermore, the history over which the weighted
average is taken for the PE is smaller (15 min) as compared
with 90 min for insulin. This is because glucagon acts faster
than insulin within the body
PEGIR
Avg (t) =
⎛ 3
GIR
KPE
×⎝

Insulin infusion rate (IIR) decision tree.

 GIR
  −z G I R ×5k  ⎞
W
×
PE
(t
−
5k)
× e PE
k =0
⎠.
4
(7)

⎛ 2

IR
G IR
⎝
DEG
A v g = KD E ×

k=0

⎞
 G IR
W × DE (t − 5k) × e−z D E ×5 k
⎠.
3

(8)
GIR
and
DE
Finally, the GIR is the sum of the average PEGIR
Avg
Avg
terms. There is no BR term for calculating GIR
GIR
GIR(t) = PEGIR
Avg (t) + DEAvg (t).

(9)

2) Adaptive Expert System: The AES consists of two subsystem components, (1) a decision tree based on the FMPD
output along with patient-specific information, and (2) an adaptive physiologic model that calculates the patient’s insulin sensitivity once every 30 min and feeds this information back to
the FMPD algorithm in the form of the TDR. Each of these is
further discussed below.
B. Decision Tree
During the use of the system, the patient and the clinician
have the ability to enter various events including meals, oral
rescue carbohydrates, IV carbohydrates, and sensor calibrations.
The inclusion of IV carbohydrates is applicable only to studies
done in an inpatient setting. IV carbohydrates were given if
the patient’s glucose dropped below 50 mg/dL. The IIR and
GIR values calculated by the FMPD algorithm are adjusted
according to these events using the decision trees shown in
Figs. 3 and 4, respectively. As an example of the rationale for
these special circumstances is the following. As glucose rises
quickly after a glucagon dose or after oral rescue carbohydrates,
it would be inappropriate for the rising slope to trigger the
derivative element of IIR. If IIR were not reduced during these
circumstances, one could see instability in the system during

JACOBS et al.: AUTOMATED CONTROL OF AN ADAPTIVE BIHORMONAL, DUAL-SENSOR ARTIFICIAL PANCREAS

Fig. 4.

2573

Glucagon infusion rate (GIR) decision tree.

which IIR and GIR both escalate to compensate for each other’s
independent effects.
The IIR is adjusted according to four events: (1) the maximum glucagon over a 50-min period has been exceeded, (2)
an oral rescue carbohydrate has been given in the past 15 min
for treatment of hypoglycemia, (3) an IV carbohydrate has been
given in the past 20 min for treatment of hypoglycemia, or (4),
the maximum IOB has been exceeded.
The IIR is reduced to 25% of its FMPD calculated value
(IIRFM PD ) if the amount of glucagon delivered within a 50min period (GGLim it ) has exceeded a maximum value or if an
oral rescue carbohydrate load has been given within 15 min for
treatment of hypoglycemia. If either of these conditions arises,
then the IIR is reduced to 25% of IIRFM PD for 40 min. The
40-min turn-down period was selected because it represents the
half-life of maximum insulin action [29]. The 25% reduction in
IIR was chosen based on clinical standards of care [43] and was
verified in-silico using the UVa-Padova simulator [41], [42].
IV carbohydrate delivery or the condition whereby IOB has
exceeded 20% of TDR results in a complete turn-off of insulin
infusion.
The GIR calculated by the FMPD algorithm (GIRFM PD ) is
adjusted using a decision tree as shown in Fig. 4.
The maximum glucagon that may be delivered by the system
within a 50-min period is termed GGLim it . GGLim it is defined
according to
GGLim it
⎧
IOB
⎪
⎨ GGconc W(GGLM in + TDR A d j (GGLM ax
=
−GGLM in )), IOB < TDRAdj × 0.2
⎪
⎩
GGconc W (GGLM ax ) , IOB ≥ TDRAdj × 0.2.

(10)

Notice that the maximum glucagon delivered within a 50-min
period is dependent on the glucagon concentration (GGconc ),
the patient’s weight (W), and the ratio of the IOB and the
TDRAdj for that patient. If the patient’s IOB is less than 20%
of the TDRAdj , then the GGLim it is proportional to the ratio
of IOB/TDRAdj within the range of that subject’s minimum
and maximum limit glucagon delivery amount (GGLM ax and
GGLM in ) which are dependent on the subject’s weight (W).

Fig. 5. Adaptive algorithm for adjusting patient’s insulin sensitivity based on
a physiologic glucoregulatory model [35].

If the IOB is greater than 20% of the patient’s TDRAdj , then
GGLim it is set equal to the limit of the maximum glucagon
delivery amount.
The glucagon decision tree in Fig. 4 is based on three conditions: (1) has the maximum 50-min glucagon as defined by (10)
been exceeded, (2) has the maximum glucagon delivery over
24-h been exceeded, and (3) has a meal occurred within the last
20 min. If any of these conditions occur, the GIR is set to 0.
Otherwise, the GIR is set according to the FMPD algorithm.
C. Adaptive Physiologic Model
We have incorporated a glucoregulatory model for estimating
insulin sensitivity based on the one described by Hovorka et al.
[40]. The Hovorka model describes a three-compartment model
including a glucose compartment, insulin absorption compartment, and insulin action compartments which feed back to the
glucose compartment. This model can be used to estimate the patient’s insulin sensitivity based on their current and prior sensed
glucose readings, meal events, and insulin bolus amounts. The
insulin sensitivity is estimated every 30 min using the approach
described further below and in Fig. 5.
The newly estimated insulin sensitivity is related to TDR
using (11) and (12) and also further explained below. Because
TDR influences both glucagon and insulin delivery ((4), (10),

2574

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 10, OCTOBER 2014

TABLE II
ADAPTIVE MODEL PARAMETERS
Parameter

Description

Value

TDR u g
TDR d g
Se
Sc

Up governor
Down governor
Sensitivity composite exponent
Sensitivity composite coefficient

6%
12%
−0.83
5.3

We can convert the BR determined in (11) to a TDR by
adjusting for the subject’s weight and by multiplying the BR in
(11) by the total number of minutes in a day (1440). Dividing by
a factor of 1000 converts the units from mU to μU. We multiply
the BR by a factor of 2 because we assume that the BR delivered
by a patient is typically about ½ of their TDR. Equation (12)
summarizes the relationship between the target BR and the TDR
Fig. 6. Relationship between IIR and insulin sensitivity composite. For lower
sensitivity to insulin, IIR is higher, and it changes based on different target
glucose levels as shown. These curves were determined by (11) empirically
using simulation runs.

and (13), respectively), the control algorithm adapts the delivery
of hormones based on a patient’s changing insulin sensitivity.
Details of the Hovorka model and how we have used it to adjust
insulin sensitivity are included in the appendix of Youssef et al.
[35]. Fig. 5 provides a summary of how it was used in this study.
Notice in Fig. 5 that every 30 min, the TDR is updated based
on the subject’s updated insulin sensitivity. The patient’s insulin sensitivity is estimated by using the patient’s prior 90 min
of sensed glucose along with meal data, oral rescue/IV carbohydrates, and insulin boluses delivered during that time and
comparing the sensed glucose with glucose values predicted
by a glucoregulatory model [40]. One of the parameters in the
glucoregulatory model is an insulin sensitivity composite coefficient (Sc ). When determining the patient’s insulin sensitivity, we
select a fraction of the sensitivity composite coefficient that can
range from 0.1 to 2.0 of the original setting. The final fraction is
selected based on a least-squares fit of the patient’s prior 90 min
of sensed glucose data with respect to the model-predicted glucose values. The sensitivity composite is selected which yields
the closest match of the model-predicted glucose with the prior
90 min worth of sensed glucose data using a mean-squared-error
criteria.
The sensitivity composite coefficient and the sensitivity composite exponent were chosen by modeling the relationship between TDR and insulin sensitivity using the glucoregulatory
model [40]. The glucose target of 115 was selected and for
each insulin sensitivity composite (Sc ), which is a percentage
of the model sensitivity, was varied between 10% and 200%;
the insulin infusion (mU/kg/minute) that maintained glucose at
the target was plotted relative to the sensitivity composite. This
relationship is a nonlinear inverse function and a power regression was fit with an R2 of 0.9995 (see Fig. 6) to determine the
sensitivity exponent value (Se )
BRtarget = (Sc )S e .

(11)

TDR =

BRtarget × 2 × W × 1440
.
1000

(12)

The rate at which the TDR was allowed to change was limited
to avoid representing a nonphysiologic swing in insulin sensitivity. This limitation in the rate at which TDR could change
was controlled by the TDR up-governor and down-governor.
The values of 6% and 12% for the up and down governors,
respectively, were selected empirically running simulations of
data within the glucoregulatory model [40] implemented within
Excel using Visual Basic for Applications. The more stringent
limit on the TDR up-governor is to avoid hypoglycemia resulting from an inappropriate increase in TDR, such as that may
occur with a glucose sensor that is overestimating blood glucose. In addition to the BR, the PE and DE gain factors for IIR
IIR
IIR
, KDE
)
are also adjusted by the TDR. The gain factors (KPE
are scaled linearly with TDR according to
IIR
IIR
KAdj
= Koriginal
× 0.02 × TDRAdj .

(13)

IIR
IIR
Koriginal
represents the original values for either KPE
or
IIR
IIR
KDE (as listed in Table I), and KAdj represents the adjusted gain
factor used to calculate the IIR based on new TDRs calculated
by the adaptive algorithm. The value of 0.02 was selected such
that if the TDRAdj is 50 units/day (mean TDR of subjects), the
IIR
= 1 in this case.
original gain factor would be used since KAdj

D. Model Parameters Summary
The model parameters for the control algorithm are shown in
Table I.
The values shown in Table I were initially chosen based on a
study done on diabetic rats as described [36]. Notice that the PE
gain constant is significantly smaller than the DE gain constant.
Given the delayed action of subcutaneous insulin, the change in
glucose is more relevant than the absolute error. Also note that
the decay constant for the PE is smaller than the decay constant
for the DE. The inverse of this decay constant represents the
half-life of the insulin infusion caused by a change in glucose.
The basal gain constant is set to 0.4, which translates to 40%

JACOBS et al.: AUTOMATED CONTROL OF AN ADAPTIVE BIHORMONAL, DUAL-SENSOR ARTIFICIAL PANCREAS

2575

Fig. 7. Results showing glucose control over entire study duration for all subjects in both the 7+ and G4 studies. Mean and upper/lower bounds are shown.
Notice that control was best during the night. Meals occurred at 60, 300, 600, and 1500 min from the experiment start time. Glucose levels were higher during the
first 5 h of the study because the subjects arrived at the study in hyperglycemia. Furthermore, the APC algorithm system parameters need time to initialize. In the
remainder of results presented in this paper, we exclude the first 5 h of data. Average insulin and glucagon are plotted on second y-axis with the insulin delivery
shown going up and the glucagon delivery shown going down.

of the subject’s TDR. In a typical clinical scenario, between
40–60% of TDR is used as basal infusion for type-1 subjects
who use insulin pumps.
The model parameters for the adaptive algorithm are given in
Table II and were chosen by running simulations to determine
how the adaptive algorithm responds to dynamic events such as
meals as well as rapid increases and decreases in glucose.
III. METHODS
Subjects were recruited from clinics at Legacy Health and
Oregon Health and Science University (OHSU). Subjects were
required to have type-1 diabetes for at least 1 year, to be age
21–65 years old, and to be currently using an insulin pump.
Women of childbearing age were required to have a negative
urine pregnancy test prior to participation. Patients with prior
history of cardiovascular, cerebrovascular, kidney, or liver disease or any other uncontrolled chronic medical conditions were
excluded. Other exclusion criteria included oral or parenteral
corticosteroid use, adrenal insufficiency, seizure disorder, immunosuppressant use, visual or physical impairments that impede the use of a CGM device, insulin or glucagon allergies,
hypoglycemia unawareness, serum insulin antibody level ࣙ
100 μUnits/mL, C peptide level ࣙ 0.5 mg/mL, or insulin resistance requiring more than 200 units of insulin per day.
The research protocol was approved by the Legacy and OHSU
Institutional Review Boards, and all subjects provided written informed consent. Permission to carry out these studies
was granted by the U.S. Food and Drug Administration (IDE
#G120009). A total of 13 closed loop studies were performed.
The mean age of the subjects was 39.5 ± 10.9 years, mean duration of diabetes was 22.5 ± 12.4 years, HbA1c was 7.7 ± 0.6%,
TDR was 50.1 ± 11.2 u/day, and weight was 82.7 ± 18.5 kg.

Subjects (n = 13) participated in a 28 h sensor-augmented
automated glycemic control experiment. Subjects were fitted
with two subcutaneous sensors (Dexcom SEVEN PLUS CGM
or Dexcom G4 PLATINUM) systems the day prior to their
study visit. During this period, subjects were trained by study
personnel on how to use and calibrate the CGM system as well
as instructed not to eat (unless necessary for treatment of hypoglycemia) after midnight prior to the study. During this 8-h
prestudy period, subjects performed calibration using a OneTouch Ultra 2 blood glucose meter. Upon arrival, subjects were
admitted and an IV catheter was placed. Venous blood glucose
(VBG) was sampled every hour during the day (07:00 h–23:00 h)
and every 2 h at night (if one sensor failed, the nocturnal frequency of VBG draws increased to every hour). In addition,
extra safety blood glucose draws occurred at night (23:00 h–
07:00 h) when the IIR was ࣙ 0.4 units/kg per hour averaged
over 30 min and the IIR rate of rise obtained over 30 min was
also ࣙ 0.4 units/kg per hour. When average sensed glucose
reached ࣘ 85 mg/dL, VBG was measured every 20 min until
the reading went above 85 mg/dL. At any point when VBG was
ࣘ 70 mg/dL, the frequency of blood draws increased to every
10 min until VBG increased above 70 mg/dL.
An insulin infusion pump (OmniPod, Insulet Corporation)
was filled with aspart insulin (NovoLog, Novo Nordisk) and a
second OmniPod was filled with glucagon (GlucaGen, Novo
Nordisk), reconstituted with sterile water to 1 mg/mL. A new
pod with fresh glucagon solution was prepared and inserted into
the subject every 8 h.
During each inpatient experiment, the CGM telemetrically
streamed sensed glucose data every 5 min to a handheld tablet
computer (Viliv, Yukyung) running the control algorithm described above. The algorithm used the average of the two sensor
values to compute insulin and GIRs and automatically call for

2576

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 10, OCTOBER 2014

the insulin or glucagon delivery at the calculated rates by the
OmniPod pumps which delivered the hormones subcutaneously.
The CGM sensors were calibrated at time zero and every 6 h for
the duration of the 28 h study. Sensor recalibration occurred if
accuracy became suboptimal, defined as when the absolute relative difference met or exceeded 35% for glucose ࣙ 75 mg/dL
or when the absolute difference exceeded 30 mg/dL for glucose < 75 mg/dL. In addition sensor calibration occurred when
the system determined that the two sensors differed by more
than 60%.
During the experiment each subject was given four meals:
breakfast, lunch, and dinner on Day 1, and breakfast on Day
2. Meals were self-selected by the subject from the hospital
menu. By design, the precise carbohydrate content for meals
was not entered into the controller. Instead, subjects were asked
to estimate the carbohydrate content to the nearest 20 grams,
and this value was entered into the APC which determined
an appropriate insulin premeal bolus based upon 60% of the
subject’s standard insulin-to-carbohydrate ratio for their current
TDR. The insulin bolus command was then sent wirelessly to
the insulin pump for delivery.
A. Phases 1 and 2 of Inpatient Study

Fig. 8. Control variability grid. Each dot on the graph represents results
from a single trial. The horizontal axes represent the minimum glucose level
above which 95% of the subject’s venous glucose values were measured during
the study. The vertical axis is the maximum glucose below which 95% of the
subject’s values were measured during the study. The white circles are from the
study done using the Dexcom G4 sensors which have been found to be more
accurate and reliable than the Dexcom 7+ sensors (black circles). Control was
significantly better when using the G4 sensors.

Results are presented from two separate phases of the study.
The control algorithm used was the same in both studies. In
the first phase, we used the Dexcom SEVEN PLUS sensors.
In the second phase, we moved to the more accurate and reliable Dexcom G4 PLATINUM once it was made available. We
also made improvements in the communication protocol with
the OmniPods. Results from these two phases are summarized
separately and individual results are designated with either a 7+
or G4 designator in the tables of Section IV.
Glucose values during both studies were well controlled;
however, control was better for the G4 study. A plot showing a
grand mean and standard deviation of all data plotted during the
both 7+ and G4 studies is shown in Fig. 7.
IV. RESULTS
For the 7+ study, the study went to completion for seven out
of the eight subjects. The one subject who did not complete the
study was stopped after 20 h due to failure of the palmtop tablet
computer to hold a charge. For the Dexcom G4 study, it went to
completion in five out of five subjects.
The mean blood glucose value across all subjects in both
inpatient studies was 153 mg/dL. It should be noted that most
subjects were quite hyperglycemic upon entry into the study
(mean entry glucose, 199 mg/dL). Therefore, a more appropriate
glycemic control metric may be calculated by excluding the first
5 h to discount the effect of insulin delivered prior to automated
control. Results obtained with such an exclusion criteria are as
follows: mean glucose: 147.4 mg/dL; mean daytime glucose:
160.1; mean nocturnal glucose, 11 PM to 7 AM: 139.2.
A control variability grid is shown in Fig. 8. The A region
is considered accurate control, lower B is benign deviations
into hypoglycemia, B is benign control deviations, upper B is
benign deviations into hyperglycemia, lower C is overcorrection

Fig. 9. Cumulative glucose graph. Each line represents the entire closed loop
trial for a single subject with the data plotted to show the percent of time
spent in each glucose range, severe hypoglycemia (<60 mg/dl), hypoglycemia,
(60–70 mg/dl), euglycemia (70–180 mg/dl).

of hypoglycemia, upper C is overcorrection of hyperglycemia,
lower D is failure to deal with hypoglycemia, upper D is failure
to deal with hyperglycemia, and E represents failed control or
errors [44].
Results show that the subjects evaluated during the G4 study
were better controlled than during the 7+ study, with results
from the G4 study all falling within the B or upper B regions.
There were no values in the E region for either of the studies.
One of the reasons why the results were better for the G4 study
than the 7+ study had to do with improvements we made with
communication between the tablet computer and the sensors and

JACOBS et al.: AUTOMATED CONTROL OF AN ADAPTIVE BIHORMONAL, DUAL-SENSOR ARTIFICIAL PANCREAS

2577

TABLE IV
SUMMARY OF DELIVERY METRICS DURING CLOSED LOOP CONTROL
Subject

Fig. 10. Closed-loop studies done using the G4 sensors yielded significantly
lower error and also zero incidence of hypoglycemia (values less than 70 mg/dl)
compared with the studies done using the older 7+ sensors. The one outlier
study which showed 28% of values < 70 mg/dl was a subject whose glucagon
pump was not functioning properly. This subject’s study ended early because
of the pump failure, thereby creating a high percentage of values less than
70 mg/dL.

TABLE III
ESTIMATED VERSUS ACTUAL CARBOHYDRATE INTAKE IN GRAMS
Breakfast
Day 1
Mean Estimated
Mean Actual

62.5
73

Lunch
Day 1

Dinner
Day 1

Breakfast
Day 2

65.0
72

65.7
93

54.3
69

301 − B
307
308
309
313
314
315
316
Mean all
500
504
505
506
506
Mean all

Study

Oral Carb
[Count /
Amount]

IV carb
[Count /
Amount]

LBGI

Ins
Given
[Units]

Glcgn
Given
[mcg]

7+
7+
7+
7+
7+
7+
7+
7+
7+
G4
G4
G4
G4
G4
G4

0/0
2 / 40 g
0/0
0/0
1 / 26 g
2 / 40 g
0/0
0/0
0.6 / 13.3
0/0
0/0
0/0
0/0
0/0
0/0

1/5g
0/0
0/0
0/0
2 / 45 g
0/0
0/0
0/0
0.4 / 0.6
0/0
0/0
0/0
0/0
0/0
0/0

4.65
7.83
3.06
2.87
15.67
6.50
0.18
1.58
5.29
0.56
1.84
0.84
2.51
0.06
1.31

64.90
66.75
76.25
89.45
83.90
48.40
30.90
62.70
59.90
32.90
51.10
62.10
105.50
74.80
65.3

436
673
752
363
635
560
57
453
453
44
185
421
259
68
195

A cumulative glucose plot is shown in Fig. 9. As depicted
there were instances of hyperglycemia, and to a much lower
degree hypoglycemia, with the values predominantly in the euglycemic range. While Fig. 9 may appear to indicate that there
was a change in algorithm tuning between 7+ and G4, this was
not the case. The algorithm did not change between 7+ and G4
studies. What changed between the two was the accuracy and
reliability of the sensors in G4 relative to 7+. By ensuring that
glucose sensor data were reliably transmitted and were accurate,
the overall performance and control of the system improved.
A primary feature of our closed loop system is that we use
glucagon to avoid hypoglycemic events. Fig. 10 shows that when
we switched to the G4 sensors and improved communication
between the tablet computer and the PDM hardware, there were
no occurrences of hypoglycemia, and the mean absolute relative
error was significantly less than during the 7+ study.
A. Meal Analysis

Fig. 11. Glucose excursions 2 h after a meal. Notice that the glucose increased
(up arrow) after both dinner and breakfast, but decreased (down arrow) after
lunch. The reason that glucose dropped after lunch is because the subjects arrived
hyperglycemic, and the system had not yet had time to bring their glucose levels
into the euglycemic range prior to lunch.

the Omnipod PDMs for the G4 study. There were times in the
7+ study when communication failed between the sensors or the
glucagon pump during hypoglycemic events which prevented
the system from responding with glucagon dosing in a timely
manner.

A critical component of an AP control system is the ability
to handle meal events. In this study, subjects were asked to estimate the amount of carbohydrates in a meal announcement
that they then input into the APC system, which simulates a
real-life situation whereby subjects must estimate their carbohydrate intake. On average, subjects underestimated the amount
of carbohydrates in their meal as shown in Table III.
The postmeal increment in blood glucose (average of 1 and
2 h postmeal minus premeal value) for the entire study duration
was 12 mg/dL; however, this value is misleadingly optimistic
because glucose was unstable during the first 5 h of the study
and markedly declined after the second meal as the automated
system called for substantial doses of insulin. This is apparent
in Fig. 11 which shows that glucose levels decreased after lunch
on the first day, as the patient’s glucose levels were still being
brought down by the control system. The postmeal glucose
levels increased as expected for the dinner and breakfast. If one
excludes the first two meals (first breakfast and lunch), the mean
increment was 30 mg/dL. This degree of glycemic control falls

2578

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 10, OCTOBER 2014

TABLE V
RESULTS OF GLUCOSE CONTROL ACROSS ALL SUBJECTS
Subject
301 − B
307
308
309
313
314
315
316
Mean all
500
504
505
506
506
Mean all

Study

Mean VBG [mg/dL]

StdDev [mg/dL]

%< 70 mg/dL

%> 70 < = 180 mg/dL

%> 180 mg/dL

7+
7+
7+
7+
7+
7+
7+
7+
7+
G4
G4
G4
G4
G4
G4

133.5
137.6
139.3
153.0
167.6
147.4
158.4
125.6
145.3
147.4
125.6
125.6
173.0
181.8
150.7

36.7
40.9
40.0
49.8
65.8
50.3
54.0
31.9
46.2
54.2
42.6
36.3
62.3
69.1
52.9

0.8%
0.8%
0.0%
0.8%
4.6%
3.2%
0.0%
0.0%
1.3%
0.0%
0.0%
0.0%
0.0%
0.0%
0.0%

83.5%
86.0%
84.3%
57.1%
55.7%
61.4%
64.7%
92.1%
73.1%
78.3%
74.8%
83.2%
60.6%
60.9%
71.6%

15.7%
13.2%
15.7%
42.1%
40.9%
34.6%
35.3%
7.9%
25.7%
21.7%
25.2%
16.8%
39.4%
39.1%
28.4%

TABLE VI
CLARKE ERROR GRID SHOWING SENSOR ACCURACY OF DEXCOM 7+ VERSUS
G4 SENSORS FOR INPATIENT STUDY (AVERAGE BETWEEN TWO SENSORS)
Sensor
7+
G4

A

B

C

D

E

72.6%
90.1%

25.2%
9.9%

0%
0%

2.2%
0%

0%
0%

TABLE VII
COMPARISON OF AP CONTROL SYSTEMS
System

Summary of Results

OHSU, this paper

Mean glucose level of 147 when using either the 7+ or
G4 sensors. Euglycemia for 72.5% of the study duration.
Zero hypoglycemic events for subjects wearing the G4
sensors. For subjects wearing either G4 or 7+ sensors,
subjects spent 1.5% of time in hypoglycemia range
(sensed glucose < 70 mg/dL).
Mean glucose level of 158 mg/dL. Euglycemia for 68%
of the sudy duration. Eight hypoglycmemia events during
576 h of closed loop control (0.7% of total time).
Mean glucose level of 140 mg/dL. Maintained glucose
levels within near euglycemia for 70.7% of the time. One
subject out of 15 had at least one hypoglycemia event (2)
during closed loop control. Note that this study was not
fully automated so there were no connectivity issues to
overcome. A doctor delivered the hormones based on the
algorithm’s recommendation.
Mean glucose levels of 120 mg/dL. Maintained glucose
within euglycemic range for 90.1% of the study duration.
High percentage of hypoglycemic events (1.1 episodes
per patient).

Russell et al. [30]

Haidar et al. [33]

Breton et al. [16]

the eight subjects in the 7+ study required rescue carbohydrates.
All oral rescue carbohydrates were given during the day. Three
IV carbohydrates were given during the 7+ phase of the study.
Two of these were given during the day (subject 301-B and
313), and one was given in the middle of the night (subject 313).
The reasons these rescue carbohydrates were required have to
do with misestimations of carbohydrate intake combined with
problems with the glucagon pump telemetry. For example, when
subject 313 had lunch, he estimated his carbohydrate intake to
be 100 g, but his actual carbohydrate intake was 57. This caused
a significant overdelivery of insulin which caused a subsequent
hypoglycemic event. Subsequently, there was a failure of the
glucagon pump to deliver, which then led to an IV carbohydrate
intervention. There were no oral or IV carbohydrates delivered
for the G4 study as shown in Table IV. Also provided in Table IV
is the low blood glucose index for each subject tested and the
total insulin and glucagon delivered for each subject.
Results for each subject are presented to show intersubject
variability in Table V.
Telemetry problems with the sensors were common. Due
largely to signal strength issues, the Dexcom SEVEN PLUS
sensors were offline on average 17.3% of the time. The pumps
were somewhat more reliable; overall, the insulin and glucagon
pumps delivered their prescribed doses 93% of the time. The
Viliv tablet computer was sometimes unreliable (several failure
modes). The G4 sensors were significantly more accurate than
the 7+ sensors as summarized in Table VI.
V. DISCUSSION AND CONCLUSION

within a range that virtually always is associated with avoidance
of long-term compli-cations in persons with type-1 diabetes
[43].
When the 60 min period after each glucagon dose was analyzed, the glucagon was successful in keeping sensed glucose
above 70 mg/dL in 86% of cases; above 60 mg/dL in 91% of
cases, and above 50 mg/dL in 100% of cases.
Rescue carbohydrate was given for blood glucose values of
less than 60 mg/dL. For the 7+ study, the mean number of rescue
carbohydrate doses was 0.9 per study (median, 0.5). Four out of

The closed loop control system presented here performed well
during the inpatient study, particularly after meals and during
the evening time.
A. Comparison With Other AP Control Systems
There have been many closed-loop clinical trials and an especially large number of them over the past several years. Results
from these trials generally demonstrate that closed-loop control
can lead to glucose levels ranging within the normal glycemic

JACOBS et al.: AUTOMATED CONTROL OF AN ADAPTIVE BIHORMONAL, DUAL-SENSOR ARTIFICIAL PANCREAS

range of 70–180 mg/dL approximately 70% of the time. For
example, the dual-hormone closed-loop system described in
Russell et al. [31] was able to achieve mean plasma glucose of
158 mg/dL with 68% of the glucose values within the range of
70–180 mg/dL. At nighttime, their control was at 123 mg/dL
with 93% within the euglycemic range. Another bihormonal
closed-loop system described in Haidar et al. [34] showed how
the use of glucagon could nearly eliminate hypoglycemia while
maintaining euglycemia for 70.7% of the time compared with
standard open-loop control (57.3%). However, the Haidar et al.
system is not automated and the bolus amounts of glucagon
and insulin were suggestions made by the algorithm with the
actual amounts given by a clinician rather than automatically.
The system described in Breton et al. [17] was not bihormonal
and only supplied insulin to the patient. The Breton et al. system maintained overall glucose levels on average at 120 mg/dL
and nighttime values at 110 mg/dL. The Breton et al. system
maintained glucose control within the normal glycemic range
of 70–180 mg/dL for an impressive 90.1% of the time. However, there were also reports of hypoglycemia (1.1 episodes per
patient) in the Breton et al. study. For a single-hormone system,
the only means for preventing hypoglycemia is to predict when a
hypoglycemic event is forthcoming, and then to turn OFF the insulin delivery. Our system takes advantage of a secondary pump
that can help to prevent hypoglycemia through the delivery of
glucagon when a hypoglycemic event is pending. During our inpatient study, the average VBG across subjects was 145.3 for the
7+ study and 150.7 for the G4 study. For our system, we were
able to maintain subjects’ glucose levels within the near-normal
glycemic range for 72.5% of the study duration as measured
by taking the percentage of VBG draws that measured below
70 mg/dL relative to the total VBG draws normalized with respect to time across both studies. Importantly, for the G4 study,
none of the subjects had a hypoglycemic event. We attribute this
prevention of hypoglycemia to the use of the bihormonal system
whereby glucagon leads to rapid glycogenolysis as the patient’s
glucose begins to drop and approach the target glucose. In contrast, in single-hormone systems such as the one described by
Breton et al., 32% of their subjects experienced a hypoglycemic
event. When we include both the 7+ and the G4 data, our subjects experienced hypoglycemia (sensed glucose <70 mg/dL)
for 1.5% of the time. Comparisons between our results and other
studies is summarized in Table VII. We acknowledge that the
G4 study included only five subjects, which is likely too few
subjects to conclude that control was significantly improved
between the G4 versus the 7+ study.

B. Summary, Technical Challenges, and Future Directions
To avoid complications caused by long-term exposure to hyperglycemia, the American Diabetes Association recommends
HbA1c levels to be below 7% [43], which translates to a glucose level of 154 mg/dL. While the automated system described
here achieved this goal, the results from this study also highlighted several technical issues that must be overcome to make
the artificial endocrine pancreas a reality.

2579

While the bihormonal system can help to prevent hypoglycemia, there are disadvantages to using glucagon. The primary disadvantage is that current formulations of glucagon are
not stable beyond 8 h. This is why patients in our study had to
change their glucagon pods every 8 h. In the future, we plan to
use new formulations of glucagon, currently under clinical trials
testing, which are stable for multiple days. An additional disadvantage is that excessive glucagon delivery to a patient may lead
to liver glycogen depletion. If liver glycogen depletion occurs,
the patient’s glucose will not increase and hypoglycemia could
result. Furthermore, excessive glucagon administration can lead
to side effects including hyperglycemia and nausea. Our control
algorithm limits glucagon delivery amounts as described in (10)
and Fig. 4. None of our subjects experienced side effects of
glucagon overexposure and a study using noninvasive imaging
to estimate hepatic glycogen is underway to address the question of potential glycogen depletion resulting from repeated SC
doses of glucagon. An additional limitation of our AP system
is that it requires the patient to provide an estimate of carbohydrate intake into the system during meals. If a patient enters
an incorrect amount, the algorithm will potentially deliver an
incorrect amount of hormone in response. Several groups have
proposed methods for accounting for inaccurate estimates of
carbohydrates by the patient [15], [46] and in the future, we will
consider improving our algorithm to handle inaccurate meal estimates. While some other groups’ AP algorithms do not require
a meal announcement, we feel that it is necessary for the patient
to estimate his carbohydrates so that insulin can be delivered
immediately to overcome the slow action of currently available
insulin preparations.
Wireless telemetry for communicating with the sensors and
the pumps was a problem during the study. Fortunately, our system utilized two sensors which enabled continued automation
when one sensor was missing. The purpose of having two sensors is primarily to help overcome the problems associated with
sensor inaccuracy, for example, when signal averaging was used
by Castle et al. [45]. Averaging cannot be carried out when a
sensor value does not arrive because of telemetry problems. In
future studies, we will continue to use the next generation Dexcom sensors (G4 PLATINUM) which we have already found
to have a more reliable wireless interface. The reliability and
accuracy of the G4 sensors has made it unlikely that we will
need to use two sensors in the future. Because of the difference
in performance between the 7+ and G4 studies (trend toward
less hypoglycemia with the latter), it is natural to assume that
the system is sensitive to sensor inaccuracies and/or missing
sensor data. Like all closed loop control systems, the system
performance is dependent on accurate sensor readings. We attempted to mitigate sensor inaccuracy by using two sensors. In
the future, we plan to use a single G4 sensor which is both more
reliable and more accurate than the earlier Dexcom models.
The wireless interface for the pumps performed poorly for the
Insulet iDex. Our setup required that both the Dexcom receivers
and the Insulet PDM be hard-wired to a USB port, making
disconnection during regular activities of daily living a common
problem. In the future, we will be migrating to a fully wireless
system that will have the mobile phone communicating directly

2580

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 10, OCTOBER 2014

with the sensors and the pumps without requiring the sensor
receiver or the pump PDM to enable communication.
We conclude that the bihormonal APC algorithm presented
here functioned well when the hardware was functional, especially in preventing hypoglycemia. We therefore expect the
system to perform well in an outpatient study once the hardware
interconnections are made to be more robust.
ACKNOWLEDGMENT
Data sets for each individual in the inpatient study are available upon request by contacting the first author. Dr. Jacobs, Dr.
Castle, and Dr. Ward have a financial interest in Pacific Diabetes
Technologies Inc., a company that may have a commercial interest in the results of this research and technology. This potential
conflict of interest has been reviewed and managed by OHSU.
REFERENCES
[1] A. M. Albisser, B. S. Leibel, and T. G. Ewart, “Clinical control of diabetes
by the artificial pancreas,” Diabetes, vol. 23, no. 5, pp. 397–404, 1974.
[2] A. M. Albisser, B. S. Leibel, T. G. Ewart, Z. Davidovac, C. K. Botz, and
W. Zingg, “An artificial endocrine pancreas,” Diabetes, vol. 23, no. 5,
pp. 389–396, 1974.
[3] H. Thabit and R. Hovorka, “Closed-loop insulin delivery in type 1 diabetes,” Endocrinol. Metab. Clin. North Amer., vol. 41, no. 1, pp. 105–117,
2012.
[4] J. Radziuk, “The artificial pancreas,” Diabetes, vol. 61, no. 9, pp. 2221–
2224, 2012.
[5] B. J. Gilligan, M. Shults, B. Rhodes, P. G. Jacobs, J. H. Brauker, T. J.
Pintar, and S. J. Updike, “Feasibility of continuous long term glucose
monitoring from a subcutaneous glucose sensor in humans,” Diabetes
Technol. Ther., vol. 6, no. 3, pp. 378–386, 2004.
[6] J. Mastrototaro, “The MiniMed continuous glucose monitoring system,”
Diabetes Technol. Ther., vol. 2, Suppl. 1, pp. S13–S18, 2000.
[7] B. W. Bode, “Clinical utility of the continuous glucose monitoring system,” Diabetes Technol. Ther., vol. 2, Suppl. 1, pp. S35–S41, 2000.
[8] E. F. Pfeiffer, C. Thum, and A. H. Clemens, “The artificial beta cell—A
continuous control of blood sugar by external regulation of insulin infusion
(glucose controlled insulin infusion system),” Horm. Metab. Res., vol. 6,
no. 5, pp. 339–342, 1974.
[9] A. H. Clemens, P. H. Chang, and R. W. Myers, “The development of
Biostator, a glucose controlled insulin infusion system (GCIIS),” Horm.
Metab. Res., vol. 7, pp. 23–33, 1977.
[10] G. M. Steil, K. Rebrin, R. Janowski, C. Darwin, and M. F. Saad, “Modeling beta-cell insulin secretion–Implications for closed-loop glucose homeostasis,” Diabetes Technol. Ther., vol. 5, no. 6, pp. 953–964, 2003.
[11] E. M. Watson, M. J. Chappell, F. Ducrozet, S. M. Poucher, and J. W. T.
Yates, “A new general glucose homeostatic model using a proportionalintegral-derivative controller,” Comput. Methods Prog. Biomed., vol. 102,
pp. 119–129, 2011.
[12] S. A. Weinzimer, G. M. Steil, K. L. Swan, J. Dziura, N. Kurtz, and
W. V. Tamborlane, “Fully automated closed-loop insulin delivery versus
semiautomated hybrid control in pediatric patients with type 1 diabetes
using an artificial pancreas,” Diabetes Care, vol. 31, no. 5, pp. 934–939,
2008.
[13] D. Pinky, F. J. Doyle, and E. N. Pistikopoulos, “Model-based blood glucose
control for type 1 diabetes via parametric programming,” IEEE Trans.
Biomed. Eng., vol. 53, no. 8, pp. 1478–1491, Aug. 2006.
[14] A. Abu-Rmileh and W. Garcia-Gabin, “A gain-scheduling model predictive controller for blood glucose control in type 1 diabetes,” IEEE Trans.
Biomed. Eng., vol. 57, no. 10, pp. 2478–2484, Oct. 2010.
[15] K. Zarkogianni, A. Vazeou, S. G. Mougiakakou, A. Prountzou, and K. S.
Nikita, “An insulin infusion advisory system based on autotuning nonlinear model-predictive control,” IEEE Trans. Biomed. Eng., vol. 58, no. 9,
pp. 2467–2477, Sep. 2011.
[16] A. Magni, D. M. Raimondo, L. Bossi, C. D. Man, G. D. Nicolao,
B. Kovatchev, and C. Cobelli, “Model predictive control of type 1 diabetes: An in silico trial,” J. Diabetes Sci. Technol., vol. 1, no. 6, pp.
804–812, 2007.

[17] M. Breton, A. Farret, D. Bruttomesso, S. Anderson, L. Magni, S. Patek,
C. M. Dalla, J. Place, S. Demartini, S. D. Favero, C. Toffanin, C.-K.
Hughes, E. Dassau, H. Zisser, F. J. Doyle, G. D. Nicolao, A. Avogaro,
C. Cobelli, E. Renard, and B. Kovatchev, “Fully integrated artificial pancreas in Type 1 diabetes, modular closed-loop glucose control maintains
near normoglycemia,” Diabetes, vol. 71, pp. 2230–2237, Sep. 2012.
[18] D. Bruttomesso, A. Farret, S. Costa, M. C. Marascotti, M. Vettore,
A. Avogaro, A. Tiengo, C. Dalla Man, J. Place, A. Facchinetti, S. Guerra,
L. Magni, G. De Nicolao, C. Cobelli, E. Renard, and A. Maran, “Closedloop artificial pancreas using subcutaneous glucose sensing and insulin
delivery and a model predictive control algorithm: Preliminary studies
in Padova and Montpellier,” J. Diabetes Sci. Technol., vol. 3, no. 5, pp.
1014–1021, 2009.
[19] B. Kovatchev, C. Cobelli, E. Renard, S. Anderson, M. Breton, S. Patek,
W. Clarke, D. Bruttomesso, A. Maran, S. Costa, A. Avogaro, C. Dalla
Man, A. Facchinetti, L. Magni, G. De Nicolao, J. Place, and A. Farret,
“Multinational study of subcutaneous model-predictive closed-loop control in type 1 diabetes mellitus: summary of results,” J. Diabetes Sci.
Technol., vol. 4, no. 6, pp. 1374–1381, 2010.
[20] R. Nimri, I. Muller, E. Atlas, S. Miller, O. Kordonouri, N. Bratina,
C. Tsioli, M. A. Stefanija, T. Danne, T. Battelino, and M. Phillip, “Night
glucose control with MD-Logic artificial pancreas in home setting: A single blind, randomized crossover trial-interim analysis,” Pediatr. Diabetes,
vol. 15, pp. 91–99, 2014.
[21] E. Atlas, R. Nimri, S. Miller, E. A. Grunberg, and M. Phillip, “MD-Logic
artificial pancreas system: A pilot study in adults with type 1 diabetes,”
Diabetes Care, vol. 33, no. 5, pp. 1072–1076, 2010.
[22] C. J. Fernandez, S. Gonzalez-Perez, and J. C. Ramos-Diaz, “Artificial
neural networks for closed loop control of in silico and ad hoc type 1
diabetes,” Comput. Methods. Programs Biomed., vol. 106, no. 1, pp. 55–
66, 2011.
[23] P. H. Herrero, P. Georgiou, N. Oliver, D. G. Johnston, and C. Toumazou,
“A bio-inspired glucose controller based on pancreatic B-cell physiology,”
J. Diabetes Sci. Technol., vol. 6, no. 3, pp. 606–616, 2012.
[24] A. K. El-Jabali, “Neural network modeling and control of type 1 diabetes
mellitus,” Bioprocess Biosyst. Eng., vol. 27, pp. 75–79, 2005.
[25] P. Grant, “A new approach to diabetic control: Fuzzy logic and insulin
pump technology,” Med. Eng. Phys, vol. 29, pp. 824–827, 2007.
[26] M. Ibbini and M. Masadeh, “A fuzzy logic based closed-loop control
system for blood glucose level regulation in diabetics,” J. Med. Eng.
Technol., vol. 29, pp. 64–69, 2005.
[27] Diabetes Control And Complications Research Group, “The effect of
intensive treatment of diabetes on the development and progression of
long-term complications in insulin-dependent diabetes mellitus,” N. Engl.
J. Med., vol. 329, no. 14, pp. 977–986, 1993.
[28] R. M. Bergenstal, D. C. Klonoff, S. K. Garg, B. W. Bode, M. Meredith,
R. H. Slover, A. J. Ahmann, J. B. Welsh, S. W. Lee, and F. R. Kaugman, “Threshold-based insulin pump interruption for reduction of hypoglycemia,” N. Engl. J. Med., vol. 369, no. 3, pp. 224–232, 2013.
[29] G. Holmes, L. Galitz, P. Hu, and W. Lyness, “Pharmacokinetics of insulin
aspart in obesity, renal impairment, or hepatic impairment,” Br. J. Clin.
Pharmacol., vol. 60, no. 5, pp. 469–476, 2005.
[30] J. R. Castle, J. M. Engle, J. El Youssef, R. G. Massoud, K. C. Yuen,
R. Kagan, and W. K. Ward, “ Novel use of glucagon in a closed loop
system for prevention of hypoglycemia in type 1 diabetes,” Diabetes Care,
vol. 33, no. 6, pp. 1282–1287, Mar. 2010.
[31] S. J. Russell, F. H. El-Khatib, D. M. Nathan, K. L. Magyar, J. Jiang, and
E. R. Damiano, “Blood glucose control in type 1 diabetes with a bihormonal bionic endocrine pancreas,” Diabetes Care, vol. 35, pp. 2148–2155,
Nov. 2012.
[32] F. H. El-Khatib, S. J. Russell, D. M. Nathan, R. G. Sutherlin, and
E. R. Damiano, “A bihormonal closed-loop artificial pancreas for type
1 diabetes,” Sci. Transl. Med., vol. 2, no. 27, pp. 182–192, Apr. 2010.
[33] F. H. El-Khatib, J. Jiang, and E. R. Damiano, “Adaptive closed-loop
control provides blood-glucose regulation using dual subcutaneous insulin
and glucagon infusion in diabetic swine,” J. Diabetes Sci. Technol, vol. 1,
no. 2, pp. 181–192, Mar. 2007.
[34] A. Haidar, L. Legault, M. Dallaire, A. Alkhateeb, A. Coriati, V. Messier,
P. Cheng, M. Millette, B. Boulet, and R. Rabasa-Lhoret, “Glucoseresponsive insulin and glucagon delivery (dual-hormone artificial pancreas) in adults with type 1 diabetes: A randomized crossover controlled
trial,” Can. Med. Assoc. J., vol. 185, no. 4, pp. 297–305, 2013.
[35] J. El Youssef, J. R. Castle, D. L. Branigan, R. G. Massoud, M. E. Breen,
P. G. Jacobs, B. W. Bequette, and W. K. Ward, “A controlled study
of the effectiveness of an adaptive closed-loop algorithm to minimize

JACOBS et al.: AUTOMATED CONTROL OF AN ADAPTIVE BIHORMONAL, DUAL-SENSOR ARTIFICIAL PANCREAS

[36]

[37]

[38]
[39]
[40]

[41]

corticosteroid-induced stress hyperglycemia in type 1 diabetes,” J. Diabetes Sci. Technol., vol. 5, no. 6, pp. 1312–1326, Nov. 2011.
B. Gopakumaran, H. M. Duman, D. P. Overholser, I. F. Federiuk, M. J.
Quinn, M. D. Wood, and W. K. Ward, “A novel insulin delivery algorithm
in rats with type 1 diabetes: The fading memory proportional-derivative
method,” Artif. Organs, vol. 29, no. 8, pp. 599–607, Aug. 2005.
P. G. Jacobs, J. El Youssef, J. R. Castle, J. M. Engle, D. L. Branigan,
P. Johnson, R. Massoud, A. Kamath, and W. K. Ward, “Development of
a fully automated closed loop artificial pancreas control system with dual
pump delivery of insulin and glucagon,” in Proc. IEEE Conf. Eng. Med.
Biol. Soc., 2011, pp. 397–400.
F. Cameron, G. Niemeyer, and B. A. Buckingham, “Probabilistic evolving meal detection and estimation of meal total glucose appearance,”
J. Diabetes Sci. Technol., vol. 3, no. 5, pp. 1022–1030, 2009.
E. Dassau, B. W. Bequette, B. A. Buckingham, and F. J. Doyle III, “Detection of a meal using continuous glucose monitoring: implications for
an artificial beta-cell,” Diabetes Care, vol. 31, no. 2, pp. 295–300, 2008.
R. Hovorka, V. Canonico, L. J. Chassin, U. Haueter, M. Massi-Benedetti,
M. OrsiniFederici, T. R. Pieber, H. C. Schaller, L. Schaupp, T. Vering,
and M. E. Wilinksa, “Nonlinear model predictive control of glucose
concentration in subjects with type 1 diabetes,” Physiol. Meas., vol. 25,
no. 4, pp. 905–20, Aug. 2004.
S. D. Patek, W. Bequette, M. Breton, B. A. Buckingham, E. Dassau,
F. J. Doyle III, J. Lum, L. Magni, and H. Zisser, “In silico preclinical

[42]
[43]
[44]

[45]
[46]

2581

trials: Methodology and engineering guide to closed-loop control in type
1 diabetes meillitus,” J. Diabetes Sci. Technol., vol. 3, no. 2, pp. 269–281,
2009.
B. P. Kovatchev, M. B. Breton, C. D. Man, and C. Cobelli, “In silico
preclinical trials: A proof of concept in closed-loop control of type 1
diabetes,” J. Diabetes Sci. Technol., vol. 3, no. 1, pp. 44–55, 2009.
American Diabetes Association, “Executive summary: Standards of medical care in diabetes—2013,” Diabetes Care, vol. 36, suppl. 1, pp. S4–S10,
2013.
L. Magni, D. M. Raimondo, C. D. Man, M. Breton, S. Patek, G. D. Nicolao,
and C. Cobelli, “Evaluating the efficacy of closed-loop glucose regulation
via control-variability analysis,” J. Diabetes Sci. Technol., vol. 2, no. 4,
pp. 630–635, 2008.
J. R. Castle and W. K. Ward, “Amperometric glucose sensors: Sources
of error and potential benefit of redundancy,” J. Diabetes Sci. Technol.,
vol. 4, no. 1, pp. 221–225, Jan. 2010.
H. Lee and B. W. Bequette, “A closed-loop artificial pancreas based on
MPC: Human-friendly identification and automatic meal disturbance rejection,” in Proc. 17th IFAC World Congr., 2008, pp. 4252–4257.

Authors’ photographs and biographies not available at the time of publication.

