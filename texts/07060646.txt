2070

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

A Stochastic Algorithm for Generating Realistic
Virtual Interstitial Cell of Cajal Networks
Jerry Gao, Shameer Sathar, Gregory O’Grady, Rosalind Archer, and Leo K. Cheng∗

Abstract—Interstitial cells of Cajal (ICC) play a central role
in coordinating normal gastrointestinal (GI) motility. Depletion of
ICC numbers and network integrity contributes to major functional GI motility disorders. However, the mechanisms relating
ICC structure to GI function and dysfunction remains unclear,
partly because there is a lack of large-scale ICC network imaging data across a spectrum of depletion levels to guide models.
Experimental imaging of these large-scale networks remains challenging because of technical constraints, and hence, we propose
the generation of realistic virtual ICC networks in silico using
the single normal equation simulation (SNESIM) algorithm. ICC
network imaging data obtained from wild-type (normal) and 5HT2 B serotonin receptor knockout (depleted ICC) mice were used
to inform the algorithm, and the virtual networks generated were
assessed using ICC network structural metrics and biophysicallybased computational modeling. When the virtual networks were
compared to the original networks, there was less than 10% error for four out of five structural metrics and all four functional
measures. The SNESIM algorithm was then modified to enable the
generation of ICC networks across a spectrum of depletion levels, and as a proof-of-concept, virtual networks were successfully
generated with a range of structural and functional properties.
The SNESIM and modified SNESIM algorithms, therefore, offer
an alternative strategy for obtaining the large-scale ICC network
imaging data across a spectrum of depletion levels. These models
can be applied to accurately inform the physiological consequences
of ICC depletion.
Index Terms—Computational modeling, confocal microscopy,
gastrointestinal (GI), gastroparesis, SNESIM.

I. INTRODUCTION
ASTROINTESTINAL (GI) motility encompasses the
muscular contractions in the GI tract required for digestion and transportation of contents. Throughout much of
the tract, this process is facilitated by specialized cells called

G

Manuscript received July 28, 2014; revised October 29, 2014, December
20, 2014, and January 6, 2015; accepted January 6, 2015. Date of publication
March 13, 2015; date of current version July 15, 2015. This work was supported in part by the Riddet Institute, New Zealand Health Research Council,
and the National Institutes of Health under Grant R01 DK64775. The work
of J. Gao was supported by the University of Auckland Health Research Doctoral Scholarship, the Freemasons Postgraduate Scholarship, and the R. H. T.
Bates Postgraduate Scholarship. The work of L. K. Cheng was supported by the
Fraunhofer-Bessel Research Award from the Alexander von Humboldt Foundation and the Fraunhofer-Gesellschaft. Asterisk indicates corresponding author.
J. Gao, S. Sathar, and G. O’Grady are with the Auckland Bioengineering
Institute, University of Auckland.
R. Archer is with the Department of Engineering Science, University of
Auckland.
∗ L. K. Cheng is with the Auckland Bioengineering Institute, University of
Auckland, Auckland 1020, New Zealand, and also with the Department of
Surgery, Vanderbilt University, Nashville, TN 37240 USA (e-mail: l.cheng@
auckland.ac.nz).
Digital Object Identifier 10.1109/TBME.2015.2412533

interstitial cells of Cajal (ICC) [1]. One of the most prominent
roles of ICC is the pacemaking of GI motor patterns, achieved
by actively initiating and propagating electrical oscillations that
excite and cause contractions in the GI musculature [2], [3]. ICC
loss and injury is now a major research focus as it is recognized
as a hallmark of several GI functional motility disorders [4],
notably gastroparesis [5], [6], intestinal pseudoobstruction [7],
[8], and slow-transit constipation [9], [10].
Although the importance of ICC in GI health and functional
disorders is now well established, the mechanism relating ICC
structure to GI function and dysfunction remain poorly defined.
A major constraint in resolving this problem is the limitations
of current ICC imaging data. The imaging of ex vivo ICC networks is technically challenging, and the obtained data are still
generally limited to small fields-of-view in the order of a few
hundred micrometers to millimeters [11]. Also, most studies
on ICC loss compare normal networks against depleted networks at some set depletion severity, such as that induced by a
gene knockout (KO) [3], [12] or disease [6], [7], and there is
no systematic method to experimentally control the depletion
severity so that networks at an intermediate depletion level can
be imaged and investigated. A comprehensive imaging dataset
encompassing large-scale ICC networks across a spectrum of
depletion levels would be of substantial benefit in investigating
the pathophysiology of ICC loss.
In a preliminary report, a computational strategy for obtaining a comprehensive ICC imaging dataset was proposed for
generating realistic virtual ICC networks in silico using the
stochastic single normal equation simulation (SNESIM) algorithm [13]. The SNESIM algorithm was originally developed
in the petroleum industry for building realistic statistical models of the geological formations, which host oil reservoirs [14],
[15]. This study now aims to advance, validate, and demonstrate proof-of-principle of the SNESIM algorithm for generating realistic virtual ICC networks. The structural and functional similarity between experimentally imaged and virtually
generated networks was assessed using ICC network structural
metrics and biophysically-based computational modeling. Following validation, the SNESIM algorithm was also adapted to
enable the generation of ICC networks across a spectrum of
depletion levels.
II. MATERIALS AND METHODS
A. SNESIM Algorithm
In summary, the SNESIM algorithm generates images of any
size with similar structural properties to a user-supplied training image that contains the desired image characteristics. Full

0018-9294 © 2015 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

GAO et al.: STOCHASTIC ALGORITHM FOR GENERATING REALISTIC VIRTUAL INTERSTITIAL CELL OF CAJAL NETWORKS

2071

TABLE I
TERMINOLOGY ASSOCIATED WITH PDFS

Fig. 1.

Flowchart of the specific steps taken by the SNESIM algorithm.

details on the algorithm and its user-supplied input parameters
can be found in previous reports [14]–[16].
In general, the SNESIM algorithm replicates the underlying
multiple-point statistics of the training image, which express
the conditional probabilities of the values that can be taken by
a pixel of interest based on the values of multiple neighboring
pixels. The relative locations of these neighboring pixels to the
pixel of interest are defined in the user-supplied data template,
and the set of neighboring pixels is termed the “data search
neighborhood” (DSN).
To capture large-scale structural properties, the DSN needs
to contain far-away neighboring pixels, whereas for small-scale
structural properties close-by neighboring pixels are required.
However, as a larger number of neighboring pixels within the
DSN incurs greater computational costs, employing a DSN encompassing both small- and large-scale structural properties is
often infeasible. The multigrid approach overcomes this difficulty by sequentially generating the image over coarse to fine
grids, while scaling the DSN accordingly. Specifically, the algorithm begins with the coarsest grid, where adjacent pixels
are further apart, and hence, the DSN efficiently covers a larger
area. The grid is then recursively refined by including all pixels halfway between any two currently adjacent pixels, thereby
shrinking the DSN by a factor of 2 with each refinement, until the
finest grid is reached. With this approach, only close-by neighboring pixels are required in the DSN, as the scaling applied

Terminology

Description

Local
Global
Conditional
Marginal

Associated with only the pixels which have already been simulated.
Associated with all pixels in the image. Opposite of Local.
Dependent upon the values of other pixels.
Relates to only which category (ICC or non-ICC) a pixel should belong
independent of the values of other pixels. Opposite of Conditional.

with the coarser grids allow large-scale structural properties to
be captured. The coarseness of the initial grid is determined
by the user-supplied number of multigrids. Each time the grid
is refined, the multigrid level decreases by one, and a multigrid
level of one corresponds to the finest grid. The DSN and number
of multigrids are, therefore, important input parameters to accurately replicate structural properties across a range of spatial
scales.
The specific steps taken by the SNESIM algorithm are summarized below (see Fig. 1), and the terminology used associated
with probability density functions (PDFs) is described in Table I.
See [17, Fig. 4.3] for an illustrative figure depicting the critical
steps of the algorithm.
1) Starting from the highest multigrid level, each pixel in
the training image is scanned using the data template to
generate the search tree, which records the multiple-point
statistics of the training image for the current multigrid
level.
2) A path that visits all pixels in the current multigrid once
only is defined. Pixels with more inferable neighboring
pixels are visited first, and the ordering of pixels with
the same number of inferable neighboring pixels is determined randomly.
3) Each undetermined pixel along the random path is scanned
by the data template, and the values of the neighboring
pixels within the DSN are used to retrieve the conditional PDF for the current pixel of interest from the search
tree generated in step one. If the values presented by the
neighboring pixels do not exist in the search tree (i.e., the
pattern presented by the pixels in the DSN do not appear
in the training image), the pixel in the DSN with furthest
distance from the pixel of interest is dropped, and the conditional PDF for the current pixel of interest is reretrieved.
It is known that the DSN have the same furthest distance
from the pixel of interest, in the training image to one
pixel is selected arbitrarily and dropped. If all neighboring pixels within the DSN are dropped, the value of the
pixel of interest is generated from the user-defined global
marginal PDF.
4) The PDF computed in step 3 is adjusted to account for
the local marginal PDF, and a value for the current pixel
of interest is simulated from this adjusted PDF. This pixel
is added into the image to inform subsequently simulated
pixels.
5) Steps 3 and 4 are repeated until all pixels in the random
path are simulated.

2072

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

6) The multigrid level is decreased by 1 and steps 1–5 are
repeated. All previously simulated pixels in the higher
multigrid levels are retained to inform the subsequently
simulated pixels. The algorithm is terminated when multigrid level one is completed.
In the context of generating virtual ICC networks, the
SNESIM algorithm can only generate virtual networks at the
depletion level of the training network as it is simply replicating
the multiple-point statistics. Therefore, the SNESIM algorithm
was modified to enable the generation of ICC networks across a
spectrum of depletion levels. The specific modifications are as
follows:
1) Two training networks are used instead of one. These two
training networks represent two points on the spectrum
of depletion levels and, hence, by merging the structural
properties of these two training networks, ICC networks
across a spectrum of depletion levels can be generated.
A search tree is constructed from each of the training
networks.
2) A merge factor (ϕ) is computed as:
ϕ=

ρ − ρ1
ρ2 − ρ1

(1)

where ρ is the user-supplied global marginal PDF, and ρ1
and ρ2 are the global marginal PDFs of training networks
one and two, respectively. The user defines the desired
depletion level of the network to be generated through
ρ, with a lower ICC probability corresponding to a more
severe depletion level. ϕ determines the severity of the
depletion level relative to those of the training networks,
with ϕ = 0 indicating the same depletion level as training network one, and ϕ = 1 indicating the same depletion
level as training network two. However, note that ϕ may
lie outside the range [0–1], when ρ lies outside the range
[ρ1 –ρ2 ] (i.e., when the desired depletion level of the virtual network is outside the spectrum presented by the two
training networks).
3) When simulating a pixel, a PDF is retrieved from each of
the two search trees separately. The PDFs retrieved from
the search trees corresponding to training networks one
and two are weighted by (1 − ϕ) and ϕ, respectively,
and the sum of these weighted PDFs is used to simulate
the pixel. Any negative probabilities are limited to 0, and
probabilities over 1 are limited to 1.
Note that the PDF adjustment to account for the local marginal
PDF in the SNESIM algorithm (step 4) involves the global
marginal PDF of the training network, and as the modified
SNESIM algorithm utilizes two training networks, this PDF
adjustment was not implemented.
B. ICC Network Imaging Data
Confocal ICC network imaging data were used as training networks to inform the SNESIM and modified SNESIM algorithms
[12]. Briefly, two-dimensional bitmap images of the Kit-positive
ICC structures at the plane of the myenteric plexus (ICC-MP)
were obtained from the jejunum of four-week-old wild-type
(WT; normal) and 5-HT2B serotonin receptor knockout (KO;

depleted ICC) mice. Normally, serotonin acts on 5-HT2B receptors to increase ICC proliferation and numbers [18], and a lack
of 5-HT2B receptors has been demonstrated to decrease ICC
proliferation, numbers, and network volume [12]. The orientation of the networks relative to the circumferential direction was
extracted from the Kit-positive ICC structures at the plane of the
deep muscular plexus [19], and the ICC-MP structures were reoriented such that the circumferential direction was horizontal.
These networks were also preprocessed to remove artifacts as
previously described [19]. Briefly, small gaps with radius of
1 pixel (ࣈ0.6 μm) or less in the network were joined, and small
objects of less than 4 pixels (ࣈ1.54 μm2 ) were removed. One
ICC-MP network was obtained from each of six mice (three
WT, three KO) as described previously [12]. Each network was
362 × 362 pixels, and corresponded to physical dimensions of
0.225 × 0.225 mm.
Three virtual ICC networks were generated for each WT
and KO training network using the SNESIM algorithm (i.e.,
9 WT and 9 KO virtual networks). The global marginal PDF
ICC probabilities of the WT and KO training networks were
calculated to be approximately 0.55 (0.51–0.59) and 0.40 (0.40–
0.41), respectively, and the virtual networks were generated with
global marginal PDF ICC probabilities matching their training
counterparts.
To generate virtual ICC networks across a spectrum of depletion levels, the WT and KO training networks were arbitrarily
paired and used to inform the modified SNESIM algorithm.
For each of the three training network pairs, three virtual ICC
networks were generated with global marginal PDF ICC probabilities of 0.30, 0.35, 0.40, 0.45, 0.50, and 0.55 (i.e., nine virtual
networks for each global marginal PDF; a total of 54 virtual
networks). The highest ICC probability (0.55) was selected to
match the WT training networks, but ICC probabilities lower
than that of the KO training networks (0.30–0.35) were selected.
This was because although the KO mice showed depleted ICC
networks, their intestinal transit times were not affected [12],
and hence, we attempted to generate virtual networks at depletion levels of yet more marked severity. All virtual networks
were generated using a multigrid level of five and a circular DSN
with radius of four pixels and one pixel spacing. All generated
virtual networks were the same size and at the same resolution
as the training networks.
C. Structural Validation
Five numerical metrics were used to quantify the structural
properties of the training and virtual ICC networks (see [19] for
details on the computation of these metrics):
1) Density: measures the ICC network volume, representative of the amount of bioelectrical current generated and
propagated;
2) Thickness: measures the width of cellular structures within
the ICC network plane, which may impact electrical activity propagation through the network;
3) Hole size: measures the radius of non-ICC regions within
the ICC network plane. Reflects the distribution of ICC
throughout the MP (i.e., the “tightness” of the network),
and may relate to the uniformity of smooth muscle cell
activation;

GAO et al.: STOCHASTIC ALGORITHM FOR GENERATING REALISTIC VIRTUAL INTERSTITIAL CELL OF CAJAL NETWORKS

2073

Fig. 2. Three WT and three KO training networks, and corresponding virtual networks generated from each training network using the SNESIM algorithm. The
white regions represent the ICC network. Each network is 362 × 362 pixels, and corresponds to physical dimensions of 0.225 × 0.225 mm. Scale bar (bottom
right) = 0.1 mm.

4) Anisotropy: indicates the degree of preferential alignment
of ICC structures, and may reflect the dominant slow-wave
propagation direction, potentially affecting predilection
and resilience to dysrhythmia [20];
5) Connectivity: measures the connectivity of the ICC network. Reflects the structural integrity of the ICC network,
indicating the cohesion of entrainment pathways [21].
Prior to the application of structural metrics, the virtual networks were preprocessed to remove artifacts in the same manner as conducted on the training networks (see Section II-B.).
Structural validation of the SNESIM algorithm was performed
by comparing the structural metric values of the training and
virtual WT and KO networks. For the nonnormalized metrics
of thickness, hole size, and connectivity (i.e., these metric have
an infinite range), the relative errors of the metric values were
computed, whereas for the normalized metrics of density and
anisotropy, the errors were computed relative to the range of the
metric [19]. Due to the logarithmic nature of the connectivity
metric, the logarithm (base 10) of the metric value was used in
the error computation.
D. Functional Validation
ICC pacemaker activity was simulated over the training and
virtual ICC networks using a biophysically-based computational
model [22]. The ICC networks were discretized into a finiteelement triangular mesh, with each node point corresponding to
a pixel in the ICC network imaging data. The cellular activity
of the ICC node points was represented using a biophysicallybased ICC model, based on the Corrias and Buist model, which
was modified to incorporate a finite-state machine approach
[23], [24]. The activity of the non-ICC grid points was represented using a passive cell model with a zero active ionic current. The continuum-based bidomain equations were employed
to model the tissue level activity, and the model was solved
using the CHASTE computational framework [24], [25].
ICC pacemaker activity was simulated over each of the training and virtual networks for 1000 ms with an ODE time step
of 0.1 ms and a PDE time step of 1 ms. These ODE and PDE
time steps were selected based on the convergence analysis to
obtain a stable solution to the model. The PDE component of the
model represents the diffusion of the ICC network pacemaker

activity, which is slow in comparison to the cellular activity
represented by the ODE component. Therefore, the PDE time
step does not need to be as refined as the ODE time step. ICC
node points within a square corresponding to 1% of the total
network area at the top-right corner of the grid were set to activate at time t = 0 ms as the initial stimulus to the simulations,
whereas the remaining ICC grid points were activated via the
voltage-dependent entrainment mechanism of the ICC model
[24]. The conductivity parameters of the model were selected
such that the pacemaker activity propagated through the WT
training networks at approximately 5 mm/s, as experimentally
recorded in the healthy rat jejunum [26]. The model parameters
used are the same as in [23] and [24]. Key parameters of the
ICC model are reproduced in Table II of the appendix.
Four measures were then used to quantitatively assess the
simulated ICC pacemaker activity [22]:
1) Activation rate: measures the rate at which the network
achieves an average Vm of −30 mV;
2) Peak [Ca2+ ]i ;
3) Time to peak [Ca2+ ]i ;
4) Half peak [Ca2+ ]i time ratio: gauges the dynamics of the
[Ca2+ ]i upstroke.
Functional validation of the SNESIM algorithm was performed by comparing the functional measure values of the training and virtual WT and KO networks. For the nonnormalized
measures of activation rate, peak [Ca2+ ]i , and time to peak
[Ca2+ ]i , the relative errors of the measure values were computed, whereas for the normalized measure half peak [Ca2+ ]i
time ratio, the errors were computed relative to the range of the
measure [22].
III. RESULTS
The three WT and three KO training networks along with an
example virtual network generated from each training network
are shown in Fig. 2.
The errors in the structural metric values of the virtual networks compared to their training counterparts are shown in
Fig. 3. The virtual networks accurately replicated the density
metric (average absolute errors: WT 1%; KO 2%), and in the
majority of networks the thickness metric as well (WT 5%; KO
2%). Replication of the anisotropy (WT 4%; KO 5%) and connectivity metrics (WT 8%; KO 6%) in the majority of networks

2074

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

Fig. 3. Percentage errors in the structural metric values of the WT and KO
virtual networks compared to their training counterparts.

Fig. 4. Percentage errors in the functional measure values of the WT and KO
virtual networks compared to their training counterparts.

was reasonable. The hole-size metric was relatively underestimated in the virtual networks (WT 16%; KO 17%).
The errors in the functional measure values of the virtual
networks compared to their training counterparts are shown
in Fig. 4. The virtual networks accurately replicated the peak
[Ca2+ ]i (WT 2%; KO 2%) and half peak [Ca2+ ]i time ratio
measures (WT 2%; KO 3%). The activation rate (WT 8%; KO
14%) and time to peak [Ca2+ ]i measures (WT 5%; KO 8%)
were also reasonably replicated for the majority of networks.
Example virtual networks generated across a spectrum of depletion levels using the modified SNESIM algorithm are shown
in Fig. 5. The structural metrics and functional measures varied
with respect to the global marginal PDF (see Figs. 6 and 7),
demonstrating that by altering the global marginal PDF, virtual
networks with a range of structural and functional properties
could be generated from two training networks of different depletion levels. In general, the structural metrics and functional
measures of the virtual networks displayed a monotonically increasing or decreasing trend with respect to the global marginal
PDF ICC probability the virtual networks were generated with.
However, the trends differed between the interpolated virtual
networks [i.e., generated with global marginal PDF ICC probabilities of 0.40 (KO) to 0.55 (WT)] and the extrapolated ones
[i.e., generated with global marginal PDF ICC probabilities of
0.30 or 0.35, below 0.40 (KO)]. This is further discussed below.
Less than 1 min was needed to generate a virtual network
using the SNESIM algorithm on a quad-core Intel Xeon W3530
CPU, whereas it took less than 2 min to generate a virtual
network using the modified SNESIM algorithm on the same
machine.
IV. DISCUSSION
ICC depletion is thought to play a key role in GI dysmotility;
however, a major constraint restricting the investigation of ICC

network structure–function relationships is the paucity of imaging data. In particular, there is a lack of ICC network imaging
data covering large fields-of-view and at a range of depletion levels spanning health and disease states. This study addresses these
challenges by generating realistic virtual ICC networks in silico
using the stochastic SNESIM algorithm. The fidelity of the virtual networks was validated both structurally and functionally,
by applying ICC network structural metrics and biophysicallybased computational modeling, respectively. Modifications to
SNESIM were also proposed to facilitate the generation of ICC
networks across a spectrum of depletion levels, and as proofof-concept, virtual networks were successfully generated with
a range of structural and functional properties.
In general, the virtual networks generated by the SNESIM algorithm possessed reasonably similar structural and functional
properties to their training counterparts. For the virtual WT networks, four out of five structural metrics and four out of four
functional measures had average absolute errors under 10%,
whereas for the virtual KO networks, four out of five structural
metrics and three out of four functional measures had average absolute errors under 10%. The structural metric associated
with the greatest errors was the hole-size metric, which focused
on examining the non-ICC regions within the ICC network.
For a non-ICC region to remain intact, it must be void of ICC
pixels (otherwise, the region essentially divides into multiple
smaller regions). The multigrid approach of SNESIM only simulates sparse pixels initially, leaving the intermediate pixels to
be simulated subsequently, but when these intermediate pixels are being simulated, the multigrid level has decreased, and
hence, the scale of the DSN has also decreased. The algorithm,
therefore, has a more restricted recognition of large-scale structures and, hence, probabilistically, ICC pixels may be simulated,
consequently reducing the hole-size metric. We tested whether
increasing the DSN would improve the fidelity of the generated
virtual networks. It is known that DSN should be larger than
the size of the largest scale structures in the training to accurately generate images with high similarity, so the DSN size
was increased to 13 pixels or inclusion of pixels up to 50 pixels
away while maintaining a multigrid level of five (at the coarsest
level the 13 pixel DSN would span 416 pixels). This resulted in
virtual networks with comparable average absolute errors in the
structural metrics (of the metrics which improved errors were
reduced by less than 5%; data not shown). However, the computational cost of using these increased DSNs was up to 11 times
more expensive than when using the original DSN with a radius
of four pixels, and hence, the original DSN was retained.
The errors in the time-related functional measures (activation
rate, time to peak [Ca2+ ]i , and half peak [Ca2+ ]i time ratio) were
slightly higher for the virtual KO networks in comparison to the
virtual WT networks. This was because training network KO1
was particularly sparse in the top-right corner where the initial
stimulus for the ICC network pacemaker activity simulation
was applied. Therefore, the onset of the simulated activity was
delayed considerably, and the functional measures for the virtual
networks generated from training network KO1 consistently
showed faster activation rates, shorter times to peak [Ca2+ ]i
and smaller half peak [Ca2+ ]i time ratios. The nontime-related

GAO et al.: STOCHASTIC ALGORITHM FOR GENERATING REALISTIC VIRTUAL INTERSTITIAL CELL OF CAJAL NETWORKS

2075

Fig. 5. Example virtual networks generated across a spectrum of depletion levels using the modified SNESIM algorithm. The white regions represent the ICC
network. The headings along the left denote the training networks used to generate the virtual networks (i.e., WT1 × KO1 denotes that the WT1 and KO1 training
networks were used to generate the virtual networks in that row), whereas the headings along the top indicate the global marginal PDF ICC probabilities used to
generate the virtual networks in that column. Each network is 362 × 362 pixels, and corresponds to physical dimensions of 0.225 × 0.225 mm. The WT and KO
training networks correspond approximately to global marginal PDF ICC probabilities of 0.55 and 0.40, respectively, and hence, virtual networks generated at
global marginal PDF ICC probabilities within this range were interpolated, whereas those generated outside this range were extrapolated. Scale bar = 0.1 mm.

Fig. 6. Structural metric values of the virtual networks generated using the
modified SNESIM algorithm against the global marginal PDF ICC probabilities
they were generated at. Crosses represent the average metric value of the nine
virtual networks generated at each of the global marginal PDF ICC probabilities.

measure of peak [Ca2+ ]i , however, was not affected. Therefore,
taking into account these virtual KO networks with particularly
high functional measure errors, the functional fidelity of virtual
WT and KO networks are comparable.
The preprocessing of the training ICC networks before informing the SNESIM and modified SNESIM algorithms is an
important step to generate realistic virtual ICC networks. As
these algorithms generate the pixels of the virtual network sequentially, pixels simulated earlier on influence subsequently
simulated pixels. Any artifacts present in the training network
may be stochastically reproduced in the virtual network, and
once reproduced, subsequently simulated pixels may therefore
also be affected by this artifact, leading to a cascade of error.
The modified SNESIM algorithm was capable of generating
virtual ICC networks with a range of structural and functional
properties by retrieving a PDF from each of the two search trees
corresponding to the two training networks, and then simulating
pixels from a weighted sum of these PDFs. However, during
extrapolation (i.e., when a virtual network is generated with
depletion severity outside the spectrum presented by the two
training networks), the merge factor takes on values less than
zero or greater than one, so a negative PDF weight will be
present. The merging of the two PDFs, hence, becomes the
subtraction of one from the other, albeit weighted, as opposed to
simply taking an intermediate value in the case of interpolation.
Therefore, interpolated virtual networks are likely to be more
reliable in terms of fidelity than extrapolated virtual networks.
The PDF adjustment to account for the local marginal PDF
in the SNESIM algorithm (step 4) allows the generated virtual

2076

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

Fig. 7. Functional measure values of the virtual networks generated using the
modified SNESIM algorithm against the global marginal PDF ICC probabilities
were generated at. Crosses represent the average measure values of the nine
virtual networks generated at each of the global marginal PDF ICC probabilities.

network to match the user-defined global marginal PDF closer
by compensating other structural properties [16]. The density
structural metric is analogous to the global marginal PDF ICC
probability and, hence, can be used to assess the degree to which
the user-defined global marginal PDF is met. Although the
PDF adjustment was not implemented in the modified SNESIM
algorithm, the density metric values of the virtual networks
still matched the user-defined global marginal PDF closely.
This could be because the merge factor is computed based on
the user-defined global marginal PDF and is then used to form
the merged PDF for generating the virtual network. Therefore,
the user-defined global marginal PDF is inherently present in
the virtual network generation process.
The computational cost of using the modified SNESIM algorithm to generate virtual networks is approximately double
that of using the SNESIM algorithm as there are two training networks, and for each pixel simulated PDFs need to
be retrieved from two search trees. However, with the current input parameters, virtual networks can still be generated
quickly using both SNESIM and modified SNESIM. As these
algorithms are capable of generating virtual networks of any
size, experimentally obtained small-scale ICC network imaging data can be used to inform these algorithms to generate
large-scale virtual ICC network imaging data at fields-of-view
extending beyond the limitations presented by experimental
imaging.
In this study, virtual ICC networks were generated across
a spectrum of depletion severities by interpolating the PDFs
drawn from the search trees of the training networks. This was
an improvement from our previous strategy [13], which directly
interpolated the search trees because in the previous strategy, if
the pattern of pixels presented by the DSN during virtual network generation only appeared in one training network but not
the other, the PDF used to simulate the pixel of interest was
only drawn from the search tree corresponding to that training
network regardless of the interpolation factor. It is, therefore,
possible that pixel values are being simulated solely based on

a training network, which is not similar to the desired network.
With the updated strategy employed in this study, the PDFs are
drawn separately and then interpolated and, hence, both training
networks are always considered appropriately according to the
interpolation factor. We, therefore, also expect the updated algorithm to generate more realistic virtual networks than previously
described [13].
Various studies have attempted to explain and predict GI electrical activity in health and disease states by utilizing computer
models. Since the 1960s, when the pacemaker role of ICC was
still unclear, GI electrical activity has been modeled as a series
of coupled Van der Pol relaxation oscillators [27]. This concept
was further expanded to demonstrate entrainment in a network
of bidirectionally coupled series of relaxation oscillators [28],
and was used to simulate the effects of partial cuts in GI organs
on the electrical activity [29]. More recently, a cellular automaton model was developed to investigate the effects of tissue
degradation on the overall GI electrical activity propagation,
with the degradation being modeled as randomly distributed
nodes throughout the simulation grid [26]. Although these studies were insightful in simulating GI electrical activity under a
variety of conditions, they lacked the underlying electrophysiological basis of ICC. The generation of virtual ICC networks
proposed here can establish a more sophisticated model of GI
tissue and, therefore, offers potential for the previous studies
to be repeated and extended in a more physiologically realistic
manner.
Simulation studies using experimentally imaged ICC networks have successfully related ICC network structure to function [30]. This framework can be further enhanced by incorporating the virtual network generation algorithms, such that the
simulations are not limited to the small spatial scale of the experimental data. The augmented framework can then be used as
a virtual platform to investigate ICC structure–function relationships in, for example, gastroparesis and slow-transit constipation where multiple cellular pathologies and competing theories
coexist [5], [10]. Another potential application of the virtual network generation algorithms is to generate large-scale networks
to inform multiscale models [31], [32], which, for instance,
can be used to investigate the mechanisms of conduction slowing and dysrhythmias, recently observed in a high-resolution
electrical mapping study of gastroparetic patients with ICC
depletion [6].
As future work, the modified SNESIM algorithm can be validated against experimental imaging data of ICC networks in
obstruction. During obstruction, ICC networks exhibit a gradient of depletion in the oral direction from the site of obstruction [33], and hence, ICC network imaging data can be
obtained at various depletion levels throughout this gradient.
The networks at the extremes of the spectrum (i.e., normal
and severely depleted) can be used as the training networks
to the modified SNESIM to test if virtual networks generated
at intermediate depletion severities have similar structural and
functional properties to those obtained experimentally. Following validation, the algorithm may also be further adapted to
generate large-scale virtual networks, which in fact capture
the transition in network properties through space. This additional functionality can reveal a holistic view of, for example,

GAO et al.: STOCHASTIC ALGORITHM FOR GENERATING REALISTIC VIRTUAL INTERSTITIAL CELL OF CAJAL NETWORKS

the natural spatial gradients present along the curvature of the
stomach [34].
In summary, this paper validated the efficacy of using the
SNESIM algorithm to generate realistic virtual ICC networks,
and presented modifications to the algorithm to enable virtual
networks with a range of structural and functional properties to
be generated. These algorithms offer an alternative strategy for
obtaining comprehensive imaging datasets encompassing largescale ICC networks across a spectrum of depletion levels. The
algorithms can now be applied in modeling studies to elucidate the structure–function relationships of ICC depletion in GI
motility disorders.
APPENDIX
TABLE II
KEY PARAMETERS OF THE ICC MODEL (FOR REINITIALIZING THE STATE
VARIABLES, SEE [24] FOR DETAILS)
State variables
Cai
dL ty p e
fL ty p e
f ca Ltyp e
dV D D R
fV D D R
dC a C l
dE R G
dk v 1 1
fk v 1 1
dN a
fN a
dN S C C
PU_unit-CaP U
PU_unit-Cam
PU_unit-CaE R
PU_unit-ADPm
PU_unit-ADPi
PU_unit-NADHm
PU_unit-h
PU_unit-deltaPsi

Value

Units

1.00314e–5
8.21294e–6
9.40876e–1
1.00000e+ 0
9.80477e–4
5.67153e–1
3.67480–4
2.00000e–1
3.98797e–3
9.97147e–1
1.37236e–2
1.81419e–1
5.04356e–3
7.54078e–5
2.30866e–4
3.22894e–3
2.60102e+ 0
7.72883e–3
1.01697e–1
9.39673e–1
1.63999e+ 2

millimolar
dimensionless
dimensionless
dimensionless
dimensionless
dimensionless
dimensionless
dimensionless
dimensionless
dimensionless
dimensionless
dimensionless
dimensionless
millimolar
millimolar
millimolar
millimolar
millimolar
millimolar
dimensionless
millivolt

ACKNOWLEDGMENT
The authors would like to thank Dr. S. Strebelle and Prof. A.
Journel for making the SNESIM algorithm source code available, and Dr. G. Farrugia and Dr. S. Gibbons for providing the
training ICC network imaging data. The authors would also like
to thank the contribution of the NeSI high-performance computing facilities at the University of Auckland and the staff at
NeSI and Center for eResearch.
REFERENCES
[1] G. Farrugia, “Interstitial cells of Cajal in health and disease,” Neurogastroenterol Motility, vol. 20, pp. 54–63, 2008.
[2] S. M. Ward et al., “Mutation of the proto-oncogene c-kit blocks development of interstitial cells and electrical rhythmicity in murine intestine,” J.
Physiol., vol. 480, pp. 91–97, 1994.
[3] J. D. Huizinga et al., “W/kit gene required for interstitial cells of Cajal and
for intestinal pacemaker activity,” Nature, vol. 373, pp. 347–349, 1995.

2077

[4] J. D. Huizinga et al., “Physiology, injury and recovery of interstitial
cells of Cajal: Basic and clinical science,” Gastroenterology, vol. 137,
pp. 1548–1556, 2009.
[5] M. Grover et al., “Cellular changes in diabetic and idiopathic gastroparesis,” Gastroenterology, vol. 140, pp. 1575–1585, 2011.
[6] G. O’Grady et al., “Abnormal initiation and conduction of slow-wave
activity in gastroparesis, defined by high-resolution electrical mapping,”
Gastroenterology, vol. 143, pp. 589–598, 2012.
[7] K. Isozaki et al., “Deficiency of c-kit+ cells in patients with a myopathic form of chronic idiopathic intestinal pseudo-obstruction,” Am. J.
Gastroenterol., vol. 92, pp. 332–334, 1997.
[8] A. E. Feldstein et al., “Chronic intestinal pseudoobstruction associated
with altered interstitial cells of Cajal networks,” J. Pediatric Gastroenterol.
Nutrition, vol. 36, pp. 492–497, 2003.
[9] G. L. Lyford et al., “Pan-colonic decrease in interstitial cells of Cajal
in patients with slow transit constipation,” Gut, vol. 51, pp. 496–501,
2002.
[10] T. Wedel et al., “Enteric nerves and interstitial cells of Cajal are altered in
patients with slow-transit constipation and megacolon,” Gastroenterology,
vol. 123, pp. 1459–1467, 2002.
[11] S. J. Gibbons et al., “ICC network density: Regulation and consequences,”
in New Advances in Gastrointestinal Motility Research. New York, NY,
USA: Springer-Verlag, 2013, pp. 29–49.
[12] V. S. Tharayil et al., “Lack of serotonin 5-HT2B receptor alters proliferation and network volume of interstitial cells of Cajal in vivo,” Neurogastroenterol Motility, vol. 22, pp. 462–469, 2010.
[13] J. Gao et al., “A stochastic multi-scale model of electrical function in
normal and depleted ICC networks,” IEEE Trans. Biomed. Eng., vol. 58,
no. 12, pp. 3451–3455, Aug. 2011.
[14] S. Strebelle and A. Journel, “Reservoir modeling using multiple-point
statistics,” presented at the SPE Annu. Tech. Conf. Exhib., New Orleans,
LA, USA, 2001.
[15] S. Strebelle, “Conditional simulation of complex geological structures using multiple-point statistics,” Math. Geol., vol. 34, pp. 1–21,
2002.
[16] Y. Liu, “Using the Snesim program for multiple-point statistical simulation,” Comput. Geosci., vol. 32, pp. 1544–1563, 2006.
[17] G. B. Arpat. (2005). Sequential simulation with patterns. [Online]. Ph.D.
dissertation, Dept. of Petroleum Eng., Stanford University, Stanford,
CA, USA. Available: https://pangea.stanford.edu/ERE/pdf/pereports/
PhD/Arpat05.pdf
[18] M. M. Wouters et al., “Exogenous serotonin regulates proliferation of
interstitial cells of Cajal in mouse jejunum through 5-HT2 B receptors,”
Gastroenterology, vol. 133, pp. 897–906, 2007.
[19] J. Gao et al., “Numerical metrics for automated quantification of interstitial
cell of Cajal network structural properties,” J. Roy. Soc. Interface, vol. 10,
p. 20130421, 2013.
[20] G. O’Grady et al., “Rapid high-amplitude circumferential slow wave propagation during normal gastric pacemaking and dysrhythmias,” Neurogastroenterol Motility, vol. 24, pp. e299–e312, 2012.
[21] D. F. van Helden et al., “Generation and propagation of gastric slow
waves,” Clin. Exp. Pharmacol. Physiol., vol. 37, pp. 516–524, 2010.
[22] J. Gao et al., “Developmental changes in postnatal murine intestinal interstitial cell of Cajal network structure and function,” Ann. Biomed. Eng.,
vol. 42, pp. 1729–1739, 2014.
[23] A. Corrias and M. L. Buist, “Quantitative cellular description of gastric
slow wave activity,” Am. J. Physiol. Gastrointest Liver Physiol., vol. 294,
pp. G989–G995, 2008.
[24] S. Sathar et al., “A biophysically based finite-state machine model for
analyzing gastric experimental entrainment and pacing recordings,” Ann.
Biomed. Eng., vol. 42, pp. 858–870, 2013.
[25] G. R. Mirams et al., “Chaste: An open source C++ library for computational physiology and biology,” PLoS Comput. Biol., vol. 9, p. e1002970,
2013.
[26] W. J. E. P. Lammers et al., “Slow wave propagation and plasticity of
interstitial cells of Cajal in the small intestine of diabetic rats,” Exp.
Physiol., vol. 96, pp. 1039–1048, 2011.
[27] T. S. Nelsen and J. C. Becker, “Simulation of the electrical and mechanical
gradient of the small intestine,” Am. J. Physiol., vol. 214, pp. 749–757,
1968.
[28] S. K. Sarna et al., “Simulation of slow-wave electrical activity of small
intestine,” Am. J. Physiol., vol. 221, pp. 166–175, 1971.
[29] S. K. Sarna et al., “Effects of partial cuts on gastric electrical control
activity and its computer model,” Am. J. Physiol., vol. 223, pp. 332–340,
1972.

2078

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 8, AUGUST 2015

[30] P. Du et al., “Tissue-specific mathematical models of slow wave entrainment in wild-type and 5-HT(2B) knockout mice with altered interstitial
cells of Cajal networks,” Biophys. J., vol. 98, pp. 1772–1781, 2010.
[31] M. L. Buist et al., “A model of slow wave propagation and entrainment along the stomach,” Ann. Biomed. Eng., vol. 38, pp. 3022–3030,
2010.
[32] P. Du et al., “A multiscale model of the electrophysiological basis of the
human electrogastrogram,” Biophys. J., vol. 99, pp. 2784–2792, 2010.

[33] I. Y. Chang et al., “Loss of interstitial cells of Cajal and development of
electrical dysfunction in murine small bowel obstruction,” J. Physiol., vol.
536, pp. 555–568, 2001.
[34] A. J. Burns et al., “Interstitial cells of Cajal mediate inhibitory neurotransmission in the stomach,” Proc. Nat. Acad. Sci. USA, vol. 93,
pp. 12008–12013, 1996.
Authors’ photographs and biographies not available at the time of publication.

