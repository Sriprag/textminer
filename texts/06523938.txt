IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 1, JANUARY 2014

231

On-Line Detection of Apnea/Hypopnea Events Using
SpO2 Signal: A Rule-Based Approach Employing
Binary Classifier Models
Bijoy Laxmi Koley, Member, IEEE, and Debangshu Dey, Member, IEEE

Abstract—This paper presents an online method for automatic
detection of apnea/hypopnea events, with the help of oxygen saturation (SpO2 ) signal, measured at fingertip by Bluetooth nocturnal pulse oximeter. Event detection is performed by identifying
abnormal data segments from the recorded SpO2 signal, employing a binary classifier model based on a support vector machine
(SVM). Thereafter the abnormal segment is further analyzed to detect different states within the segment, i.e., steady, desaturation,
and resaturation, with the help of another SVM-based binary ensemble classifier model. Finally, a heuristically obtained rule-based
system is used to identify the apnea/hypopnea events from the timesequenced decisions of these classifier models. In the developmental
phase, a set of 34 time domain-based features was extracted from
the segmented SpO2 signal using an overlapped windowing technique. Later, an optimal set of features was selected on the basis of
recursive feature elimination technique. A total of 34 subjects were
included in the study. The results show average event detection
accuracies of 96.7% and 93.8% for the offline and the online tests,
respectively. The proposed system provides direct estimation of the
apnea/hypopnea index with the help of a relatively inexpensive and
widely available pulse oximeter. Moreover, the system can be monitored and accessed by physicians through LAN/WAN/Internet and
can be extended to deploy in Bluetooth-enabled mobile phones.
Index Terms—Event detection, recursive feature elimination,
support vector machine (SVM), oxygen saturation.

I. INTRODUCTION
LEEP apnea-hypopnea syndrome (SAHS) is a common
sleep disorder with a high prevalence of 4% inadult men and
2% in adult women [1]. It is characterized by recurrent cessation
of breathing during sleep [2]. Previous studies have revealed
that untreated SAHS can lead to cardiovascular pathologies,
metabolic deregulation, sexual dysfunction, diabetes, and even
sudden cardiac arrest [3]. Therefore, the early detection and
treatment of SAHS is essential.

S

Manuscript received February 4, 2013; revised April 6, 2013; accepted May
24, 2013. Date of publication June 5, 2013; date of current version December
31, 2013. The work was supported by the University Grant Commission, India
under the University with Potential for Excellence, phase II scheme awarded to
Jadavpur University, Kolkata, India.
B. L. Koley is with Department of Instrumentation Engineering, B. C.
Roy Engineering College, Durgapur, West Bengal 713206, India (e-mail:
bijoylaxmikoley@yahoo.com).
D. Dey is with the Department of Electrical Engineering, Jadavpur University,
Kolkata, West Bengal 700098, India (e-mail: debangshudey80@gmail.com).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/JBHI.2013.2266279

Polysomnography (PSG) is the gold standard method for the
diagnosis of sleep apnea. PSG requires nocturnal recordings
of different electrophysiological signals in sleep laboratories
with dedicated systems and attending personnel [2]. The apneahypopnea index (AHI), obtained through PSG, is used to characterize SAHS severity. The AHI is defined as the number of apnea
and hypopnea events occurring per hour of sleep. However, PSG
is an expensive, time-consuming, and labor-intensive procedure.
Thus, several techniques have been developed for simplified
SAHS detection based on the electrocardiogram (ECG) [4]–[6],
airflow [7], snoring [8], abdominal movement [9], and pulse
oximetry [10].
Based on early results, the apnea and hypopnea events are
accompanied by concomitant cyclic variations in the heart rate;
this ordered variations in the heart rate has been applied for the
detection of sleep apnea [6], [11]. Tagluk et al. [9] developed
a system for classification of sleep apnea via wavelet transform
and artificial neural networks. Recently, Le et al. [12] predicted
the apnea episodes from a wireless wearable multisensor suite.
Blood oxygen saturation (SpO2 ), measured by the pulse
oximetry, is one of the extensively studied signals for this
purpose, because it can be easily acquired and is suitable for
portable monitoring [13]–[28]. Oximetry recordings contain essential information about SAHS. Apnea and hypopnea events
are usually accompanied by repetitive oxygen desaturation due
to the lack of airflow. Therefore, patients with SAHS exhibit irregular fluctuations in SpO2 signals. Several quantitative indices
are available to measure such irregular behavior of SpO2 , e.g.,
the number of oxyhemoglobin desaturations below a certain
threshold (usually a 3% or 4% decline from baseline) [14], [16],
cumulative time spent below a certain saturation level [15], and
the saturation variability index [17], [18]. Many researchers have
quantified the variability of SpO2 by means of spectral and nonlinear measures [25], [26]. Different diagnostic models based on
logistic regression [10], linear discriminant analysis [22], and
neural networks [23], [24] are in use for the detection of SAHS
on the basis of these features. All the aforementioned methods,
however, provide either a categorical decision for each subject
(SAHS/non-SAHS) or an indirect estimation of AHI, based on
overnight SpO2 recordings.
Now-a-days, research interest toward real-time apnea monitoring has increased. Recently, Bsoul et al. [5] and Burgos
et al. [27] implemented real-time SAHS detection systems using a classifier based on the support vector machine (SVM),
on ECG signal, and an ensembled classifier using SpO2 signal, respectively. Most recently, Xie et al. [28] developed both

2168-2194 © 2013 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

232

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 1, JANUARY 2014

TABLE I
DEMOGRAPHIC DETAILS OF THE SUBJECT POPULATION

group of eight subjects; this was also accompanied by PSG
recordings and expert scorings. The sensor used for the online
test was NONIN Onyx II, Model 9560 flexible probe type fingertip Bluetooth oximeter.
III. METHODS
The proposed methodology involves several stages, which are
discussed in the following sections.

ECG and SpO2 signals based real-time detection of SAHS using a classifier combiner. However, the previous works tried to
identify apneic episodes in terms of fragments of the signal on
minute-by-minute basis (per epoch analysis), but did not identify the events. The number of apneic events may not be the
same as the number of epochs, because one epoch may contain multiple events and a long apnea event may be prolonged
in multiple epochs. Therefore, the identification of events for
direct estimation of AHI is desirable.
In this context, the present study proposes an online apnea
and hypopnea event detection system that provides direct estimation of AHI by counting the total number of identified events.
In contrast to other works, it uses overlapping segments of SpO2
signal and then categorizes these segments into different classes
with the help of classifiers, rather than using some threshold. Finally, with the help of time sequence decisions of the classifiers,
a rule-based system is employed to identify the event, which
basically takes the reference of the typical time domain signature produced in SpO2 during the apnea/hypopnea event. The
strategic combination of the time-sequenced decisions of several binary SVM classifiers is found to be robust with efficient
event detection capability. Moreover, the proposed scheme has
been implemented online and is suitable for deploying through
GSM or any communication network to communicate with a
medical practitioner or sleep center for real-time monitoring
and assessment of SAHS.
II. MATERIALS
Thirtyfour subjects suspected of suffering from sleep apnea were included in this study. All of them presented typical
symptoms, such as sleepiness, snoring, and awakenings or apneic events, as reported by the subjects or their bedmate. The
PSG (model: Alice LE, part no. 1002287, Philips Respironics)
recordings were conducted at the Center for Sleep Disorder Diagnosis , Burdwan, West Bengal, India, following clinical ethics.
Table I presents the demographic details of the subjects under
study.
Initially, 26 SpO2 recordings from the PSG system were collected for the study. These recordings were scored by a clinical
expert with the help of complete PSG recordings using criteria proposed by the American Academy of Sleep Medicine
(AASM) [29]. In addition to the standard scoring, the starting
point of desaturation, resaturation, and end point resaturation
of SpO2 signals that are related to apnea or hypopnea events
were marked in consultation with the expert. Among the 26
recordings, randomly chosen 16 recordings were included in
the training dataset and the remaining ten recordings were used
for offline testing. Online testing was performed on a separate

A. Signal Processing
For analysis, the recorded SpO2 signals are made free from
artifacts by removing all changes > 4%/s between two consecutive samples of 1 s interval and eliminating any SpO2 < 50%,
as suggested in [15]. During online testing with the Bluetooth
oximeter, the SpO2 signal was sampled at 3 Hz thereafter filtered by a moving average filter of 3 s [29] duration and then
down-sampled to 1 Hz, followed by artifact removal. A baseline is calculated from the top fifth percentile of the previous
fiveminute recording [14].
B. Segmentation of the SpO2 Signal
During the apnea/hypopnea event, a desaturation period followed by a faster resaturation period can be observed in the
SpO2 signal. Hence, the present study aims to identify the apnea/hypopnea event, by identifying the desaturation and resaturation. These desaturation and resaturation are of finite duration.
Thus, if segmentation is performed on the SpO2 signal, then
identifying some segment as desaturation, resaturation, or normal may help to identify the apnea/hypopnea event. Moreover,
an apnea/hypopnea event may occur at any time during sleep,
and its duration may vary from 10 to 120 s [13]. Thus, to ensure
that all the events are separately identified, overlapping of the
segments is necessary.
In this study, an overlapping segmentation method is used
to separate a normal segment (N) (containing SpO2 signal of
normal sleep condition) from an abnormal segment (AB) (containing SpO2 signal originating from some apnea or hypopnea
events). Specifically, the AB segments are those that have at
least 50% of their length falling within the interval of the starting point of desaturation to the end point of resaturation. All
other segments are considered N-segments. An event-related
SpO2 signature consists of desaturation followed by resaturation periods, as well as a steady part before desaturation or
after resaturation. The identified AB segments are further fragmented in a similar fashion with shorter duration. These short,
overlapped segments are then classified into three categories:
desaturation (D) (falls between starting point of desaturation
and starting point of resaturation), resaturation (R) (falls within
starting to end point of resaturation), and steady (S) (remaining
segments). These segmentations are performed with the help of
the annotations on SpO2 signals, from the PSG recordings.
C. Feature Extraction
Initially, 34 time domain features were extracted from each
segment of SpO2 signal; these are listed in Table II. Most of

KOLEY AND DEY: ON-LINE DETECTION OF APNEA/HYPOPNEA EVENTS USING SpO2 SIGNAL

TABLE II
TIME-DOMAIN MEASURES FOR SpO2

233

of event-related deviation by additionally identifying desaturation and resaturation another sliding segment of shorter duration
was considered. Fig. 1(b) shows a measure (maximum of first
derivative calculated over shorter duration sliding segment of
8 s) which takes negative value (due to negative slope of SpO2 )
during desaturation while positive value (due to positive slope of
SpO2 ) during resaturation period. The aforementioned window
lengths and overlapping durations were found to provide best
result which are discussed in Section IV-B.
D. Feature Selection and Classification

Fig. 1. (a) Recorded SpO2 signal and 32 s segment wise (with 8 s sliding)
calculated median values, (b) firstderivative of the SpO2 signals, its 32 s segment
wise (with 8 s sliding) calculated variance values and 8 s segment wise (with
2 s sliding) maximum values.

these features, such as minimum, mean, variance, and derivative of SpO2 , have shown good performance for detection of
SAHS [17], [19], [28], [30].The slope and bias of the regression
line obtained from the SpO2 signal were also found to be effective features [28]. The area under the different dip values were
proposed in [27] and [28].
Fig. 1(a) shows the representation of the SpO2 signal along
with longer duration sliding segment (32 s with sliding of 8 s)
wise calculated values of one of the measure, i.e., median. It
can be observed that whenever SpO2 level falls, the median
value calculated over the segment also shows some deviation,
similar observation can also be made on the measure of variance calculated on same segment of first derivative as shown in
Fig. 1(b). It can be also observed that the variance of the first
derivative which is related to the changes in SpO2 is much sensitive measure than the median of SpO2 , which is sensitive to
the dip level of SpO2 . Though both of these measures can provide information about the deviation of SpO2 level from normal
but may not differentiate apnea event-related deviation from the
deviation occurred due to other reasons accurately, on the other
hand both these measures may not differentiate desaturation and
resaturation period of SpO2 . Thus, for an accurate identification

The generalization performance of a classifier depends primarily on the selection of good features, i.e., the features that
represent maximal separation between the classes [31].
In the present case, the multivariate method of feature selection by backward elimination is applied [32]. Backward selection is often found to be suitable to find the optimal set of
features, rather than the best feature as in the case of the forward selection method [32]. Moreover, the multivariate method
considers the predictive power of features jointly, rather than
independently. Hence, it can identify those features that are individually irrelevant but may become relevant in the context
of others and can eliminate redundant features that might be
individually relevant.
In this study, the recursive feature elimination (RFE) technique was combined with SVM-based classifiers for the selection of features, and the same SVM model was used for
classification. Recently, SVM classifiers have shown better performance over linear discriminant and neural network classifiers
in SAHS recognition [33]. Moreover, the application of SVM
on SAHS detection has already been used in previous studies [6], [34].
1) Theory of SVM and SVM-RFE Technique: A brief theory
of SVM and SVM-RFE is presented here for ready reference
while the details are available in [35]. The basic idea of nonlinear
SVM is to map data from d dimensional feature space into a
higher dimensional space by the Kernel method and to find an
optimum separating hyperplane (OSH) by minimizing a cost
function under constraints, for maximal margin and minimal
error.
The RFE technique is based on the value of the margin on
a different set of features. The feature selection is performed
through a sequential backward elimination procedure followed
by the margin maximization principle [35]. In this study, for
any feature q from the feature subspace S (q ∈ S) during certain iteration of RFE, a ranking score was calculated using the
method explained in [32] and [35]. The feature with the smallest
ranking score is eliminated from feature subspace S.
2) Classification Models: The present study used two classifier models. The first model consists of a single binary SVM
classifier, responsible for separating an AB segment from a N
segment in the SpO2 signal, and is termed SVM_N_AB. For this
classifier, the sign of the decision function was used to make a
decision about the wining class.
The second classifier model is termed SVM_S_D_R. It is
formed by combining three binary SVM classifiers into a

234

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 1, JANUARY 2014

one-against-all strategy, where each classifier of the ensemble
system (containing three binary classifiers), is trained to find
OSH between feature vectors of a particular class (say steady
class S) against the feature vectors of remaining other classes,
i.e., desaturation (D) and resaturation (R). This classifier model
is used to separate three different states of an abnormal SpO2
signal, i.e., desaturation (D), resaturation (R), and steady (S)
states, that belong to the AB class of segments. Finally, in the
decision phase, a winner-takes-all rule [35] was used to decide
which class label is to be assigned to a particular feature vector,
and the winning class is the one that corresponds to the SVM
classifier of the ensemble which shows the highest output of
discriminant function value.
3) Training and Testing: For training and cross validation,
two sets of databases were formed for the two classification
models (i.e., SVM_N_AB and SVM_S_D_R) with extracted
features from respective SpO2 signal segments. All the features
in the training dataset were normalized and scaled between 0 to
1 (outliers were set to respective limiting values).
To check the performance of the classifiers, the k-fold (k = 4)
cross-validation (CV) scheme [36] was adopted. In this scheme,
the whole training dataset is divided into k subsets subject wise,
with one subset used for testing and the remaining k–1 subsets
used to train and construct the SVM decision surface. This is
repeated for other subsets so that all subsets are used as the
testing sample.
After the repetitive cycle of training and testing process, the
classification performance of the individual subjects was averaged and used for the performance analysis. The four measures,
namely, sensitivity (SE), specificity (SP), predictivity (PR), and
accuracy (AC), were used to assess the performance using the
formulae given in [37].
4) Selection of Model Parameters: The performance of the
proposed system depends on the classification performance,
which is again dependent on the selection of features, appropriate choice of length of SpO2 signal segments, and proper tuning
of the parameters of SVM classifiers, such as C, kernel function, and its parameters. A heuristic approach was considered
for the selection of these parameters by varying one parameter
iteratively while keeping the others as constants and observing
the performance. Such grid search process involves a significant
amount of computational load. Hence, a coarse long-range grid
search [5] was performed initially to find the region of optimal
solution, and thereafter a fine grid search was performed over
that smaller range. Among the several measures, the commonly
used sensitivity parameter [5], [28] was used to optimize the
classifiers, and the event detection accuracy was considered to
evaluate the performance of the scheme.
5) Event Detection by Combining the Outputs of the Classifiers: Apnea/hypopnea event detection is performed on the
basis of the decisions of the properly trained classifiers. This
involves presenting the ith feature vector extracted from the ith
data segment (termed the longer segment) to the SVM_N_AB
classifier model for prediction of possible class, i.e., N or AB. If
the decision of the classifier is AB, then that longer segment of
the SpO2 signal is further fragmented into shorter overlapped
time sequenced segments. Features are again extracted from

Fig. 2. Block diagram of the proposed system for automated detection of
apnea and hypopnea events.

these fragments of shorter duration and are presented to the
SVM_S_D_R classifier model for classification of the desaturation (D), resaturation (R), and steady (S) states of the SpO2
signal. Fig. 2 shows a schematic of the proposed logic. On the
basis of the decisions of the SVM_N_AB and SVM_S_D_R
classifiers, some sets of rules are obtained heuristically to detect
the apnea-hypopnea events.
IV. RESULTS AND ANALYSIS
The present section summarizes the obtained results at various
stages of the proposed scheme, starting from the selection of
features.
A. Feature Selection
During the selection of the optimal set of features by SVMRFE, it was observed that the features that were eliminated in the
successive iteration of backward elimination were sensitive to
the length of data segments as well as to the model parameters.
Fig. 3(a) shows the variation of sensitivity with respect to rankwise (as obtained using SVM-RFE) inclusion of one feature at
a time in the feature vector for both the classifiers for a particular setting of classifier model parameters. It can be observed
from Fig. 3(a) that sensitivity does not improve substantially
by incorporating more than nine features for SVM_N_AB and
six features for SVM_S_D_R. Thus, an optimal set of nine features as obtained by SVM-RFE for the SVM_N_AB classifier
model are as follows: mean, minimum, and median of SpO2 ,
variance of the first derivative, maximum of the third derivative,
difference from the median to the minimum of SpO2 , difference
from mean to maximum of the first derivative, and area under
dip level of 3% and that of 4%. It can be observed that majority
of the features are sensitive to the dip level of SpO2 , but as
during event the desaturation and resaturation rates are much
faster, thus some of the rate sensitive features obtained from
the derivatives has also been included. The optimal set of six
features for SVM_S_D_R consists of slope, maximum value
of the third derivative, minimum value of the first derivative,
minimum and maximum of the second derivative, and mean of
SpO2 . In this case as the SVM_S_D_R is trained to classify
the desaturation, resaturation, and steady part of the SpO2 , thus
almost all the selected features are rate sensitive, except mean

KOLEY AND DEY: ON-LINE DETECTION OF APNEA/HYPOPNEA EVENTS USING SpO2 SIGNAL

235

Fig. 3. Results and analysis: (a) Average classification sensitivities of SVM_N_AB and SVM_S_D_R classes with respect to the rank-wise number of features
in feature vector. (b) Optimization of average sensitivity for C and γ. (c), (d) Variations of event detection accuracies with respect to segment duration and segment
sliding duration for SVM_N_AB. (e) Correlation and (f) Bl and Altman plots between AHIP S G and AHIM O D E L .
TABLE III
OPTIMUM PARAMETERS VALUES FOR DIFFERENT SVM MODELS

of SpO2 , it can also be observed that features obtained from the
second and third derivatives are more rate sensitive than the features obtained from the first derivative. The mean of SpO2 was
found to be useful, in some case where middle point of sliding
segment has fallen at the starting of the resaturation period, in
those cases the average slope/rate over the segment becomes
small, and should not be identified as the steady class.
B. Analysis of Performance and Computation Sensitive Model
Parameters
In this study, the Gaussian Radial basis function kernel
was shown to perform similar to or better than polynomial
and linear kernels. Fig. 3(b) shows the variation of sensitivity of SVM_N_AB for a limited-range fine grid search. Table III shows the optimum values of classifier model parameters
namely C, which is the regularization parameter that allow to
control the shape of the discriminant function and consequently,
the decision boundary of the classifier when data are nonseparable and γ, which represents a parameter inversely proportional
to the width of the Gaussian kernel for both classifier models.
Fig. 3(c) and (d) shows the variations of the event detection accuracies with variations of the segment length and segment sliding duration (in other words, the overlap) for the SVM_N_AB
classifier respectively. Fig. 3(c) shows that for the window length
of 32 s, the event detection accuracy is maximum. It is expected
that a small amount of sliding (i.e., a higher amount of overlap) will improve the performance by increasing the resolution
of the entire event detection process, but it will also increase
the computational burden. The drop in performance with increasing window sliding duration can be observed in Fig. 3(d)
for SVM_N_AB. Hence, to choose the proper sliding duration,

TABLE IV
PERFORMANCE IN% FOR BOTH SVM CLASSIFIER MODELS, WITH SEGMENT
SIZE OF 32 AND 8 s AND SLIDING DURATION OF 8 AND 2 s, RESPECTIVELY

there is a compromise between accuracy and computational burden. In the case of the SVM_N_AB classifier model, the sliding
duration of 8 s (i.e., an overlap of 24 s) was chosen, as it is an
integer multiple of the longer segment of 32 s. Similarly, in the
case of the SVM_S_D_R classifier, the segment length of 8 s
with a sliding duration of 2 s (i.e., an overlap of 6 s) was selected
following the logic used for SVM_N_AB.
C. Classification Performance
After the selection of the respective model parameters, i.e.,
optimum set of features, segment length, sliding duration, kernel
function, C, and γ, both SVM models were validated on seen
and unseen data in the following three ways.
Experiment No. 1 (k-fold CV on training (seen) data): This
involved a k-fold (k = 4) CV test with the training set of 16
recordings for both SVM models. Table IV presents the obtained classification performance in terms of SE and SP for both
SVM models with optimum SVM model parameters (shown in
Table III).
Experiment No. 2 (offline testing on unseen data): This involved testing the classifier models with test dataset obtained
from ten different subjects. The features in the test dataset were
normalized by the scaling factor obtained from the training
dataset, and out-of-range instances were set to corresponding
limiting values.
Experiment No. 3 (intrasubject training and testing): This test
was performed with training data collected from a part of the
recording of the SpO2 signal for a particular subject and tested

236

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 1, JANUARY 2014

TABLE V
EVENT DETECTION ACCURACY IN% AT DIFFERENT COMBINATIONS

with the remaining part of the signal. This was done for all the
subjects having AHI > 15. Table IV shows the SVM model wise
average performance.
Table IV shows that the performance of SVM_S_D_R is quite
good compared with SVM_N_AB, which may be due to the fact
that only the AB event-related signal segments are presented to
the SVM_S_D_R classifier model, where there are significant
changes in SpO2 level.
D. Event Detection Performance
After several experiments and manual investigations of the
successes and failures of the event detector for different values
of segment length and their sliding durations, the following
rule was formulated heuristically, which is valid for the chosen
segments length (i.e., 32 and 8 s) and their respective sliding
durations (i.e., 8 and 2 s). The heuristically obtained rule may
be stated as follows.
For any valid event, at least two consecutive longer segments
must be classified as AB, and consequently there must be at least
three consecutive D-labeled segments followed by at least two
consecutive R-labeled segments.
The event detector was tested on both seen and unseen subjects, as stated before. Under the column of System-III, Table V
shows the average event detection accuracies over the subjects
as obtained from the event detector with the properly trained
SVM classifier models (trained while doing the experiments 1
to 3 as discussed in the previous section). The accuracy for each
subject in (%) was calculated using the following equation:
Accuracy(%)


|No. of events present − events detected|
= 100 × 1 −
No. of events present
Table V also shows the event detection performance by combining decisions of the SVM_N_AB classifier model alone,
termed as System-I. Similarly, the event detection performance
of the SVM_S_D_R classifier model alone is given in the
same table under the column of System-II. It can be seen from
Tables IV and V that although the segment classification performance of SVM_N_AB (see Table IV) is poor compared with
SVM_S_D_R, System-I can identify events better than SystemII. When System-I and System-II were carefully investigated,
it was observed that System-I identified some of the noneventrelated long-duration drops in SpO2 as events. However, this
system was found to be robust in detecting events with duration
of more than 20 s. On the other hand, System-II was found to
overestimate the AHI by detecting short-duration fluctuations of
SpO2 as events, but it was found robust, to reject long-duration

Fig. 4. Picture of the proposed system: (a) PSG monitor, (b) proposed apnea
detection system, and (c) DAS: USB 6009.

drops in SpO2 as events, which were often incorrectly identified
by System-I. The system identical to System-III, but with the
output of SVM_S_D_R fed to SVM_N_AB, was found to provide an accuracy close to System-III, but this system requires
comparatively higher computations.
Finally, the subject-wise AHIs were evaluated, and the relationship between the AHIM ODEL predicted by the proposed
system (System-III) and the AHIPSG predicted by the clinical
expert (from PSG records) were evaluated using Pearson’s correlation. The obtained correlation value was 0.988. Fig. 3(e)
shows the correlation between AHIPSG and AHIM ODEL . The
agreement between these indexes was evaluated through the
Bland–Altman analysis [38]. Fig. 3(f) shows that the estimation of AHIM ODEL is almost balanced, with a slight systematic
negative bias.
E. Online Field Testing
Online field tests were performed on eight subjects. To facilitate representation of the results, the subjects were given IDs,
i.e., OT01 to OT08. Among them, five subjects (subject IDs
OT01, OT02, OT03, OT04, and OT05) were tested by using
previously trained SVM models. The remaining three subjects
(subject IDs OT06, OT07, and OT08) were tested with the help
of SVM models trained by collecting training feature vectors
from the respective subjects (i.e., as per experiment no. 3, as
described in the previous section). In the latter case, the training
data were collected from the SpO2 level of the subject just before
sleep, by instructing the subject to hold the breath. The procedure was repeated several times, and each time the holding duration of successive breath was incremented by 2 s. To facilitate
an automatic training, a pushbutton switch interfaced with the
PC through a low-cost direct attached storagedevice (USB 6009
from NI), was given to the subject. Fig. 4 shows a photograph
of the system. The subject was instructed to press the switch
whenever he/she stopped breathing and to release it whenever
he/she resumed breathing. In this manner, the SVM models were
trained by collecting features from the stop-breathing events of
more than 10 s and remaining considered as normal. Table VI
shows the accuracy of the AHI estimation by the proposed model
for online testing. In this case, the starting/end point of desaturation and end point of resaturation were derived from ON/OFF
operation of the switch along with some delay time. The average
AHI estimation error of the online testing of the three subjects
was found to be 5.15% (shown in Table VI), higher than the
average error value for the other five subjects (OT01-OT05).
The reason for this slight variation may be due to improper

KOLEY AND DEY: ON-LINE DETECTION OF APNEA/HYPOPNEA EVENTS USING SpO2 SIGNAL

TABLE VI
RESULTS OBTAINED FROM ONLINE TESTING

training and inaccuracies occurring in finding the start/end time
of desaturation and resaturation, as the associated delay time
was found to be subject dependent. The overall average event
detection accuracy for these eight subjects was 93.8%.
V. ONLINE IMPLEMENTATION
This section discusses the algorithmic issues related to online
implementation of the proposed apnea/hypopnea event detection
system.
A. Sensor and Data Acquisition
To acquire data in a PC, an additional oximeter with a Bluetooth communication facility was attached to the fingertip.
This Bluetooth device was configured in point-to-point network
topology to collect data in PC. For the serial port profile of the
Bluetooth port, with a baud rate of 9600 with eight data bits
and one stop bit, was chosen, and then the pairing process with
Bluetooth PIN was initiated. After the first page was read, the
oximeter was configured in Data Format 7 mode, so that full
resolution (16 bit) with a sampling frequency of 3 Hz for the
SpO2 measurement could be obtained.
B. Detection System
The event detection system was implemented in LabVIEW
environment, with remote communication and real-time operation mode, so that the implemented algorithm could be easily
converted to generate the target code for PDA, mobile and compatible FPGA-based systems. In this study, the target code for
PC with TCP/IP Network was tested. The developed algorithm
for online event detection system is discussed in brief in the
following section.
The entire algorithm was implemented in four interrupt loops.
The first interrupt, having the highest priority with an interrupt
time period of 1/3 s, is responsible for acquiring samples by
page scan process of the Bluetooth data packets. From these,
it extracts the current SpO2 sample value, performs averaging
by the previous eight samples for moving average of 3 s, and
stores it in a shift register array of size 8. The second interrupt
loop, which has medium interrupt priority and an interrupt interval of 2 s, reads the previous shift register contents, down
samples the SpO2 signal to 1 Hz by averaging three samples,
and then stores them in another shift register sequentially with
the previously acquired 30 s data (the size of this shift register

237

is 32). It also calculates the first, second, and third derivatives
and stores them in another three shift registers of the same size.
The third interrupt loop, with lower priority and having an interrupt interval of 8 s, calculates the features for SVM_N_AB by
reading the shift register contents, i.e., 32 s data of SpO2 , first,
and third derivatives, and then presents them to SVM_N_AB for
prediction of class. In the next sequence, if the decision of the
SVM_N_AB is AB class, it will calculate the 8 s segment-wise
features for SVM_S_D_R from end of the shift register and will
consequently present them to SVM_S_D_R for possible prediction of class. All the decisions of the two SVM models are
stored into another two shift registers, called the event register.
The fourth interrupt loop, with the lowest priority, is responsible
for communication through the Web server; it also updates the
display and reads the status of user controls. The main event
detection logic is implemented in a user control infinite loop
that reads the status of the event register with an interval of time
(this interval was adjusted in higher side so that the PC could
perform other tasks as well, without compromising the event
detection process) to detect event. After detecting some valid
event it increments the event counter and resets the content of
the event register. The SVM and feature extraction algorithms
were implemented in C/C++ language and then were interfaced
with LabVIEW.
C. Access Through the Internet
Provision was made to observe the detection process in real
time through LAN/WAN/Internet as well as to download realtime streamed raw SpO2 data packets. This was done through
the LabVIEW remote panel operation, which downloads the
executable and freely available LabVIEW run-time engine in
the remote system automatically through LAN/WAN/Internet
and runs the program, where the PC used for the detection of
events acts as the Web server.
VI. DISCUSSION
The proposed study presents a technique to judge SAHS
from SpO2 , which is one of the physiological signals listed by
the AASM to characterize sleep apnea events [29]. The developed system uses Bluetooth communication facilities to realize
a wireless cost-effective platform for SpO2 acquisition, monitoring, and real-time detection. Among several features that can be
extracted from SpO2 signals, an optimal set of features is identified by the SVM-RFE method. The proposed model achieved
96.7% accuracy for the test dataset, which is reasonably good
compared with other related works.
Although a few works toward the identification of apnea/hypopnea events are reported in [4], [30], [39]–[42] there
is an ample scope to improve the performance. Khandoker
et al. [4] used ECG signal of 5 s nonoverlapping segments
to identify the event and obtained 94.7% and 79.7% accuracies for apnea and hypopnea events, respectively. The authors
in [30] implemented a fuzzy-logic-based automated system using three respiration signals and SpO2 signal to detect apneic
events, and the system achieved 87% sensitivity and 89% specificity for identifying events. Nakano et al. [39] used a threshold

238

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 1, JANUARY 2014

technique to identify the events from a single-channel respiration signal but finally showed the results for disease classification with different AHI cut-off values. Lee et al. [40] used SpO2
signal and obtained 88% accuracy for event detection. Recently,
automatic apnea/ hypopnea event detection systems have been
developed using respiration signal [41], [42]. All these techniques are based on offline analysis of the signals. Some of the
most recent automated real-time SAHS detection approaches
involved epoch/episodes classification [5], [27], and [28], not
the events, and hence did not estimate AHI directly as per the
guidelines of AASM [29]. Estimating AHI without correctly
identifying the individual respiratory events could give an inaccurate assessment of the severity of SAHS. Moreover, unlike in
other works [5], [27], the classifier decision is not considered as
final; rather, the classifier decisions on several time-sequenced
windows are used by the event detector. The final decision is
based on several decisions of the classifiers, where one or two
misclassified windows may not affect the event detection (explained in Fig. 2).
VII. CONCLUSION
The developed system for the automatic identification of apnea and hypopnea events based on the time domain features of
the SpO2 signal achieved an accuracy of 96.7%. Developing a
set of rules heuristically for detection of apnea/hypopnea event
from the decisions of the strategically combined binary SVM
classifier models with the help of features extracted from sliding
segments of SpO2 signal is the main contribution of this study.
Moreover, the online implementation of this scheme is another
important aspect of this study. The proposed scheme can also
be deployed in PDA and FPGA, which can communicate with
the hospital via GPRS/UMTS, etc.
The number of subjects used in the study was limited. Thus,
testing with a larger dataset with other classifiers and feature
selection techniques lies within the scope of future work.

[8]
[9]
[10]

[11]

[12]
[13]
[14]

[15]

[16]
[17]
[18]
[19]

[20]
[21]

[22]

REFERENCES
[1] T. Young, M. Palta, J. Dempsey, J. Skatrud, S. Weber, and S. Badr, “The
occurrence of sleep-disordered breathing among middle-aged adults,” N.
Engl. J. Med., vol. 328, pp. 1230–1235, 1993.
[2] American Academy of Sleep Medicine (AASM) Task Force, “Sleeprelated breathing disorders in adults: Recommendations for syndrome
definition and measurement techniques in clinical research,” Sleep,
vol. 22, pp. 667–689, Aug. 1999.
[3] T. Young, P. E. Peppard, and D. G. Gottlier, “Epidemiology of obstructive
sleep apnea, a population health perspective,” Amer. J.Respir. Crit. Care
Med., vol. 165, pp. 1217–1239, May 2002.
[4] A. H. Khandoker, J. Gubbi, and M. Palaniswami, “Automated scoring of
obstructive sleep apnea and hypopnea events using short-term electrocardiogram recordings,” IEEE Trans. Inf. Technol. Biomed., vol. 13, no. 6,
pp. 1057–1067, Nov. 2009.
[5] M. Bsoul, H. Minn, and L. Tamil, “Apnea MedAssist: Real-time sleep
apnea monitor using single-lead ECG,” IEEE Trans. Inf. Technol. Biomed.,
vol. 15, no. 3, pp. 416–427, May 2011.
[6] A. H. Khandoker, C. K. Karmakar, and M. Palaniswami, “Support vector
machines for automated recognition of obstructive sleep apnea syndrome
from ECG recordings,” IEEE Trans. Inf. Technol. Biomed., vol. 13, no. 1,
pp. 37–48, Jan. 2009.
[7] S. I. Rathnayake, I. A. Wood, U. R. Abeyratne, and C. Hukins, “Nonlinear features for single-channel diagnosis of sleep-disordered breathing

[23]

[24]
[25]

[26]

[27]
[28]

diseases,” IEEE Trans. Biomed. Eng., vol. 57, no. 8, pp. 1973–1981, Aug.
2010.
U. R. Abeyratne, A. S. Wakwella, and C. Hukins, “Pitch jump probability
measure for the analysis of snoring sound in apnea,” Physiol. Meas.,
vol. 26, pp. 779–798, Oct. 2005.
M. E. Tagluk, M. Akin, and N. Sezgin, “Classification of sleep apnea by
using wavelet transform and artificial neural networks,” Expt. Sys. Appl.,
vol. 37, pp. 1600–1607, Mar. 2010.
D. Alvarez, R. Hornero, J. V. Marcos, and F. Del Campo, “Multivariate
analysis of blood oxygen saturation recordings in obstructive sleep apnea
diagnosis,” IEEE Trans. Biomed. Eng., vol. 57, no. 12, pp. 2816–2824,
Dec. 2010.
T. Penzel, J. W. Kantelhardt, L. Grote, J. H. Peter, and A. Bunde, “Comparison of detrended fluctuation analysis and spectral analysis for heart
rate variability in sleep and sleep apnea,” IEEE Trans. Biomed. Eng.,
vol. 50, no. 10, pp. 1143–1151, Oct. 2003.
T. Q. Le, C. Cheng, A. Sangasoongsong, and S. T. S. Bukkapatnam, “Prediction of sleep apnea episodes from a wireless wearable multisensory
suite,” in Proc. IEEE Conf. PHT, Bengaluru, India, 2013, pp. 152–155.
N. Netzer, A. H. Eliasson, C. Netzer, and D. A. Kristo, “Overnight pulse
oximetry for sleep-disordered breathing in adults: A review,” Chest,
vol. 120, pp. 625–633, Aug. 2001.
J. Vazquez, W. H. Tsai, W. W. Flemons, A. Masuda, R. Brant, E. Hajduk,
W. A. Whitelaw, and J. E. Remmers, “Automated analysis of digital
oximetry in the diagnosis of obstructive sleep apnea,” Thorax, vol. 55,
pp. 302–307, Apr. 2000.
U. J. Magalang, J. Dmochowski, S. Veeramachaneni, A. Draw,
M. J. Mador, and A. El-Solh, “Prediction of the apnea-hypopnea index
from overnight pulse oximetry,” Chest., vol. 124, pp. 1694–1701, Nov.
2003.
C-L. Lin, C. Yeh, C-W. Yen, and W. H. Hsu, “Comparison of the indices
of oxyhemoglobin saturation by pulse oximetry in obstructive sleep apnea
hypopnea syndrome,” Chest, vol. 135, pp. 86–93, Jan. 2009.
P. Levy, J. L. Pepin, C. Deschaux-Blanc, and B. Paramelle, “Accuracy
of oximetry for detection of respiratory disturbances in sleep apnea syndrome,” Chest, vol. 109, pp. 395–399, Feb. 1996.
J. L. Pepin, P. Levy, B. Lepaulle, C. Brambilla, and C. Guilleminault,
“Does oximetry contribute to the detection of apneic events?” Chest,
vol. 109, pp. 395–399, 1996.
S. Choi, L. S. Bennett, and R. Mullins, “Which derivative from overnight
oximetry best predicts symptomatic response to nasal continuous positive
airway pressure in patients with obstructive sleep apnea?” Respir. Med.,
vol. 94, pp. 895–899, Sep. 2000.
H. Rauscher, W. Popp, and H. Zwick, “Computerized detection of respiratory events during sleep from rapid increases in oxyhemoglobin saturation,” Lung, vol. 169, pp. 335–342, Dec. 1991.
R. Hornero, D. Alvarez, F. Del Campo, C. Zamarron, and M. Lopez,
“Utility of approximate entropy from overnight pulse oximetry data in the
diagnosis of the obstructive sleep apnea syndrome,” IEEE Trans. Biomed.
Eng., vol. 54, no. 1, pp. 107–113, Jan. 2007.
J. V. Marcos, R. Hornero, D. Alvarez, F. Del Campo, and M. Aboy, “Automated detection of obstructive sleep apnoea syndrome from oxygen
saturation recordings using linear discriminant analysis,” Med. Biol. Eng.
Comput., vol. 48, pp. 895–902, Sep. 2010.
J. V. Marcos, R. Hornero, D. Alvarez, F. Del Campo, C. Zamarron, and
M. Lopez, “Utility of multilayer perceptron neural network classifiers in
the diagnosis of the obstructive sleep apnoea syndrome from nocturnal
oximetry,” Comput. Meth. Programs Biomed., vol. 72, pp. 79–89, Oct.
2008.
J. V. Marcos, R. Hornero, D. Alvarez, and M. Aboy, “Automated prediction of the apnea-hypopnea index from nocturnal oximetry recordings,”
IEEE Trans. Biomed. Eng., vol. 59, no. 1, pp. 141–149, Jan. 2012.
C. Zamarron, F. Gude, J. Barcala, J. Rodriguez, and P. V. Romero, “Utility
of oxygen saturation and heart rate spectral analysis obtained from pulse
oximetric recordings in the diagnosis of sleep apnea syndrome,” Chest,
vol. 123, no. 5, pp. 1567–1576, May 2003.
D. Alvarez, R. Hornero, D. Ab´asolo, F. Campo, and C. Zamarr´on, “Nonlinear characteristics of blood oxygen saturation from nocturnal oximetry for
obstructive sleep apnoea detection,” Physiol. Meas., vol. 27, pp. 399–412,
Apr. 2006.
A. Burgos, A. Goni, A. Illarramendi, and J. Bermudez, “Real-Time detection of apneas on a PDA,” IEEE Trans. Inf. Technol. Biomed., vol. 14,
no. 4, pp. 995–1002, Jul. 2010.
B. Xie and H. Minn, “Real-time sleep apnea detection by classifier combination,” IEEE Trans. Inf. Technol. Biomed., vol. 16, no. 3, pp. 469–477,
May 2012.

KOLEY AND DEY: ON-LINE DETECTION OF APNEA/HYPOPNEA EVENTS USING SpO2 SIGNAL

[29] C. Iber, S. Ancoli-Israel, A. L. Chesson, Jr., and S. F. Quan, The AASM
manual for the Scoring of Sleep and Associated Events: Rules, Terminology and Technical Specifications, American Academy of Sleep Medicine,
Westchester, PA, USA, 2007.
[30] D. A. Estevez and V. M. Bonillo, “Fuzzy reasoning used to detect apneic
events in the sleep apnea-hypopnea syndrome,” Expt. Sys. Appl., vol. 36,
no. 4, pp. 7778–7785, May. 2009.
[31] C. M. Bishop, Neural Networks for Pattern Recognition. NewYork, NY,
USA: Oxford Univ. Press, 1995.
[32] I. Guyon, M. Nikravesh, and S. Gunn, Feature Extraction: Foundations
and Applications. New York, NY, USA: Springer-Verlag, 2006.
[33] A. H. Khandoker, C. K. Karmakar, and M. Palaniswami, “Automated
recognition of patients with obstructive sleep apnoea using wavelet-based
features of electrocardiograms recordings,” Comput. Biol. Med., vol. 39,
pp. 88–96, Jan. 2009.
[34] H. M. Al-Angari and A. V. Sahakian, “Automated recognition of obstructive sleep apnea syndrome using support vector machine classifiers,” IEEE
Trans. Inf. Technol. Biomed., vol. 16, no. 3, pp. 463–468, May 2012.
[35] Y. Bazi and F. Melgani, “Toward an optimal SVM classification system
for hyperspectral remote sensing images,” IEEE Trans. Geosci. Remote
Sens., vol. 44, no. 11, pp. 3374–3385, Nov. 2006.
[36] M. Stone, “Cross-validatory choice and assessment of statistical predictions,” J. Roy. Statis. Soc., series B, vol. 36, no. 1, pp. 111–147, 1974.
[37] C. C. C. Pang, A. R. M. Upton, G. Shine, and M. V. Kamath, “A comparison of algorithms for detection of spikes in the electroencephalogram,”
IEEE Trans. Biomed. Eng., vol. 50, no. 4, pp. 521–526, Apr. 2003.
[38] J. M. Bland and D. G. Altman, “Statistical methods for assessing agreement between two methods of clinical measurement,” Lancet, vol. 1,
pp. 307–310, Feb. 1986.
[39] H. Nakano, T. Tanigawa, T. Furukawa, and S. Nishima, “Automatic detection of sleep-disordered breathing from a single-channel airflow record,”
Eur. Respir. J., vol. 29, pp. 728–736, Apr. 2007.
[40] Y. K. Lee, M. Bister, P. Blanchfield, and Y. M. Salleh, “Automated detection of obstructive apnea and hypopnea events from oxygen saturation
signal,” in Proc. 26th Annu. Int. Conf. IEEE EMBS, San Francisco, CA,
USA, 2004, vol. 1, pp. 321–324.

239

[41] B. Koley and D. Dey, “Automated detection of apnea and hypopnea
events,” in Proc. 3rd Int. Conf. Emerg. Appl. Inf. Technol., Kolkata, India,
2012, pp. 85–88.
[42] B. Koley and D. Dey, “Selection of features for detection of obstructive
sleep apnea events,” in Proc. IEEE Conf. INDICON, Kochi, India, 2012,
pp. 991–996.

Bijoy Laxmi Koley (M’11) received the B.E. and
M.Tech. degrees from National Institute of Technology, Rourkela, India and Devi Ahilya Vishwavidyalaya, Indore, India, in 2000 and 2002,
respectively.
She is currentlya faculty member in the Department of Applied Electronics and Instrumentation Engineering., Dr. B. C. Roy Engineering College, Durgapur, India. Her research interest includes biomedical signal processing and its application in clinical
and health informatics.

Debangshu Dey (M’09) received the B.E.E, M.E.E.
and the Ph.D. degrees from Jadavpur University,
Kolkata, India, in 2003, 2005, and 2009, respectively.
He is currently afaculty member in the Department
of Electrical Engineering, Jadavpur University. His
research interests include condition monitoring, intelligent instrumentation and measurements, and applications of signal processing tools.

