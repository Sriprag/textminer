IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 12, DECEMBER 2015

2867

Improving Cardiac Phase Extraction in IVUS Studies
by Integration of Gating Methods
Gonzalo D. Maso Talou∗ , Ignacio Larrabide, Pablo J. Blanco, Cristiano Guedes Bezerra, Pedro A. Lemos,
and Raúl A. Feijóo

Abstract— Goal: Coronary intravascular ultrasound (IVUS) is a
fundamental imaging technique for atherosclerotic plaque assessment. However, volume-based data retrieved from IVUS studies
can be misleading due to the artifacts generated by the cardiac
motion, hindering diagnostic, and visualization of the vessel condition. Then, we propose an image-based gating method that improves the performance of the preexisting methods, delivering a
gating in an appropriate time for clinical practice. Methods: We
propose a fully automatic method to synergically integrate motion signals from different gating methods to improve the cardiac
phase estimation. Additionally, we present a local extrema identification method that provides a more accurate extraction of a cardiac
phase and, also, a scheme for multiple phase extraction mandatory
for elastography-type studies. Results: A comparison with three
state-of-the-art methods is performed over 61 in-vivo IVUS studies including a wide range of physiological situations. The results
show that the proposed strategy offers: 1) a more accurate cardiac
phase extraction; 2) a lower frame oversampling and/or omission
in the extracted phase data (error of 1.492 ± 0.977 heartbeats
per study, mean ± SD); 3) a more accurate and robust heartbeat
period detection with a Bland–Altman coefficient of reproducibility (RPC) of 0.23 s, while the second closest method presents an
RPC of 0.36 s. Significance: The integration of motion signals
performed by our method shown an improvement of the gating
accuracy and reliability.
Index Terms—Gating, intravascular ultrasound (IVUS), motion
compensation and analysis, ultrasound.

I. INTRODUCTION
NTRAVASCULAR ultrasound (IVUS) is a widely used
imaging technique that allows a detailed description of the
vessel cross section and surrounding tissues, playing a key role
in atherosclerotic plaque assessment [1]. In the case of coronary IVUS, the periodic contractions of the heart impose large

I

Manuscript received March 12, 2015; revised May 25, 2015; accepted June
20, 2015. Date of publication June 24, 2015; date of current version November
20, 2015. This work was partially supported by the Brazilian agencies CNPq,
FAPERJ, and CAPES. Asterisk indicates corresponding author.
∗ G. D. M. Talou is with the National Laboratory for Scientific Computing
(LNCC) and the National Institute of Science and Technology in Medicine
Assisted by Scientific Computing (INCT/MACC), Petrópolis, RJ 25651-075,
Brazil (e-mail: gonzalot@lncc.br).
I. Larrabide is with the National Scientific and Technical Research Council
(CONICET-Pladema), UNICEN.
P. J. Blanco and R. A. Feijóo are with the National Laboratory for Scientific
Computing (LNCC) and the National Institute of Science and Technology in
Medicine Assisted by Scientific Computing (INCT/MACC).
C. G. Bezerra and P. A. Lemos are with the Department of Interventional
Cardiology, Heart Institute (InCor), and the University of São Paulo Medical
School.
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2015.2449232

displacements of the vessel structures and the acquisition probe.
The estimation of volumetric measurements and axial position
of structures can be misleading due to this motion [2]. Consequently, nonhomogeneous displacements and rotations are observed along the axial and longitudinal directions of the vessel
[3]. Since the typical IVUS study acquisition time is approximately 2 min, it spans along many cardiac cycles, and thus,
the pseudoperiodic motion imposed by the heartbeat is clearly
distinguishable throughout the entire study. To deal with the motion, the heartbeat is usually divided into different cardiac phases
or instants. Along the study, a repeating motion pattern is observed, which suggests a relation between each cardiac phase
and the motion exerted to the structures. Several approaches
explore this aspect by sampling images of a particular cardiac
phase during (online) or after (offline) the IVUS acquisition [2],
[4]–[15]. From these methods, a severe reduction of motion is
expected, so that specific configurations of the vessel structures
in a particular state of the heart can be identified.
Online ECG-gated techniques [16] use the ECG signal to acquire images of one particular cardiac phase. This procedure
increases the acquisition time up to three times in comparison
with the standard IVUS study [17]. Furthermore, it only presents
information of one cardiac phase, neglecting all the others, forbidding studies such as palpographies or 4-D reconstructions.
Online gated ECG aims at acquiring end diastolic phase images,
which presents the lowest motion artifacts. However, this is difficult to achieve [2], [10]. Since the acquisition is gated in terms
of R-peak offsets and due to the heart rate variability, ensuring
a consistent cardiac phase acquisition is a challenging task.
To overcome these obstacles, an offline ECG gating can be
performed on top of a standard IVUS study. However, the necessary equipment for this technique is not always available and,
furthermore, cannot be applied retrospectively on already acquired data.
In the last decade, image-based techniques for offline gating
IVUS studies have been developed [4]–[15]. As these are independent of ECG data, they can be used at a lower cost and
on already available data. As proposed in [15], these methods
usually present three steps for the gating process: 1) generation
of a signal that measures the cardiac motion in each frame; 2)
filtering and extraction of the local extrema values from the motion signal; and 3) offline gating of the study in cardiac phases.
The first stage creates a signal describing the motion between
neighboring frames mentioned above. In the second step, local
extrema related to a specific cardiac phase are extracted to obtain a partition of the study into cardiac cycles. Finally, each
cycle is divided in cardiac phases that are used to retrieve images corresponding to a specific cardiac phase along the whole

0018-9294 © 2015 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

2868

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 12, DECEMBER 2015

study. The main differences among these methods resides in the
methodological strategies involved in the first two steps.
For the first step, the signal generation can be performed by
analyzing the lumen morphological variations [6], [7] or the
image intensity features [4], [5], [8]–[15]. The methods in the
former category require the segmentation of the luminal area,
which is still an open research topic, and some approximations
are time consuming [6]. Also, luminal topological variations,
such as bifurcations, induce spurious extremal values in the
motion signal.
For methods in the latter category, a set of features are
used to measure the variations between adjacent images: crosscorrelation [5], [9], [10], [12], sum of squared distances (SSD)
[14], local mean variation [4], [11], [12], [15], Gabor filters’
descriptors [8] or radial blurring [13]. It is worth noting that
the blurring feature measures the motion by perturbations over
the transducer probe being not sensitive to topological variations, while features like cross-correlation or SSD measure by
differences between adjacent frames. Then, these features are
potentially complementary to assess the motion in each frame.
The second stage frequently involves the application of a
bandpass filter centered in a fundamental frequency associated
with the mean cardiac frequency along the study. This strategy
neglects the high-order frequencies of the motion signal, which
might misalign local extrema.
In the present work, we propose an automatic gating method
for synergical combination of image features. Also, a novel
method for phase extraction is presented using an iterative signal reconstruction scheme. Specifically, the proposed method,
hereafter referred to combined correlation and blurring (CCB),
is based on: 1) the definition of a combined motion signal that
integrates the signals presented in [10] and [13] giving less
sensitivity to topological variations and a more accurate cardiac phase extraction; 2) a scheme for the identification of local
extrema in the motion signal based on the progressive incorporation of harmonic components, which increasingly refines the
position of extremal values; and 3) a physiological criteria for
the extraction of multiple phases. The method validation is conducted using 61 in-vivo IVUS studies from 21 patients including
a wide range of functional and physiological situations (different
degrees of stenoses, stent deployments, and mild arrhythmias)
through different coronary arteries.
This paper is organized as follows. In Section II, we present
a detailed description of each step involved in the proposed
methodology and the parameter setup to ensure the automation
of the method. In Section III, we present the validation of the
method and a comparison with the state-of-the-art methods for
image-based gating. Finally, Section IV presents the conclusions
of this work.

produced by the microstructures of the tissue [18] arises as a
coherent pattern that varies through the different material composition in the vessel wall. For this reason, the noise variations
that increment s(n) are associated to movements or topological
changes of the structures present in the images.
The signal s(n) is chosen to be a linear combination of M
image features, si (n), i = 0, . . . , M − 1, characterizing the motion in an image. Then, the function s(n) is defined as
s(n) =

M
−1


wi si (n)

where w ∈ (0, 1) is the weight factor of the feature si and
M −1 i
i=0 wi = 1.
In this study, we choose two features similar to those presented in [10] and [13], respectively. The first feature, ŝ0 (n), is
an inverse correlation between two consecutive images, that is
H W
i=1
j =1 (un (i, j) − μn ) (un +1 (i, j) − μn +1 )
ŝ0 (n) = 1−
σn σn +1
(2)
where un (i, j) is the intensity at the ith row and jth column,
μn and σn are mean and standard deviation of the intensity for
the nth frame, and H and W are the frame height and width,
respectively. The choice of this feature is justified because the
absence of movement is associated with two almost identical
images, leading to an s0 (n) ≈ 0. When the motion between
the frames increases, the matching of structures decreases leading to smaller correlation, although the feature also increases
in motionless scenarios such as topological changes (e.g., bifurcations) or the appearance of new structures (e.g., stents or
calcium deposits). To improve the treatment of these scenarios,
we use another feature for motion assessment, insensitive to differences between adjacent frames. This second feature, called
ŝ1 (n), measures the blurring in the image
ŝ1 (n) = −

H 
W


|∇un (i, j)|

A. Integration of Motion Signals
Let us define the motion signal as a function s(n) that measures the motion of the nth image of the study. Then, s(n)
increases if the structures in the vessel change their distribution
by translation, deformation or rotation with respect to the preceding/succeeding images. Besides, the image noise (speckle)

(3)

i=1 j =1

which exploits the fact that the transducer movement provokes
a blurring effect at the borders of the structures.
To adequately combine the image features used to generate
s(n), we normalize their ranges as
s+ (n)
si (n) = N i +
n =1 si (n)

(4)

s+
i (n) = ŝi (n) − min (ŝi (n))

(5)

where
1≤n ≤N

II. METHODOLOGY

(1)

i=0

and N is the number of images in the IVUS study. This last step
ensures that all si are positive and of the same magnitude order.
For the particular case of using two image features, the weighing
factors can be reduced to only one parameter, α, defined as
w0 = α and w1 = 1 − α; thus
s(n) = αs0 (n) + (1 − α)s1 (n).

(6)

MASO TALOU et al.: IMPROVING CARDIAC PHASE EXTRACTION IN IVUS STUDIES BY INTEGRATION OF GATING METHODS

2869

Fig. 2. Motion signal in the frequency domain. Red lines depict the range of
physiologically valid heart frequencies.

Fig. 1. Partial longitudinal view (first 150 frames) of an IVUS study presenting
the motion signal s(n) and the associated features, s0 (n) and s1 (n), using
α = 0.25. Also, the P-wave occurrence from the synchronized ECG is marked.

frequency along the study (see Section III-E). The use of fm
as cut frequency for a low-pass filter over s(n) yields a filtered
signal that preserves an approximate amount of heartbeats in the
study. Therefore, the automatic detection of fm is performed by
extracting the maximum frequency component of s(n) in the
physiological range, i.e.,
fm =

The image features and the integrated signal are presented in
Fig. 1 for an in-vivo study. It is observed that several consecutive
columns present a similar intensity pattern around the points
of minima, which means the transducer is acquiring a set of
almost identical frames. A pseudoperiodic pattern with equally
separated minima is observed for s(n). These minima are also
present in the individual features and are equally displaced to the
end diastolic phase (P-wave, marked with green-dashed vertical
lines) in each heartbeat. Therefore, we can infer a direct relation
between these minima and a specific cardiac phase in the study.
B. Cardiac Phase Identification
Next goal is to detect the set of pseudoperiodic minima related to the specific cardiac phase previously described. As seen
in Fig. 1, s(n) presents many local minima in each heartbeat
making nontrivial the automatic gating of this cardiac phase. But
taking advantage of the s(n) pseudoperiodicity, the frequency
spectrum of s(n) is analyzed and a low-frequency version of
s(n) is created, eliminating spurious minima. To maintain the
direct relation between the remaining minima and the physiological cardiac phases, the filtered low-frequency signal must
include a minimum amount of frequencies such that the original
pulsation pattern is preserved. Otherwise, the lack of high-order
frequencies can lead to a poor representation of the pseudoperiodicity of the signal local minima.
The frequency spectrum of the signal, s̃(k), is computed as
the discrete Fourier transform of s(n). In Fig. 2, the absolute
value of the frequency spectrum s̃(k) from an in-vivo IVUS
study is presented. There, a local maximum frequency fm in
the range of physiologically valid heart frequencies is observed
(0.75–1.66 Hz or, equivalently, 45–100 beats/min). As will be
shown later, fm is a close approximation of the mean cardiac

max

k ∈[0.75,1.66]

(s̃(k))

(7)

where the physiological range is defined between 0.75 and
1.66 Hz.
To consider the pseudoperiodicity of the signal, we introduce
a factor, δ fm , δ ∈ (0, 1), which models the deviation of the
heartbeat frequency along the study. Then, the cut frequency for
the low-pass filter is defined as
fc = (1 + δ)fm .

(8)

The low-frequency signal, slow (n), is constructed as the convolution of s(n) against a low-pass kernel f (n), namely
slow (n) = s(n) ∗ f (n)

(9)

where ∗ is the convolution operator. In turn, the low-pass kernel
is defined as
f (n) = w(n) · h(n)

(10)

where w(n) is the equivalent of a rectangular unitary window for
the frequencies k ∈ [0, fc ] and h(n) is a Hamming window of N
points. The approximations involved with the Fourier discrete
transform are avoided by applying this kernel in the time domain.
Thus, the expression of f (n) is given by

 

	 n 

fc n
fc
τ − ν cos 2π
(11)
sinc
f (n) =
fm ax
fm ax
N
where fm ax if the maximum frequency in the study calculated
as half of the transducer frame rate. In the equiripple sense,
optimal values for the Hamming window are chosen as τ = 25
46
and ν = 21
46 (see [19] and [20]).
The resulting signal slow (n) presents approximately one minimum for each heartbeat, which provides a first approximation
for the local minima positions p(i), at the ith heartbeat. Using

2870

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 12, DECEMBER 2015

C. Decomposition in Cardiac Phases

Fig. 3. Activity diagram detailing the iterative adjustment of p(i) from the
initial signal slow (n) to s(n).

The identification of the images corresponding to the detected
cardiac phase, i.e., the ones acquired at the p(i) instants, allows
the decomposition of the study in sets of images associated with
each heartbeat. This is done by grouping the images between
p(i) and p(i + 1) as the set of images acquired in the ith heartbeat. In this manner, the number of sets found is equivalent to
the number of heartbeats identified in the IVUS study.
Over these new sets of images, we define HB(i, j) as the
index (frame number) in the original IVUS study of the jth
image corresponding to the ith heartbeat in the study. In this
indexation HB(i, 1) represents the images at the first identified
cardiac phase (i.e., the frames acquired at p(i)).
Since the heart frequency changes along the study, the heartbeats are sampled with a variable amount of frames. This variability in the heartbeat affects mainly the time of the diastole
(more specifically the T-P interval), i.e., the heart relaxes during
a major or minor period of time. Although, the cardiac waves
duration associated with the cardiac phases show almost no
change at all. As consequence, longer heartbeats present more
cardiac phases than a short heartbeat.
Then, P cardiac phases for the ith heartbeat are identified as
the first P frames. The value of P is chosen as the amount of
frames of the shortest heartbeat in the study. The reason behind
this choice was to preserve axial spacing as homogeneous as
possible between images from different cardiac phases. This
guarantees that each phase is represented by the same amount
of information.
Finally, the set of images U k (i) corresponding to the kth
cardiac phase is defined as
U k (i) = I(HB(i, k)),

Fig. 4. Evolution of the iterative scheme for adjusting the minima position.
The axis fc corresponds to the cut frequency of the low-pass filter, and at each
fixed value of this axis, the slow (n) associated signal is presented. The red dots
mark the position of the adjusted minima, p(i), corresponding to the identified
cardiac phase.

this initialization, the iterative scheme presented in Fig. 3 is
applied. At each step, all frequencies up to the next harmonic
component are incorporated in the definition of slow (n) and
p(i) is adjusted to the nearest local minimum. Note that the
adjusted value of p(i) is not necessarily the ith minimum of
slow (n) because addition of higher frequencies may induce the
apparition of additional minima. This process is repeated until
slow (n) incorporates all harmonic components of fm , obtaining
the adjusted minimum for each heartbeat.
In Fig. 4, the evolution of slow (n) through the incorporation
of frequencies is observed along the fc axis. It can be seen
that the initialization of the minima in slow (n) can be displaced
from the pseudoperiodic minima of s(n) due to the absence of
high-frequency contributions. As we incorporate harmonic components of s(n) progressively, the minima is adjusted smoothly
(red points path in the fc axial direction) to the associated minima position at the signal s(n). This increases the precision of
the p(i) locations, for the cardiac phase detection.

i = 1, . . . , B, k = 1, . . . , P

(12)

where I(n) is the nth image of the IVUS study and B is the
quantity of heartbeats along the study.
D. Parameter Setup
An analysis for the parameters α and δ [(6) and (8), respectively] is performed to ensure an appropriate and automatic
execution of the method.
1) Parameter α: IVUS studies present small variations in
the cardiac period during acquisition for patients without severe cardiac arrhythmia. For this reason, the criterion used to
choose the optimal α is to reduce the heartbeat period variability detected with the gating method (see Section III-H for
associated implications). This is simply done by minimizing
the standard deviation of the set of values p(i + 1) − p(i) for
i = 1, . . . , B − 1.
In this manner, an optimization problem is solved to determine the optimal α parameter that efficiently combines the features s0 and s1 for an specific IVUS study. This minimization
process is performed by testing a large number of candidates,
say αc , c ∈ C being C the set of candidates, and then picking
the best fitting one for the aforementioned criteria. Combining
s0 and s1 with a particular α and computing the adjusted minima p(i) are computationally cheap tasks; then, we can apply a
brute force minimization scheme with low computational cost.

MASO TALOU et al.: IMPROVING CARDIAC PHASE EXTRACTION IN IVUS STUDIES BY INTEGRATION OF GATING METHODS

2871

c
To formalize this, let us define tαHB
(i) = p(i + 1) − p(i) as
the period of the ith heartbeat from the signal s(n) calculated
c
(i)
with αc and σtα c as the standard deviation of the periods tαHB
for the entire study; then, the optimal α is obtained as

α = arg min σtα c .
α c ∈C

(13)

To determine an appropriate quantity of αc values used in
the calculus of α, we evaluate the variation of the minimum
σtα c from (13) for different sizes of C. We define C as a set of
equally spaced candidates C = {αci ; αci = i/A, i = 0, . . . , A},
where A is the quantity of αc candidates to be tested in (13).
For the set of studies available (61 studies), a suitable size of
C was given by A = 103 , for which the error of estimating σtα c
was smaller than 10−3 s.
The α value from (13) varies among studies due to their vessel
topology and intensity of sensor motion. As commented before,
s0 does not accurately represent motion for studies with numerous topological changes (bifurcations, dissections, etc.); then, a
lower α is expected for these cases. On the other hand, studies
with poor blurring (usually associated with low sensor motion
during acquisition) will produce a unreliable s1 , increasing the
value of α.
This setup is straightforwardly generalized for the integration of K motion signals by performing the same optimization
scheme over the K-dimensional space defined by the weight factors w = w1 , w2 , . . . , wK [see (1)]. The optimal weights factors
of the features are obtained as
w = arg min σtw
w ∈C w

(14)

where Cw = Cw 1 × Cw 2 × · · · × Cw K and Cw i is the set of
candidates for the weight factor wi .
2) Parameter δ: The range δ ∈ (0, 1) guarantees no harmonic contributions in each low-pass filter iteration. This ensures that the signal s(n) contains only one minima at each
heartbeat. Meanwhile, the variability in the heartbeat frequency
can mislead the detection of the heartbeats for values of δ near
the range limits.
For the lower limit, when δ is close to 0, the heartbeats with
frequency above fm are not recovered in slow (n). For the superior limit, when δ is close to 1, we are recovering in slow (n) a
harmonic contribution for the heartbeats with frequency below
fm . As a result, we would be generating two local minima for
the heartbeats with duration above the mean heartbeat duration.
Both cases are unacceptable because they introduce inaccuracies to the initialization of our minima adjustment scheme (see
Fig. 3).
For these reasons, intermediate values render better results.
Concretely, a good agreement was empirically obtained for δ =
0.4, which presented neither omission nor addition of minima
in comparison with the data retrieved from the ECG signal.
Theoretically, this value is also valid given that variability in the
heartbeat frequency above 40% of the mean is not usually seen
in patients without severe cardiac arrhythmia.
III. RESULTS
The proposed method was validated using IVUS images with
a synchronized ECG signal. A manual offline ECG gating was

Fig. 5. ECG signal depicting the specialist red marks at R-wave peak instants.
The marks are then associated with the frames acquired at these instants according with the IVUS DICOM header. This example shows 5 s of the ECG
signal synchronously acquired during the IVUS pullback by the iLab Ultrasound
Imaging System.

chosen as ground truth for comparison, where a specialist determine the frames at the R-wave peak by inspection of the ECG
signal. Moreover, other state-of-the-art methods described in the
literature were implemented for comparison, namely absolute
intensity difference (AID) [4], correlation dissimilarity matrix
(CDM) [10], and motion blur (MB) [13]. It is worth noting
that the image feature combined by our method is presented in
CDM and MB. A direct comparison between the three methods
is useful to assess the improvement introduced by our proposal.
A. Acquisition of In-Vivo IVUS Studies
The IVUS studies were acquired with the Atlantis SR Pro
Imaging Catheter 40 MHz synchronized with an ECG signal
and connected to an iLab Ultrasound Imaging System (both
by Boston Scientific Corporation, Natick, MA, USA), at the
Heart Institute (InCor), University of São Paulo Medical School
and Sı́rio-Libanês Hospital, São Paulo, Brazil. The acquisition
frame rate was of 30 frames/s performing for each frame 256
radial scans with 256 intensity measurements. The generated
frames of 512 × 512 pixels in Cartesian coordinates present a
resolution of 17.5 μm × 17.5 μm per pixel.
The procedure was performed during a diagnostic or therapeutic percutaneous coronary procedure. Vessels were imaged during automated pullback at 0.5 mm/s, but additional
manual runs, not used in the subsequent analysis, were performed. Overall, multiple runs where performed on 21 patients
leading to 61 IVUS studies with synchronized ECG signal.
The IVUS sequence length reported in these studies comprises
2974.8 ± 1133.8 frames (mean ± SD). Images from different
coronary arteries (left anterior descending, 31 studies; right
coronary artery, eight studies; left circumflex artery, 12 studies; and obtuse marginals and diagonals, ten studies) at different
mean cardiac frequencies (from 65 to almost 105 beats/min) including cases with severe stenosis, stent deployment, and mild
arrhythmia (presence of ≤ 5 extrasystole in nine studies) were
analyzed.
After the procedure, a manual offline ECG gating was performed for each study. Specifically, a specialist marks, as shown
in Fig. 5, the elapsed time at each R-wave peak over the ECG
signal of each study. Using that information, the period of each
cardiac cycle in the studies is calculated. As the IVUS study is

2872

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 12, DECEMBER 2015

TABLE I
INTRAOBSERVER VARIABILITY FROM THREE SEGMENTATIONS (S 1 , S 2 , AND S 3 ) PER SPECIALIST (O 1 , O 2 , AND O 3 )
S 1 versus S 2

O1
O2
O3

LA (in frames)
−0.0130 ± 0.2351
−0.0081 ± 0.2647
0.0033 ± 0.3521

S 1 versus S 3
%C V
0.012
0.014
0.019

LA (in frames)
−0.0098 ± 0.2553
0.0016 ± 0.2457
0.0163 ± 0.3471

S 2 versus S 3
%C V
0.014
0.013
0.018

LA (in frames)
0.0033 ± 0.2285
0.0098 ± 0.2210
0.0130 ± 0.3425

%C V
0.012
0.012
0.018

Bland–Altman limits of agreement (LA) and coefficient of variations (% C V ) are presented for each comparison.

TABLE II
INTEROBSERVER VARIABILITY FROM MEAN VALUES OF THE THREE
INTRAOBSERVER SEGMENTATIONS

O 1 versus O 2
O 1 versus O 3
O 2 versus O 3

LA

%C V

−0.0141 ± 0.1196 frames
−0.0038 ± 0.1729 frames
0.0103 ± 0.1737 frames

0.006
0.009
0.009

Bland–Altman limits of agreement (LA) and coefficient of
variations (% C V ) are presented for each comparison.

synchronized with the ECG signal, the R-wave peak frames are
identified and the gating of this phase is used as ground truth. As
the time between the beginning P-wave and the R-wave peak
rarely varies, it is reasonable to infer the period between the
steady phase as the period between the R-wave peaks.
Manual R-wave peak segmentation reliability was estimated
by calculating intra- and interobserver variability in terms of the
Bland–Altman limits of agreement (LA) and the coefficient of
variability (%CV ). Thus, three specialists segment three times
five studies (with 77, 112, 130, 130, and 165 R-wave peaks giving N = 614 samples). For intraobserver variability, we compare among the repeated segmentations of a fixed specialist to
observer the degree of variation. The results are presented in
Table I where it is seen that variations within each specialist
are less than one frame (maximum variation of 0.3634 frames
for the specialist 3 between segmentations 1 and 3), showing
negligible variability in the segmentation process. Interobserver
variability was addressed by estimating the mean observation,
Oi , corresponding to the ith specialist. The values of Oi are
simply the mean values of each R-wave peak time from the
three repeated segmentations of the ith specialist. This step attenuates the intraobserver variability in order to deliver a more
reliable interobserver analysis. The results presented in Table II
suggest even lower variability than intraobserver analysis (worst
case present a discrepancy of 0.184 frames between specialists 2
and 3), indicating a high level of agreement between specialists
about this ground truth.
B. Features Correlation
The main purpose of constructing a combined signal from
two image features is to increase the robustness of the heart
motion estimation. Thus, we seek for features uncorrelated that
at the same time present a close motion pattern associated with
the heartbeat. As the features present a low correlation, their
combination presents minimal redundancy, implying that the
motion is characterized in different manners by each feature.

In that manner, we analyze the correlation between the features s0 and s1 , by computing the Pearson’s linear correlation between them. As result, we obtain a mean correlation of
−0.164 ± 0.266 (mean ± SD), presenting scarce redundancy of
information. Meanwhile, both features present a similar motion
frequency, characterized by fm from (7), showing a shallow
absolute difference of 0.0146 ± 0.0263 heartbeats per second
(mean ± SD) along the studies. The resemblance in fm allow
us to infer that both feature reproduce a closer pseudoperiodic
pattern associated with the transducer motion.
C. Error Measurements
The proposed image-based gating method was assessed using
two quality measures. For the sake of simplicity, we introduce
some definitions first. Let us generalize the definition of p(i)
as the time at which a particular cardiac event occurs at the ith
heartbeat of the study, e.g., the R-wave peak in the ECG signal
(pECG (i)) or the minima in an image-based method (pIB (i)).
From p(i) then, we can derive tHB (i) and pm (i), the heartbeat
period, and the middle time instant of the ith heartbeat of the
study, as
tHB (i) = p(i + 1) − p(i)
pm (i) =

tHB (i)
+ p(i).
2

The mean error per heartbeat εHBP measures the mean period
difference between the image-based and the offline ECG gating
method. For each heartbeat, its period, obtained from the imagebased gating, is compared with the nearest period from the ECG
gating as


M 
 
 IB
ECG
ECG
tIB



p
(i)−t
(i)−
p
(j)
min
HB
m
m

i=1  HB
j
εHBP =
M
(15)
where M is the quantity of cardiac events detected by the imagegating method and (·)IB and (·)ECG are quantities associated
with the image-based gating method and the offline ECG gating
method, respectively. Using this error measurement, the omission or erroneous detection of the p(i) event does not affect
the error estimation in the next cardiac cycles. Notice that the
quantity of heartbeats in a study according to the gating method
is equal to M − 1.
The phase detection error εPD measures the difference
between the R-wave peak detected by the image-based and
the ECG gating methods. As previously mentioned, the time
elapsed between the P-wave and the R-wave peak rarely varies

MASO TALOU et al.: IMPROVING CARDIAC PHASE EXTRACTION IN IVUS STUDIES BY INTEGRATION OF GATING METHODS

Fig. 6. Error εH B P at each study for the different gating methods. The dashed
lines represents a linear fitting (via linear least-squares) that describes the error
behavior for each method.

(independently of the heartbeat frequency variations); then, we
can identify the R-wave peak frames in the image-based gating
by displacing all P-wave frames with the same offset. As we
want to retrieve the most similar phase to the R-wave peak, we
calculate this offset as the mean distance between pIB (i) events
to the pECG , given by



M 

 IB
ECG
ECG
IB


p
min pm (i) − pm (j) − p (i)
i=1
j
.
μPD =
M
(16)
Thus, we calculate the error at each heartbeat as the distance
between the pECG instant and the pIB displaced by μPD , namely



 IB
IB
ECG
ECG


εPD (i) = p (i) + μPD − p
min pm (i) − pm (j)
j

(17)
with i = 1, . . . , M .
D. Method Performance
The performance of the CCB method was evaluated through
comparisons with the following methods: AID, CDM, and MB.
The comparison of our method against [10] and [13] shows
the improvement obtained by the integration of both motion
signals and, also, from the proposed cardiac phase identification
strategy.
In the first comparison, the capability of the different methods for predicting the cardiac cycles periods is compared. The
heartbeat periods estimated via the ECG offline method were
used as ground truth. In Fig. 6, the error εHBP for the four methods is shown. The CCB method presents the best behavior as
indicated by the linear fitting in the same figure, followed by
the AID method. The variability of the error is also smaller for
the CCB method and increases of the cardiac frequency barely
increment its error.

2873

An additional comparison between the image-based methods
and the ECG offline gating method is featured in Fig. 7. In
this case, we present the heartbeat period estimation for each
heartbeat in every study (61 studies). The Bland–Altman coefficient of reproducibility (RPC= 1.96 × SD) is the smallest for CCB, RPC(%) = 0.23 s (26%), followed by AID with
RPC(%) = 0.36 s (41%). This implies that the CCB method is
the closest one to the manual offline ECG gating. The proposed
method also presents a more robust estimation of the heartbeat
period evidenced by the reduced dispersion and range of samples in the y-axis (see Fig. 7).
Using the acquisition time of frames at R-wave peak according to the manual offline ECG gating, we evaluate the performance of the methods. Since the R-wave peak is the only cardiac
phase that we can extract precisely from the ECG, this is the
only indicator where the success in recognizing a specific cardiac phase can be measured. For this reason, the εPD error is
a trustful indicator of success when using pECG as the R-wave
peaks. As the mean of this error is zero by construction, we
are interested in its standard deviation along each study, which
shows differences between the gated phase and the ground truth.
The value of this indicator is presented in Fig. 8 where the mean
and maximum standard deviation for the 61 studies using each
of the four methods are shown. The CCB method presents the
most accurate results, with mean SD of εPD being 0.165, 0.251,
0.282 and 0.475 for the CCB, AID, CDM, and MB methods,
respectively.
From the analysis of these results, it is seen that MB presents
outliers exceeding 0.8 s (see Fig. 6) caused by the omission
of several frames associated with the steadiest phase. In these
studies, the transducer motion is too low to produce the blurring
effect, at least not along the full study. Then, the motion signal
poorly represents the cardiac pulsatility and does not present the
characteristic quasiperiodic pattern (the frames extracted do not
represent any specific phase; see Fig. 8). CCB circumvents this
issue by the adjustment of α performed in (13). As s1 shows
high variation of heartbeat periods, α is adjusted to values closer
to 1 giving major weight to s0 data (which resembles the signal
used in AID).
In another analysis, we compare the number of heartbeats
estimated by each method against the ground truth. Here, it is
evident that the methods using band pass filter around the mean
cardiac frequency (i.e., CCB and AID) delivered better results
(see Table III). This is given by the low heartbeat frequency variation within a study. As extra systoles may occur in a study from
time to time, the cardiac frequency remains almost invariant and
the use of this information is fundamental to provide robustness
to the method. Methods like CDM and MB do not assume
low variation of the cardiac frequency, making them potentially
capable of detecting any kind of cardiac variations, although
these methods would also be capable of detecting extremely
shorts heartbeats (most of the times physiologically meaningless) which would yield an incoherent phase gating. Particularly,
the CCB method presents a better performance compared to the
other methods (even against AID) diminishing the number of
frames omitted or oversampled for the extracted cardiac phase.
For the CCB, less than 6 beats per study are missed or overestimated presenting a mean error of 1.492 ± 0.977 heartbeats

2874

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 12, DECEMBER 2015

Fig. 7. Bland–Altman plots comparing the heartbeat periods measured by the offline ECG method (assumed as ground truth) and (a) the CCB method presenting
RPC(%)= 0.23 s (26%); (b) the AID method presenting RPC(%)= 0.36 s (41%); (c) the CDM method presenting RPC(%)= 0.67 s (90%); (d) the MB method
presenting RPC(%)= 1.4 s (170%). Each sample represents one heartbeat period in one of the studies. The color indicates the amount of samples overlapped in
the same position of the diagram, horizontal solid line stands for the mean difference and dashed line depict the limits of agreement (1.96× standard deviation of
the differences). Plots (a)–(d) contain, respectively, 6802, 6614, 10 077, and 7651 samples corresponding to 61 studies.

TABLE III
NUMBER OF HEARTBEATS (FRAMES IN THE LONGITUDINAL VIEW) DETECTED
BY EACH GATING METHOD
Id
Mean error
SD error
Maximum error

CCB
1.492
0.977
6

AID
4.246
3.567
22

CDM
52.984
48.028
219

MB
24.623
19.068
80

The error in the ith study is calculated as |B E C G − B I B |,
where B E C G and B I B are the heartbeats estimated in the
ground truth and the image based method, respectively.

Fig. 8. Mean and maximum standard deviation of the error measure εP D for
each of the gating methods.

(mean ± SD) along all the studies. As consequence, the proposed method presents a larger proportion of phase coherent
data extracted from the study for a specific cardiac phase.
From the different comparisons, AID and CCB reported the
closer heartbeat period detection mainly because the use of a
band filter around the mean cardiac frequency of the study. Their
motion signals present low heartbeat period variations (as higher
frequencies were removed) as is physiologically expected. Thus,
an accurate prediction of mean heartbeat periods and number of

MASO TALOU et al.: IMPROVING CARDIAC PHASE EXTRACTION IN IVUS STUDIES BY INTEGRATION OF GATING METHODS

2875

Fig. 9. Longitudinal views of an IVUS study processed with the different gating methods: (left column) standard longitudinal view; (right column) absolute
difference versus the ECG offline method.

heartbeats present in the study is obtained. AID is not phase consistent, i.e., the identified frames are not necessarily associated
with the same cardiac phase, as can be shown in Fig. 8. In turn,
CCB underpins this issue by combining the motion signal s0
(associated with frames correlation) with another uncorrelated
motion signal (associated with blurring). The resulting signal intensity decreases at the steadiest phase frames while increases at
the remaining phases’ frames. Then, when minima are adjusted
by the iterative harmonic scheme, we obtain a more accurate
steadiest phase identification.

E. Mean Cardiac Frequency Estimation
Using the ground truth, we compute the mean cardiac frequency f ECG as the quantity of heartbeats detected over the
study time duration. Then, we compare f ECG against fm calculated using (7) in terms of their absolute difference, i.e., εHF =
|f ECG − fm | . The comparison shows an error of 1.109 ± 0.861
beats/min (mean ± SD) and always minor than 4.126 beats/min.
This allows estimating the mean cardiac frequency of the patient
with reasonable accuracy, only by using the IVUS image data.

F. Gating Comparison
As a qualitative comparison, the corresponding longitudinal
views after the gating process with the different methods for a
particular IVUS study are shown in Fig. 9. The endothelial layer
gated by the offline ECG method clearly resembles the result of
the CCB method more than those obtained with other methods.
This comparison is accentuated when looking at the differences
between our ground truth and the different methods (see Fig. 9,
right column). This can be seen at the bifurcation presented in
the middle section of the sequence, where delay or anticipation
of the branch origin occurs for other methods (CDM, AID, and
BM). Moreover, a substantial reduction of saw tooth artifact is
remarkable for the results given by CCB and AID methods.
The distribution of the differences between the image-based
and the offline gating method is not homogeneous. As shown in
Fig. 10, the maximum differences are located at the middle part
of the vessel where the bifurcation is located. This encourages
the use of features that correctly measure the motion while
topological changes occur. In fact, small differences are seen for
the CCB method, where blurring information reduces motion
misidentification.

2876

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 12, DECEMBER 2015

Fig. 10. Volume rendering corresponding to the absolute difference pixel to pixel of the volumes gated by the image-based gating method and the manual offline
ECG gating. The study visualized is the same as in Fig. 9.

G. Computational Cost
The method was implemented partially in MATLAB and
C++ languages. The signal si calculation is performed in C++
parallelized at frame level with OpenMP. Alpha estimation [see
(13)] and the iterative filtering scheme are performed in MATLAB using parfor parallelization for alpha estimation.
For the method execution, we used a workstation with an
Intel Xeon CPU E5-2620 at 2.00-GHz processor and Kingston
99U5471-031.A00LF at 1333 MHz (latency of 27 ns) RAM
memory over Ubuntu 14.04.1 LTS. The method execution process was parallelized into 12 threads for all the measurements
reported in this section. As performance measurement, we use
the wall clock time because we are interested in showing that
the execution time is reasonable for clinical use. To diminish the
operative system time variations during the method execution,
we run five times each study processing and store only the mean
wall clock time from these executions.
The results show that the execution time is 20.63 ± 8.11 s
(see Fig. 11), which in comparison to the acquisition time of the
study (99.16 ± 37.79) represents 20%. This overhead is found
to be suitable for medical practice since it allows us to perform
image gating during the diagnostic or therapeutic procedure. In
a closer analysis, it is seen that the time-consuming tasks are the
α estimation and signal computation (see Figs. 11 and 12). Both
tasks could be fully parallelized with a maximum of A and N
threads, respectively, where A is the number of alpha candidates
to be tested in (13) and N is the quantity of frames in the IVUS
study. As reported in Sections II-D1 and III-A, A = 1000 and
N = 2974.8 ± 1133.8 frames, which allows a theoretical speed
up of the methods until two order of magnitude from the reported
results. Finally, almost all the estimation time for the value of α is
spent in the iterative adjustment of p(i) (see Fig. 12). This task
was implemented in MATLAB and parallelized using parfor.
Clearly, its performance can be improved by reimplementing
the task in C++ with OpenMP parallelization.

Fig. 11. Mean processing time of the 61 IVUS studies showing the time for
the signal computation [see (2) and (3)], α estimation [see (13)], study gating
(see Sections II-B and II-C), and total method execution time.

H. Limitations
Known limitations of this method, as well as for other methods using a low/band-pass filters at the spectral filtering of a
motion signal, are related to the treatment of IVUS studies in
patients with large heart rate variability, such as cardiac dysrhythmia, or at locations with no vessel movement at all, such
as infarcted areas of the heart.
IV. CONCLUSION
A novel method to improve the IVUS gating by combining different image motion features has been presented.
Particularly, the implementation, called CCB, has shown to

MASO TALOU et al.: IMPROVING CARDIAC PHASE EXTRACTION IN IVUS STUDIES BY INTEGRATION OF GATING METHODS

2877

Conflict of Interest: The authors declare that they have no
conflict of interest.
Ethical approval: For this type of study formal consent is not
required.
REFERENCES

ACKNOWLEDGMENT

[1] Y. Honda and P. J. Fitzgerald, “Frontiers in intravascular imaging technologies,” Circulation, vol. 117, no. 15, pp. 2024–2037, 2008.
[2] N. Bruining et al., “Ecg-gated versus nongated three-dimensional intracoronary ultrasound analysis: Implications for volumetric measurements,”
Catheter Cardio. Diag., vol. 43, no. 3, pp. 254–260, 1998.
[3] A. Arbab-Zadeh et al., “Axial movement of the intravascular ultrasound
probe during the cardiac cycle: Implications for three-dimensional reconstruction and measurements of coronary dimensions,” Am. Heart J.,
vol. 138, no. 5, pp. 865–872, 1999.
[4] H. Zhu, “Retrieval of cardiac phase from IVUS sequences,” in Proc. SPIE
Med. Imaging, 2003, pp. 135–146.
[5] S. A. De Winter et al., “A novel retrospective gating method for intracoronary ultrasound images based on image properties,” in Proc. Comput.
Cardiol., 2003, pp. 13–16.
[6] S. K. Nadkarni et al., “Image-based cardiac gating for three-dimensional
intravascular ultrasound imaging,” Ultrasound Med. Biol., vol. 31, no. 1,
pp. 53–63, 2005.
[7] J. Barajas et al., “Cardiac phase extraction in IVUS sequences using 1-D
gabor filters,” in Proc. 29th Annu. Int. Conf. IEEE Eng. Med. Biol. Soc.,
2007, pp. 343–346.
[8] C. Gatta et al., “Robust image-based IVUS pullbacks gating,” in Proc.
Int. Conf. Med. Image Comput. Comput.-Assisted Intervention, 2008,
pp. 518–525.
[9] S. M. O’Malley et al.,“Image-based frame gating of IVUS pullbacks:
A surrogate for ECG,” in Proc. IEEE Int. Conf. Acoust., Speech Signal
Process., 2007, vol. 1, pp. I-433–I-436.
[10] S. M. O’Malley et al., “Image-based gating of intravascular ultrasound
pullback sequences,” IEEE Trans. Inf. Technol. Biomed., vol. 12, no. 3,
pp. 299–306, May 2008.
[11] A. Hernandez et al.,, “Image-based ECG sampling of IVUS sequences,”
in Proc. IEEE Ultrasonics Symp., 2008, pp. 1330–1333.
[12] M. S. Matsumoto et al., “Cardiac phase detection in intravascular ultrasound images,” in Proc. SPIE Med. Imag. Ultrasonic Imag. Signal
Process., 2008, vol. 6920, pp. 69200D-1–69200D-9.
[13] C. Gatta et al., “Real-time gating of IVUS sequences based on motion
blur analysis: Method and quantitative validation,” in Proc. Int. Conf. Med.
Image Comput. Comput.-Assisted Intervention, 2010, pp. 59–67.
[14] G. G. Isguder et al.,, “Manifold learning for image-based gating of intravascular ultrasound (IVUS) pullback sequences,” in Proc. 5th Int. Conf.
Med. Imaging Augmented Reality, 2010, pp. 139–148.
[15] A. Hernàndez-Sabaté et al., “Image-based cardiac phase retrieval in intravascular ultrasound sequences,” IEEE Trans. Ultrason. Ferroelectrics
Freq. Control, vol. 58, no. 1, pp. 60–72, Jan. 2011.
[16] C. von Birgelen et al., “Electrocardiogram-gated intravascular ultrasound
image acquisition after coronary stent deployment facilitates on-line threedimensional reconstruction and automated lumen quantification,” J. Am.
Coll. Cardiol., vol. 30, no. 2, pp. 436–443, 1997.
[17] C. von Birgelen et al.,, “Morphometric analysis in three-dimensional
intracoronary ultrasound: An in vitro and in vivo study performed with a
novel system for the contour detection of lumen and plaque,” Am. Heart.
J., vol. 132, no. 3, pp. 516–527, 1996.
[18] J. G. Abbott and F. L. Thurstone, “Acoustic speckle: Theory and experimental analysis,” Ultrason. Imag., vol. 324, no. 4, pp. 303–324, 1979.
[19] L. D. Enochson and R. K. Otnes, Programming and Analysis for Digital
Time Series Data. Washington, DC, USA: Shock and Vibration Information Center, 1969.
[20] F. Harris, “On the use of windows for harmonic analysis with the discrete
Fourier transform,” Proc. IEEE, vol. 66, no. 1, pp. 51–83, Jan. 1978.

Also, the authors would like to thank the anonymous reviewers for their valuable comments and suggestions to improve the
quality of the paper.

Authors’ photographs and biographies not available at the time of publication.

Fig. 12. Percentage consumed by each method subtask during the execution.
The task α estimation presented in Fig. 11 here is subdivided in the tasks:
iterative adjustment of p(i) and other tasks for α estimation.

outperform other methods that use the same image features
separately. The proposed method is capable of identifying cardiac phases, heartbeats, and mean cardiac frequency along the
studies in an accurate and robust manner for a wide range of
situations (severe stenoses, stents, different coronary vessels,
and studies from 65 to almost 105 beats/min). This has been
verified through direct comparison with the cardiac phase associated with the R-wave peak, retrieved from a manual offline
ECG gating with scarce intra-/interobserver variability.
In terms of heartbeat detection and cardiac period estimation,
the CCB method outperforms other compared methods. The
cardiac phase detection performed by the CCB method presents
the smallest error between the image-based gating methods,
rendering the most accurate gating for IVUS study. From the
comparisons carried out in this study, it presents the lowest
frame omission and/or oversampling at each heartbeat, as direct
consequence of the correct identification of the heartbeats along
the study.
In contrast to the time-consuming manual offline ECG gating,
it is worthwhile to highlight that our method is fully automatic,
independent from other studies or equipment, and is applicable
to preexisting IVUS studies. Also, the computational overhead
of this method to the IVUS acquisition time is 20%, allowing
its use for medical practice during the diagnostic or therapeutic
percutaneous coronary procedure. All these aspects permit the
direct application of the CCB method as a preprocessing stage
for filtering, segmentation or reconstruction methods, which
would be greatly benefited from the increase of accuracy and
time consistency of the so-extracted cardiac phases from the
IVUS study.

