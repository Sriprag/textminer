IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 4, JULY 2014

1285

An Online Sleep Apnea Detection Method Based on
Recurrence Quantification Analysis
Hoa Dinh Nguyen, Brek A. Wilkins, Qi Cheng, Senior Member, IEEE, and Bruce Allen Benjamin

Abstract—This paper introduces an online sleep apnea detection
method based on heart rate complexity as measured by recurrence
quantification analysis (RQA) statistics of heart rate variability
(HRV) data. RQA statistics can capture nonlinear dynamics of a
complex cardiorespiratory system during obstructive sleep apnea.
In order to obtain a more robust measurement of the nonstationarity of the cardiorespiratory system, we use different fixed amount
of neighbor thresholdings for recurrence plot calculation. We integrate a feature selection algorithm based on conditional mutual
information to select the most informative RQA features for classification, and hence, to speed up the real-time classification process
without degrading the performance of the system. Two types of binary classifiers, i.e., support vector machine and neural network,
are used to differentiate apnea from normal sleep. A soft decision
fusion rule is developed to combine the results of these classifiers in
order to improve the classification performance of the whole system. Experimental results show that our proposed method achieves
better classification results compared with the previous recurrence
analysis-based approach. We also show that our method is flexible
and a strong candidate for a real efficient sleep apnea detection
system.
Index Terms—Feature selection, recurrence quantification analysis (RQA), sleep apnea detection, soft decision fusion.

I. INTRODUCTION
BSTRUCTIVE sleep apnea (OSA) is a disorder in which
a person experiences periodic disruption in breathing during sleep. An obstructive apneic episode is defined as the absence of airflow for at least 10 s, and may happen hundreds of
times a night without individuals knowing they have OSA. This
is a common problem with major health implications such as
excessive daytime drowsiness, nonrestorative sleep, decreased
memory, depression, and even serious cardiac arrhythmias. It
has been linked to increased risks of high blood pressure, myocardial infarction, stroke, and increased mortality rates. Fortunately, sleep apnea is a treatable condition. However, most individuals with OSA are not identified and remain untreated [1].
Polysomnography (PSG) is a standard approach to recognize
sleep apnea, which is based on the comprehensive monitoring

O

Manuscript received January 16, 2013; revised September 4, 2013; accepted
November 17, 2013. Date of publication November 27, 2013; date of current
version June 30, 2014.
H. D. Nguyen is with the Posts and Telecommunications Institute of Technology, Hanoi, Vietnam, 10000 (e-mail: hoadn@okstate.edu).
Q. Cheng is with the School of Electrical and Computer Engineering,
Oklahoma State University, Stillwater, OK 74078 USA (e-mail: qi.cheng@
okstate.edu).
B. A. Wilkins and B. A. Benjamin are with the Center for Health
Sciences, Oklahoma State University, Tulsa, OK 74107 USA (e-mail:
brek.wilkins@okstate.edu; bruce.benjamin@okstate.edu).
Digital Object Identifier 10.1109/JBHI.2013.2292928

of cardiorespiratory and sleep signals. PSG generally requires
an overnight stay in a hospital for sufficient collection of signals
related to OSA [2]. This can be an uncomfortable and inconvenient experience for individuals because it often disturbs or
inhibits normal sleep and is often expensive.
Alternatively, the ECG signal is very promising for OSA
detection since it offers a more convenient data collection procedure [3]–[6]. At present, new and low-priced 1-lead ECG
recorders are already available, in which only two or three electrode attachments are needed [7]. ECG measurements provide
an alternative view of physiological changes corresponding to
sleep apnea behavior/severity. In 2000, the organizers of the
Physionet database repository recognized the importance and
potential use of the ECG signals in diagnosing sleep apnea. As
a result, they hosted a challenge where various research teams
introduced a number of different methodologies for sleep apnea
detection using the ECG alone [8]–[15]. Since then, many methods using the ECG signal to diagnose OSA have been developed.
For example, McNames and Fraser [13] introduce a sleep apnea
detection method using heart rate (HR) and pulse energy of ECG
signals. Khandoker et al. [5] use support vector machine (SVM)
with 28 features extracted from heart rate variability (HRV) data
and ECG-derived respiration data using wavelet decomposition
to detect OSA. The performance comparison between SVM and
other classifiers, i.e., K-nearest neighbors (KNN), probabilistic
neural network (PNN), and linear discriminant (LD) using the
same features is also presented in [6]. Mendez et al. [4] explore both temporal features and spectral features extracted from
power spectral densities of recurrence rate (RR) intervals and
QRS area series, and use a bivariate time-varying autoregressive
model at each heart beat for OSA detection. KNN and neural
networks (NNs) are used to classify apneic data from normal
data on a 1-min basis. Bsoul et al. [16] implement a real-time
sleep apnea and hypopnea syndrome detection system using 111
features in both time and spectral domains extracted from ECG
data. Those features include 18 time-domain statistical features
extracted directly from ECG signals, two features from ECGderived respiration signals [17], and 91 features extracted from
the frequency domain of ECG signals.
In this paper, we introduce a new framework for OSA detection, which capitalizes on nonlinear dynamical information
within HRV signals extracted from the ECG. HRV is the variation of the time distance between consecutive heartbeats. HRV
reflects the heart’s ability to detect, quickly respond, and adapt to
changing intrinsic and extrinsic stimuli. Since apneic episodes
cause changes to heart regulation during sleep, using HRV data
for sleep apnea detection is very promising [18], [19]. Moreover,
recurrence plots (RPs) [20], [21] of HRV data are believed to be

2168-2194 © 2013 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

1286

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 4, JULY 2014

immune to the effects of the nonstationarity of nonlinear time
series, and hence can be used as a good tool for OSA detection.
RPs and subsequent recurrence quantification analysis (RQA)
of HRV allow for the statistical characterization of complex
HR regulations. The use of recurrence analysis on nocturnal
HR for sleep apnea detection was first introduced by Maier and
Dickhaus [3]. They pointed out that RP/RQA is inferior to spectral methods. By choosing a different RP thresholding method
with different parameters (embedding dimensions m = 6, delay
τ = 10, and eight different fixed amount of nearest neighbors
(FAN) values) from their approach, we attempt to better capture HR dynamics associated with OSA, thereby improving the
classification of apnea versus normal. Data used in this study
have been divided into 1-min sections and the corresponding
label for each section is either apnea (1) or normal (0). As a
result, we are limited to measuring minute by minute changes
in nonlinear HR complexity using RQA, i.e., the window step
is 1 min. A subsequent decision of apnea or normal is made
each minute. A feature selection algorithm is integrated into
the detection system design to improve the computational speed
without degrading the classification performance of the whole
system. To exploit the complementary information of different
classifiers, two types of binary classifiers, i.e., SVM and NN,
are used. A soft decision fusion rule is proposed to combine the
outputs of these two classifiers for performance improvement.
Experimental results show that our proposed decision rule is effective in improving the classification performance of the whole
system.
II. MATERIALS AND METHODS
A. Datasets
In this paper, we use the Physionet Apnea-ECG database [1].
A total of 35 subjects with OSA are used (classes a, b, c).
The records were labeled and scored by an expert for sleep apnea/hypopnea events on a 1-minute basis. Each record contains
a set of reference annotations, one for each minute of the recording that indicates the presence or absence of apnea during that
minute. More details of the data can be found in [1].
ECG signals are sampled at 100 Hz with 12-bit resolution.
HRV data are extracted from the digitized ECG signals. In the
following section, we present a method to extract RQA features
from HRV data.
B. RPs and RQA
Recurrence, which was first introduced by Poincare [22] in
1890, is a fundamental characteristic of dynamic systems. In
1987, Eckmann et al. [23] proposed the method of RPs to visualize the trends within time series from complex dynamic
systems. In order to obtain RPs of a time series, u(t), the data
must be embedded in a phase space using Takens’ time delay
method [24]. Let a phase state be defined as follows:
xi = [u(i), u(i + τ ), . . . , u(i + (m − 1)τ )]

(1)

where τ is the delay and m is the dimension of the embedding
phase space. To set the appropriate values of m and τ , one must

estimate the number of representative system variables expected
to influence the system of interest, as well as the time required
to achieve variable independence to avoid redundancy, respectively [25]. It is estimated that six cardiorespiratory variables
have direct and immediate influence on HR dynamics at any
given moment, i.e., cardiac output [26], blood pressure [27],
respiratory rate [28], SpO2, cardiac repolarization (QT interval) [29], and central venous return [30]. Therefore, m = 6 is
used in the study on the dynamics of HRV data. The delay τ
must be chosen large enough to avoid constructing state vectors
that are autocorrelated [31]. Empirically, we see that τ = 10 is
sufficient for analyzing HRV data.
An RP of a time series u(t) is an N × N matrix, each element
of which is calculated by the following equation:
Ri,j = Θ(i − xi − xj ), i, j = 1, 2, . . . , N

(2)

where Θ(·) is the unit step function, i is the cutoff distance,
and  ·  is the Euclidean norm. This means that if a space
vector xj is within a range of i from vector xi , then Ri,j =
1; otherwise, Ri,j = 0. The cutoff distance i can either be a
constant value or vary such that there is a constant number of
neighboring states surrounding each point of a trajectory. The
latter is also known as the FAN method [23]. It is often difficult
to choose a proper value of threshold i because if i is too small,
there will be too few recurrences resulting in small recurrence
statistic values, whereas too large i may lead to a saturation of
recurrences and an increase in all recurrence statistics. FAN is
more advantageous for use on HRV data since it does not require
attractors to be of a similar volume for the comparison of statespace behaviors. Instead, a predefined percentage of recurrence
points is set for all states [32].
RQA refers to quantitative measures that describe the structures of RPs. There are ten commonly used RQA measures
in the literature. These measures include RR, determinism
(DET ), maximum diagonal line length (L), maximum vertical line length (V ), entropy of the distribution of diagonal lines
(ENTR) [33], laminarity (LAM ), mean diagonal line (M DL),
trapping time (T T ) [21], recurrence time type 1 (T1 ), and recurrence time type 2 (T2 ) [34]. As discussed earlier, by choosing the
FAN method for RP calculation, the cutoff threshold i changes
at every state such that there is a fixed number of recurrence
points found for each xi of the RP. This means an RR is fixed.
As a result, only nine RQA measures are considered as features
in this study and they are described as follows.
L is the length of the longest diagonal line, while V is the
length of the longest vertical line of an RP. In all the following statistical calculations relating to diagonal lines, the main
diagonal line is discarded.
DET is the percentage of recurrent points forming diagonal
lines in a RP with minimal length lm in
L
m in
DET = l=l
N

i,j =1

lP (l)
Ri,j

(3)

where P (l) is the histogram of the diagonal lines of length
l, l = lm in , . . . , L.

NGUYEN et al.: ONLINE SLEEP APNEA DETECTION METHOD BASED ON RECURRENCE QUANTIFICATION ANALYSIS

1287

The recurrence points of the second type are those points just
getting inside B i (xi ) from outside. They are denoted as the
dark solid dots in Fig. 1. The trajectory may stay inside the
neighborhood for a while, thus generating a sequence of points
designated as open dots in Fig. 1. These are called sojourn points
[34]. Recurrence time of the second type (T2 ) is the average time
difference between adjacent dark dots on a trajectory. It denotes
the average time required for the system to return to a specific
state after removing sojourn points.
These measures form a set of RQA statistics of each RP.
Given time-series data, by using different values of FAN we
obtain different sets of RQA statistics. In order to capture the
nonstationarity of the human system by using RPs, we attempt
to extract a more comprehensive profile representation of the
dynamics by applying various fixed numbers of neighbors for
RPs calculation. Eight different FAN values are used (2.5%, 5%,
7.5%, 10%, 12.5%, 15%, 17.5%, and 20%). Therefore, there are
a total of 72 RQA features created for each HRV series.
Fig. 1. Illustration of the recurrence points of the second type (solid dots) and
the sojourn points (open dots) in B  i (xi ).

MDL is the average length of diagonal lines
L
lP (l)
m in
MDL = l=l
.
L
l=l m i n P (l)

(4)

ENTR measures the Shannon entropy of the distribution of
diagonal lines
ENTR = −

L


p(l) ln p(l)

(5)

l=l m i n

where p(l) is the probability of the diagonal line having a length
of l, p(l) =  L P (l) P (l) .
l = l m in

LAM stands for the percentage of recurrence points forming
vertical lines with minimum length of vm in , which is so-called
laminarity
V
v =v m i n vP (v)
(6)
LAM = 
N
i,j =1 Ri,j
where P (v) is the histogram of vertical lines of the length v,
v = vm in , . . . , V .
T T represents the average length of vertical lines. It indicates
how long the system remains in a specific state
V
vP (v)
.
(7)
T T = vV=v m i n
v =v m i n P (v)
Consider a particular state xi . Let B i (xi ) = {x : x −
xi  ≤ i } denote a set of its recurrence points, which includes all dots in Fig. 1. These recurrence points form a sequence in the order of their appearances on a trajectory, i.e.,
{xt 1 , xt 2 , . . . , xt B i }, where Bi is the cardinality of B i (xi ).
From this, the recurrence time of the first type T1 is the average of all tj +1 − tj , j = 1, . . . , Bi − 1, i = 1, . . . , N and it
measures the evolution of the constructed phase states.

C. Feature Selection
A set of 72 RQA features is large and may contain redundant
and/or irrelevant features for apnea detection. Using a large
number of features also increases the processing time of classifiers that limits the potential application of real-time detection.
Feature selection is needed to trim irrelevant features, leaving
the most compact feature set while maintaining the performance
of the classification system. Exhaustive search is conceptually
straightforward but computationally expensive. There have been
various sequential search-based approaches including best individual features [35], sequential forward search, sequential forward floating search [36], etc. Mutual information (MI) has been
explored in greedy forward feature selection methods [37]–[40].
The use of MI as a search criterion can be justified as follows.
It has been shown in [41] and [42] that the classification er)−I (C ;S)−1
ror is lower bounded by Pe ≥ H (C
log 2 (N C −1) , where C is the
class label; NC is the number of classes; S is the set of features
being used for classification; H(C) is the Shanon entropy of
class variable; I(C; S) is the MI between class variable and
the set of selected features. It is generally difficult to quantify
directly the performance improvement of a classifier when selecting features. Therefore, MI is evaluated since increasing the
MI can reduce the lower bound of the classification error for
given H(C).
Battiti [37] proposes an incremental search method, i.e., mutual information-based feature selection (MIFS). This method
selects
 feature f into the existing feature subset S if I(C; f ) −
β s∈S I(f ; s) is the largest. That is, feature f should be selected if it maximizes the MI with the class C and has minimum
MI with every existing feature s in S. The main disadvantage
of this MIFS method is the difficulty in setting the parameter β.
Especially, when the size of S becomes large, the selection algorithm tends to select features that are less correlated with the
selected features while neglecting its correlation with the class
label. In [39], β is set to be 1/|S|, where |S| is the cardinality of
the selected feature subset and this can partly solve the problem
aforementioned. However, the wide range of MI values may still

1288

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 4, JULY 2014

cause the bias [40]. To handle this issue, the normalized MI is
introduced in [40].
The limitations of existing MIFS methods are twofolds. First,
ideally, the feature with maximum conditional MI I(C; f |S)
should be selected. Existing methods approximate it by an
alternative problem that maximizes I(C; f ) and minimizes

s∈S I(f ; s) through a weighted sum. This approximation
helps facilitate the MI estimation since we do not have to deal
with high-dimensional data. However, the conditional MI between f and C given the knowledge of S cannot be correctly
represented by a function of the MI between f and C and the
MI between f and every feature in S. In other words,
 the feature
that both maximizes I(C; f ) and minimizes s∈S I(f ; s) is
not necessary the one that maximizes I(C; f |S). Second, current methods can select relevant features for classification but
cannot eliminate redundant features if already selected. There is
no step to reevaluate the redundancy of selected features when
new features are added into the subset. As a result, the selected
feature subset may not be the most compact one. We intend to
find the most compact feature subset while maintaining the classification performance. The proposed feature selection method
is described as follows.

To calculate the required MI in the algorithm, the joint probability density functions (pdfs) of selected features are needed.
These pdfs can be estimated using the Parzen window method
[43]. Let vector z denote the values of selected features. Given
mc samples of z belonging to class c, the approximated conditional pdf p̂(z|c) using the Parzen window method is
1 
φ(z − zi , h)
(8)
p̂(z|c) =
mc
i∈I c

where c = 1, . . . , NC ; Ic is the set of indices of training samples
zi belonging to class c; φ(·) is the window function; h is the
window parameter. The estimation of pdf p̂(z|c) can converge
to the true one if φ(·) and h are properly chosen [43]. In the
literature, a Gaussian window is usually used
  −1 
z̃ Σ z̃
1
exp −
(9)
φ(z̃, h) =
2h2
(2π)D /2 hD |Σ|1/2
where z̃ = z − zi ; D is the dimensions of sample z̃; Σ is the
covariance matrix of z̃. In order to simplify the pdf estimation for
high-dimensional data, “kernel independence” is assumed [44].
The general pdf estimate of a D-dimensional variable is then
expressed as follows:
p̂(z|c) =

D
1 
(d)
φ(z (d) − zi , hd ).
mc

(10)

i∈I c d=1

−1/5

hd in each dimension can be chosen as hd = 1.06σd mc ,
where σd is the standard deviation of training data in dimension
d [44].
The conditional MI I(C; fi |S) can be expressed in terms of
conditional entropies as follows:
I(C; fi |S) = H(C|S) − H(C|S, fi )

(11)

where H(C|S) is the conditional entropy of class variable C
given the selected features S. The conditional entropy can be
approximated as
NC
M 


p̂(sj |c)p(c)
p(c)p̂(sj |c) log N C
k =1 p̂(sj |k)p(k)
j =1 c=1
(12)
where sj is the jth training sample, M is the total number of
training samples, p(c) is the prior probability of class c, which
can be assumed as uniformly distributed indicating the least
prior knowledge.
Ĥ(C|S) = −

In essence, this feature selection method aims at selecting any
features that are relevant to the class label, but not redundant.
The threshold γ is set at a reasonably small value such that
it helps remove features containing pure noise. In this feature
subset selection method, we integrate a redundancy evaluation
step right after a new feature is selected into the subset. This
step helps remove all redundant features emerging during the
selection process. The evaluation step is similar to the idea
of backward feature elimination. However, we only need to
apply it to a small set of selected features instead of the whole
original feature set, which helps reduce the computational effort
significantly.

D. Classification
1) Binary “Soft” Decision Fusion: Different classifiers may
have different decision making perspectives, and misclassified
samples may not overlap in different classifiers. Therefore, combining the results from different classifiers may help compensate
the information loss of respective classifiers, and could further
increase the classification accuracy. As a result, classifier combination is a powerful tool for classification improvement in
many fields of study [45]. In general, any classifier combination
approach may belong to one of three categories: abstract level,
rank level, and measurement level [46]. Majority voting [47]

NGUYEN et al.: ONLINE SLEEP APNEA DETECTION METHOD BASED ON RECURRENCE QUANTIFICATION ANALYSIS

is an abstract-level combination example. Examples of ranklevel methods include weighted majority voting [48] and Borda
count [45]. In the measurement level, the outputs of a classifier are scores reflecting the degrees of a sample belonging to
individual classes, instead of the class labels. These scores are
combined for final decision making. The combination methods
of this level include sum-rule, product-rule, and max-rule [45].
Xie and Minn [49] investigate the application of four binary
classifier combination methods for sleep apnea detection, such
as max probability, average probability, product of probability
(which all belong to the measurement level), and majority voting
(abstract level). They show that classifier combination can help
improve the classification performance.
The limitation of current decision fusion methodologies is
that they do not take into account the quality of each classifier.
Some classifiers may provide higher sensitivity, and others may
have higher specificity, and vice versa. If the classifier quality
information can be integrated in the decision fusion process, the
global decision is believed to be more reliable. In this section,
a binary soft decision fusion rule based on the confidence score
maximization strategy is proposed. The new decision fusion rule
belongs to the measurement level.
Outputs of binary classifiers are scores representing the probability that the sample belongs to either class. We denote the
outputs of all K classifiers to be {Tk ∈ [0, 1]}, k = 1, . . . , K.
These scores are fused together to provide a reliable final decision on the class of the data. We introduce the term “confidence
score” for each class. This is a combination between the score
Tk of classifier k and its classification quality. The confidence
score of classifier k for each class can be formulated as follows:
Confidence score of class 1 (apnea)
Qk1 = Tk P k (Dk = 1, H = 1)
= Tk P k (Dk = 1|H = 1)P (H = 1).

(13)

Confidence score of class 0 (normal)
Qk0 = (1 − Tk )P k (Dk = 0|H = 0)P (H = 0)

(14)

where P (H = 1) and P (H = 0) are the prior probabilities of
hypotheses apnea and normal, respectively; P k (Dk = 1|H =
1) and P k (Dk = 0|H = 0) are probabilities of correct decisions
of classifier k for the two classes, which can be obtained from
the training process.
These confidence scores represent soft decisions of all binary
classifiers. It is shown by Kittler et al. [50] that the sum-rule is
less sensitive to noise than other combination rules. Therefore,
we combine confidence
from all classifiers using the
 scores
k
Q
,
i
∈ {0, 1}. The final decision is
sum-rule, i.e., Qi = K
i
k =1
made by choosing the class with a highest confidence score
D = arg maxi Qi .
Indeed, this soft decision fusion rule is a weighted sum of
the output scores of all binary classifiers. The weights being
used are the qualities of individual classifiers combined with
the prior knowledge of each class of the data. By changing
the prior probabilities of the classes, the final decision will be
affected. For example, with patients having a high chance of
sleep apnea symptoms, the prior probability of apeic events

1289

500 RR intervals
N

N

N

N

N

N

N

N

N

A

A

A

500 RR intervals
A

A

A

A

A

A

Fig. 2. Training data of binary classifiers. Each block is 1 min of HRV data.
RPs are calculated based on a 500 RR interval window. Training data for class
normal contain pure normal (N) blocks; training data for class apnea include
pure apnea (A) blocks.

during sleep can be set higher than that of normal people. This
shows the flexibility of the proposed method. In this study,
uniformly distributed probabilities are used since there are both
apnea and normal data contained in each OSA record.
2) Binary Classifiers: Two most widely used binary classifiers, SVM and NN are adopted for classifier fusion.1 SVM with
kernel constructs a hyperplane with maximal margins to separate data into two classes in a higher dimensional feature space.
Gaussian radial basis functions (RBF) are commonly used as
kernels because the corresponding feature space is of infinite
dimensions. SVM in [51] is followed except that the parameter
γ of RBF is set to 0.001, and the cost C is set to 4 in order to
keep the validation error rate under 1%. A ten neuron hiddenlayer NN provided by the Matlab toolbox [52] is used. To assess
the performance of classifiers, we use three metrics: sensitivity,
specificity, and accuracy [49]. Specificity represents the ability
to correctly classify normal data, while sensitivity reflects the
ability to detect apneic events.
3) Classifier Training: Binary classifiers are trained using
apneic and normal data separately. Fig. 2 illustrates training data
of each class. RPs are calculated from two separate normal and
apnea subsets, and RQA statistics of normal and apneic data
are extracted, respectively. The window width for calculating
RPs is set at 500 RR intervals, and the moving window step
is set at five RR intervals. There are roughly a total of 62,000
RQA samples of the normal class and 59,000 RQA samples
of the apneic events available. Each binary classifier is trained
using one-third of the data (training set), and validated using the
remaining two-thirds of it (validating set). Specifically, the data
for training are selected in every three samples from the data pool
resulting in the window step of 15 RR intervals. Empirically,
given the rapid adaptability of the body system, we observe that
significant dynamic changes will occur from window to window
with this step. Therefore, the effect of overtraining is minimized.
Threefold cross validation is adopted. The average classification
performances are summarized in Table I and the classifier with
the best classification performance is selected for testing.

1 The proposed fusion framework is sufficiently general to integrate different
number and/or types of binary classifiers.

1290

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 4, JULY 2014

TABLE I
CLASSIFICATION PERFORMANCE OF BINARY CLASSIFIERS AFTER TRAINING USING EITHER FULL FEATURE SET OR SELECTED FEATURE SUBSET

1 min window step
500 RR intervals
N

N

N

N

N

A

A

A

A

500 RR interval window moves to the right with 1 min step

A

A

A

A

A

N

N

N

N

Fig. 3. Real data with a mixture of normal and apneic blocks. The ground
truth of each window is determined by the content of newly added block on the
right.
TABLE II
SELECTED RQA FEATURES

III. RESULTS AND DISCUSSIONS
A. Binary Classifier Performance
Table I presents all sensitivity, specificity, and accuracy rates
of both NN and SVM after training. Training performances are
obtained from datasets containing pure normal and apneic data.
The results show that the normal and apnea classes can be well
distinguished when pure data are considered.
The performance of these classifiers are expected to deteriorate when we apply to real data, which may contain the mixture
of normal and apneic events within the window (see Fig. 3).
Specifically, RPs are calculated based on a moving window of
500 RR intervals in real data with a 1-min-window step. There
are many time points at which the observation window contains
both normal and apneic data. The system makes decisions for
the newly coming minute of data as a normal or apneic event
based on the information of the whole window. With the mixture
of normal and apneic data, the output scores of binary classifiers
tend to become less extreme values. As a result, the classification accuracy of individual classifiers can be affected. In fact,
the change in output scores of classifiers can be further used
as an indicator of the boundaries between normal and apneic
events, which will not be discussed in this paper.

Fig. 4. Sample RPs of normal and apnea sleep. Data are extracted from record
a01. RPs are calculated based on a window width of 500 RR intervals. In each
of those figures, R 1 , 1 is located at the bottom left conner.

NGUYEN et al.: ONLINE SLEEP APNEA DETECTION METHOD BASED ON RECURRENCE QUANTIFICATION ANALYSIS

1291

TABLE III
CLASSIFICATION PERFORMANCE OF THE SYSTEM ON REAL DATA

TABLE IV
COMPARISON BETWEEN DIFFERENT METHODS

B. Feature Selection
The proposed feature selection method is applied to select
the most compact feature subset from the 72 available RQA
features. The final feature subset consists of 33 features as listed
in Table II. In the Table, “1” represents a selected RQA feature
in accordance with a specific value of FAN. Those selected
features include all eight DET , all eight LAM , together with
four MDL, five T T , four T1 , and four T2 features.
Apneic events, which normally last from 20 s to over 1 min,
usually occur periodically and consecutively in a span of more
than 5 min. As a result, the cardiorespiratory dynamic change
occurs periodically during sleep apnea. This leads to the appearance of diagonal and vertical patterns in the RPs of apneic
events (see Fig. 4). Therefore, DET and LAM turn out to be
the most useful features to distinguish the two sleeping conditions. Meanwhile, RQA features such as L, V , and ENTR0 do
not appear to be closely related to cardiorespiratory changes as
manifested by the structures of RPs between the two sleeping
states.
The performance comparison between the classifiers using
the selected feature subset and using the whole feature set is
presented in Table I. The compact feature subset has minor
effect on the accuracy of the classification system. Specifically,
the accuracy of NN is reduced by 2.07%, while that of SVM is
reduced by 0.52% if we use the selected feature subset. However,
the processing time of both classifiers is significantly reduced.
The processing time of NN is reduced by more than ten times,
while that of SVM is improved by almost three times. This is
especially important for real-time detection implementation.
The comparison between the two feature sets using the real
data is summarized in Table III. There is a slight impact on all
measures, i.e., sensitivity, specificity, and accuracy, when we
switch from the full feature set to the compact feature subset.
However, the accuracy rates of the system in the two cases are

not much different. Specifically, the decrease of both sensitivity
and specificity of NN are less than 0.1%, while the decrease
of accuracy of NN is 0.31%. Meanwhile, the reduction of the
accuracy of SVM is 0.73%. If we use the proposed soft decision
fusion, the reduction of the accuracy of the whole system is only
1.07%.
C. Decision Fusion and Classification Efficiency
Table III tabulates the classification results of SVM and NN
when they work separately, as well as when they are combined
using the soft decision fusion rule. According to the results, soft
decision fusion can help improve the classification accuracy.
This is mainly because when there is a mixture of data between normal and apneic episodes, the output scores of individual classifiers become less extreme values. Additionally, there
may be some nonoverlap misclassified samples among different
classifiers. If these output scores are combined together, the information of individual classifiers may complement each other.
Furthermore, the quality information of each classifier is used
as the weight to combine its score with the other. As a result,
the global decision becomes more reliable.
D. Comparison With Other Methods
In this section, we compare our work with some other recent
methods based on ECG data to detect sleep apnea. Table IV
presents a summary of classification performances of various
methods obtained from [3]–[6], [49].
The experimental results show that our proposed OSA detection method based on only ECG data using soft decision fusion
has good accuracy compared with other approaches. Specifically, our method outperforms the previous approach that introduced the use of RQA features for sleep apnea detection [3]. The
main reason is that our method, with a different choice of RP
parameters, effectively exploits the difference in nonlinear and

1292

IEEE JOURNAL OF BIOMEDICAL AND HEALTH INFORMATICS, VOL. 18, NO. 4, JULY 2014

nonstationary dynamical information of HRV data during normal and apneic breathing. Empirically, we find that the complex
cardiorespiratory system control changes acutely during night
time obstructive sleep. RQA statistics of HRV data obtained
from different FAN values can successfully capture this information for classification. Additionally, our soft decision fusion
rule efficiently combines the outputs of different binary classifiers based on their performance qualities, and hence, helps
improve decision accuracy on the real data.
It is noted that LD using wavelet features in [6] and NN with
temporal and spectral features in [4] outperform our proposed
method on this dataset. However, their performance is very sensitive to the type of classifiers and parameters selected. This
implies that they may not generalize well to different datasets
with different conditions. Our method, on the other hand, has
fewer parameters that need to be tuned in training. We mainly
capture HR dynamic features associated with OSA using different FAN values. Besides, classifier fusion is integrated in the
framework to exploit the complementary information of different classifiers. Therefore, our approach is expected to be more
robust and generalize well for different conditions.
The price to pay for the improve robustness, however, is
increased computational time. With eight different FAN values,
eight RPs have to be generated and a total of 72 features need
to be calculated for each HRV window. Two different classifiers
need to be trained separately. To reduce the computational time,
feature selection is integrated in the framework, thus only 33
features needs to be calculated for each window.
IV. CONCLUSION
In this paper, we have proposed a new sleep apnea detection
approach based on RQA statistics of HRV data, which are extracted from ECG signals. The RQA features extracted from
HRV data using different FAN values help provide a detailed
picture of the dynamical control of the cardiorespiratory system during normal and apneic sleeping. The use of only ECG
data for sleep apnea detection is preferable to PSG data or
the combination of ECG data and PSG data since it offers a
more convenient data collection procedure. In addition, the new
method includes an efficient soft decision fusion rule combining output scores of multiple binary classifiers and help improve
the sleep apnea detection accuracy. Our experimental results in
Section III illustrate the advantages of the proposed method
in terms of higher classification accuracy compared with the
previous approach based on recurrence analysis. There are still
many possible ways to improve the classification performance
in the real implementation of our method such as the change in
the types and number of binary classifiers. Furthermore, a new
feature selection algorithm integrated in our method is shown to
be very efficient to select the most discriminative RQA features
for classification. It helps reduce the computational time significantly during real-time detection, while maintaining acceptable
classification performance. The mixture of apneic and normal
events in the real data may lead to inconsistent output scores of
binary classifiers and make them become less extreme values.
These changes in outputs of classifiers may be exploited as an

indicator of the boundaries between normal and apneic events.
This will be investigated in our future work.
REFERENCES
[1] A. L. Goldberger, L. A. N. Amaral, L. Glass, J. M. Hausdorff,
P. Ch. Ivanov, R. G. Mark, J. E. Mietus, G. B. Moody, C.-K. Peng, and
H. E. Stanley, “Physiobank, physiotoolkit, and physionet: Components of
a new research resource for complex physiologic signals,” Circulation,
vol. 101, no. 23, pp. e215–e220, 2000.
[2] R. K. Kakkar and R. B. Berry, “Positive airway pressure treatment for
obstructive sleep apnea,” Chest, vol. 132, no. 3, pp. 1057–1072, 2007.
[3] C. Maier and H. Dickhaus, “Recurrence analysis of nocturnal heart rate in
sleep apnea patients,” Biomed. Tech., vol. 51, no. 4, pp. 224–228, 2006.
[4] M. O. Mendez, A. M. Bianchi, M. Matteucci, S. Cerutti, and T. Penzel,
“Sleep apnea screening by autoregressive models from a single ECG lead,”
IEEE Trans. Inf. Technol. Biomed., vol. 56, no. 12, pp. 2838–2850, Dec.
2009.
[5] A. H. Khandoker, M. Palaniswami, and C. K. Karmakar, “Support vector
machines for automated recognition of obstructive sleep apnea syndrome
from ECG recordings,” IEEE Trans. Inf. Technol. Biomed., vol. 13, no. 1,
pp. 37–48, Jan. 2009.
[6] A. H. Khandoker, C. K. Karmakar, and M. Palaniswami, “Automated
recognition of patients with obstructive sleep apnoea using wavelet-based
features of electrocardiogram recordings,” Comput. Biol. Med., vol. 39,
pp. 88–96, 2009.
[7] J. W. Grier. (2008). “How to use 1-lead ECG recorders to obtain 12lead resting ECGs and exercise (‘stress’) ECGs,” [Online]. Available:
http://www.ndsu.edu/pubweb/∼grier/1to12-lead-ECG-EKG.html
[8] M. J. Drinnan, J. Allen, P. Langley, and A. Murray, “Detection of sleep apnoea from frequency analysis of heart-rate variability,” Comput. Cardiol.,
vol. 27, pp. 259–262, 2000.
[9] M. Schrader, C. Zywietz, V. von Einem, B. Widiger, and G. Joseph,
“Detection of sleep apnea in single channel ECGs from the PhysioNet
data base,” Comput. Cardiol., vol. 27, pp. 263–256, 2000.
[10] P. K. Stein and P. P. Domitrovich, “Detecting OSAHS from patterns seen
on heart-rate tachograms,” Comput. Cardiol., vol. 27, pp. 271–274, 2000.
[11] M. Ballora, B. Pennycook, P. Ch. Ivanov, A. Goldberger, and L. Glass,
“Detection of obstructive sleep apnea through auditory display of heartrate variability,” Comput. Cardiol., vol. 27, pp. 739–740, 2000.
[12] P. de Chazal, C. Heneghan, E. Sheridan, R. Reilly, P. Nolan, and
M. O’Malley, “Automatic classification of sleep apnea epochs using the
electrocardiogram,” Comput. Cardiol., vol. 27, pp. 745–748, 2000.
[13] J. McNames and A. Fraser, “Obstructive sleep apnea classification based
on spectrogram patterns in the electrocardiogram,” Comput. Cardiol.,
vol. 27, pp. 749–752, 2000.
[14] J. E. Mietus, C.-K. Peng, P. Ch. Ivanov, and A. L. Goldberger, “Detection
of obstructive sleep apnea from cardiac interbeat interval time series,”
Comput. Cardiol., vol. 27, pp. 753–756, 2000.
[15] Z. Shinar, A. Baharav, and S. Akselrod, “Obstructive sleep apnea detection
based on electrocardiogram analysis,” Comput. Cardiol., vol. 27, pp. 255–
258, 2000.
[16] M. Bsoul, M. Minn, and L. Tamil, “Apnea MedAssist: Real-time sleep
apnea monitor using single-lead ECG,” IEEE Trans. Inf. Technol. Biomed.,
vol. 15, no. 3, pp. 416–427, May 2011.
[17] G. B. Moody, R. G. Mark, A. Zoccola, and S. Matero, “Derivation of
respiratory signals from multilead ECGs,” Comput. Cardiol., vol. 12,
pp. 113–116, 1985.
[18] P. K. Stein and Y. Pu, “Heart rate variability, sleep and sleep disorders,”
Sleep Med. Rev., vol. 16, pp. 47–66, 2012.
[19] C. Heneghan, P. D. Chazal, S. Ryan, C. P. Chua, L. Doherty, P. Boyle,
P. Nolan, and W. T. McNicholas, “Electrocardiogram recording as a
screening tool for sleep disordered breathing,” J. Clinical Sleep Med.,
vol. 4, no. 3, pp. 223–228, 2008.
[20] N. Marwan, N. Wessel, U. Meyerfeldt, A. Schirdewan, and J. Kurths,
“Recurrence plot based measures of complexity and its application to
heart rate variability data,” Phys. Rev. E, vol. 66, no. 2, p. 026702, 2002.
[21] N. Marwan, M. C. Romano, M. Thiel, and J. Kurths, “Recurrence plots
for the analysis of complex systems,” Phys. Rep., vol. 438, pp. 237–329,
2007.
[22] H. Poincare, “Sur la probleme des trois corps et les quations de la dynamique,” Acta Mathematica, vol. 13, pp. 1–271, 1890.
[23] J. P. Eckmann, S. O. Kamphorst, and D. Ruelle, “Recurrence plots of
dynamical systems,” Europhys. Lett., vol. 5, pp. 973–977, 1987.

NGUYEN et al.: ONLINE SLEEP APNEA DETECTION METHOD BASED ON RECURRENCE QUANTIFICATION ANALYSIS

[24] F. Takens, D. A. Rand, and L. S. Young, “Detecting strange attractors in
turbulence,” Dynamical Syst. Turbulence, vol. 898, pp. 366–381, 1981.
[25] M. Shelhamer, Nonlinear Dynamics in Physiology: A State-Space Approach. Hackensack, NJ, USA: World Scientific, 2007.
[26] A. C. Guyton and E. John, Textbook of Medical Physiology, 11th ed.
Philadelphia, PA, USA: Elsevier, 2006.
[27] R. Klabunde, Cardiovascular Physiology Concepts. Riverwoods, IL,
USA: Lippincott Williams & Wilkins, 2005.
[28] G. J. Tortora and N. P. Anagnostakos, Principles of Anatomy and Physiology, 6th ed. New York, NY, USA: Harper-Collins, 1990.
[29] A. Sagie, M. G. Larson, R. J. Goldberg, J. R. Bengston, and D. Levy,
“An improved method for adjusting the QT interval for heart rate (the
Framingham Heart Study),” Amer. J. Cardiol., vol. 70, no. 7, pp. 797–801,
1992.
[30] G. L. Brengelmann, “A critical analysis of the view that right atrial pressure determines venous return,” J. Appl. Physiol., vol. 94, no. 3, pp. 849–
859, 2003.
[31] H. Kantz and T. Schreiber, Nonlinear Time Series Analysis, 2nd ed. Cambridge, U.K.: Cambridge Univ. Press, 2004.
[32] M. Javorka, Z. Turianikova, I. Tonhajzerova, K. Javorka, and M. Baumert,
“The effect of orthostasis on recurrence quantification analysis of heart rate
and blood pressure dynamics,” Physiol. Meas., vol. 30, no. 1, pp. 29–41,
2009.
[33] C. L. Webber, Jr. and J. P. Zbilut, “Dynamical assessment of physiological
systems and states using recurrence plot strategies,” J. Appl. Physiol.,
vol. 76, no. 2, pp. 965–973, 1994.
[34] J. B. Gao, “Recurrence time statistics for chaotic systems and their applications,” Phys. Rev. Lett., vol. 83, no. 16, pp. 3178–3181, 1999.
[35] G. Abandah and T. Malas, “Feature selection for recognizing handwritten
Arabic letters,” Dirasat Eng. Sci. J., vol. 37, no. 2, pp. 242–256, 2010.
[36] P. Pudil, J. Novovicova, and J. Kittler, “Floating search methods in feature
selection,” Pattern Recognit. Lett., vol. 15, pp. 1119–1125, 1994.
[37] R. Battiti, “Using mutual information for selecting features in supervised
neural net learning,” IEEE Trans. Neural Netw., vol. 5, no. 4, pp. 537–550,
Jul. 1994.
[38] N. Kwak and C. Choi, “Input feature selection by mutual information
based on Parzen window,” IEEE Trans. Pattern Anal. Mach. Intell., vol. 24,
no. 12, pp. 1667–1671, Dec. 2002.
[39] H. Peng, F. Long, and C. Ding, “Feature selection based on mutual information: Criteria of max-dependency, max-relevance, and minredundancy,” IEEE Trans. Pattern Anal. Mach. Intell., vol. 27, no. 8,
pp. 1226–1238, Aug. 2005.
[40] P. A. Estevez, M. Tesmer, C. A. Perez, and J. M. Zurada, “Normalized
mutual information feature selection,” IEEE Trans. Neural Netw., vol. 20,
no. 2, pp. 189–201, Feb. 2009.
[41] R. M. Fano, Transmission of Information: A Statistical Theory of Communications. New York, NY, USA: MIT Press, 1961.
[42] B. Guo and M. S. Nixon, “Gait feature subset selection by mutual information,” IEEE Trans. Syst., Man, Cybern. A: Syst. Humans, vol. 39, no. 1,
pp. 36–46, Jan. 2009.
[43] E. Parzen, “On the estimation of a probability density function and mode,”
Ann. Math. Statist., vol. 2, no. 3, pp. 1065–1076, 1962.
[44] R. Gutierrez-Osuna, “Lecture notes on Introduction to Pattern Recognition,” [Online]. Available: http://research.cs.tamu.edu/prism/lectures/
pr/pr_l7.pdf
[45] S. Tulyakov, S. Jaeger, V. Govindaraju, and D. Doermann, “Review of
classifier combination methods,” Stud. Computat. Intell., vol. 90, pp. 361–
386, 2008.
[46] L. Xu, A. Krzyzak, and C. Y. Suen, “Methods for combining multiple
classifiers and their applications to handwriting recognition,” IEEE Trans.
Systems, Man, Cybern., vol. 23, no. 3, pp. 418–435, May/Jun. 1992.
[47] L. Lam and C. Y. Suen, “Application of majority voting to pattern recognition: An analysis of its behavior and performance,” IEEE Trans. Syst.,
Man, Cybern. A: Syst. Human, vol. 27, no. 5, pp. 553–568, Sep. 1997.
[48] N. Littlestone and M. Warmuth, “Weighted Majority Algorithm,” in Proc.
IEEE Symp. Found. Comput. Sci., 1989, pp. 256–261.
[49] B. Xie and H. Minn, “Real-time sleep apnea detection by classifier combination,” IEEE Trans. Inf. Technol. Biomed., vol. 16, no. 3, pp. 469–477,
May 2012.
[50] J. Kittler, M. Hatef, R. Duin, and J. Matas, “On combining classifiers,”
IEEE Trans. Pattern Anal. Mach. Intell., vol. 20, no. 3, pp. 226–239, Mar.
1998.
[51] C.-C. Chang and C.-J. Lin. (2011). LIBSVM—A library for support vector
machines. ACM Trans. Intell. Syst. Technol. [Online]. 2(3), pp. 1–27.
Software available at http://www.csie.ntu.edu.tw/∼cjlin/libsvm/

1293

[52] Neural network toolbox, Mathworks. (2013). [Online]. Available: http://
www.mathworks.com/products/neural-network/

Hoa Dinh Nguyen received the B.S. and M.S. degrees in electrical engineering from Hanoi University of Science and Technology, Hanoi, Vietnam,
and the Ph.D. degree in electrical engineering from
Oklahoma State University, Stillwater, OK, USA, in
2000, 2002, and 2013, respectively.
From 2000 to 2004, he was an Engineer at Vietnam
Television Technology Development and Investment
Company. From 2004 to 2007, he was an Expert in
Posts and Telecommunications Institute of Technology (PTIT), Hanoi, Vietnam. Currently, he is a Lecturer in information technology at PTIT. His research interests include feature
selection, classification, decision fusion, statistical signal processing, database
systems, and machine learning.

Brek A. Wilkins received the Ph.D. degree in
biomedical sciences from Oklahoma State University Center for Health Sciences, Tulsa, OK, USA, in
2011.
He is currently a Postdoctoral Associate at
Oklahoma State University Center for Health Sciences. He also serves as the Entrepreneurial Lead
for an interdisciplinary group of biomedical and apparel engineers, where he oversees translational and
commercialization processes associated with university technology. His professional research interests
include biomedical signal analysis (nonlinear dynamics, vectorcardiography)
and complex systems-based approaches to forecast cardiorespiratory disease and
disorders.

Qi Cheng (M’06–SM’12) received the B.E. degree in
electrical engineering (highest honors) from Shanghai Jiao Tong University, Shanghai, China, in July
1999, and the M.S. and Ph.D. degrees in electrical
engineering from Syracuse University, Syracuse, NY,
USA, in 2003 and 2006, respectively.
From 1999 to 2000, she was a System Engineer at
Guoxin Lucent Technologies Network Technologies
Company, Ltd., Shanghai, China. Since August 2006,
she has been with Oklahoma State University, Stillwater, OK, USA, where she is currently an Associate
Professor with the School of Electrical and Computer Engineering. Her areas
of interest mainly focuses on statistical signal processing and data fusion with
applications in distributed sensor networks.
Dr. Cheng has served as an Associate Editor for the IEEE COMMUNICATIONS
LETTERS. She is a Member of the Women in Engineering ProActive Network.

Bruce Allen Benjamin was born in Lincoln
Nebraska, USA. He received the Ph.D. degree in
cardiovascular physiology from the University of
Oklahoma, Norman, OK, USA, in 1980.
From 1980 to 1984, he was a National Council
Research Associate at NASA Ames Research Center
at Moffett Field California. Since that time he held
faculty positions at Texas A&M University College
of Medicine and at Duke University Medical Center.
Currently, he is the Associate Dean for Biomedical
Sciences and Interim Vice Provost for Graduate Programs at Oklahoma State University Center for Health Sciences, Tulsa, OK. His
professional activity lies in the field of cardiovascular dynamics.

