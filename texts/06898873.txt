450

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

In Vivo Ultrasound Thermography in Presence
of Temperature Heterogeneity and Natural Motions
Mahdi Bayat∗ , Member, IEEE, John Robert Ballard, Member, IEEE, and Emad S. Ebbini, Fellow, IEEE

Abstract—Real-time ultrasound thermography has been recently demonstrated on commercially available diagnostic imaging
probes. In vitro experimental results demonstrate high sensitivity
to small, localized temperature changes induced by subtherapeutic focused ultrasound. Most of the published results, however, are
based on a thermally induced echo strain model that assumes infinitesimal change in temperature between imaging frames. Under
this assumption, the echo strain is computed using a low-pass axial
differentiator, which is implemented by a finite-impulse response
digital filter. In this paper, we introduce a new model for temperature estimation, which employs a recursive axial filter that acts as a
spatial differentiator–integrator of echo shifts. The filter is derived
from first principles and it accounts for a nonuniform temperature
baseline, when computing the spatial temperature change between
two frames. This is a major difference from the previously proposed
infinitesimal echo strain filter (δ-ESF) approach. We show that the
new approach can be implemented by a first-order infinite-impulse
response digital filter with depth-dependent spatial frequency response. Experimental results in vitro demonstrate the advantages
over the δ-ESF approach in terms of suppressing the spatial variations in the estimated temperature without resorting to ad hoc
low-pass filtering of echo strains. The performance of the new recursive echo strain filter (RESF) is also illustrated using echo data
obtained during subtherapeutic localized heating in the hind limb
of Copenhagen rat in vivo. In addition to the RESF, we have used
an adaptive spatial filter to remove motion and deformation artifacts during real-time data collection. The adaptive filtering algorithm is described and comparisons with uncompensated estimated
spatio-temporal temperature profiles are given. The results demonstrate the feasibility of in vivo ultrasound thermography with high
sensitivity and specificity.
Index Terms—Adaptive motion compensation, speckle tracking,
ultrasound thermography.

I. INTRODUCTION
LTRASOUND thermography has proved to be a promising modality for noninvasive monitoring and control of
temperature during thermal therapy. Local temperature changes

U

Manuscript received April 7, 2014; revised June 27, 2014 and August 27,
2014; accepted September 2, 2014. Date of publication September 15, 2014;
date of current version January 16, 2015. This work was supported in part
by Grant EB009750 from the National Institutes of Health and in part by a
Minnesota Futures Grant from the University of Minnesota’s office of VicePresident for research. Asterisk indicates corresponding author.
∗ M. Bayat was with the Department of Electrical and Computer Engineering, University of Minnesota, Minneapolis, MN 55455 USA. He is now with
the Ultrasound Imaging Laboratory, Mayo Clinic, Rochester, MN 55905 USA
(e-mail: bayat.mahdi@mayo.edu).
J. R. Ballard is with the Medical Devices Center, University of Minnesota,
Minneapolis, MN 55455 USA (e-mail: ball0250@umn.edu).
E. S. Ebbini is with the Department of Electrical and Computer Engineering, University of Minnesota, Minneapolis, MN 55455 USA (e-mail:
emad@umn.edu).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2014.2358075

create echo shifts due to physical and apparent displacements.
The former is the result of thermal expansion, while the rather
is related to the local changes in speed of sound. Using an
infinitesimal model for thermal expansion and a linear temperature dependence assumption for the speed of sound, Simon et al.
[1] suggested a model that lumped these two effects in a single
equation, which related the echo strain to the induced temperature change. We call this the δ-ESF model. Similar results were
reported in [2], where the requirement for a good thermal expansion model was also explained. Based on the δ-ESF model
and using the speckle tracking method explained in [1], authors
in [3] demonstrated the real-time tracking of the temperature
change in vivo using the integrated imaging-therapy system described in [4]. This model has also been confirmed by other
groups [5]–[7], where some limitations have been addressed,
as well as solutions for some of the common problems, such
as the thermoacoustic lens effect have been suggested [8]. In
addition to the time-domain method, spectral domain tracking
of the temperature has been suggested [9], [10]. Although the
derivations in these models include the spatial dependence of
the temperature change, the final result is similar to the δ-ESF in
time domain and does not account for the temperature gradients.
Additionally, methods which are not based on displacement estimation have been proposed in [11]–[13] with varying degrees
of development in terms of real-time implementation and spatial
and temporal resolution. In spite of successful implementation
of the δ-ESF model by many groups, ignoring the nonuniform
temperature baseline can cause unrealistic temperature fluctuations at the focus. When these effects are combined with the
thermal lens artifacts, without using any ad hoc low-pass filtering, the specificity of the ultrasound thermography can degrade
significantly. In this paper, we propose a new derivation of the
temperature estimation based on the echo shifts. In this derivation, instead of infinitesimal changes, the commutative effect
of the thermal expansion is considered for modeling the physical shifts. This results in a recursive echo strain filter which
was first introduced in [14]. We show that the final temperature
reconstruction filter has the form of a differentiator–integrator
as opposed to a pure differentiator used in the δ-ESF model.
It is shown that the integrator part acts as a low-pass filtering
process, which is derived from the local tissue properties and is
effective in reducing inconsistent temperature fluctuations due
to temperature gradients, as well as ripples due to thermal lens
effect without additional filtering.
In case of in vivo temperature estimation, in addition to
the modeling errors, deformations caused by natural motions
such as breathing, gasping, and blood pulsation can introduce
nonthermal displacements in the same spatial and temporal

0018-9294 © 2014 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

BAYAT et al.: IN VIVO ULTRASOUND THERMOGRAPHY IN PRESENCE OF TEMPERATURE HETEROGENEITY AND NATURAL MOTIONS

frequency bands as the true temperature change. Methods based
on frame-to-frame decorrelation were presented in [15] and [16].
Even though these methods are suitable for detecting large motions, they are not applicable for tracking of fast temperature
changes with high frame rate speckle tracking. The results presented in [17] and [18] showed that postprocessing of the temperature using a 2-D filter inspired by the bioheat equation can
further reduce some of the inconsistencies including the ripples
caused by the thermal lens effect and sudden transitions due to
mechanical stresses. However, due to shared bandwidth of the
artifacts and the temperature field, a filtering mechanism with
spatial and temporal selectivity is preferred. Using the global
availability of the motion strain and adaptive filtering techniques, a method is presented which can significantly reduce
most of the motion related artifacts. The organization of this
paper is as follows. In Section II, we present the new model for
the ultrasound echo shift thermography. Section III describes
a motion compensation algorithm based on an adaptive filter
technique for dealing with natural deformation artifacts during
in vivo temperature estimation. Material and methods are described in section IV. Phantom experiment as well as in vivo
results are presented in Section V. Section VI concludes the
paper with a brief summary of achievements and future works.
II. TEMPERATURE ESTIMATION MODEL
Localized heating of tissue in the order of few millimeters
in each dimension creates echo shifts due to local changes in
the speed of sound and thermal expansion. While the change
in echos due to speed of sound variations is unidirectional with
respect to temperature change (i.e., scatterers always appear
closer to the transducer at higher temperatures, when the speed
of sound increases with temperature), tissue displacement due to
thermal expansion is directional such that all the points between
the transducer and the center of focused heating move toward
the transducer, while the points behind the center of heating
are pushed away from the center. The infinitesimal echo strain
filter presented in [1] does not take this directionality of the
thermal expansion behavior into account. For a point between
the transducer and heating center located at depth z at baseline
temperature of θ, the round-trip time delay of the echoes can be
calculated as
 z
dξ
(1)
τ (z; θ) = 2
0 c(ξ; θ)
where c(ξ; θ) is the depth and temperature dependent speed of
sound. Temperature change creates both apparent and physical
changes in the estimated delay. The former is caused by the
change in speed of sound, while the latter is a result of tissue
thermal expansion. Hence, the frame-to-frame change in the
delay can be written as


z (θ +Δ θ )

δτ (z, T ) = 2
0

dξ
−2
c(ξ; θ + Δθ)


0

for the change in speed of sound and thermal expansion

and hence

c(ξ; θ + Δθ) = c(ξ; θ)(1 + βΔθ)

(3)

z(θ + Δθ) = z(θ)(1 − αΔθ)

(4)



z (θ )(1−α Δ θ )

dξ
c(ξ; θ)

(2)

where Δθ is the differential change in temperature at depth z
and T is the frame (wall clock) time. Assuming a linear model



z

dξ
.
0
0 c(ξ; θ)
(5)
Ignoring the second-order approximation terms, this can be further simplified as
 z (θ )
αzΔθ
βΔθdξ
δτ (z, T ) = −2
−2
.
(6)
c(z; θ)
c(ξ; θ)
0
δτ (z, T ) = 2

(1 − βΔθ)

dξ
−2
c(ξ; θ)

A closed form solution of (6) is presented in Appendix A where
temperature change and speed of sound are both considered as
functions of depth and time. Although the final solution is interesting in terms of the reconstruction model in the spatial domain
and it corroborates with a simpler model which follows, the implementation requires nonuniform sampling transformation and
successive updating of speed of sound and temperature field in
an iterative fashion. A simpler model can be derived by assuming small variations in the speed of sound and differentiating
both sides of the (6) with respect to z
αΔθ
αz∂Δθ/∂z
βΔθ
∂δτ (z, T )
= −2
−2
−2
.
∂z
c(z; θ)
c(z; θ)
c(z; θ)

(7)

Substituting for ∂z by c∂t/2 into (7) results in the simplified
equation:
z ∂Δθ
∂δτ (t, T )
= −(α + β)Δθ − α
(8)
∂t
c ∂t
where t is the propagation delay based on (1). Note that the
second term in (8) is an approximation of the second term in (7)
(by dropping the term with 1/c2 dependence).
In general, (8) is a nonlinear differential equation, which can
be solved numerically. However, for complexity reasons, we
would like to form a simpler implementation of the algorithm
using only ordinary digital filters. For this reason, the depth
variable z is replaced by a constant depth z0 . By taking Fourier
transform from both sides of the (8) with respect to the variable
t and rearranging the terms
Δ̂θ =

1
−jω (α +β
)
α τ /2
1 + jω (α
+β )

ˆ
δτ

(9)

ˆ are the Fourier transforms of Δθ and δτ ,
where Δ̂θ and δτ
respectively, and we defined τ = 2z0 /c as a constant.
The δ-ESF model presented in [1] was based on the infinitesimal length changes, which resulted in the following reconstruction model in the frequency domain:
Δ̂θ = jω

z

451

1
ˆ
δτ
(α − β)

(10)

which acts as a pure differentiator operator on the echo shifts
independent of any variations in the temperature baseline. The
slope of this differentiator is defined based on the tissue thermal
coefficients. Equation (9), on the other hand, has the form of a

452

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

differentiator–integrator, which can be implemented as an IIR
filter in the axial direction or can be combined with time accumulation to form a spatial-temporal filter. It is interesting to note
that, at low frequencies, the filter behaves like a differentiator,
which is consistent with the δ-ESF model in (10)1 . At higher
frequencies, however, the filter has a flat response with a gain of
2/ατ . The cutoff frequency of the filter is also a function of the
thermal expansion and the change in speed of sound coefficients.
This result is still attractive from the real-time implementation
point of view. Even though the derivation accounted for the inhomogeneous baseline, the final result does not rely on explicit
knowledge of this baseline.
The discrete time equivalent of the reconstruction filter in (9)
can be derived by using the bilinear transformation [19], [20]
2 z−1
Ts z + 1
where Ts is the sampling time of the RF data. Hence
s=

Δ̌θ =

1 − z −1
−2
ˇ
δτ
α
τ
ατ + Ts (α + β) 1 − −T s (α +β ) z −1

(11)

(12)

α τ +T s (α +β )

ˇ are the z transforms of Δθ and δτ respecwhere Δ̌θ and δτ
tively. (12) resembles an IIR filter in the axial direction on the
displacement data, the main reason that we call this the RESF
model. The gain and location of the pole of this filter are defined
by α, β (tissue dependent), and τ = 2z0 /c in which z0 is the effective length over which the recursion implied by (12) occurs.
A very small z0 results in a model that approaches the δ-ESF
model.
Fig. 1 shows the frequency response of the reconstruction
filters based on the δ-ESF model and the RESF model with
different z0 values, where we used α = 1 × 10−4 ◦ C−1 and β =
1 × 10−3 ◦ C−1 [1], [21]. As it can be seen from the plots, as z0
approaches zero, the RESF model approaches the δ-ESF model.
For given values of α and β, The effective recursion length,
z0 , defines the amount of smoothing implied by the integrator
part in (12). In monitoring of hyperthermia using HIFU, for
example, z0 can be in the order of the extent of the therapy
beam in the imaging plane, typically in the millimeter range.

Fig. 1. Frequency response of the RESF model for different depths along
with the δ-ESF response for α = 10−4 and β = 10 −3 . Solid black: The δ-ESF
model. Dashed red: The RESF model with z0 = 0.3 mm. Dotted blue: the RESF
model with z0 = 1 mm. Dash-dotted green: The RESF model with z0 = 4 mm.

can create a more localized pattern. The strong time correlation
of these patterns and the fact that most of these artifacts appear
as strong foci with quasi-cyclic temporal patterns suggest that
we can use strain information from outside the target region
of ultrasound thermography to correct for the errors occurring
within this region using adaptive filter techniques.
Let us assume the estimated temperature in the axial-lateral
grid point (m, n) and time index k to be θ(m, n, k). The artifactual temperature of a point outside the heated region due
to a strong deformation strain is denoted as θa (mi , ni , k) and
we collect N such points for interference compensation. Before
heating starts, for each time index k, the error is defined as
e(m, n, k) = θ(m, n, k) −

N


ai (m, n)θa (mi , ni , k)

(13)

III. ADAPTIVE MOTION COMPENSATION

i=1

Natural motions such as breathing, gasping, and pulsation in
vivo can cause significant artifacts in the estimated temperature.
These artifacts are due to the strain pattern induced by the mechanical stress on the tissue and the area for which the artifacts
manifest depends on the extent of the motion and connectivity
of the different parts of the underlying tissue. For example, the
strain pattern caused by gasping can spread over a wide range
of the imaging plane, such that when using the speckle tracking
algorithm regions of strong strain can be detected in almost entire imaging plane. Pulsation of small vessels, on the other hand,

where ai (m, n)’s are the coefficients of the adaptive filter for grid point (m, n). Using a normalized least mean
squares (NLMS) method, this error is used to find the optimal value of the coefficient vector a(m, n) = [a1 (m, n),
a2 (m, n), . . . , aN (m, n)] using the update equation

1 The difference in the scaling factors is due the fact that in [1], the thermal
expansion was included in the differential length element as dξ(θ + δθ) =
dξ(θ)(1 + αδθ), whereas here it is modeled as an overall length decrease in
the integral limit in (1) as z(θ + Δθ) = z(θ)(1 − αΔθ). Nevertheless, both
models result in a similar reconstruction filter at low frequencies and as long as
β is much larger than α as shown in Fig. 1.

a(k +1) (m, n) = a(k ) (m, n) + μe(m, n, k)

tfo ci (k)
T
tfo ci (k)tfo ci (k)

(14)
where tfo ci (k) = [θa (m1 , n1 , k), θa (m2 , n2 , k), . . . , θa (mN ,
nN , k)]T is a N × 1 vector containing the artifactual temperature data of each training point, at time k and μ is the step size
of the gradient descent algorithm used for training of the adaptive filter coefficients. The training phase stops as soon as the
artifactual temperature values drop below a defined threshold.
Once heating starts the corrected temperature field is calculated

BAYAT et al.: IN VIVO ULTRASOUND THERMOGRAPHY IN PRESENCE OF TEMPERATURE HETEROGENEITY AND NATURAL MOTIONS

Fig. 3.

453

Experiment setup used for imaging of the resistive wire in gel phantom.

Fig. 2. Adaptive filter configuration. N observation points are selected outside
the heated region based on preheating analysis of tissue motions and deformations (Green dots). A temperature reference point is selected from the heated
region (Red dot) based on the target of the focus and/or the analysis of the initial
heating rate immediately after the HIFU pulse is applied. The error function
shown in the schematics controls the adaptation according to an NLMS method
[22], [23].

as follows:
θc (m, n, k) = θ(m, n, k) −

N


a∗i (m, n)θa (mi , ni , k) (15)

i=1

where θc is the motion compensated temperature field and a∗i s
are the entries of the coefficient vector calculated at the last
iteration of the NLMS algorithm during the training phase. Fig. 2
depicts the diagram of this process, where green dots represent
the deformation foci and the red dot represents a point from the
target region for temperature estimation.
IV. MATERIALS AND METHODS
A. Experiment Setup and Data Acquisition
1) Wire Heating in Tissue-Mimicking Phantom: A thin resistive Nichrome wire (32 AWG) was embedded in a tissue
mimicking phantom which was prepared based on the method
described in [24]. The wire was 15-cm long with 4.5-Ω resistance. A 3-V dc source was applied to both ends of the wire,
which created around 667 mA of current for 13 s. RF data was
acquired before, during, and after the heating in a plane cross
sectional to the wire in M2D mode2 . RF data was collected using
a L14-5/38 linear array (LA) probe and the SonixRP machine
with research interface (Ultrasonix, BC, CA, USA).
A needle thermocouple (HYP-1 Omega, Philadelphia, PA,
USA) was inserted into the phantom very close to the heating
wire. During experiment, temperature data from the thermocouple was collected at 100 frames/s. A schematic of the experiment
setup is shown in Fig. 3.
2) Subtherapeutic Heating in the Hind Limb of Copenhagen
Rat In Vivo: The M2D data was acquired at 40-MHz sampling
rate and about 91 frames/s during subtherapeutic HIFU shots
in the hind limb of a Copenhagen rat as described in [17]. The
2 M2D-mode simply refers to acquiring RF data frames with limited extent in
a straightforward extension of the familiar M-mode imaging.

Fig. 4. Axial-lateral distribution of the estimated temperature around the
heated wire using (a) δ-ESF model and (b) RESF model at peak temperature.

HIFU shots were created using a 64-element DMUA transducer
(Imasonic, FR) operating at 3.5 MHz as described in [25]. The
M2D data was acquired using a LA (HST 15-8, Ultrasonics,
BC, CA, USA) and as described in [4], which allowed for relatively high frame rates at the expense of smaller lateral extent
of the image. The animal was partially submerged in a temperature controlled (34 ◦ C) degassed water and anesthetized
using Ketamine and Xylazine under University of Minnesota
approved IACUC protocol. This combination often results in
deep anesthesia, which appear to change the breathing pattern
of the animal. For example, the animal gasps for air at semiregular intervals after each period of low breathing activity. These
gasps are often separated by periods of 1.5–2 s and result in
significant displacements and strains throughout the hind limb
that present as temperature artifacts. Frame rates in the 80–200
frames/s range were found to be necessary for capturing the
transients of tissue motion and deformation due to pulsation,
breathing, as well as the radiation force effects of the pulsed
HIFU beams.
B. Data Processing
In all experiments, the M2D data was collected before, during, and after the heating procedure for use in calculating the
incremental displacement using speckle tracking algorithm as
presented in [1]. A kernel length of about 9λ (1.84 mm) was
used for both experiments, where λ is the wavelength of the

454

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

Fig. 5. Axial distribution of the estimated temperature around the heated wire. (a) Estimated temperature based on RESF model for z0 = 1 mm, z0 = 3 mm,
and z0 = 6 mm along with δ-ESF result. (b) Estimated temperature based on the RESF model with z0 = 6 mm at different heating (solid black) and cooling (solid
red) time instances.

diagnostic imaging waveform operating at 7.5 MHz. The incremental displacement field was passed through the axial filter
described in (12). For in vivo experiments α and β were set
to 3 × 10−4 and 2 × 10−3 ◦ C−1 , respectively, based on the average values of thermal coefficients for soft tissue [21], [26].
For gel phantom experiment α and β were set to 2 × 10−4 and
2 × 10−3 ◦ C−1 , respectively, based on the average values from
the slow heating experiments of the tissue mimicking phantoms
reported in [1] and [27]. The integrator part of the axial filter
in (12) was also applied in the reverse direction to compensate
for the group delay. After performing the axial processing, the
data is passed through a frame-to-frame accumulator followed
by a low-pass filer with the cutoff frequency of 1.5 Hz to create
the final estimated temperature. In each experiment, the baseline temperature was measured and used to map the estimated
temperature rise to the absolute temperature.
In order to compare the RESF temperature reconstruction
model with the δ-ESF model, the displacement data was also
processed using a wide-band axial differentiator and temporal
accumulator as described in [1] for the case of the phantom
experiment. In both in vitro and in vivo experiments, we exclude
the use of any 2-D filtering posttemperature calculations. For
example, the (2-D + Time) BHTE-inspired filter proposed in
[18] was not used here. This approach was effective in removing
temperature artifacts inconsistent with the physical model of
temperature evolution in tissue media. However, the objective
of this paper is to show that the new formulation removes some
of these artifacts by virtue of the filtering step implied by (12).
V. RESULTS AND DISCUSSION
To show the improvements achieved by the RESF model
and rule out other sources of interference and artifacts, we first
present the phantom results.
A. Heated Wire in a Tissue Mimicking Phantom
In order to demonstrate the ability of the RESF method in
correcting some of the temperature artifacts seen in the δ-ESF
model, we first present the results for heating the thin resistive

Fig. 6. Ultrasound estimated temperature (solid black) and thermocouple
reading (dotted red) very close to the heated wire.

wire embedded in the tissue mimicking phantom. Fig. 4 shows
the axial-lateral distribution of the estimated temperature using
(a) the δ-ESF model and (b) the RESF model. While the δ-ESF
model shows rapid temperature fluctuations and ripples due to
thermal lens effect, the RESF model has created a more localized
2-D temperature map consistent with the expected temperature
distribution around the heated wire. Fig. 5(a) shows the axial
distribution of the estimated temperature using the δ-ESF model
and the RESF model with different values of z0 . As it can be
seen the RESF suppresses most of the rapid fluctuations close to
the heating center, partly caused by the thermal lens effect. Fig.
5(b) shows the axial distribution of the estimated temperature using the RESF model with z0 = 6 mm at different time instances
during heating and cooling cycles. It can be seen that the RESF
model has resulted in a localized temperature map with a subtle elevation in the temperature distribution tail during cooling
cycle, which can be attributed to the diffusion process. Fig. 6
shows the thermocouple data along with the estimated temperature of a point at similar distance from the wire. As it can
be seen there is a good agreement between the two datasets
in terms of the extent of temperature change without using

BAYAT et al.: IN VIVO ULTRASOUND THERMOGRAPHY IN PRESENCE OF TEMPERATURE HETEROGENEITY AND NATURAL MOTIONS

455

Fig. 7. Spatio-temporal temperature profiles obtained: (a) Before and (b) after applying the motion compensation algorithm. In both cases the new derivation is
used without any post processing.

Fig. 8. Temperature profiles at t = 1.7 s obtained: (a) Before (b) after using the motion compensation method overlaid on a 50-dB B-mode iamge. (c) Temporal
profile of the estimated temperature before (dashed black) and after (solid black) motion correction along with the difference (dotted red).

additional scaling. The estimated temperature rise and fall also
show strong consistency with the thermocouple data.
B. In Vivo Results
We present the results of applying a subtherapeutic HIFU shot
in the hind limb of a Copenhagen rat in vivo. The displacement
data was passed through the temperature reconstruction filter in
(12) with z0 = 6 mm. This value of z0 provided best results when
combined with the adaptive motion compensation technique.
The result was then processed by the band-limited accumulator
in the temporal direction to create the final temperature estimate.
Subtherapeutic HIFU started after 1 s of baseline measurements and was on for 750 ms. The total duration of data recording was 4 s, where three sporadic gasps occurred within the data
collection interval. Mechanical deformation foci were observed
throughout the imaging plane and one location was selected
using a simple threshold on the strain data where 33 points
were selected as the interference inputs to the algorithm. Classic NLMS algorithm with step size of μ = 0.5 was implemented
on the artifactual (before HIFU was applied) temperature

data to train the coefficients of the filter for each grid point in the
target region. The update process stopped once the artifactual
temperature dropped below 38 ◦ C, where the baseline temperature was 34 ◦ C. Fig. 7 shows the axial-temporal distribution
of the estimated temperature profile before and after applying
the motion compensation method. First of all, the spatial distribution of the temperature seems to be consistent with the focus
of the HIFU beam which was at 40 mm. Ripple artifacts due
to the thermal lens effect are considerably reduced by using the
new model. In Fig. 7(a), it can be seen that three strong gasps
caused erroneous temperature estimates at three different time
instances right at the heating focus and 2 mm beyond the focus.
The motion compensation method has successfully canceled the
effect of these gasps without scarifying the spatial distribution
of the temperature. Fig. 8(a) and (b) shows the axial-lateral distribution of the estimated temperature before and after applying
the motion compensation overlaid on 50-dB B-mode image at
the second gasp time instance. The heterogeneity of the tissue
can be observed in this image, where the skin and connective tissues have created hyperechoic regions, while muscle tissues appeared as uniform defused scattering areas. The overlaid

456

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 62, NO. 2, FEBRUARY 2015

temperature map in Fig. 8(a) shows three regions with significant temperature rise. Fig. 8(b) shows the same temperature
map after applying the correction, where a confined temperature rise is seen and the artifact are significantly reduced. Fig.
3(c) shows the time profile of a point close to the focus. The
NLMS algorithm is able to converge in a fraction of second. It is
seen that while the corrected temperature preserves most of the
unaffected parts of the temperature profile, large temperature
errors in the order of 4 ◦ C (almost 40% of the peak temperature
change) are corrected.
VI. CONCLUSION
In this paper, we presented the RESF model for temperature
estimation based on the ultrasound echo shifts. In this model, instead of infinitesimal changes, the cumulative effect of thermal
expansion was used to relate the echo shifts to the temperature
changes which enabled the incorporation of the temperature
gradient in the derivations. The final formulation was shown to
be in the form of a differentiator–integrator filter with parameters defined by the physical properties of tissue and heating
source. The results of using the RESF model in the heated wire
phantom showed consistent axial distribution of the temperature as well as strong agreement with the thermocouple readings without additional scaling. Compared to the δ-ESF model
presented previously, the RESF model was shown to be less
sensitive to the rapid fluctuations caused by ignoring temperature gradients, as well as propagation artifacts including the
thermal lens effect. It was also shown that the RESF model can
change to the δ-ESF model via changing an effective recursion
length variable z0 . We then used the RESF model for estimating
the temperature during subtherapeutic HIFU shots in the hind
limb of a Copenhagen rat in vivo. Due to gasping significant
artifacts were introduced to estimated temperature. Using an
adaptive filter technique, we presented a motion compensation
method which takes advantage of the global availability of the
mechanical deformation patterns to train the coefficients of a
corrective filter. By using these coefficients and the data from
outside the target region, we showed that the effect of gasps
can be significantly reduced without sacrificing the spatial and
temporal distribution of the temperature. When combined by
spatial temporal filtering approaches, these results suggest the
suitability of ultrasound thermography for in vivo applications
as long as good assumptions about local tissue formation and
physical properties can be made.
APPENDIX
CLOSED FORM SOLUTION OF THE THERMAL-ECHO
DISPLACEMENT EQUATION
At high frame rates where the change in temperature is very
small, (6) becomes
 z
βdθ
2zαdθ
−2
dξ
(16)
dτ (z, T ) = −
c(z; θ)
0 c(ξ; θ)
where the temperature field θ(z, T ) is considered as a 2-D function and variable T represents the time progress along M2D
frames. The first term in the right-hand side of (16) represents

the change in echo shifts due to the thermal expansion, while
the second term represents the variations due to the change in
speed of sound. By replacing c(z; θ) with c(z, T ) and noticing
that the differential in (16) is due to time progress we have
 z
β(ξ, T ) ∂θ(ξ, T )
2zα ∂θ(z, T )
∂τ (z, T )
=−
−2
dξ.
∂T
c(z, T ) ∂T
∂T
0 c(ξ, T )
(17)
The time derivative of the echo location in (17) can be regarded
as the incremental displacement in the speckle tracking algorithm as explained in [1]. Given that the variations of speed of
sound with temperature is known, in its general form, (17) represents a nonhomogeneous nonlinear integro-differential equation
of temperature distribution over time and space. A consistent solution for this equation should satisfy the bioheat equation with
given boundary and initial conditions. Taking Fourier transform
from both sides of (17) with respect to variable z

Fz

∂τ (z, T )
∂T





1 ∂θ(z, T )
d
Fz
= −2αj
dkz
c(z, T ) ∂T


β(z, T ) ∂θ(z, T )
2
Fz
. (18)
−
jkz
c(z, T ) ∂T

Considering β as a constant and defining ϕ = (∂θ/∂T )/c we
have


∂τ (z, T )
2
dφ
−
βφ
(19)
Fz
= 2αj
∂T
dkz
jkz
where φ = Fz {ϕ}. Alternatively
dφ
β φ
1
Fz
−
=−
dkz
α kz
2αj



∂τ (z, T )
∂T


.

(20)

Equation (20) is a solvable ODE with the following closed form
solution


 −β /α
∂τ (z, T )
kz
Fz
(21)
φ = −kzβ /α
dkz
2αj
∂T
and taking inverse Fourier transform




 −β /α
∂τ
(z,
T
)
k
z
ϕ = −Fz−1 kzβ /α
Fz
dkz .
2αj
∂T

(22)

The last equation relates the temperature rate to the incremental displacement via baseline speed of sound which can be in
turn updated sequentially. Considering that (22) is derived with
minor assumptions about change in speed of sound and temperature heterogeneity, it still resembles the form of a differentiator–
integrator suggested by (9) with appropriate assumptions about
α and β.
ACKNOWLEDGMENT
The authors would like to thank Dr. D. Liu for his efforts in
the design of the M2D system, Dr. J. Choi, and Prof. J. Bischof
for helping with the animal study, and Dr. A. J. Casper, A.
Haritonova, and E. Welken-Resman for help during the experiment and discussions.

BAYAT et al.: IN VIVO ULTRASOUND THERMOGRAPHY IN PRESENCE OF TEMPERATURE HETEROGENEITY AND NATURAL MOTIONS

REFERENCES
[1] C. Simon, P. VanBaren, and E. S. Ebbini, “Two-dimensional temperature
estimation using diagnostic ultrasound,” IEEE Trans. Ultrason., Ferroelect., Freq. Control, vol. 45, no. 4, pp. 989–1000, Jul. 1998.
[2] R. Maas-Moreno, and C. A. Damianou, “Noninvasive temperature estimation in tissue via ultrasound echo shifts. Part I. Theoretical model,” J.
Acoust. Soc. Amer., vol. 100, pp. 2514–2521, NCRP rep. no. 113, 1996.
[3] D. Liu, J. Jeong, J. Ballard, J. Bischof, and E. S. Ebbini, “Real-time
monitoring of thermal and mechanical response to sub-therapeutic HIFU
beams in vivo,” in Proc. IEEE Ultrason. Symp., 2010, pp. 2254–2257.
[4] D. Liu, and E. Ebbini, “Real-time 2-D temperature imaging using ultrasound,” IEEE Trans. Biomed. Eng., vol. 57, no. 1, pp. 12–16, Jan. 2010.
[5] N. R. Miller, J. C. Bamber, and P. M. Meany, “Fundamental limitations
of noninvasive temperature imaging by means of ultrasound echo strain
estimation,” Ultrasound Med. Biol., vol. 28, pp. 1319–1333, 2002.
[6] R. Souchon, G. Bouchoux, E. Maciejko, C. Lafon, D. Cathignol,
M. Bertrand, and J.-Y. Chapelon, “Monitoring the formation of thermal
lesions with heat-induced echo-strain imaging: A feasibility study,” Ultrasound Med. Biol., vol. 31, no. 2, pp. 251–259, Feb. 2005.
[7] T. Varghese, J. A. Zagzebski, Q. Chen, U. Techavipoo, G. Frank,
C. Johnson, A. Wright, and F. L., Jr., “Ultrasound monitoring of temperature change during radiofrequency ablation: Preliminary in-vivo results,”
Ultrasound Med. Biol., vol. 28, pp. 321–329, 2002.
[8] M. Pernot, M. Tanter, J. Bercoff, K. Waters, and M. Fink, “Temperature
estimation using ultrasonic spatial compounding,” IEEE Trans. Ultrason.,
Ferroelect., Freq. Control, vol. 51, no. 5, pp. 606–615, May 2004.
[9] R. Seip, P. VanBaren, C. Cain, and E. S. Ebbini, “Non-invasive real-time
multipoint temperature control for ultrasound phased array treatments,”
IEEE Trans. Ultrason., Ferroelect., Freq. Control, vol. 43, pp. 1063–1073,
Nov. 1996.
[10] A. N. Amini, E. S. Ebbini, and T. Georgiou, “Noninvasive estimation of
tissue temperature via high-resolution spectral analysis techniques,” IEEE
Trans. Biomed. Eng., vol. 52, no. 2, pp. 221–228, Feb. 2005.
[11] R. M. Arthur, W. L. Straube, J. W. Trobaugh, and E. G. Moros, “In vivo
change in ultrasonic backscattered energy with temperature in motioncompensated images,” Int. J. Hyperthermia, vol. 24, no. 5, pp. 389–398,
2008.
[12] R. L. Clarke, N. L. Bush, and G. R. T. Haar, “The changes in acoustic attenuation due to in vitro heating,” Ultrasound Med. Biol., vol. 29,
pp. 127–135, 2003.
[13] U. Techavipoo, T. Varghese, Q. Chen, T. A. Stiles, J. A. Zagzebski, and
G. R. Frank, “Temperature dependence of ultrasonic propagation speed
and attenuation in excised canine liver tissue measured using transmitted
and reected pulses,” J. Acoust. Soc. Amer., vol. 115, pp. 2859–2865, 2004.
[14] M. Bayat, J. R. Ballard, and E. S. Ebbini, “Ultrasound thermography in
vivo: A new model for calculation of temperature change in the presence of temperature heterogeneity,” in Proc. IEEE Int. Ultrason. Symp.,
Jul. 2013, pp. 116–119.
[15] C. Simon, P. VanBaren, and E. S. Ebbini, “Motion compensation algorithm
for non-invasive two-dimensional temperature estimation using diagnostic
pulse-echo ultrasound.’ in Proc. SPIE, vol. 3249, 1998, pp. 182–192.
[16] M. J. Daniels and T. Varghese, “Dynamic frame selection for in vivo
ultrasound temperature estimation during radiofrequency ablation,” Phys.
Med. Biol., vol. 55, no. 16, pp. 4735–4753, Aug. 2010.
[17] D. Liu, J. R. Ballard, A. Haritonova, J. Choi, J. Bischof, and E. S. Ebbini,
“Real-time monitoring of thermal and mechanical tissue response to modulated phased-array HIFU beams in vivo,” in Proc. Int. Symp. Ther. Ultrasound, 2011, vol. 1481, pp. 227–232.
[18] E. Ebbini, “Noninvasive two-dimensional temperature imaging for guidance of thermal therapy,” in Proc. Int. Symp. Biomed. Imag., 2006,
pp. 884–887.
[19] J. G. Proakis, C. M. Rader, F. Ling, C. L. Nikias, M. Moonen, and I. K.
Proudler, Algorithms for Statistical Signal Processing. Englewood Cliffs,
NJ, USA: Prentice-Hall, 2001.
[20] M. Bayat, J. R. Ballard, and E. S. Ebbini, “Ultrasound thermography: A
new temperature reconstruction model and in-vivo results,” Submitted for
publication, in Proc. Int. Symp. Ther. Ultrasound, Apr. 2014.
[21] F. A. Duck, Physical Properties of Tissues. London, U.K.: Academic
Press, 1990.
[22] M. Bayat, J. R. Ballard, and E. S. Ebbini, “Adaptive motion compensation for in vivo ultrasound temperature estimation,” in Proc. IEEE Int.
Ultrason. Symp., Jul. 2013, pp. 1797–1800.
[23] S. Haykin, Adaptive Filter Theory, (Information and System Science Series). Englewood Cliffs, NJ, USA: Prentice-Hall, 2002.

457

[24] K. R. Nightingale, M. L. Palmeri, R. W. Nightingale, and G. E. Trahey,
“On the feasibility of remote palpation using acoustic radiation force,” J.
Acoust. Soc. Amer., vol. 110, pp. 625–634, Jul. 2001.
[25] A. J. Casper, D. Liu, J. R. Ballard, and E. S. Ebbini, “Real-time implementation of a dual-mode ultrasound array system: In vivo results,” IEEE
Trans. Biomed. Eng., vol. 60, no. 10, pp. 2751–2759, Oct. 2013.
[26] NCRP, “Report no. 113: Exposure criteria for medical diagnostic ultrasound: I. Criteria based on thermal mechanics,” National Council on Radiation Protectin and Measurements, Tech. Rep., 1992.
[27] D. Liu, “Real-time imaging of thermal and mechanical tissue response to
focused ultrasound,” Ph.D. dissertation, Dept. Biomed. Eng., University
of Minnesota, Minneapolis, MN, USA, 2010.

Mahdi Bayat (S’12–M’14) received the B.Sc. degree
in electrical engineering from the Iran University of
Science and Technology, Tehran, Iran, in 2004, and
the M.S. and Ph.D. degrees in electrical engineering from the University of Minnesota, Twin Cities,
Minneapolis, MN, USA, in 2014.
He is currently a Postdoctoral Research Fellow
at the Ultrasound Imaging Laboratory, Mayo Clinic,
Rochester, MN. His research interests include statistical signal processing with applications to therapeutic
and diagnostic ultrasound.

John Robert Ballard (S’02, M’12) received the
B.S. degree in electrical engineering from Michigan
State University, East Lansing, MI, USA, in 2005,
and the M.S. and Ph.D. degrees in electrical engineering, from the University of Minnesota, Twin
Cities, Minneapolis, MN, USA, in 2007 and 2012,
respectively.
He was a Postdoctoral Researcher with the Ultrasound Imaging and Signal Processing Laboratory,
University of Minnesota, where he worked on minimal and noninvasive surgery with a particular focus
on the use of HIFU for oncological and cardiovascular applications. He is currently a Senior Innovation Fellow at the Medical Devices Center, University of
Minnesota. His research interests include signal processing, IP development,
and Class I and Class II medical device development for use in cardiology,
intensive care, medical imaging, and at home monitoring.

Emad S. Ebbini (S’82–M’90–SM’08–F’11) received the B.Sc. degree in EE/communications from
the University of Jordan, Amman, Jordon, in 1985,
and the M.S. and Ph.D. degree in EE from the University of Illinois at Urbana-Champaign, Champaign,
IL, USA, in 1987 and 1990, respectively.
From 1990 to 1998, he was at the Faculty of
the EECS Department, University of Michigan, Ann
Arbor. Since 1998, he has been with the ECE Department, University of Minnesota, Minneapolis, MN,
USA. His research interests include signal and array
processing with applications to biomedical ultrasound and medical devices.
Dr. Ebbini received the National Science Foundation Young Investigator
Award for his work on new ultrasound phased arrays for imaging and therapy
in 1993. He was a Member of AdCom for the IEEE Ultrasonics, Ferroelectrics,
and Frequency Control Society between 1994 and 1997. In 1996, he was a
Guest Editor for a special issue on therapeutic ultrasound and an Associate
Editor from 1997 to 2002, both of the IEEE TRANSACTIONS ON ULTRASONICS,
FERROELECTRICS, AND FREQUENCY CONTROL. He is a Member of the standing
technical program committee for the IEEE Ultrasonics Symposium. He served
as a Member of the Board of the International Society for Therapeutic Ultrasound from 2002 to 2011, and is currently serving as its President from 2012 to
2015.

