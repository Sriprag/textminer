IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 3, MARCH 2014

911

A Self-Tuning Adaptive Controller for 3-D
Image-Guided Ultrasound Cancer Therapy
Amin Yazdanpanah Goharrizi∗ , Member, IEEE, Raymond H. Kwong, Senior Member, IEEE, and Rajiv Chopra

Abstract—One of the challenges in MRI-controlled hyperthermia cancer treatment for localized tumor is that the tissue properties are dynamic and difficult to measure. Therefore, tuning the
optimal gains for a constant gain controller can be challenging.
In this paper, a new multi-input single-output adaptive controller
strategy is proposed to address these problems. The inputs to the
controller block are the frequency, rotation rate, and applied power
level of an interstitial applicator, and the output is the boundary
temperature during treatment. The time-varying gains of the new
controller are updated over time using Lyapunov-based stability
analysis. The robustness of the new controller to changes in the
parameters of the tissue is investigated and compared to a constant gain controller through simulation studies. Simulations take
into account changes in tissue properties and other conditions that
may be encountered in a practical clinical situation. Finally, the
effectiveness of the proposed controller is validated through an
experimental study.
Index Terms—Adaptive temperature control, image-guided
therapy, minimally-invasive, ultrasound interstitial thermal
therapy.

I. INTRODUCTION
HERE is an increasing interest in the development of
less-invasive treatments for localized cancer as an alternative to conventional therapies (radiation, surgery) which
are associated with high complication rates and long recovery
times [1]–[3]. MRI-guided ultrasound therapy is under development as a minimally-invasive, image-guided treatment for
localized soft-tissue cancers in which high-intensity ultrasound
energy is used to coagulate a target region of tumor from outside
the body or within body cavities. Externally applied focused ultrasound where the ultrasound transducer is located outside the
body works well in organs which have a clear acoustic path
such as uterine fibroids, but is difficult in cases where gas/bone
is in the beam path. In these cases, an interstitial ultrasound applicator (UA) inserted into body cavities or directly into tissue

T

Manuscript received January 22, 2013; revised November 4, 2013; accepted
November 14, 2013. Date of publication November 25, 2013; date of current version February 14, 2014. This work was supported in part by MITACS.
Asterisk indicates corresponding author.
∗ A. Y. Goharrizi is with Medmectron, Inc., North York, Toronto, ON M2K
1S2, Canada (e-mail: aminyazdan@gmail.com).
R. H. Kwong is with the Department of Electrical and Computer Engineering, University of Toronto, Toronto, ON M5S 3G4, Canada (e-mail:
kwong@control.utoronto.ca).
R. Chopra is with the Department of Radiology, University of Texas
Southwestern Medical Center, Dallas, TX 75235 USA (e-mail: Rajiv.
Chopra@utsouthwestern.edu).
Color versions of one or more of the figures in this paper are available online
at http://ieeexplore.ieee.org.
Digital Object Identifier 10.1109/TBME.2013.2292559

can deliver ultrasound energy to the tumor volume to raise the
temperature for thermal coagulation.
Thermal therapy for localized tumors requires the ability to
deliver the energy precisely to a target volume of tissue while
avoiding thermal damage to surrounding structures. To have
accurate control over spatial and temporal deposition of ultrasound energy for temperature regulation, a feedback control
loop is required. Magnetic resonance (MR) thermometry using
the proton resonant frequency shift method [4] makes it possible
to monitor the temperature under feedback control for clinical
situations. Various control strategies have been used for controlling the temperature in hyperthermia treatments. In this context,
Lin et al. [5] developed a proportional-integral-derivative (PID)
controller with constant gains for controlling the temperature.
They used an external ultrasound transducer and controlled the
temperature at a single point or multiple points. Another application of PID controller for 3-D thermal treatment has been
reported in [6] in which an external focused UA was used.
Their targeted volumes were limited to simple geometries (cubes
and spheres). Other advanced control techniques such as linear
quadratic regulator [7] and model predictive control [8] have
been developed. Adaptive control techniques for temperature
regulation have been also reported in [9]. However, their applications were only limited to a single-point temperature control
and using an external focus ultrasound transducer. Furthermore,
an accurate model of the tissue is required for designing such
controllers. Due to the lack of a theoretically rigorous and experimentally validated Bioheat transfer model [10], model-based
control techniques cannot guarantee a good performance for
controlling the temperature. Besides, thermal properties such
as thermal conductivity and blood perfusion are patient-specific
and can change during treatment [11]. These inaccuracies degrade significantly the performance of the controllers which
are designed based on the model of the tissue [7]–[9] or have
constant gains such as [5], [6].
A number of research groups have been developing MRIguided interstitial ultrasound therapy as a minimally-invasive,
image-guided treatment for localized soft-tissue tumors [12]–
[15]. Another group [16] has also used an endorectal phasedarray applicator with a PID controller to control the power.
Our initial efforts have been focused on the application of this
technology for the treatment of localized prostate cancer, and
the technology has been evaluated through simulations, device
development, preclinical canine studies, and human feasibility
studies [17]. The applications for this technology are broader
than prostate cancer, and it could have been used in soft-tissue
organ sites where a target volume of tissue is amenable to thermal coagulation.

0018-9294 © 2013 IEEE. Personal use is permitted, but republication/redistribution requires IEEE permission.
See http://www.ieee.org/publications standards/publications/rights/index.html for more information.

912

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 3, MARCH 2014

A prototype system developed within our group for MRIcontrolled transurethral ultrasound therapy consists of a multielement ultrasound heating applicator, operated under rotational
control within a standard MRI [18], similar to systems described
by others previously [12], [14], [15]. The multielement planar
transducer emits a directional ultrasound beam producing localized heating in the prostate gland. Although many researchers
developed different controller algorithms for external focused
ultrasound [5]–[9], their applications in interstitial therapy is
still limited. In similar work by other groups [12], [14], the
power was set to a constant value and the rotation rate was
changed manually. In our system, the rotation rate of the applicator, the frequency, and the power output from each element
can be independently adjusted to control the targeted temperature, resulting in a multi-input single-output (MISO) control
problem. The technology developed in our group, is the only
interstitial ultrasound technology in which these multiple inputs are automatically adjusted such that a desired temperature
threshold is achieved along the predefined target boundary. Previously, a simple proportional temperature controller was used
to adjust the power [13], [18]. The rotation rate is also adjusted
using a separate proportional controller. In [19], a constant gain
proportional-integral (PI) controller is designed to control the
power, and the rotation rate is calculated as a function of power.
It is further shown that one value of the temperature measured
along the beam path is sufficient enough to have an acceptable
3-D conformal heating pattern [19].
This study is motivated by the desire to develop a control
algorithm which does not rely on the model of the tissue, as
well as, offers a robust, accurate, and fast temperature control in
the presence of time-varying tissue properties. PID controllers
still are the most popular controllers in industry since they have
a simple structure and do not require any detailed information
about the model of the system under control. However, the
performance of these controllers is highly dependent on the
tuning process for the gains. The main difficulty in MR-guided
thermal therapy in vivo is the uncertainty in the parameters used
for tuning the controller such as the ultrasound absorption or
blood perfusion [20]. These properties are known to be spatially
heterogeneous and difficult to measure in tissue, potentially
reducing the effectiveness of constant gains PID controllers in
clinical hyperthermia applications [21]. However, alternative
PID approaches (e.g., adaptive PID) can provide more robust
temperature control which is less dependent on tissue parameters
[20], [21]. In [22], an adaptive PID controller is proposed to
control the temperature at a single point using external focused
ultrasound. The effect of heat diffusion and surrounding tissues
were not considered in the evaluation of the performance of
the controller. In this paper, a controller strategy incorporating
an adaptive PI controller is introduced which eliminates the
tuning challenges of a constant gain controller due to dynamic
environment in the tissue. As opposed to [22], we have a MISO
control problem subject to time-varying tissue properties and
other conditions that may be encountered in a practical clinical
situation. The power from each ultrasound transducer element
is controlled using this adaptive PI controller. A Lyapunovbased stability approach is introduced to update the gains of

the controller over time that guarantees stability of the closedloop system. A simple controller is proposed for controlling
the device rotation rate (motor speed). The frequency of the
applicator is also adjusted based on the targeted radius. This
controller algorithm requires no model knowledge of the system
and is simple to implement. These features make the proposed
controller very attractive from an industrial point of view. Using
a simulation platform developed for image guided interstitial
ultrasound therapy in our group; the effectiveness of the new
self-tuning adaptive controller is compared with a constant gain
controller under dynamic environment. The results indicate that
the self-tuning adaptive controller works significantly better in
terms of treatment time and accuracy compared to the constant
gain controller.
II. TISSUE AND TRANSDUCER MODELING
A. Treatment Model
For the numerical study in this paper, the bioheat transfer
equation [23] was used. This differential equation approximates
the dynamics between heat diffusion, power deposition, and the
loss of heat due to blood perfusion in tissue. The equation is
given as follows:
∂T (r, t)
∂t
(1)
where kt is the thermal conductivity of tissue (W m−1 ◦ C−1 ),
T (r, t) is the temperature distribution in tissue, Tb is the temperature of blood, Q(r, t) is the deposited acoustic power
(W m−3 ), wb is the blood perfusion (kg m−3 s−1 ), cb is the
specific heat capacity of blood (J kg−1 ◦ C−1 ), ct is the specific
heat capacity of tissue, and ρ is the density of tissue (kg m−3 ).
The left-hand side of (1) can be replaced by a finite difference
approximation at time interval t. An obvious approximation for
∂T
the forward difference formula applied to T at point p,
∂ t is
∂T 
T (t+Δ t)−T p (t)
i.e., ∂ t p = p
. An explicit 3-D finite difference
Δt
solution allows Tp (t + Δt) to be calculated simply in terms of
its own and its six neighboring temperature value at time interval
t, which are all known. The thermal calculations were performed
at a temporal and spatial resolution of 1s and 1 mm (isotropic),
respectively. More details can be found in [24] and [25]. The
values used for tissue parameters used in the simulations are
shown in Table I [25].
∇(kt ∇T )(r, t) + Q(r, t) − wb cb (T (r, t) − Tb ) = ρct

B. Transducer Model
The UA contains a multielement planar PZT ultrasound transducer with a width of 4 mm, and a length determined by the
number of elements and the length of each element. For this
study, UA consists of eight elements, each 5 mm in length.
Continuously degassed water is circulated through the device
at approximately 300 mL/min during power delivery to remove
thermal losses from the transducer. The electrical power is transmitted from a multipin receptacle (Lemo, Ecubiens, Switzerland) at the back end of the applicator to the transducer via a
multi-conductor shielded cable (New England Wire and Cable,
Lisbon, NH, USA). More details can be found in [18].

GOHARRIZI et al.: A SELF-TUNING ADAPTIVE CONTROLLER FOR 3-D IMAGE-GUIDED ULTRASOUND CANCER THERAPY

TABLE I
PHYSICAL PARAMETERS USED IN ACOUSTIC CALCULATION AND
BIOTHERMAL SIMULATION [25]

913

in this application. An adaptive PI controller is designed based
on Lyapunov stability [28] to control the power of ultrasound
transducer. The Lyapunov design guarantees the stability of a
closed-loop control system. It is similar to the adaptive PID
controller in [29].
Consider the single-input and single-output system
ẋ = Ax + Bu
y = Cx

(5)

where x is the (n × 1) state vector and u and y are the scalar
control and output signals, respectively.
Based on Kalman–Yakubovich Lemma, the system is strictly
positive real (SPR), if and only if there are positive definite
matrices P and Q such that [29]
AT P + P A = −Q

The ultrasound power deposited in tissue, Q (W cm−3 ), was
obtained from [26]
Q=

αabs p
ρc

2

(2)

where, p is the acoustic pressure distribution (Pa), c is the speed
of sound (m/s), and αabs is the ultrasound absorption coefficient (Np/m/MHz). The 3-D acoustic pressure distribution was
calculated as [27]
 

N
kxn Δw
jρcΔAun  1 −(μ a t t +j k )R
e
p=
sinc
λ
R
2R
n =1
 

kyn Δh
× sinc
(3)
2R
where N is the number of elements of size ΔA = ΔhΔw, j is
the imaginary unit, λ is the wavelength (m), un is the amplitude
velocity of the surface, R is the distance from the transducer
(m), μatt is the acoustic attenuation (Np/m/MHz), and k is the
wave number (m−1 ).

B T P = C.

We assume that the 3-D state-space model in (4) is SPR.
In this application, we control the temperature at one voxel
each time. As shown in the Appendix, if we consider this as a
single-input single-output system, it can be modeled quite well
by a first-order system. Such a first-order system is SPR. While
Lyapunov stability provides the theoretical underpinnings to the
adaptive control design, ultimately its performance is the most
important metric in this application.
Define the error as x̃ = xd − x where xd is the desired value
for x resulting in the desired output yd = Cxd . Let ud be the
control value such that x reaches the steady-state value of xd .
Set the control signal u to be given by

u = ud + Kp (t)(yd − y) + KI (t) (yd − y)dt
(7)
where Kp (t) is the proportional gain and KI (t) is the integral
gain. Define z = (yd − y)dt. The error x̃ can be found to
satisfy the equation
x̃˙ = (A − BKp C)x̃ − BKI z.

C. State-Space Formulation
A state-space model is capable of incorporating the coupling
between the input power u and output temperature y. Using
finite dimensional approximation, the Bioheat equation (1) can
be written as [8]
Ṫ = AT + Bu
y = CT

(6)

(4)

where A is the system matrix incorporating both conduction
and perfusion terms and B is the input matrix determined by
(2), the state vector T is the temperature at different nodes of
the tissue model. The output matrix C selects the temperature
at the boundary and u = ρcu2n is the input power. The form of
matrices A, B, and C are given in the Appendix.
III. SELF-TUNING ADAPTIVE CONTROLLER
As we will see in the next section, we have to control three
separated variables (power, frequency, as well as the rotation
rate of the ultrasound applicator) to regulate the temperature

(8)

Choose the Lyapunov function for (8) as
V = x̃T P x̃ +

Kp2
K2
+ I
γ1
γ2

(9)

where P is the solution to (6) and γ1 > 0, γ2 > 0 are the adaptation gains for the controller. Using (8) and (6), a straightforward
calculation shows that the derivative of Lyapunov function is
given by
V̇ = x̃T AT P x̃ + x̃T P Ax̃ − x̃T C T KP B T P x̃
− x̃T P BKp C x̃ +

2Kp K̇p
γ1

− zKI B T P x̃ − x̃T P BKI z +

2KI K̇I
γ2

= −x̃T Qx̃ − 2x̃T C T KP C x̃
+

2Kp K̇p
2KI K̇I
− 2zKI C x̃ +
.
γ1
γ2

914

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 3, MARCH 2014

Fig. 2.

Fig. 1. Typical temperature profile along the direction of heating of an ultrasound transducer element.

By selecting these adaptation laws for Kp and KI
K̇p = γ1 (yd − y)2
K̇I = γ2 (yd − y)z = γ2 (yd − y)


(yd − y)dt.

(10)

Then, we have V̇ = −x̃T Qx̃ ≤ 0 which shows the system
in (8) is stable. Note that V̇ = 0 only when x̃ = 0. Applying
LaSalle’s theorem [28], we conclude that x̃ → 0 as t → ∞.
In the next section, we apply this adaptive PI controller design
to control the power so that the controller gains are automatically
adjusted as the treatment environment changes.
IV. THREE-DIMENSIONAL CONTROL ALGORITHM
FOR INTERSTITIAL THERMAL TREATMENT
Fig. 1 shows a multielement transducer positioned inside a
continuous 3-D target boundary of the prostate as well as the typical temperature profile along the direction of heating of an ultrasound transducer element. The temperature rises quickly from
Tu (the temperature of water flowing through the transurethral
device), reaching a maximum value Tm ax at about 5–10 millimeters from the transducer surface, then decreasing and reaching
the ambient body temperature within a few millimeters. An MR
thermometry image centered on each transducer element measures temperature changes created within the target boundary
in the plane of rotation of each element. The distance from
each transducer element, i, to the 3-D target boundary along
the direction of heating is defined as the target radius, ri , with
temperature Tr i . The control algorithm should be able to reduce
the temperature error between the Tc , the desired temperature
at the boundary, and Tr i (e = Tc − Tr i ) by adjusting the power
(P ), frequency (f ), and rotation rate (ω). The value for Tc is
chosen to be 55 ◦ C to keep the same consistency as our previous
studies.
As mentioned previously, we have a MISO control problem
in this application. The output to be controlled is the temperature at the targeted boundary,Tr i , and the inputs are power
(P ), frequency (f ) and rotation rate (ω). The block diagram
representing the proposed controller is also shown in Fig. 2.
First to adjust the power, the adaptive PI controller developed
in previous section is used. The power is considered to be the

Block diagram of the proposed controller.

input to the system (u in (4)) and the targeted boundary, Tr i , is
considered to be the output, y, in (4).
The power for each element changes between zero and the
maximum acoustic power, pm ax , which is 4 watt. The power is
turned OFF, when the maximum temperature (Tm ax ) exceeds a
threshold value,Th (typically 90 ◦ C), to avoid boiling in tissue.
It is also turned OFF, if the boundary temperature exceeds the
critical temperature to avoid overtreatment (e < 0). Therefore,
the equation for power turns out to be as
	
0
Tm ax > Th , or e < 0

Pi =
Kp (t)e + KI (t) edt Tm ax ≤ Th , and e > 0
(11)
where Kp and KI are the adaptive gains and calculated as
K̇p (t) = γ1 e2

K̇I (t) = γ2 e edt.

(12)

The values for γ1 , γ2 are chosen to be 0.0004. Another challenge in this study is to control the rotation rate. This is the only
interstitial ultrasound therapy system which has an automatically adjusted rotation rate. We propose a simple but effective
controller to adjust the rotation rate of the device and relate it
to the error e. The logic is that for a high error value we need to
slow down to give the controller more time to raise the temperature and for a small error value the applicator should speed up
to avoid overheating the tissue. Thus, the following controller is
proposed:
⎧
if e > 5◦ C
⎪
⎨ ωm in ,
ωi = 30◦ / min, if 0◦ C < e <= 5◦ C
⎪
⎩
if e ≤ 0
ωm ax ,
ω = min {ωi }.
i=1,...,n

(13)

Note that the aforementioned values were found to be appropriate to have a fast treatment as well as good accuracy.
The rotation rate is limited between the maximum rotation rate,
ωm ax , and the minimum rotation rate ωm in . These values are
set to be 120 and 8◦ /min, respectively, based on the finite imaging time (for the maximum rotation rate) and limitations of the
rotational motor (for the lower value). To avoid overtreatment,
the motor rotates with the maximum rotation rate, ωm ax , when
e < 0.
The frequency of the applicator is also adjusted based on
the radius at which the temperature should be controlled and is

GOHARRIZI et al.: A SELF-TUNING ADAPTIVE CONTROLLER FOR 3-D IMAGE-GUIDED ULTRASOUND CANCER THERAPY

defined as

	
fi =

fhigh ,

ri < rf

flow ,

ri ≥ rf

.

915

(14)

Here, rf is the target radius where the frequency is switched
between the first and third harmonic in order to optimize treatment time [30]. The resonant frequencies, fhigh and flow , of
the transducer are 4.5 and 14.5 MHz, respectively, based on the
frequencies of existing devices, and the rf is set to be 18 mm.
The ri values are the prostate boundaries which are known beforehand. The complete description of the new controller is thus
given by (11)–(14).
Remark: For most of the time, the temperature at the targeted
boundary, Tr i , is less than the desired temperature which is
55 ◦ C. This makes the error positive and leads to integral windup.
Although an antiwindup strategy is employed, we still have
overtreatment due to heat diffusion. Our observation shows that
the temperature rises up to about 3 ◦ C due to heat diffusion.
Therefore, in order to compensate for this problem, we subtract
this value from the error before calculating its integral at each
sampling time.
V. SIMULATION RESULTS
In this section, the effectiveness of the self-tuning adaptive
controller is studied for interstitial ultrasound thermal therapy
of prostate cancer. A simulation platform was developed in our
group in order to simulate an interstitial UA inserted into the
tumor (see Fig. 1). The core section of the simulation platform
is written in C++ with a MATLAB graphical user interface
in which someone can set the simulation variables such as the
frequency of the applicator and blood perfusion. The technology
has been evaluated through preclinical canine studies as well as
human feasibility studies [17], [18].
One of the problems in thermal treatment of cancer is that the
parameters of tissue change over time. A controller is needed
to compensate for these changes for a safe and more accurate
treatment. Tuning of a constant gain controller can be challenging due to the fact that the properties of the tissue are still not
well known and can change from patient to patient [10], [11].
In order to show the effectiveness of the new controller, we
compare its performance with a constant gain PI controller for
power under a dynamic environment using the same rotation rate
and applicator frequency control schemes for both controllers.
One of the most important tissue properties which can change
during the treatment is the blood perfusion. The other one is
the attenuation of the ultrasound. For the purpose of this paper,
we assume that the tissue blood perfusion is 2.6 kg/s/m3 and
the attenuation is 9.3 Np/m/MHz. A constant gain PI controller
was tuned to work well for these tissue values. The gain Kp
was found to be 2.5 and the gain KI was found to be 0.01.
We call these conditions the normal operating conditions. In the
next scenario, we assume that the blood perfusion is increased
to 10 kg/s/m3 and the ultrasound attenuation is decreased to
be 4.5 Np/m/MHz. These values are chosen in order to show
the difference between two controllers more clearly. Hereafter,
these conditions are called the faulty operating condition. The

Fig. 3. Pattern of conformal thermal heating for elements E4, E5 of ultrasound
transducer under normal operating condition.

effectiveness of both controllers is examined for both normal
and faulty operating conditions through simulation studies. For
simulation studies, three prostate geometries segmented from a
recent human feasibility test of patients undergoing transurethral
ultrasound therapy were used for target boundaries. These 3-D
volumes were treated (i.e., the target boundary was heated to
Tc ), and the ultrasound power and rotation rate were recorded.
In these simulations, the conditions expected when MRI is used
as the source of temperature feedback (i.e., temperature noise,
finite imaging time, and spatial resolution) were simulated. In
particular, a temperature uncertainty of 1 ◦ C, a sampling (i.e.
image acquisition) time of 5 s, and a spatial resolution of 1.14 ×
1.14 mm in plane, and 5-mm-slice thickness were assumed [31].
These are the parameters we have measured in human volunteers on a clinical MRI (data not shown). The simulation results
are shown for one patient; similar results were observed for the
other geometries.
The spatial heating pattern produced in planes centered at
each transducer element is depicted in Fig. 3 relative to the target boundary (solid black line). The results are only shown for
elements four and five of the ultrasound transducer represented
by E4, E5, respectively. It shows that both controllers work
equally well for thermal treatment. The dash red lines indicate
the boundaries at which the temperature reaches the desired
threshold (55 ◦ C). The white lines indicate the temperature of
42 ◦ C. The plus sign is the location of the applicator. The temperature scale is shown at the side. As seen from Fig. 3, it is
clear that the well-tuned constant gain PI controller performed
quite well under normal operating condition.
Next, we consider changes in the environment and the performance of the controllers under faulty operating conditions.
The spatial heating pattern produced in planes centered at each
transducer element is depicted in Fig. 4, relative to the target
boundary. As seen, under faulty operating condition, the performance of the constant PI controller degraded substantially;
however, the adaptive PI controller still worked well. This shows
that the adaptive PI controller can deal better with the dynamic
environment inherent in thermal therapy applications compared
to a constant gain PI controller. To have a better understanding
of how the controllers work, both rotation rate and the power
are also plotted for faulty operating condition. Fig. 5 shows the

916

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 3, MARCH 2014

Fig. 4. Pattern of conformal thermal heating for elements E4, E5 of ultrasound
transducer under faulty operating condition.

Fig. 6. Calculated power (control signal) required to treat a human prostate
boundary under faulty operating condition: (a) constant gain PI controller and
(b) adaptive PI controller.

Fig. 5. Rotation rate required to treat a human prostate boundary under faulty
operating condition: (a) constant gain PI controller and (b) adaptive PI controller.

rotation rate throughout a full treatment for constant gain PI
controller and adaptive PI controller. The adaptive PI controller
produces a faster rotation rate. The initial phase of zero rotation
corresponds to a period of stationary heating used to build up
the spatial heating pattern in the radial direction, followed by
a short period of rotation at maximum rotation rate. To have a
better view, we only show a close up between 90◦ and 225◦ for
rotation rate and power in this paper.
The power transmitted from one transducer element is plotted
in Fig. 6 for PI and adaptive PI controllers. In this case, the
adaptive PI produces more power compared to the constant gain
PI controller to compensate for increasing in perfusion value.
However, the power has the same trend for both controllers.
The gains for the adaptive PI controller for one element of the
transducer are depicted in Fig. 7. Note that the gains are time
varying as opposed to the constant gain PI controller.
Next, a more realistic scenario which can happen under clinical conditions is studied. First, a rectal cooling mechanism
is modeled to avoid thermal damage to rectum. Second, the
presence of pelvic bone is taken into account (refer to Fig. 8).
The attenuation value of the soft tissue and the pelvic bone is
chosen to be 5.76 and 250 Np/m/MHz, respectively. Third, a
time-varying blood perfusion is also considered. The perfusion

Fig. 7.

Gains of the adaptive controller.

Fig. 8. Segmentation of pelvic structures under clinical conditions from axial
MR images. 1. Transurethral device. 2. Prostate. 3. Rectum and rectal cooling
device. 4. Bones.

is assumed to change over time as a function of the temperature.
A typical profile for these changes has been studied in [32]. A
similar profile is considered in this paper (see Fig. 9).
For the simulation, a different patient is considered to show
the robustness of the controller when used on different patients.
The results of treatment are shown in Fig. 10. Only two elements
out of four elements are illustrated (E2, E3). The adaptive PI

GOHARRIZI et al.: A SELF-TUNING ADAPTIVE CONTROLLER FOR 3-D IMAGE-GUIDED ULTRASOUND CANCER THERAPY

917

Fig 11. Pattern of conformal thermal heating of ultrasound transducer in a
phantom-mimicking gel.
Fig. 9.

Time-varying perfusion.

VI. EXPERIMENTAL VALIDATION

Fig. 10. Pattern of conformal thermal heating for elements (E2, E3) of ultrasound transducer under clinical conditions.

controller produces noticeably better treatment accuracy. To facilitate comparison, the average of maximum error between the
treated boundary (red dash lines) and the targeted boundary
(solid black lines) is calculated over all slices for three different
patients.
The value is 2.28 and 5.4 mm for adaptive PI and constant gain
PI controllers, respectively. This further confirms that the adaptive PI controller has a better accuracy in treatment compared to
the constant gain PI controller. In terms of overall treatment time,
the constant gain PI controller takes 24 min to treat the whole
region but the adaptive PI controller takes only 17 min which
shows that the adaptive PI also has a faster treatment. Regarding
the bone heating, the adaptive PI controller produces more heat
at the bones surface compared to the constant gain PI controller.
This is due to the fact that, the adaptive PI compensates for less
under-treatment and this results in having more heat at the bones
surface. This increase in bone heating is a fundamental tradeoff
in this technology resulting from the desire to treat tissues to
the boundary of the prostate gland which necessitates longer
heating and lower frequencies, and the goal of reducing adverse
effects in surrounding tissues such as bones. This tradeoff has
been described in more detail by Burtnyk et al. [33]. We are
actively investigating control strategies and device designs that
can optimize the balance between these two goals. We would
point out, however, that if the constant gain PI controller was
tuned to achieve a better treatment of the target boundary, an
increase in the heating of nearby bones would also be observed.

To further show the effectiveness of the proposed adaptive
PI controller, an experimental study is conducted in a tissuemimicking gel phantom (Zerdine, CIRS Inc., VA, USA). A different prostate geometry is evaluated here to further demonstrate
the ability of the proposed controller to conform to anatomical
geometries. The UA is inserted into the phantom and attached
to the MRI-compatible rotary motor. More details about the experimental setup can be found in [19]. The results are shown in
Fig. 11. As seen, the proposed controller can still produce an
acceptable thermal treatment. In many clinical studies, it was
observed that the tumor is only located in a sector of the prostate.
Here, we only consider a sector treatment as opposed to a full
treatment in our simulation studies. Due to heat diffusion, some
overtreatments can be observed at sharp changes of the boundary. This represents another challenge in this application and
future work will focus on addressing this problem.
VII. CONCLUSION
In this study, we described a new adaptive algorithm capable
of controlling the 3-D spatial heating pattern from an interstitial ultrasound device which also has an automatic rotation
capability. The control of heat at the targeted boundary is a
MISO control problem. The inputs are power, rotation rate, and
the frequency of the applicator. These features make the control problem more challenging. Using the Lyapunov stability
analysis, an adaptive PI controller is developed to control the
ultrasound power. Furthermore, a simple but effective controller
is used to adjust the rotation rate of the applicator and relates it
to the error. The frequency of the applicator is switched between
two different values based on the radius of treatment. Similar to
a constant gain PI controller, the proposed controller requires
no detailed mathematical model of the tissue. It is simple to
implement, with a minimal increase in algorithm complexity.
Its advantages over a constant gain PI controller are that it gives
a better accuracy and speed in treatment, and is more robust in
a dynamically changing environment during treatment. Compared to a fixed gain controller, there is no need to find optimal
gains.
All of the mentioned properties were validated through a simulation platform developed in our group for interstitial thermal
therapy of prostate cancer. A clinically more realistic scenario
taking into account changes in blood perfusion, rectum cooling,
and attenuation due to pelvic bone is used to demonstrate the
effectiveness of the proposed adaptive controller. Finally, the

918

IEEE TRANSACTIONS ON BIOMEDICAL ENGINEERING, VOL. 61, NO. 3, MARCH 2014

performance of the proposed adaptive PI controller was experimentally tested in a tissue-mimicking gel phantom.
The usefulness of the proposed adaptive PI controller is much
broader than this application and can be applied in other areas.
Ongoing areas of investigation include incorporating additional
measured temperatures beyond the single temperature at the
boundary along the beam direction, and investigating methods
to incorporate normal tissue safety into the treatment strategy.
APPENDIX
After using the finite dimensional approximation for (1), and
assuming equal spacing in x-, y-, z- direction, i.e., Δx = Δy =
Δz = Δ [24], the matrices A and B are found to be
⎤
⎡
⎡
⎤
a11 a12 · · · a1n
Q1
⎥
⎢a
⎢Q ⎥
⎢ 21 a22 · · · a2n ⎥
2 ⎥
1 ⎢
⎥
⎢
⎢
⎥
, B=
A = ⎢ ..
..
.. ⎥
.
.
⎢
.
⎥
⎢ .
ρct ⎣ .. ⎥
.
.
.
⎦
⎦
⎣
an 1 an 2 · · · an n
Qn
n× 1

n× n

(15)
where n is the number of nodes. The diagonal elements of A
t
are ρc6kt Δt 2 + wρcb ct b . Other elements of A are either zero or ρckt Δ
2
depending on the interaction between nodes. Δ is the distance
between nodes and can be chosen to be 0.001 m. The matrix
C is the output matrix. Since at each time we are interested
in controlling the temperature at a single node located at the
boundary, the matrix C can be defined as


.
(16)
C = 0 0 0 ··· 1
1× n

The transfer function from the input power P to the temperature at the boundary Tr i is given by
G(s) =

Tr i (s)
= C(sI − A)−1 B
P (s)

(17)

where s represents the Laplace transform variable. For the design procedure, we assume that the system in (4) is SPR. If we
focus on a single node at radius 34 mm, G(s) is found to be
sufficiently well modeled by [19]
a
(18)
G(s) =
bs + 1
with a = 7.87, b = 208.7. A first-order transfer function of the
form (18) with a > 0, b > 0 is readily verified to be SPR.
For other radii, the above transfer function changes only in
gain and time constant. All such transfer functions are SPR.
This provides justification for our Lyapunov-based adaptive PI
control design.
REFERENCES
[1] D. F. Penson, M. S. Litwin, and N. K. Aaronson, “Health related quality
of life in men with prostate cancer,” J. Urol., vol. 169, pp. 1653–1661,
2003.
[2] C. McCann, J. C. Kumaradas, M. R. Gertner, S. R. Davidson,
A. M. Dolan, and M. D. Sherar, “Feasibility of salvage interstitial
microwave thermal therapy for prostate carcinoma following failed
brachytherapy: Studies in a tissue equivalent phantom,” Phys. Med. Biol.,
vol. 48, pp. 1041–1052, 2003.

[3] J. Trachtenberg, J. Chen, W. Kucharczyk, A. Toi, and C. Lancaster, “Microwave thermoablation for localized prostate cancer after failed radiation therapy: Role of neoadjuvant hormonal therapy,” Mol. Urol., vol. 3,
pp. 247–250, 1999.
[4] J. D. Poorter, C. D. Wagter, Y. D. Deene, C. Thomsen, F. Stahlberg, and
E. Achten, “Noninvasive MRI thermometry with the proton resonance
frequency (PRF) method: In vivo results in human muscles,” Magn. Reson.
Med., vol. 33, pp. 74–81, 1995.
[5] W. L. Lin, R. B. Roemer, and K. Hynynen, “The theoretical and experimental evaluation of a temperature controller for scanned focused ultrasound hyperthermia,” Int. J. Hypertherm., vol. 4, pp. 615–625, 1990.
[6] C. Mougenot, B. Quesson, B. D. De Senneville, P. L. de Oliveira,
S. Sprinkhuizen, J. Palussie‘re, N. Grenier, and C. T. W. Moonen,
“Three-dimensional spatial and temporal temperature control with MR
thermometry-guided focused ultrasound (MRgHIFU),” Mag. Resonance
Med., vol. 61, pp. 603–614, 2009.
[7] E. B. Hutchinson, M. Dahleh, and K. Hynynen, “The feasibility of MRI
feedback control for intercavitary phased array treatments,” Int. J. Hypertherm., vol. 11, pp. 39–56, 1998.
[8] D. Arora, M. Skliar, and R. B. Roemer, “Model predictive control of hyperthermia treatments,” IEEE Trans. Biomed. Eng., vol. 49, no. 7, pp. 629–
639, Jul. 2002.
[9] L. Sun, C. M. Collins, J. L. Schiano, M. B. Smith, and N. B. Smith, “Adaptive real time closed loop temperature control for ultrasound hyperthermia using magnetic resonance thermometry,” Mag. Res. Eng., vol. 27B,
pp. 51–63, 2005.
[10] S. A. Goss, R. L. Johnston, and F. Dunn, “Comprehensive compilation
of empirical ultrasonic properties of mammalian tissues,” J. Acoust. Soc.
Amer., vol. 64, pp. 423–457, 1978.
[11] C. Gabriel, S. Gabriel, and E. Corthout, “The dielectric properties of biological tissues. I. Literature survey,” Phys. Med. Biol., vol. 41, pp. 2231–
2249, 1996.
[12] A. M. Kinsey, C. J. Diederich, V. Rieke, W. H. Nau, K. B. Pauly,
D. Bouley, and G. Sommer, “Transurethral ultrasound applicators with
dynamic multi-sector control for prostate thermal therapy: In vivo evaluation under MR guidance,” Med. Phys., vol. 35, pp. 2081–2093, 2008.
[13] R. Chopra, M. Burtnyk, W. A. N’Djin, and M. Bronskill, “MRI-controlled
transurethral ultrasound therapy for localized prostate cancer,” Int. J. Hypertherm., vol. 26, pp. 804–821, 2010.
[14] A. B. Ross, C. J. Diederich, W. H. Nau, H. Gill, D. M. Bouley, B. Daniel,
V. Rieke, R. K. Butts, and G. Sommer, “Highly directional transurethral
ultrasound applicators with rotational control for MRI-guided prostatic
thermal therapy,” Phys. Med. Biol., vol. 49, pp. 189–204, 2004.
[15] C. Lafon, D. Melodelima, R. Salomir, and J. Y. Chapelon, “Interstitial
devices for minimally invasive thermal ablation by high-intensity ultrasound,” Int. J. Hyperthermia, vol. 23, pp. 153–163, 2007.
[16] R. Salomir, M. Rata, D. Cadis, L. Petrusca, V. Auboiroux, and F. Cotton,
“Endocavitary thermal therapy by MRI-guided phased-array contact ultrasound: Experimental and numerical studies on the multi-input single output PID temperature controller’s convergence and stability,” Med. Phys.,
vol. 36, pp. 4726–4741, 2009.
[17] R. Chopra, A. Colquhoun, M. Burtnyk, W. A. N’djin, I. Kobelevskiy,
A. Boyes, K. Siddiqui, H. Foster, L. Sugar, M. A. Haider, M. Bronskill,
and L. Klotz, “Preliminary clinical experience using MRI-controlled
transurethral ultrasound therapy for conformal treatment of prostate tissue,” Radiology, in press, 2012.
[18] R. Chopra, N. Baker, V. Choy, A. Boyes, K. Tang, D. Bradwell, and
M. J. Bronskill, “MRI-compatible transurethral ultrasound system for the
treatment of localized prostate cancer using rotational control,” Med.
Phys., vol. 35, pp. 1346–5137, 2008.
[19] A. Yazdanpanah Goharrizi, W. A. N’djin, R. Kwong, and R. Chopra,
“Development of a new control strategy for 3D MRI-controlled interstitial
ultrasound cancer therapy,” Med. Phys., vol. 40, pp. 33301–33313, 2013.
[20] R. Salomir, M. Rata, D. Cadis, L. Petrusca, V. Auboiroux, and F. Cotton,
“Endocavitary thermal therapy by MRI-guided phased-array contact ultrasound: Experimental and numerical studies on the multi-input singleoutput PID temperature controller’s convergence and stability,” Med.
Phys., vol. 36, pp. 4726–4741, 2009.
[21] A. Partanen, P. S. Yarmolenko, A. Viitala, S. Appanaboyina,
D. Haemmerich, A. Ranjan, G. Jacobs, D. Woods, J. Enholm, B. J. Wood,
and M. R. Dreher, “Mild hyperthermia with magnetic resonance-guided
high-intensity focused ultrasound for applications in drug delivery,” Int.
J. Hyperthermia, vol. 28, pp. 320–336, 2012.
[22] S. Hey, M. Ries, and C. Moonen, “Online temperature control of focused
ultrasound heating using an adaptive PID feedback loop,” in Proc. Int.
Soc. Mag. Reson. Med., 2011, vol. 19.

GOHARRIZI et al.: A SELF-TUNING ADAPTIVE CONTROLLER FOR 3-D IMAGE-GUIDED ULTRASOUND CANCER THERAPY

[23] H. H. Pennes, “Analysis of tissue and arterial blood temperature in the
resting human forearm,” J. Appl. Physiol., vol. 1, pp. 93–122, 1948.
[24] D. R. Croft and J. A. R. Stone, Heat Transfer Calculations Using Finite
Difference Equations. London, U.K.: Applied Science Publisher, 1997.
[25] R. Chopra, M. Burtnyk, M. A. Haider, and M. J. Bronskill, “Method
for MRI-guided conformal thermal therapy of prostate with planar
transurethral ultrasound heating applicators,” Phys. Med. Biol., vol. 50,
pp. 4957–4975, 2005.
[26] W. L. Nyborg, “Heat generation by ultrasound in a relaxing medium,” J.
Acoust. Soc. Amer., vol. 70, pp. 310–320, 1981.
[27] K. B. Ocheltree and L. A. Frizzell, “Sound field calculation for rectangular sources,” IEEE Trans. Ultrason. Ferroelec. Freq. Control., vol. 36,
pp. 242–248, 1989.
[28] H. K. Khalil, Nonlinear Systems. Englewood Cliffs, NJ, USA: PrenticeHall, 1996.
[29] Z. Iwai, I. Mizumoto, L. Liu, S. Shah, and H. Jiang, “Adaptive stable PID
controller with parallel feedforward compensator,” in Proc. 9th Int. Conf.
Control, Autom., Robot. Vis., 2006, pp. 1253–1258.
[30] W. A. N’djin, M. Burtnyk, M. Bronskill, and R. Chopra, “Investigation
of power and frequency for 3D conformal MRI-controlled transurethral
ultrasound therapy with a dual frequency multi-element transducer,” Int.
J. Hypertherm., vol. 28, pp. 87–104, 2012.
[31] E. Ramsay, C. Mougenot, M. Kohler, M. Bronskill, L. Klotz, M. Haider,
and R. Chopra, “Evaluation of PRFS MR Thermometry in the human
prostate gland at 3.0 T for transurethral ultrasound therapy,” in Proc.
ISMRM 20th Annu. Meeting, 2012.
[32] D. Fuentes, Y. Feng, A. Elliott, A. Shetty, R. J. McNichols, J. Tinsley
Oden, and R. J. Stafford, “Adaptive real-time Bioheat transfer models for
computer-driven MR-Guided laser induced thermal therapy,” IEEE Trans.
Bio. Med. Eng., vol. 57, no. 5, pp. 1024–1030, May 2010.
[33] M. Burtnyk, R. Chopra, and M. Bronskill, “Simulation study on the heating of the surrounding anatomy during transurethral ultrasound prostate
therapy: A 3D theoretical analysis of patient safety,” Med. Phys., vol. 37,
pp. 2862–2875, 2010.

Amin Y. Goharrizi (M’09) received the B.S. degree from the Amirkabir University of Technology,
Tehran, Iran, in 2003, the M.Sc. degree from K. N.
Toosi University, Tehran, Iran, in 2005, and the Ph.D.
degree from the University of Manitoba, Winnipeg,
MB, Canada.
He was a Postdoctoral fellow at the University
of Toronto, Toronto, ON, Canada. He is currently a
Research Engineer at Medmectron, Toronto. His research interests include fault detection, signal/image
processing, and control systems with application to
biomedical engineering.

919

Raymond H. Kwong (M’75–SM’08) received the
S.B., S.M. and Ph.D. degrees in electrical engineering from the Massachusetts Institute of Technology,
Cambridge, MA, USA, in 1971, 1972, and 1975, respectively.
From 1975 to 1977, he was a Visiting Assistant
Professor of electrical engineering at McGill University and a Research Associate at the Centre de
Recherches Mathematiques, Universite de Montreal,
Montreal, QC, Canada. Since August 1977, he has
been with the Edward S. Rogers Sr. Department of
Electrical and Computer Engineering, University of Toronto, Toronto, ON,
Canada, where he is currently a Professor. His current research interests include
estimation and stochastic control, adaptive signal processing and control, fault
diagnosis and fault-tolerant control, discrete event systems, and biomedical systems.

Rajiv Chopra received the Ph.D. degree in medical
biophysics from the University of Toronto, Toronto,
ON, Canada, in 2002.
From 2006 to 2012, he was a Scientist at Sunnybrook Research Institute, and an Assistant Professor
in the Department of Medical Biophysics, University
of Toronto, Toronto, ON, Canada, as an Assistant
Professor. Since 2012, he has been with the Department of Radiology, University of Texas Southwestern Medical Center, Dallas, TX, USA, where he is an
Associate Professor, and a CPRIT Scholar in Cancer
Research. His research interests include development of image-guided therapies.
In particular, he has focused on the biomedical applications of high-intensity
focused ultrasound (HIFU) for thermal therapy.

